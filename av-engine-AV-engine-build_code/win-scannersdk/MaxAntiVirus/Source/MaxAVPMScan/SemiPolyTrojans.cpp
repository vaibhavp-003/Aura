/*======================================================================================
FILE				: SemiPolyTrojans.cpp
ABSTRACT			: Part of AuAVPMScan.dll module.
DOCUMENTS			: 
AUTHOR				: Tushar Kadam + Virus Analysis Team
COMPANY				: Aura 
COPYRIGHT NOTICE	: (C) Aura
					Created as an unpublished copyright work.  All rights reserved.
					This document and the information it contains is confidential and
					proprietary to Aura.  Hence, it may not be 
					used, copied, reproduced, transmitted, or stored in any form or by any 
					means, electronic, recording, photocopying, mechanical or otherwise, 
					without the prior written permission of Aura
CREATION DATE		: 22 Apr 2011
NOTES				: This is detection module for malware using * base detection pattern.
					  Aho-corasick binary seraching is used to fasten the detection 
					  Boyer-moor algo is used for single pattern
					  It is the collection of different malwares for which we use Aho-corasick
					  Class is derived from CPolyBase Class
					  The repair action is : DELETE or REPAIR
VERSION HISTORY		: 
=====================================================================================*/
#include "SemiPolyTrojans.h"
#include "SemiPolyDBScn.h"
#include "MaxBMAlgo.h"
#define ENCODING (X509_ASN_ENCODING | PKCS_7_ASN_ENCODING)
/*-------------------------------------------------------------------------------------
	Function		: CSemiPolyTrojans
	In Parameters	: CMaxPEFile *pMaxPEFile
	Out Parameters	: 
	Purpose			: 
	Author			: Tushar Kadam
	Description		: Constructor for this class
--------------------------------------------------------------------------------------*/
CSemiPolyTrojans::CSemiPolyTrojans(CMaxPEFile *pMaxPEFile):
CPolyBase(pMaxPEFile)
{
	memset(&m_szSysDrive[0x00],0x00,sizeof(TCHAR) * MAX_PATH);
	int iRet = GetWindowsDirectory(&m_szSysDrive[0x00],MAX_PATH);
	if (iRet > 0x00)
	{
		m_szSysDrive[0x02] = '\0';
	}
	else
	{
		_tcscpy(m_szSysDrive,_T("c:"));
	}
}

/*-------------------------------------------------------------------------------------
	Function		: ~CSemiPolyTrojans
	In Parameters	:
	Out Parameters	: 
	Purpose			: 
	Author			: Tushar Kadam
	Description		: Destructor for this class
--------------------------------------------------------------------------------------*/
CSemiPolyTrojans::~CSemiPolyTrojans(void)
{
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function is main scanning handler for different types of Malwares.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVirus(void)
{
	typedef int (CSemiPolyTrojans::*LPFNDetectVirus)();	
	LPFNDetectVirus pVirusList[] = 
	{	
		//&CSemiPolyTrojans::DetectCertificate,
		&CSemiPolyTrojans::DetectTrojanCommon,
		/***************************************************************/
		//Add Latest Entries Here 
		&CSemiPolyTrojans::DetectBrontokN,
		&CSemiPolyTrojans::DetectBankerTricksterEKD,
		&CSemiPolyTrojans::DetectVBJW,
		&CSemiPolyTrojans::DetectVBM,
		&CSemiPolyTrojans::DetectVBKM,
		&CSemiPolyTrojans::DetectSmallX,
		&CSemiPolyTrojans::DetectTrojanSlugin,
		&CSemiPolyTrojans::DetectTrojanFsysna,
		&CSemiPolyTrojans::DetectChapakCNYR,
		&CSemiPolyTrojans::DetectLamerEL,
		&CSemiPolyTrojans::DetectMinerGen,
		&CSemiPolyTrojans::DetectDostreA,
		&CSemiPolyTrojans::DetectUpatreA,
		&CSemiPolyTrojans::DetectWormZafiB,
		&CSemiPolyTrojans::DetectMSILGEN,
		&CSemiPolyTrojans::DetectDownloaderNSISHafengen,
		&CSemiPolyTrojans::DetectGenericKDZ51306,
		&CSemiPolyTrojans::Detectcerbu25355,
		&CSemiPolyTrojans::DetectAgentdjcr,
		&CSemiPolyTrojans::DetectBackdoorPaddorGen,
		&CSemiPolyTrojans::DetectApplicationBundleiStartSurfAEO,
		&CSemiPolyTrojans::DetectWORMBAGLEZ,
		&CSemiPolyTrojans::DetectAdWareStartSurf,
		&CSemiPolyTrojans::DetectFearsoB,
		&CSemiPolyTrojans::DetectTrojanReconycFXMS,
		&CSemiPolyTrojans::DetectBankerEmotetSB,
		&CSemiPolyTrojans::DetectChapakBNBM,
		&CSemiPolyTrojans::DetectNakuraA,
		&CSemiPolyTrojans::DetectEmotetBankerGen,
		&CSemiPolyTrojans::DetectSalgoreaB,
		&CSemiPolyTrojans::DetectGenerickd,
		//&CSemiPolyTrojans::DetectDropperRSJ, // Commented as covered in DetectTrojanCommon
		&CSemiPolyTrojans::DetectCryptoLockerDY,
		&CSemiPolyTrojans::DetectPackedKrapO,
		&CSemiPolyTrojans::DetectAgentCP,
		&CSemiPolyTrojans::DetectGlomaruA,
		&CSemiPolyTrojans::DetectDownAdGazele,
		&CSemiPolyTrojans::DetectDropper,
		&CSemiPolyTrojans::DetectPackedKrapJC,
		&CSemiPolyTrojans::DetectBackGbotANWY,
		&CSemiPolyTrojans::DetectOnlineGames,
		&CSemiPolyTrojans::DetectStartSurfGEN,
		&CSemiPolyTrojans::DetectTrojanUrsu,
		&CSemiPolyTrojans::DetectRansomChapak,
		&CSemiPolyTrojans::DetectKryptikDL,
		&CSemiPolyTrojans::DetectBackdoorPliteBHSY,
		&CSemiPolyTrojans::DetectPackedCrapJD,
		&CSemiPolyTrojans::DetectTrojanClickerCNGJ,
		&CSemiPolyTrojans::DetectRansomGandCrab,
		&CSemiPolyTrojans::DetectRansomXorist,
		&CSemiPolyTrojans::DetectCrabRansomGandCryptGen,
		&CSemiPolyTrojans::DetectCosstaSHU,
		&CSemiPolyTrojans::DetectUpatreGen,
		//&CSemiPolyTrojans::DetectPondFullA, //Flase +ve : ming software file
		&CSemiPolyTrojans::DetectAdposhel_C,
		&CSemiPolyTrojans::DetectTrojRanBlockerKPUO,
		&CSemiPolyTrojans::DetectCrabRansomGandCryptJZ,
		&CSemiPolyTrojans::DetectPackedUpantrixGen,
		&CSemiPolyTrojans::DetectWormNgrbotDHX,
		&CSemiPolyTrojans::DetectPalevoHZDG,
		&CSemiPolyTrojans::DetectWormCAC,
		&CSemiPolyTrojans::DetectWindefAAQA,
		//&CSemiPolyTrojans::DetectDownloaderAgent,
		&CSemiPolyTrojans::DetectDownloadSponsorPE,
		&CSemiPolyTrojans::DetectAdwareAmontize,
		&CSemiPolyTrojans::DetectTrojanSelfDelesqg,
		&CSemiPolyTrojans::DetectTrojanSelfDeldpaj,
		&CSemiPolyTrojans::DetectTrojanScarOjsz,
		&CSemiPolyTrojans::DetectAdwareBrowsefox10,
		&CSemiPolyTrojans::DetectAdwareBrowsefoxFY,
		&CSemiPolyTrojans::DetectAdwareBrowsefoxGE,
		&CSemiPolyTrojans::DetectTrojanjpai,
		&CSemiPolyTrojans::DetectCrabRansom,
		//&CSemiPolyTrojans::DetectTrojanCurruptedFile,
		&CSemiPolyTrojans::DetectClickerGEN,
		&CSemiPolyTrojans::DetectIRCbotGEN,
		&CSemiPolyTrojans::DetectAgentSILTZR,
		&CSemiPolyTrojans::DetectSelfDelASBD,
		&CSemiPolyTrojans::DetectAdwareELEX,
		&CSemiPolyTrojans::DetectSpyQQLogger,
		&CSemiPolyTrojans::DetectDropperInjectotJKSA,
		&CSemiPolyTrojans::DetectMP3EXT,
		&CSemiPolyTrojans::DetectAdwareZugoO,
		&CSemiPolyTrojans::DetectTAgentIGRH,
		&CSemiPolyTrojans::DetectDLBoost,
		&CSemiPolyTrojans::DetectDropperTDSS,
		&CSemiPolyTrojans::DetectRazy,
		&CSemiPolyTrojans::DetectBublik,
		&CSemiPolyTrojans::DetectFenomenGame,
		&CSemiPolyTrojans::DetectAgentKDEA,
		&CSemiPolyTrojans::DetectLinkuryBD,
		&CSemiPolyTrojans::DetectMorstarAS,
		//&CSemiPolyTrojans::DetectOutBrowseBU,
		&CSemiPolyTrojans::DetectRootkitBSE,
		&CSemiPolyTrojans::DetectRootkitVkd,
		&CSemiPolyTrojans::DetectBadurJISX,
		&CSemiPolyTrojans::DetectCosmuDHRW,
		&CSemiPolyTrojans::DetectCryptEUQ,
		&CSemiPolyTrojans::DetectScarOetr,
		&CSemiPolyTrojans::DetectDownloaderAX,
		&CSemiPolyTrojans::DetectTrojRazy91846,
		&CSemiPolyTrojans::DetectDownDriverUpdAYVN,
		&CSemiPolyTrojans::DetectTrojRAZY71851,
		&CSemiPolyTrojans::DetectRansomeBlockerOOEW,
		&CSemiPolyTrojans::DetectdWbtlbrDownloaderPGA,
		//&CSemiPolyTrojans::DetectTrojanRazy9138,
		&CSemiPolyTrojans::DetectBankerSHIFU,
		&CSemiPolyTrojans::DetectTrojanDropperEB,
		&CSemiPolyTrojans::DetectVBZtl,
		/***************************************************************/
		&CSemiPolyTrojans::DetectScreensaver,
		&CSemiPolyTrojans::DetectTrojanScar,
		&CSemiPolyTrojans::DetectDelf,
		&CSemiPolyTrojans::DetectLLAC,
		&CSemiPolyTrojans::DetectStartPageM,
		&CSemiPolyTrojans::DetectRefroso,
		&CSemiPolyTrojans::DetectDybalom,
		&CSemiPolyTrojans::DetectSwisyn,
		&CSemiPolyTrojans::DetectArchSMS,
		&CSemiPolyTrojans::DetectAutoRun,
		&CSemiPolyTrojans::DetectKapucenB,
		&CSemiPolyTrojans::DetectSahatG,
		&CSemiPolyTrojans::DetectCinmus,
		&CSemiPolyTrojans::DetectRbotHyj,
		&CSemiPolyTrojans::DetectTentRootkit,
		&CSemiPolyTrojans::DetectSecurityShield,		
		&CSemiPolyTrojans::DetectHIGEN,
		&CSemiPolyTrojans::DetectTrojanBHO,
		&CSemiPolyTrojans::DetectiBryteX,
		&CSemiPolyTrojans::DetectProrat,
		&CSemiPolyTrojans::DetectAgentSdpu,
		//&CSemiPolyTrojans::DetectMultplugA,
		&CSemiPolyTrojans::DetectMSILPetunA,
		&CSemiPolyTrojans::DetectArtuaVladislav,
		&CSemiPolyTrojans::DetectAgentDywo,
		&CSemiPolyTrojans::DetectVBca,
		&CSemiPolyTrojans::DetectWormJuched,
		&CSemiPolyTrojans::DetectSmartFake,
		&CSemiPolyTrojans::DetectDownloaderGaur,
		&CSemiPolyTrojans::DetectEorezoGP,
		&CSemiPolyTrojans::DetectFujackAA,
		&CSemiPolyTrojans::DetectAgentBPXO,
		&CSemiPolyTrojans::DetectSpySCKeyLog,
		&CSemiPolyTrojans::DetectKoutodoorAIHC,
		&CSemiPolyTrojans::DetectTepfer,
		&CSemiPolyTrojans::DetectAvalod,
		&CSemiPolyTrojans::DetectJorikSkor,
		&CSemiPolyTrojans::DetectAgentGUPX,
		&CSemiPolyTrojans::DetectGameVance,
		&CSemiPolyTrojans::DetectClickRun,
		&CSemiPolyTrojans::DetectAgentBJEV,
		&CSemiPolyTrojans::DetectBHOBENF,
		&CSemiPolyTrojans::DetectAgentAirs,
		&CSemiPolyTrojans::DetectPWSOnlineGames,
		&CSemiPolyTrojans::DetectDropperDecayFVR,
		&CSemiPolyTrojans::DetectCodecPackAFBF,
		&CSemiPolyTrojans::DetectSmallBrus,
		&CSemiPolyTrojans::DetectSpyKeyloggerQZP,
		&CSemiPolyTrojans::DetectMahato,
		&CSemiPolyTrojans::DetectBackdoorRipinipOTB,
		&CSemiPolyTrojans::DetectZhelatinvg,
		&CSemiPolyTrojans::DetectDropperInegeryCQ,
		&CSemiPolyTrojans::DetectDarkComet,
		&CSemiPolyTrojans::DetectDialerSmallE,
		&CSemiPolyTrojans::DetectClickerAutoItO,
		&CSemiPolyTrojans::DetectAgentDJ,
		&CSemiPolyTrojans::DetectAdwareLook2MeAB,
		&CSemiPolyTrojans::DetectBackdoorAgentBULO,
		&CSemiPolyTrojans::DetectScarEXXU,
		&CSemiPolyTrojans::DetectBackdoorXtremeAZC,
		&CSemiPolyTrojans::DetectBackdoorVBLVN,
		&CSemiPolyTrojans::DetectAgentSXPQ,
		&CSemiPolyTrojans::DetectKillav,
		&CSemiPolyTrojans::DetectVBNA,
		&CSemiPolyTrojans::DetectArdamax,
		&CSemiPolyTrojans::DetectBrontok,
		&CSemiPolyTrojans::DetectPSWAccPhishEU,
		&CSemiPolyTrojans::DetectBackdoorAgentBYKX,
		&CSemiPolyTrojans::DetectMapler,
		&CSemiPolyTrojans::DetectDialerQN,
		&CSemiPolyTrojans::DetectBybz,
		&CSemiPolyTrojans::DetectPalevo,
		&CSemiPolyTrojans::DetectSmall_EDB,
		&CSemiPolyTrojans::DetectNrgBot,
		&CSemiPolyTrojans::DetectTrojanVBEZU,
		&CSemiPolyTrojans::DetectAgentEVQG,
		&CSemiPolyTrojans::DetectZopfodA,	
		&CSemiPolyTrojans::DetectLoadwar,
		&CSemiPolyTrojans::DetectBackdoorXtremeA,
		&CSemiPolyTrojans::DetectTrojanMicroFakeBA,
		&CSemiPolyTrojans::DetectAgentCbot,
		&CSemiPolyTrojans::DetectAdwareFlvTubeBT,
		&CSemiPolyTrojans::DetectBancos,
		&CSemiPolyTrojans::DetectPinballCorporation,
		&CSemiPolyTrojans::DetectIRCNite,
		&CSemiPolyTrojans::DetectFosniw,
		&CSemiPolyTrojans::DetectCodraEQM,
		&CSemiPolyTrojans::DetectAgentAJV,
		&CSemiPolyTrojans::DetectAzbregPYV,
		&CSemiPolyTrojans::DetectAdloadAQDQ,
		&CSemiPolyTrojans::DetectDownloaderAgentEDBQ,
		&CSemiPolyTrojans::DetectDropperAgentBCZN,
		&CSemiPolyTrojans::DetectKnigsfot,
		&CSemiPolyTrojans::DetectAgentAzCj,
		&CSemiPolyTrojans::DetectPlaygameA,
		&CSemiPolyTrojans::DetectAgentACW,
		&CSemiPolyTrojans::DetectTrojanAgent2LDT,
		&CSemiPolyTrojans::DetectBeastdoorL,
		&CSemiPolyTrojans::DetectBinderRz,
		&CSemiPolyTrojans::DetectDipleDmqa,
		&CSemiPolyTrojans::DetectFraudPackCpMz,
		&CSemiPolyTrojans::DetectNilageBXY,
		&CSemiPolyTrojans::DetectDropAgentAyqa,
		&CSemiPolyTrojans::DetectAgentLTA,
		&CSemiPolyTrojans::DetectGamupFR,
		&CSemiPolyTrojans::DetectPakesTyi,
		&CSemiPolyTrojans::DetectRansomBlockerJGB,
		&CSemiPolyTrojans::DetectIRCNiteCBV,
		&CSemiPolyTrojans::DetectScarEAML,
		&CSemiPolyTrojans::DetectDrpAgentEMLQ,
		&CSemiPolyTrojans::DetectBackDooorCZP,
		&CSemiPolyTrojans::DetectStudALB,
		&CSemiPolyTrojans::DetectDownloaderAndromedaEBJ,
		&CSemiPolyTrojans::DetectClickerCyclerAJSZ,
		&CSemiPolyTrojans::DetectJorikVobfusCqaz,
		&CSemiPolyTrojans::DetectAutorunCxps,
		&CSemiPolyTrojans::DetectAgentRzr,
		&CSemiPolyTrojans::DetectGameThiefMaganiaBIHT,
		&CSemiPolyTrojans::DetectDeeceeG,
		&CSemiPolyTrojans::DetectTrojanMalwareBSM,
		&CSemiPolyTrojans::DetectUrelas,
		&CSemiPolyTrojans::DetectCoolMirageLtd,
		&CSemiPolyTrojans::DetectIRCmirc603,
		&CSemiPolyTrojans::DetectQhostsAF,
		&CSemiPolyTrojans::DetectQhost,
		&CSemiPolyTrojans::DetectAirInstaller,
		&CSemiPolyTrojans::DetectDebris,
		&CSemiPolyTrojans::Detect4Shared,
		&CSemiPolyTrojans::DetectDelfDuy,
		&CSemiPolyTrojans::DetectDropperMetalA,
		&CSemiPolyTrojans::DetectWormBundpil,
		&CSemiPolyTrojans::DetectSinowalORC,
		&CSemiPolyTrojans::DetectWormBenjaminA,
		&CSemiPolyTrojans::DetectBackdoorDonbotB,
		&CSemiPolyTrojans::DetectBackdoorAgentUEK,
		&CSemiPolyTrojans::DetectBackdoorFinloskyB,
		&CSemiPolyTrojans::DetectChydoAXA,
		&CSemiPolyTrojans::DetectPalevoCqmm,
		&CSemiPolyTrojans::DetectDownloaderLMN,
		&CSemiPolyTrojans::DetectInstallBrain,
		&CSemiPolyTrojans::DetectAdloadU,
		&CSemiPolyTrojans::DetectObfuscatedFEQ,
		&CSemiPolyTrojans::DetectDragonMess,
		&CSemiPolyTrojans::DetectWinper,
		&CSemiPolyTrojans::DetectInjectZZX,
		&CSemiPolyTrojans::DetectWebtoolbarMyWebSearch,
		&CSemiPolyTrojans::DetectJorikFareitQsy,
		&CSemiPolyTrojans::DetectJorikWanbagEM,
		&CSemiPolyTrojans::DetectVBAso,
		&CSemiPolyTrojans::DetectQukartGen,
		&CSemiPolyTrojans::DetectHotKeyHook,
		&CSemiPolyTrojans::DetectPowpGen,
		//&CSemiPolyTrojans::DetectGameThiefLmirWJ,
		&CSemiPolyTrojans::DetectPePatchedLX,
		&CSemiPolyTrojans::DetectAgentSn,
		&CSemiPolyTrojans::DetectTrojanFakeAVASBH,
		&CSemiPolyTrojans::DetectPSWLdPinchDLT,
		&CSemiPolyTrojans::DetectPSWOnLineGamesGen,
		&CSemiPolyTrojans::DetectIndirectA,
		&CSemiPolyTrojans::DetectMegaSearch,
		&CSemiPolyTrojans::DetectAgentFO,
		&CSemiPolyTrojans::DetectAgentAYUW,
		&CSemiPolyTrojans::DetectIRCBotAerz,
		&CSemiPolyTrojans::DetectInjectorHXBU,
		&CSemiPolyTrojans::DetectDangloKT,
		&CSemiPolyTrojans::DetectDomaIQ,
		&CSemiPolyTrojans::DecteAgentAl,
		&CSemiPolyTrojans::DetectDownloadSponsor,
		&CSemiPolyTrojans::DetectDdoxCJN,
		&CSemiPolyTrojans::DetectAbuseMx,
		&CSemiPolyTrojans::DetectKeyLogger,
		&CSemiPolyTrojans::DetectLolipop,
		&CSemiPolyTrojans::DetectVanBot,
		&CSemiPolyTrojans::DetectWebprefixApj,
		&CSemiPolyTrojans::DetectStagetEg,
		&CSemiPolyTrojans::DetectBanker,
		&CSemiPolyTrojans::DetectSmallo,
		&CSemiPolyTrojans::DetectZenoSearch,
		&CSemiPolyTrojans::DetectOficla,
		&CSemiPolyTrojans::DetectSocks,
		&CSemiPolyTrojans::DetectTrojanBuzus,
		&CSemiPolyTrojans::DetectAgentBcw,
		&CSemiPolyTrojans::DetectBlueHeaven,
		&CSemiPolyTrojans::DetectAgentdele,
		&CSemiPolyTrojans::DetectClickerAgent,
		&CSemiPolyTrojans::DetectDownloaderCeed,
		&CSemiPolyTrojans::DetectReconycBvep,
		&CSemiPolyTrojans::DetectHacktoolAgentape,
		&CSemiPolyTrojans::DetectBuzusFvjf,
		&CSemiPolyTrojans::DetectInjectorHxth,
		&CSemiPolyTrojans::DetectDownloaderMorstarAs,
		&CSemiPolyTrojans::DetectDropperhkve,
		&CSemiPolyTrojans::DetectMultiplagB,
		&CSemiPolyTrojans::DetectAgenthedm,
		&CSemiPolyTrojans::DetectJuchedPgy,
		&CSemiPolyTrojans::DetectYotoonBFM,
		&CSemiPolyTrojans::DetectChydoCCQ,
		&CSemiPolyTrojans::DetectAirAdInstallerGacx,
		&CSemiPolyTrojans::DetectGenomeAdbwg,
		&CSemiPolyTrojans::DetectMultiPlugL,
		&CSemiPolyTrojans::DetectAgentahruw,
		&CSemiPolyTrojans::DetectBadurjukw,
		&CSemiPolyTrojans::DetectDropperSmall,
		&CSemiPolyTrojans::DetectMultiPlugNbld,
		&CSemiPolyTrojans::DetectLollipopMv,
		&CSemiPolyTrojans::DetectDelfgk,
		&CSemiPolyTrojans::DetectWenper,
		&CSemiPolyTrojans::DetectSmartInstallerA,
		&CSemiPolyTrojans::DetectClickerKuk,
		&CSemiPolyTrojans::DetectLolbot,
		&CSemiPolyTrojans::DetectDorifel,
		&CSemiPolyTrojans::DetectAgentJKOA,
		&CSemiPolyTrojans::DetectTenta,
		&CSemiPolyTrojans::DetectBackdoorZegostAIKW,
		&CSemiPolyTrojans::DetectPlocustJCMB,
		&CSemiPolyTrojans::DetectDomaIQBtzf,
		&CSemiPolyTrojans::DetectLMNMldc,
		&CSemiPolyTrojans::DetectFareitApfz,
		&CSemiPolyTrojans::DetectKranetC,
		&CSemiPolyTrojans::DetectBagleAf,
		&CSemiPolyTrojans::DetectBdmj,
		&CSemiPolyTrojans::DetectPlocust,
		&CSemiPolyTrojans::DetectAutoRunBANT,
		&CSemiPolyTrojans::DetectCryptPIA,
		&CSemiPolyTrojans::DetectLinkuryA,
		&CSemiPolyTrojans::DetectScarEXWW,
		&CSemiPolyTrojans::DetectMydoomM,
		&CSemiPolyTrojans::DetectSelfDeltke,
		&CSemiPolyTrojans::DetectIbryteJhl,
		&CSemiPolyTrojans::DetectCosmuCbyn,
		&CSemiPolyTrojans::DetectZusy,
		&CSemiPolyTrojans::DetectClickerSmallAK,
		&CSemiPolyTrojans::DetectDroppernekl,
		&CSemiPolyTrojans::DetectNvxg,
		&CSemiPolyTrojans::DetectHedxp,
		&CSemiPolyTrojans::DetectBrainInst,
		&CSemiPolyTrojans::DetectShipupBoe,
		&CSemiPolyTrojans::DetectAgentN,
		&CSemiPolyTrojans::DetectLargeFiles,
		&CSemiPolyTrojans::DetectAgentUWUE,
		&CSemiPolyTrojans::DetectDriverUPD,
		&CSemiPolyTrojans::DetectRansomBlockerMGN,
		&CSemiPolyTrojans::DetectMydoomL,
		&CSemiPolyTrojans::DetectRansomBlockerGFEQ,
		&CSemiPolyTrojans::DetectFiseriaHV,
		&CSemiPolyTrojans::DetectYotoonSZT,
		&CSemiPolyTrojans::DetectDapatoEdqu,
		&CSemiPolyTrojans::DetectBaduramrst,
		&CSemiPolyTrojans::DetectAgentXknn,
		&CSemiPolyTrojans::DetectAgentUggl,
		&CSemiPolyTrojans::DetectPlocustFzpb,
		&CSemiPolyTrojans::DetectPlocustGlbw,
		&CSemiPolyTrojans::DetectPlocustGmby,
		&CSemiPolyTrojans::DetectDriverUpd,
		&CSemiPolyTrojans::DetectBackdoorZepfod,
		//&CSemiPolyTrojans::DetectWormSohanad, // False (+)ve
		&CSemiPolyTrojans::DetectScarOich,
		&CSemiPolyTrojans::DetectPliteBhst,
		&CSemiPolyTrojans::DetectWecodAll,
		&CSemiPolyTrojans::DetectZepfodYY,
		&CSemiPolyTrojans::DetectUpatreDmid,
		&CSemiPolyTrojans::DetectUpatre,
		&CSemiPolyTrojans::DetectSmallCpl,
		&CSemiPolyTrojans::DetectArdurkG,
		&CSemiPolyTrojans::DetectUpatreSby,
		&CSemiPolyTrojans::DetectJSMultiplugP,
		&CSemiPolyTrojans::DetectInjectUezn,
		&CSemiPolyTrojans::DetectRootkitegxj,
		&CSemiPolyTrojans::DetectTrojanAcqad,
		&CSemiPolyTrojans::DetectSoftplusXsw,
		&CSemiPolyTrojans::DetectDownBVTD,
		//&CSemiPolyTrojans::DetectDownHFDG,
		&CSemiPolyTrojans::DetectWormBloored,
		&CSemiPolyTrojans::DetectAgentB,
		&CSemiPolyTrojans::DetectUpatreBkvd,
		&CSemiPolyTrojans::DetectAdLoadGen,
		&CSemiPolyTrojans::DetectShizEuxx,
		&CSemiPolyTrojans::DetectImaliC,
		&CSemiPolyTrojans::DetectDownloadmin,
		&CSemiPolyTrojans::DetectMorstarEWI,
		&CSemiPolyTrojans::DetectWormNgrbotOu,
		&CSemiPolyTrojans::DetectCabresA,
		&CSemiPolyTrojans::DetectWebToolbarLinkury,
		&CSemiPolyTrojans::DetectAdwAgentJTVG,
		&CSemiPolyTrojans::DetectDownMorstarBFT,
		&CSemiPolyTrojans::DetectDownLmnAEV,
		&CSemiPolyTrojans::DetectVbCUVT,
		&CSemiPolyTrojans::DetectCosmuAIGH,
		&CSemiPolyTrojans::DetectScarOetk,
		&CSemiPolyTrojans::DetectWebToolbarCossder,
		//&CSemiPolyTrojans::DetectBackdoorSena, //Remove 03-09-2021
		&CSemiPolyTrojans::DetectInjectAfhey
		//&CSemiPolyTrojans::DetectTrojGenB //Removed because of False (+)ve : Swapnil Sanghai
	};

	int iRetStatus = VIRUS_NOT_FOUND;
	for(int i = 0; i < _countof(pVirusList); i++)
	{
		iRetStatus = (this->*(pVirusList[i]))();
		if(iRetStatus)
		{					
			return iRetStatus;
		}
	}	

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPSWOnLineGamesGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of OnLineGames Family
					  PSW.OnLineGames.taue, .tatl
		   			  PSW.OnLineGames.tatz, 		[Alisha]
					  GameThief.OnLineGames.ajoin	[Alisha]
						A. Installation:	
							- All are DLLS
						B. File Modification 
							- none
						C. Registry Modifications:
							- none
						Covered trojans : 
								PSW.OnLineGames.at, .tavh, .tawl, .taue
								GameThief.OnLineGames.ajoio, .ajoim, .ajnpw, .ajrfn, .boke
						Intention  : 1. CLSID
						Detection  : 100%
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPSWOnLineGamesGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL || m_pMaxPEFile->m_bIsVBFile == true)
		return iRetStatus;

	if(m_wAEPSec != 0)
		return iRetStatus;

	if(m_pMaxPEFile->GetSectionNoFromOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress) == 0)
		return iRetStatus;

	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x2].Size == 0)
		return iRetStatus;
	
	//----------------Detection-------------------
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int	ONLINEGAMES_BUFF_SIZE = 0xB0;
	m_pbyBuff = new BYTE[ONLINEGAMES_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	LPCTSTR dwNameID = (_T("REGISTRY"));
	DWORD dwLang = 0x65 , dwLangID = 0x409, dwSize = 0x0, dwReadOff = 0x0;
	if(FindRes(dwNameID, LPCTSTR(&dwLang), LPCTSTR(&dwLangID), dwReadOff, dwSize)== 0)
		return iRetStatus;

	if(!m_pMaxPEFile->Rva2FileOffset(dwReadOff, &dwReadOff))
		return iRetStatus;

	if(!GetBuffer(dwReadOff + (dwSize - 0xA0),ONLINEGAMES_BUFF_SIZE,ONLINEGAMES_BUFF_SIZE))
		return iRetStatus;

	CSemiPolyDBScn	polydbObj;
	TCHAR			szVirusName[MAX_PATH] = {0};
	LPCTSTR	szOnLineGames = (_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654"));
	polydbObj.LoadSigDBEx(szOnLineGames, _T("PSW.OnLineGames.gen"), FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], ONLINEGAMES_BUFF_SIZE, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectOnlineGames
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Prajakta + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients of OnlineGames Family
						Trojan-Poly.Worm.OnlineGames(A,EA,EC)
						Trojan-GameThief.OnLineGames(xich)
						Trojan-GameThief.OnLineGames(ajrwk)
						Trojan-GameThief.OnLineGames(ajoio)
						Trojan-GameThief.OnLineGames(bngp,ajoim,ajnpw)
						Trojan.GameThief.OnLineGames.bomb
						Trojan.GameThief.OnlineGames.ajlgt
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectOnlineGames(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;
	WORD	wInSec = 0x00;
	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int ONLINEGAME_BUFF_SIZE = 0x1000;
	m_pbyBuff = new BYTE[ONLINEGAME_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	//GameThief.OnlineGames.ajlgt,ajllp,boju,ajloi,bojg,ajmbv,bokg,ajlto,ajoyj,ajqto,ajorv,ajrfa,ajptf,PSW.OnLineGames.au,PSW.OnLineGames.swgp
	if((m_wAEPSec == 0x0 || m_wAEPSec == 0x1)&& ((memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".yata", 5) == 0) ||
		(memcmp(&(m_pSectionHeader[m_wAEPSec + 1].Name[0x1]), "tata", 4) == 0) ||
		(memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".wata", 5) == 0) ||
		(memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".pata", 5) == 0) ||
		(memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".1dsa", 5) == 0) || //ADDED
		(memcmp(m_pSectionHeader[m_wAEPSec + 3].Name, ".uata", 5) == 0) ||  //ADDED
		(memcmp(m_pSectionHeader[m_wAEPSec + 3].Name, ".pata", 5) == 0) ||//ADDED
		(memcmp(m_pSectionHeader[m_wAEPSec + 3].Name, ".1ata", 5) == 0) ||//ADDED
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)) &&
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		DWORD dwBuffSize = 0x0;
		DWORD dwBuffStart= 0x0;
		if(((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5 || m_wNoOfSections == 0x7 || m_wNoOfSections == 0x8) &&  //ADDED
			(m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x38E0 || 
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x3CF0 ||
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x30C0 ||
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0xD000 ||
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x4100 || //ADDED
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x0104 || //ADDED
			m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == m_pSectionHeader[m_wAEPSec].SizeOfRawData)) ||
			((m_wNoOfSections == 0x7 || m_wNoOfSections == 0x6 || m_wNoOfSections == 0x8) 
			&& (m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x4920 ||
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x4510 ||
			m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x4D30)))
		{
			dwBuffStart = m_pSectionHeader[0x0].PointerToRawData + 0x310;
			dwBuffSize = 0x7A0;
		}
		else if(m_wNoOfSections == 0xF && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x34D0)
		{
			dwBuffStart = m_pSectionHeader[0x0].PointerToRawData + 0x320;
			dwBuffSize = 0xFB5;
		}
		else if(m_wNoOfSections == 0x7 && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x2CB0) 
		{
			dwBuffSize = 0x15E;
			dwBuffStart = 0x6AB4; 
		}
		else if(m_wNoOfSections == 0xB && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x2CB0)// added
		{
			dwBuffSize = 0x69;
			dwBuffStart = 0x1770; 
		}
		else if(m_wNoOfSections == 0x4 && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x2CB0)// added
		{
			dwBuffSize = 0x4E6;
			dwBuffStart = 0x6C0; 
		}//added By Swapnil
		else if(m_wNoOfSections == 0x8 && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x104)// added
		{
			dwBuffSize = 0x4F0;
			dwBuffStart = 0x740; 
		}//added By SNEHA
		else if(m_wNoOfSections == 0x7 && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize == 0x1EB8)// added
		{
			dwBuffSize = 0x4F0;
			dwBuffStart = 0x1F130; 
		}//added By SNEHA
		else if((m_wNoOfSections == 0x9 || m_wNoOfSections== 0x07) && (m_dwAEPMapped & 0xFF000) == 0x15000)// added
		{
			dwBuffSize = 0x600;
			dwBuffStart = m_pSectionHeader[0x2].PointerToRawData; 
		}//added By SNEHA


		//if(!GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x320,dwBuffSize,dwBuffSize))//REMOVE
		//{
		//	return iRetStatus;
		//}
		if(!GetBuffer(dwBuffStart,dwBuffSize,dwBuffSize)) //added
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szGameThiefOnlineGamesAJLGT[] = {_T("44756E67656F6E20262046696768746572*6B65696D6967666F7540686F746D61696C2E636F6D*47616D654C61756E6368*6D61706C6573746F72792E657865")};
		//Dungeon & Fighter*keimigfou@hotmail.com*GameLaunch*maplestory.exe
		TCHAR	szGameThiefOnlineGamesAJRTA[] = {_T("44756E67656F6E20262046696768746572*6B65696D6967666F7540686F746D61696C2E636F6D*47616D654C61756E6368*6D61706C6573746F72792E657865")};
		//Dungeon & Fighter*keimigfou@hotmail.com*GameLaunch*maplestory.exe
		TCHAR	szGameThiefOnlineGamesBOJG[] = {_T("44756E67656F6E20262046696768746572*636A666965666A69656A6640686F746D61696C2E636F6D*47616D654C61756E6368696E6700006D61706C6573746F72792E657865")};
		//Dungeon & Fighter*cjfiefjiejf@hotmail.com*GameLaunching..maplestory.exe
		TCHAR	szGameThiefOnlineGamesARBO[] = {_T("4D61706C6553746F7279*5C646F69742E726172*7968737973")};
		//MapleStory*\doit.rar*yhsys
		TCHAR	szGameThiefOnlineGamesBOMB[] = {_T("4D61706C6553746F7279*7968737973*5C646F69742E726172")};//added
		//MapleStory*yhsys*\doit.rar

		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesAJLGT, _T("Trojan.GameThief.OnlineGames.ajlgt"),TRUE);
		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesAJRTA, _T("Trojan.GameThief.OnlineGames.AJRTA"),TRUE);
		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesBOJG, _T("Trojan.GameThief.OnlineGames.bojg"),TRUE);
		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesARBO, _T("Trojan.GameThief.OnlineGames.arbo"),TRUE);//added
		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesBOMB, _T("Trojan.GameThief.OnlineGames.bomb"),FALSE);//added

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	//GameThief.OnlineGames.bngp, ajrwk, GameThief.Ferthoq.fifu
	 if(m_wAEPSec == 0x0 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL &&
		(((memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, "mysechx", 5) == 0) && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x431A && m_wNoOfSections == 0x6 && m_dwAEPUnmapped == 0x14A5) 
		|| (m_wNoOfSections == 0x5 && (m_dwAEPUnmapped == 0x6338 || m_dwAEPUnmapped == 0x6378) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5600 &&
		(memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name,"Shared",6)== 0) && m_pSectionHeader[m_wAEPSec + 0x3].SizeOfRawData == 0x200)
		|| ((m_dwAEPUnmapped == 0x3241 || m_dwAEPUnmapped == 0x125CE || m_dwAEPUnmapped ==0x10630) && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2330 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x44000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x4A000)
		&& (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x3))))
	{
		const BYTE ONLINEGAMESBNGP_SIG1[] = {0x69,0x6D,0x65,0x68,0x6F,0x73,0x74,0x2E,0x64,0x6C,0x6C}; //imehost.dll
		const BYTE ONLINEGAMESBNGP_SIG2[] = {0x69,0x6D,0x65,0x68,0x6F,0x73,0x74,0x2E,0x69,0x6D,0x65}; //imehost.ime
		const BYTE ONLINEGAMESBNGP_SIG3[] = {0x44,0x4C,0x4C,0x49,0x53,0x55,0x49}; //DLLISUI
		const BYTE FRETHOQFIFU_SIG[]	  = {0x47,0x61,0x6D,0x65,0x44,0x6C,0x6C,0x2E,0x64,0x6C,0x6C};//GameDll.dll
		
		if((m_dwAEPUnmapped == 0x6338 || m_dwAEPUnmapped == 0x6378) && (memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name,"Shared",6)== 0))
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0x1800,0x70,0x70))
			{
				return iRetStatus;
			}
			TCHAR szVirusName[MAX_PATH] = {0};
			TCHAR szONLINEGAMESAJRWK[] ={_T("576F726C64206F66205761726372616674*5A315A325A330000776F772E6578650062667363616E0000426967466F6F742E65786500576F772E657865")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(szONLINEGAMESAJRWK, _T("Trojan.GameThief.OnlineGames.ajrwk"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					iRetStatus = VIRUS_FILE_DELETE;
				}
			}
		}
		DWORD dwDllNameOff = 0x0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].VirtualAddress, &dwDllNameOff))
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(&dwDllNameOff, dwDllNameOff + 0xC, 0x04, 0x04))
			return iRetStatus;

		if((OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDllNameOff, &dwDllNameOff)) || dwDllNameOff == 0x0)
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(m_pbyBuff, dwDllNameOff, 0x30, 0x30))
			return iRetStatus;

		if(memcmp(&m_pbyBuff[0x0], ONLINEGAMESBNGP_SIG1, sizeof(ONLINEGAMESBNGP_SIG1))== 0 || 
			memcmp(&m_pbyBuff[0x0], ONLINEGAMESBNGP_SIG2, sizeof(ONLINEGAMESBNGP_SIG2))== 0 ||
			memcmp(&m_pbyBuff[0x0], FRETHOQFIFU_SIG, sizeof(FRETHOQFIFU_SIG))== 0)
		{
			if(m_dwAEPUnmapped == 0x14A5)
			{
				if(!GetBuffer(m_pSectionHeader[0x2].PointerToRawData + 0x44,sizeof(ONLINEGAMESBNGP_SIG3),sizeof(ONLINEGAMESBNGP_SIG3)))
				{
					return iRetStatus;
				}
				if(memcmp(&m_pbyBuff[0x0], ONLINEGAMESBNGP_SIG3, sizeof(ONLINEGAMESBNGP_SIG3))== 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GameThief.OnlineGames.bngp"));
					return VIRUS_FILE_DELETE;
				}
			}
			else if(m_dwAEPUnmapped == 0x3241)
			{
				if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData,0x350,0x350))
				{
					return iRetStatus;
				}
				TCHAR szVirusName[MAX_PATH] = {0};
				TCHAR szGAMETHIEFFRETHOQFIFU[] ={_T("69006D006100670065002F006A007000650067*3764396362333130343834*504F5354000000002E6A7067000000005C00000041434400CDBCC6ACBACD*636C69656E742E657865")};
				CSemiPolyDBScn polydbObj;
				polydbObj.LoadSigDBEx(szGAMETHIEFFRETHOQFIFU, _T("Trojan.GameThief.Ferthoq.fifu"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						iRetStatus = VIRUS_FILE_DELETE;
					}
				}
			}
		}
	 }
	//GameThief.OnLineGames.tcnt
	else if((m_wAEPSec == 0x0 && ((m_dwAEPUnmapped & 0xFF0F) == 0x1806 || (m_dwAEPUnmapped & 0xFF0F) == 0x1706) 
		&& (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4)) || 
		((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL &&	
		m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && ((m_dwAEPUnmapped & 0xF000) == 0x2000 || (m_dwAEPUnmapped & 0xF000) == 0x3000) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000)))
	{
		DWORD dwXORKey = 0xA5,dwCallOffset = 0x0,dwDecOff = 0x0,dwCallData = 0x0;
		if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		{
			DWORD dwCallCnt = 0x0,dwNxtCallCnt = 0x0;
			bool flag = false;
			if(GetPatchedCalls(m_dwAEPMapped,m_dwAEPMapped + 0x50,m_wAEPSec))
			{
				LPVOID lpPos = m_arrPatchedCallOffsets.GetHighest();
				while(lpPos)
				{
					m_arrPatchedCallOffsets.GetKey(lpPos, dwCallOffset);
					dwCallCnt++;
					if(dwCallCnt == 0x2)
					{
						if(GetPatchedCalls(dwCallOffset,dwCallOffset + 0x185,m_wAEPSec))
						{
							LPVOID lpPos = m_arrPatchedCallOffsets.GetFirst();
							while(lpPos)
							{
								m_arrPatchedCallOffsets.GetKey(lpPos, dwCallOffset);
								m_arrPatchedCallOffsets.GetData(lpPos, dwCallData);
								dwNxtCallCnt++;
								if(dwNxtCallCnt == 0x3)
								{
									flag = true;
									break;
								}
								lpPos = m_arrPatchedCallOffsets.GetNext(lpPos);
							}
						}
					}
					if(flag == true)
						break;
					lpPos = m_arrPatchedCallOffsets.GetHighestNext(lpPos);
				}
			}
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwCallOffset,&dwCallOffset))
			{
				return iRetStatus;
			}
			if(m_pMaxPEFile->ReadBuffer(&dwDecOff,dwCallData - 0x5,sizeof(DWORD),sizeof(DWORD)))
			{
				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDecOff - m_dwImageBase,&dwDecOff))
				{
					return iRetStatus;
				}
			}
			if(GetBuffer(dwCallOffset,0x200,0x200))
			{
				DWORD		dwLength = 0, dwOffset=0, dwMatchedInstr = 0;
				t_disasm	da;
				char * cRegisterSearch = NULL;
				char cXORReg1[0x20]={0},cXORReg2[0x20]={0};

				while(dwOffset < 0x200)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);	

					if(dwMatchedInstr == 0 && dwLength == 2 && strstr(da.result, "JMP"))
					{
						dwOffset = m_pbyBuff[dwOffset + 1] +  dwOffset;
						dwMatchedInstr++;
					}
					else if(dwMatchedInstr == 1 && (dwLength == 3 && strstr(da.result, "XOR DL,A5")) || 
						(dwLength == 4 && strstr(da.result, "XOR BYTE PTR [E")))
					{
						if(da.immconst == 0xA5)
						{
							if(m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x200],dwDecOff,0x20,0x20))
							{
								for(DWORD i = 0x0; i < 0x20; i++)
								{
									m_pbyBuff[i + 0x200] ^= dwXORKey;
								}
							}
							dwMatchedInstr++;
							if(dwLength == 0x4)
							{
								cRegisterSearch = strchr(da.result,'+');
								cRegisterSearch += 0x01;
								memset(&cRegisterSearch[3],0,1);
								sprintf_s(cXORReg2,0x20,"INC %s",cRegisterSearch);
								cRegisterSearch -= 0x04;
								memset(&cRegisterSearch[3],0,1);
								sprintf_s(cXORReg1,0x20,"INC %s",cRegisterSearch);
							}
						}


					}
					else if(dwMatchedInstr == 2 && dwLength == 1 && (strstr(da.result, "INC ECX") || strstr(da.result, cXORReg1) || strstr(da.result, cXORReg2)))
					{
						const BYTE bEXEChk[] = {0x2E,0x65,0x78,0x65};
						const BYTE bDATChk[] = {0x2E,0x64,0x61,0x74};
						const BYTE bDLLChk[] = {0x2E,0x64,0x6C,0x6C}; 
						const BYTE bMODChk[] = {0x2E,0x6D,0x6F,0x64};
						const BYTE bMPRChk[] = {0x2E,0x6D,0x70,0x72};
						for(DWORD i = 0x200; i < 0x220 ; i++)
						{
							if(memcmp(&m_pbyBuff[i],&bEXEChk,sizeof(bEXEChk)) == 0 || 
								memcmp(&m_pbyBuff[i],&bDATChk,sizeof(bDATChk)) == 0 ||
								memcmp(&m_pbyBuff[i],&bDLLChk,sizeof(bDLLChk)) == 0 ||
								memcmp(&m_pbyBuff[i],&bMODChk,sizeof(bMODChk)) == 0 ||
								memcmp(&m_pbyBuff[i],&bMPRChk,sizeof(bMPRChk)) == 0)
							{
								_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GameThief.OnlineGames.tcnt"));
								return VIRUS_FILE_DELETE; 
							}
						}
					}
					dwOffset += dwLength;
				}
			}
		}
		else 
		{
			DWORD dwReadOff = 0x0;
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x1020,&dwReadOff))
			{
				return iRetStatus;
			}
			if(GetBuffer(dwReadOff,0x50,0x50))
			{
				const BYTE bTCNTSig[] = {0x80,0x34,0x1F,0xA5,0x53,0x47,0xFF,0xD6,0x3B,0xF8,0x7C,0xF4};
				const BYTE bDLLChk[] = {0x2E,0x64,0x6C,0x6C}; 
				for(DWORD i = 0x0; i < 0x50; i++)
				{
					if(memcmp(&m_pbyBuff[i],bTCNTSig,sizeof(bTCNTSig)) == 0)
					{	
						if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x3050,&dwReadOff))
						{
							return iRetStatus;
						}
						if(GetBuffer(dwReadOff,0x200,0x200))
						{
							for(i = 0x0; i < 0x200; i++)
							{
								m_pbyBuff[i] ^= dwXORKey;
							}
							for(i = 0x0; i < 0x200; i++)
							{
								if(memcmp(&m_pbyBuff[i],bDLLChk,sizeof(bDLLChk)) == 0) 
								{
									while(i < 0x200)
									{
										if(m_pbyBuff[i] == 0x4D && m_pbyBuff[i + 0x1] == 0x53 && m_pbyBuff[i + 0x2] == 0x43)
										{
											_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GameThief.OnlineGames.tcnt"));
											return VIRUS_FILE_DELETE; 
										}
										i++;
									}
								}
							}
						}
					}
				}
			}
		}
	}
	//Poly.Worm.OnlineGames.A
	else if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		DWORD dwExportTblRVA = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x00].VirtualAddress;
		if (dwExportTblRVA == 0x00)
		{
			BYTE bAEPBuff[] = {0xE0, 0xFE, 0xFF, 0xFF, 0x60, 0x83, 0x7D, 0x0C, 0x01, 0x0F, 0x85, 0xB9, 0x08, 0x00, 
				0x00, 0x68, 0x04, 0x01, 0x00, 0x00, 0x8D, 0x85, 0xFC, 0xFE, 0xFF, 0xFF, 0x50, 0x6A, 0x00};

			if(GetBuffer(m_dwAEPMapped, 0x50))
			{
				if (memcmp(&m_pbyBuff[0x05],bAEPBuff,sizeof(bAEPBuff)) == 0x00)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Poly.Worm.OnlineGames.A"));
					return VIRUS_FILE_DELETE; 
				}
			}
		}
		//Poly.Worm.OnlineGames.EA,EB,EC
		else
		{	
			DWORD dwExportTblAddrs = Rva2FileOffsetEx(dwExportTblRVA,&wInSec); 
			if (0 == dwExportTblAddrs)
				return iRetStatus;

			memset(m_pbyBuff,0x00,sizeof(m_pbyBuff));
			if(!GetBuffer(dwExportTblAddrs,0x300,0x200))
				return iRetStatus;

			TCHAR szVirusName[MAX_PATH] = {0};
			TCHAR szOnLnGameA[] ={_T("64736F756E642E646C6C00446972656374536F756E6443617074757265437265*47657444657669636549440064736F756E643031302E476574446576696365")};
			TCHAR szOnLnGameB[] ={_T("4D61696E2E646C6C00456E486F6F6B57696E646F77*556E486F6F6B57696E646F7700")};
			TCHAR szOnLnGameC[] ={_T("646C315F4D61696E2E646C6C00446C6C43616E556E6C6F61644E6F77*446C6C476574436C6173734F626A656374*446C6C5265676973746572536572766572")};

			CSemiPolyDBScn polydbObj;
			if(polydbObj.LoadSigDBEx(szOnLnGameA, _T("Poly.Worm.OnlineGames.EA"), TRUE) <= 1)
				return iRetStatus;

			polydbObj.LoadSigDBEx(szOnLnGameB, _T("Poly.Worm.OnlineGames.EB"), TRUE);
			polydbObj.LoadSigDBEx(szOnLnGameC, _T("Poly.Worm.OnlineGames.EC"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}
	}
	//GameThief.OnLineGames.xich
	else
	{	
		DWORD dwDebugTblAddrs = 0;
		m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x6].VirtualAddress, &dwDebugTblAddrs); 
		if (0 == dwDebugTblAddrs)
		{
			return iRetStatus;
		}

		DWORD SizeOfDebugType = 0, DebugTypeOffset = 0;
		if(!m_pMaxPEFile->ReadBuffer(&DebugTypeOffset, dwDebugTblAddrs + 0x14, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if (0 == DebugTypeOffset)
		{
			return iRetStatus;
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(DebugTypeOffset, &DebugTypeOffset))
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&SizeOfDebugType, dwDebugTblAddrs + 0x10, 0x04, 0x04))
		{
			return iRetStatus;
		}

		if(DebugTypeOffset + SizeOfDebugType > m_pMaxPEFile->m_dwFileSize || SizeOfDebugType > 0x200 || SizeOfDebugType ==0x0  )
		{
			return iRetStatus;
		}

		memset(m_pbyBuff,0x00,sizeof(m_pbyBuff));
		if(!GetBuffer(DebugTypeOffset,SizeOfDebugType,SizeOfDebugType))
		{
			return iRetStatus;
		}

		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szOnLnGameSig[] ={_T("653A5C4A696E5A515C486F6F6BE5BC80*7374747261792D736D73735C52656C656173655C7374747261792E706462")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(szOnLnGameSig, _T("GameThief.OnLineGames.xich"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus; 
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScreensaver
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of ScreenSaver Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScreensaver()
{
	int iRetStatus = VIRUS_NOT_FOUND; 
	// Conditions checked after unpacking
	if((m_wAEPSec == 0 ||(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".crepe", 6) == 0 && m_dwAEPUnmapped == 0x4B180))
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x40000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize <= m_pSectionHeader[m_wAEPSec].SizeOfRawData ||
		m_pSectionHeader[m_wAEPSec].VirtualAddress == m_pSectionHeader[m_wAEPSec].PointerToRawData) && 
		(m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 ||
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize <= m_pSectionHeader[m_wAEPSec].SizeOfRawData ||
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize >= m_pSectionHeader[m_wAEPSec].SizeOfRawData)
		&& m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress != 0x0 && //Resource table chk
		m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size != 0x0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		if((m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress == 0x0 && //Certificate table chk
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x0) ||
			(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress != 0x0 && 
			(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xEB0 || //E
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xE98 ||  //G
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xEB8 ||  //I
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xEA8 ||  //K & Zango.qfp
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xC50 ||  //Zango.gen
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xC60 ||  //Zango.LK
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xEA0 ||  //Zango.soh
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xCA8 ||  //Zango.L
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1330 || //Zango.UT
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1518 || //Zango.UU
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1348 || //Zango.QI
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1528 || //Zango.KN
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1340 ||
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xC68 ||
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xC40 ||
			m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0xC58))) 
		{
			if(m_pMaxPEFile->m_dwFileSize -(m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData) == 0x0)
			{
				return iRetStatus;
			}
			DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
			if(OUT_OF_FILE == dwOverlayStart)
			{
				return iRetStatus;
			}
			const int SCREENSAVER_BUFF_SIZE = 0x100000;
			m_pbyBuff = new BYTE[SCREENSAVER_BUFF_SIZE];

			TCHAR SCREENSAVER_SIG[] = {_T("7906977FE10D46F268ED6C2CF56792E6E666091C2AD6575186663C01B9D064FA8AF2DD1741F07693AFD9097E31DBDEF83B4C*7C52CB16E76CE4EE23B9F7AB9FD8363FF3C3FF001F6FF1A341FF0090541FF02FFD08D61F8C7E202784754D374E4D1752*4526751B65CB7976C8DC67770C391E9C57AED72DF173FE453B3FFB0F68BFFA74*579357BC6B280C6015575B79A725F24606D81C719392BC632478EF857C216973F152")};
			//Screensaver
			TCHAR SCREENSAVER_E_SIG[] = {_T("B00E00000002020030820E9D06092A864886F70D010702A0820E8E30820E8A020101310B30*57617368696E67746F6E3111300F0603550407130842656C6C65767565311730*61707062756E646C65722E636F6D31")};
			TCHAR SCREENSAVER_G_SIG[] = {_T("980E00000002020030820E8B06092A864886F70D010702A0820E7C30820E78020101310B30*57617368696E67746F6E3111300F0603550407130842656C6C65767565311D30*50696E62616C6C20436F72706F726174696F6E*48006F0074006200610072")};
			TCHAR SCREENSAVER_G1_SIG[] = {_T("980E00000002020030820E8B06092A864886F70D010702A0820E7C30820E78020101310B30*57617368696E67746F6E3111300F0603550407130842656C6C65767565311D30*50696E62616C6C20436F72706F726174696F6E*56006F006F004D00750075")};
			TCHAR SCREENSAVER_G2_SIG[] = {_T("980E00000002020030820E8B06092A864886F70D010702A0820E7C30820E78020101310B30*57617368696E67746F6E3111300F0603550407130842656C6C65767565311D30*50696E62616C6C20436F72706F726174696F6E*5A00650065004400690070")};
			TCHAR SCREENSAVER_I_SIG[] =  {_T("B80E00000002020030820EA706092A864886F70D010702A0820E9830820E94020101310B30*22E49C51DCD71B05713AAF786582D135*57617368696E67746F6E3111300F0603550407130842656C6C65767565311D30*50696E62616C6C20436F72706F726174696F6E*3082010A0282010100D81B238648581DB3BAED5BC80C5510FE1CB0D6A81F55F1B0ECC1A9*CF99A9EA7B26F44BC98E8FD7F00526EFE3D2A79D")};
			TCHAR SCREENSAVER_K_SIG[] =  {_T("A80E00000002020030820E9706092A864886F70D010702A0820E8830820E84020101310B30*50696E62616C6C20436F72706F726174696F6E*42007200690067006800740042007200650065007A0065")};
			TCHAR SCREENSAVER_L_SIG[] =  {_T("A80C00000002020030820C9B06092A864886F70D010702A0820C8C30820C88020101310B30*5365656B6D6F20546563686E6F6C6F67696573*5300650065006B006D006F")};
			//Webtoolbar.Zango
			TCHAR ZANGO_QFP_SIG[] =  {_T("A80E00000002020030820E9506092A864886F70D010702A0820E8630820E82020101310B30*61707062756E646C65722E636F6D*46005200450045007A006500460072006F0067")};
			TCHAR ZANGO_GEN_SIG[] =  {_T("500C00000002020030820C3F06092A864886F70D010702A0820C3030820C2C020101310B30*50696E62616C6C20436F72706F726174696F6E*48006F0074006200610072")};
			TCHAR ZANGO_SFS_SIG[] =  {_T("A80E00000002020030820E9B06092A864886F70D010702A0820E8C30820E88020101310B30*50696E62616C6C20436F72706F726174696F6E*530068006F0070007000650072005200650070006F00720074")};
			TCHAR ZANGO_LK_SIG[] =  {_T("600C00000002020030820C4F06092A864886F70D010702A0820C4030820C3C020101310B30*50696E62616C6C20436F72706F726174696F6E*530068006F0070007000650072005200650070006F007200740073")};
			TCHAR ZANGO_SOH_SIG[] =  {_T("A00E00000002020030820E8F06092A864886F70D010702A0820E8030820E7C020101310B30*50696E62616C6C20436F72706F726174696F6E*4D006F0073007300790053006B0079")};
			TCHAR ZANGO_UT_SIG[] =  {_T("30130000000202003082131E06092A864886F70D010702A082130F3082130B020101310B30*53616C74204C616B652043697479*54686520555345525452555354204E6574776F726B*50696E62616C6C20436F72706F726174696F6E*48006F0074006200610072")};
			TCHAR ZANGO_UU_SIG[] =  {_T("18150000000202003082150806092A864886F70D010702A08214F9308214F5020101310B30*50696E62616C6C20436F72706F726174696F6E*48006F0074006200610072")};
			TCHAR ZANGO_QI_SIG[] =  {_T("48130000000202003082133A06092A864886F70D010702A082132B30821327020101310B30*53616C74204C616B652043697479*54686520555345525452555354204E6574776F726B*50696E62616C6C20436F72706F726174696F6E")};
			TCHAR ZANGO_KN_SIG[] =  {_T("28150000000202003082151806092A864886F70D010702A082150930821505020101310B30*50696E62616C6C20436F72706F726174696F6E*530068006F0070007000650072005200650070006F007200740073")};
			//New Webtoolbar.Zango
			TCHAR ZANGO_ACFM_SIG[] = {_T("A00E00000002020030820E9106092A864886F70D010702A0820E8230820E7E020101310B30*50696E62616C6C20436F72706F726174696F6E*52006100760065006E0042006C00650075")};	
			TCHAR ZANGO_ACFM1_SIG[] = {_T("A00E00000002020030820E8F06092A864886F70D010702A0820E8030820E7C020101310B30*50696E62616C6C20436F72706F726174696F6E*7A004D0061006E0061007400650065")};		
			TCHAR ZANGO_GEN1_SIG[] = {_T("A00E00000002020030820E8F06092A864886F70D010702A0820E8030820E7C020101310B30*50696E62616C6C20436F72706F726174696F6E*4B0061006E0067006F0042006F0078")};
			TCHAR ZANGO_GEN2_SIG[] = {_T("40130000000202003082132E06092A864886F70D010702A082131F3082131B020101310B30*53616C74204C616B652043697479*54686520555345525452555354204E6574776F726B*50696E62616C6C20436F72706F726174696F6E*530068006F0070007000650072005200650070006F007200740073")};
			TCHAR ZANGO_GEN3_SIG[] = {_T("B00E00000002020030820EA106092A864886F70D010702A0820E9230820E8E020101310B30*50696E62616C6C20436F72706F726174696F6E*42006C0075006500200054007500720074006C0065002000470061006D00650073")};
			TCHAR ZANGO_GEN4_SIG[] = {_T("A00E00000002020030820E8D06092A864886F70D010702A0820E7E30820E7A020101310B30*50696E62616C6C20436F72706F726174696F6E*4100700070004B0069006B0078")};
			TCHAR ZANGO_GEN5_SIG[] = {_T("680C00000002020030820C5B06092A864886F70D010702A0820C4C30820C48020101310B30*50696E62616C6C20436F72706F726174696F6E*500069006E00620061006C006C00200043006F00720070006F0072006100740069006F006E")};			
			
			TCHAR ZANGO_IU_SIG[] =  {_T("400C00000002020030820C3406092A864886F70D010702A0820C2530820C21020101310B30*6C524F9175558ABA22F2D2EA4175882F63557D1E545A9559CAD93481C05F5EF67A*5300650065006B006D006F")};
			TCHAR ZANGO_ACR_SIG[] = {_T("580C00000002020030820C4B06092A864886F70D010702A0820C3C30820C38020101310B30*50696E62616C6C20436F72706F726174696F6E*53006D00610072007400530068006F0070007000650072")};

			TCHAR szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn polydbObj;
			
			if(!FindResorce(SCREENSAVER_BUFF_SIZE))
			{
				return iRetStatus;
			}
			if((polydbObj.ScanBuffer(&m_pbyBuff[0x0], m_dwNoOfBytes, szVirusName) >= 0))
			{
				if(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".crepe", 6) == 0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x0)
				{
					if(!GetBuffer(m_dwAEPMapped + 0x1900, 0x2000))
					{
						return iRetStatus;
					}
				}
				else if(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".crepe", 6) == 0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size != 0x0)
				{
					DWORD dwBuffSize = m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size;
					if(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size > SCREENSAVER_BUFF_SIZE)
					{
						dwBuffSize = SCREENSAVER_BUFF_SIZE;
					}
					if(!GetBuffer(dwOverlayStart, dwBuffSize))
					{
						return iRetStatus;
					}
				}
				else if(!GetBuffer(dwOverlayStart , 0x1500))
				{
					return iRetStatus;
				}
				polydbObj.LoadSigDBEx(SCREENSAVER_SIG, _T("Poly.Adware.ScreenSaver"), TRUE);

				//Screensaver sig's			
				polydbObj.LoadSigDBEx(SCREENSAVER_E_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_G_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_G1_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_G2_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_I_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_K_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(SCREENSAVER_L_SIG, szVirusName, TRUE);
				//Webtoolbar.Zango sig's
				polydbObj.LoadSigDBEx(ZANGO_QFP_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_SFS_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_LK_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_SOH_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_UT_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_UU_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_QI_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_KN_SIG, szVirusName, TRUE);
				//New Webtoolbar.Zango sig's
				polydbObj.LoadSigDBEx(ZANGO_ACFM_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_ACFM1_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN1_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN2_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN3_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN4_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_GEN5_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_IU_SIG, szVirusName, TRUE);
				polydbObj.LoadSigDBEx(ZANGO_ACR_SIG, szVirusName, FALSE);

				if((polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0))
				{					
					if(_tcslen(szVirusName) > 0)
					{
						iRetStatus = VIRUS_FILE_DELETE;
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Poly.Adware.ScreenSaver"));
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: FindResorce
	In Parameters	: int dwBuffSize, bool bCheckID
	Out Parameters	: true if success else false
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function finds the resurce information from resource table
--------------------------------------------------------------------------------------*/
bool CSemiPolyTrojans::FindResorce(int dwBuffSize, bool bCheckID/* = false*/)
{
	DWORD dwBaseResATFileOffset = 0;	
	m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress, &dwBaseResATFileOffset);
	DWORD dwOffset = dwBaseResATFileOffset;

	WORD wNoofResTypes = 0x00, byOffset = bCheckID ? 0xE : 0x0C;
	if(!m_pMaxPEFile->ReadBuffer(&wNoofResTypes, dwOffset + byOffset, sizeof(WORD), sizeof(WORD)))
	{
		return false;
	}

	DWORD iBufferSize = 0, OffSetOfDir = 0, OffSetOfDir1 = 0, OffSetOfDir2 = 0;	
	for(int i = 0; i < wNoofResTypes ; i++)
	{
		if(!m_pMaxPEFile->ReadBuffer(&OffSetOfDir, (dwOffset + 0x14), sizeof(DWORD), sizeof(DWORD)))
		{
			return false;
		}

		WORD wNoofIDEntry = 0;
		if(!m_pMaxPEFile->ReadBuffer(&wNoofIDEntry, (dwBaseResATFileOffset +(OffSetOfDir^0x80000000)+0xE), sizeof(WORD), sizeof(WORD)))
		{
			return false;
		}

		for(int j = 0; j < wNoofIDEntry; j++)
		{
			if(!m_pMaxPEFile->ReadBuffer(&OffSetOfDir1, (dwBaseResATFileOffset + (OffSetOfDir^0x80000000)+0x14), sizeof(DWORD), sizeof(DWORD)))
				return false;

			WORD wNoofIDEntries=0;
			if(!m_pMaxPEFile->ReadBuffer(&wNoofIDEntries, (dwBaseResATFileOffset +(OffSetOfDir1^0x80000000)+0xE), sizeof(WORD), sizeof(WORD)))
				return false;

			for(int k = 0; k < wNoofIDEntries; k++)
			{  
				WORD wNoofIDEntrie=0;
				if(!m_pMaxPEFile->ReadBuffer(&OffSetOfDir2, (dwBaseResATFileOffset +(OffSetOfDir1^0x80000000)+0x14), sizeof(DWORD), sizeof(DWORD)))
					return false;

				DWORD Startoffset=0, Size=0;

				if(!m_pMaxPEFile->ReadBuffer(&Startoffset, (dwBaseResATFileOffset+OffSetOfDir2), sizeof(DWORD), sizeof(DWORD)))
					return false;
				if(!m_pMaxPEFile->Rva2FileOffset(Startoffset, &Startoffset))
					return false;
				if(!m_pMaxPEFile->ReadBuffer(&Size, (dwBaseResATFileOffset+OffSetOfDir2 +4), sizeof(DWORD), sizeof(DWORD)))
					return false;
				if(iBufferSize + Size > dwBuffSize)
				{
					m_dwNoOfBytes = iBufferSize;
					return true;
				}
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[iBufferSize], Startoffset, Size, Size))
					return false;

				iBufferSize += Size;
				OffSetOfDir1+=0x8;
			}
			OffSetOfDir+=0x8;
		}
		dwOffset+=0x8;
	}
	m_dwNoOfBytes = iBufferSize;
	return true;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanScar
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Scar Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanScar()
{
	int iRetStatus = VIRUS_NOT_FOUND;	
	if(((m_pSectionHeader[0].Characteristics & 0x60000020) == 0x60000020) && (m_wAEPSec == 0x01) && 
		(memcmp(m_pSectionHeader[0].Name,".togk",4) == 0) && 
		((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff  = NULL;
		}
		m_pbyBuff = new BYTE[0x500];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, 0x500);  
		if(m_pMaxPEFile->ReadBuffer(m_pbyBuff, 0x80D0, 0x500, 0x500))
		{
			TCHAR SCAR_SIGN[] = _T("557164617465*5C256325632563256325632E657865007266777372762E657865");
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SCAR_SIGN, _T("Trojan.Scar"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};				
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x500, szVirusName) >= 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				iRetStatus = VIRUS_FILE_DELETE;
			}
		}
	}
	if(((m_pSectionHeader[0].Characteristics & 0xE0000020) == 0xE0000020) && 
		(m_wAEPSec == 0x00) && (m_wNoOfSections == 2) && 
		((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff  = NULL;
		}
		m_pbyBuff = new BYTE[0x300];
		if(GetBuffer(0x970, 0x300, 0x300))
		{
			TCHAR SCARU_SIGN[] = _T("2E50415800000000C0180010000000002E504144*25735C257365782E646C6C*6C706B2E646C6C*433A5C00686867686F737444444F53");
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SCARU_SIGN, _T("Trojan.ScarU"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};				
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x300, szVirusName) >= 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				iRetStatus = VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDelf
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Delf Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDelf(void)
{	
	int	iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x08 && m_pSectionHeader[0].SizeOfRawData == 0x8E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;		
		}
		const int DELF_CS_BUFF_SIZE	= 0x100;
		m_pbyBuff = new BYTE[DELF_CS_BUFF_SIZE];
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szDelfSig[] ={ _T("6E746B726E6C7061*687474703A2F2F6E746B726E6C70612E696E666F2F72632F3F693D31")};
					//ntkrnlpa*http://ntkrnlpa.info/rc/?i=1

		if(GetBuffer(0x89E8, DELF_CS_BUFF_SIZE, DELF_CS_BUFF_SIZE))
		{
			CSemiPolyDBScn	polydbObj;
			DWORD			dwAllocSize = DELF_CS_BUFF_SIZE;

			if(polydbObj.LoadSigDBEx(szDelfSig, _T("Virus.Delf.CS"), FALSE) <= 1)
			{
				return iRetStatus;
			}
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwAllocSize, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}	
	}

	if(m_wNoOfSections >= 0x05 && m_pSectionHeader[0].SizeOfRawData > 0xA2000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;		
		}
		const int DELF_AZNP_BUFF_SIZE	= 0x1000;
		m_pbyBuff = new BYTE[DELF_AZNP_BUFF_SIZE];
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szDelfSig[] ={ _T("640031002E0064006F0077006E007800690061002E006E00650074*640032002E0064006F0077006E007800690061002E006E00650074")};

		if(GetBuffer(0x9D500, DELF_AZNP_BUFF_SIZE, DELF_AZNP_BUFF_SIZE))
		{
			CSemiPolyDBScn	polydbObj;
			DWORD			dwAllocSize = DELF_AZNP_BUFF_SIZE;

			if(polydbObj.LoadSigDBEx(szDelfSig, _T("Trojan.Delf.AZNP"), FALSE) <= 1)
			{
				return iRetStatus;
			}
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwAllocSize, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}	
	}

	if((m_wNoOfSections >= 0x08) && 
		((m_pSectionHeader[0].Misc.VirtualSize >= 0x08E000) && (m_pSectionHeader[0].Misc.VirtualSize <= 0x08F100)) &&
		((m_pSectionHeader[0x01].Misc.VirtualSize >= 0x1800) || (m_pSectionHeader[0x01].Misc.VirtualSize <= 0x2200)))
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		m_pbyBuff = new BYTE[0x200];
		DWORD dwOffset = 0x61780;
	
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwOffset, &dwOffset))
			return iRetStatus;

		if(GetBuffer(dwOffset,0x200, 0x200))
		{
			TCHAR szSig[] = {_T("4381E3FF00008079084B81CB00FFFFFF4303BC9DE4FBFFFF81*B6849DE4FBFFFF8845EB8B84BDE4FBFFFF*400FB68485E4FBFFFF8B55")};
			polydbObj.LoadSigDBEx(szSig, _T("Backdoor.W32.Delf.aecw"), FALSE);
			
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x200, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	if((m_wNoOfSections == 0x08 || m_wNoOfSections == 0x0A)&& m_dwAEPMapped == 0x14CC && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1400)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int BUFF_SIZE = 0x125;
		int iCALLCnt = 0;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byDELFChk[] = {0x55, 0x8B, 0xEC, 0xB9, 0x0C, 0x00, 0x00, 0x00, 0x6A};//,0x57,0x56};

			for(int i =0;i<0x10; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byDELFChk,sizeof(byDELFChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				t_disasm	da;
				int			iInstruction =0;
				for(DWORD dwOffset = 0x0; dwOffset < (BUFF_SIZE - MAX_INSTRUCTION_LEN);dwOffset +=dwLength)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);

					if(dwLength == 0x1 && strstr(da.result,"PUSH EBP"))
					{  
						iInstruction++;
						continue;
					}

					else if(dwLength == 0x5 && strstr(da.result,"MOV ECX,C"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"MOV EAX,40209C"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"CALL "))
					{
						iCALLCnt++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"PUSH 402361"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x3 && strstr(da.result,"MOV FS:[EAX],ESP"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"MOV EAX,402378"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x3 && strstr(da.result,"CMP ESI,6"))
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x7 && strstr(da.result,"JMP"))
					{
						iInstruction++;
						continue;
					}

				}	

				if(iCALLCnt == 0x12)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Delf.EFNZ")); 
					return VIRUS_FILE_DELETE; 
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLLAC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of LLAC Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLLAC(void)
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
		
	if(((m_pSectionHeader[0x00].SizeOfRawData >= 0xB000 && m_pSectionHeader[0x00].SizeOfRawData <= 0xC000) && (m_wNoOfSections >= 7)) ||
		((m_wNoOfSections >= 3) && (m_pSectionHeader[0].SizeOfRawData == 0x11000)) ||
		((m_wNoOfSections == 1) && (memcmp(m_pSectionHeader[0].Name, ".maxs01", 7) == 0) && (m_dwAEPUnmapped == 0xE1A8)) ||
		((memcmp(m_pSectionHeader[0].Name, ".scpack", 7) == 0) && (m_pSectionHeader[0].SizeOfRawData <= 0x59000)) ||
		((m_wNoOfSections == 0x02) && ((memcmp(m_pSectionHeader[0].Name, "CODE", 4) == 0) || (memcmp(m_pSectionHeader[0].Name, "MEW", 3) == 0) || (memcmp(m_pSectionHeader[0].Name, ".packed", 6) == 0))) ||
		((memcmp(m_pSectionHeader[0].Name, m_pSectionHeader[1].Name, 3) == 0) && (m_pSectionHeader[0].SizeOfRawData > 0x9000)))
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int LLAC_BUFF_SIZE = 0x130;	// Modified Buffer Size
		m_pbyBuff = new BYTE[LLAC_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		DWORD dwBDMOffset = 0;		
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0xC160, &dwBDMOffset))
		{
			return iRetStatus;
		}

		if(GetBuffer(dwBDMOffset, LLAC_BUFF_SIZE, LLAC_BUFF_SIZE))
		{		
			TCHAR			szVirusName[MAX_PATH] = {0};
			TCHAR			szBDMSig[] = {_T("5265737461727400*58582D2D58582D2D58582E747874")};
			
			CSemiPolyDBScn	polydbObj;
			polydbObj.LoadSigDBEx(szBDMSig, _T("Trojan.W32.LLAC.BDM"), FALSE);
			
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}
	}
	
	if((m_wNoOfSections >= 7) && ((m_pSectionHeader[0].SizeOfRawData >= 0xD400) && (m_pSectionHeader[0].SizeOfRawData <= 0xE000)) ||
		((memcmp(m_pSectionHeader[0].Name, m_pSectionHeader[1].Name, 3) == 0) && (m_pSectionHeader[0].SizeOfRawData > 0x9000)) ||
		((m_wNoOfSections == 2) && (memcmp(m_pSectionHeader[0].Name, "CODE", 4) == 0) || (memcmp(m_pSectionHeader[0].Name, "MEW", 3) == 0)) ||
		((m_wNoOfSections == 1) && (memcmp(m_pSectionHeader[0].Name, ".maxs01", 7) == 0) && (m_dwAEPUnmapped == 0xE1A8)))		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int LLAC_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[LLAC_BUFF_SIZE];	
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwOffset = 0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0xE800, &dwOffset))
		{
			return iRetStatus;
		}

		if(GetBuffer(dwOffset, LLAC_BUFF_SIZE, 0x100))
		{
			TCHAR			szMainSig[] ={ _T("5A5959648910683AE840008D8544FFFFFFBA2B*5265737461727400FFFFFFFF040000002E74787400")};
			CSemiPolyDBScn	polydbObj;
			TCHAR szVirusName[MAX_PATH];
			
			if(polydbObj.LoadSigDBEx(szMainSig, _T("Trojan.W32.LLAC.HAS"), FALSE) <= 1)
				return iRetStatus;

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}
	} 
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectStartPageM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of StartPage Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectStartPageM()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 5 && 
		((m_dwAEPUnmapped % 0x100 == 0x61) || (m_dwAEPUnmapped % 0x100 == 0x90)) && (strstr((char *)m_pSectionHeader[m_wNoOfSections - 2].Name,".ndata")) &&
		(m_pMaxPEFile->m_dwFileSize > (m_pSectionHeader[m_wNoOfSections -1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData + 0x1200)) && 
		(m_pMaxPEFile->m_stPEHeader.DataDirectory[5].VirtualAddress == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int STARTPAGE_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[STARTPAGE_BUFF_SIZE];
		if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData, STARTPAGE_BUFF_SIZE, STARTPAGE_BUFF_SIZE))
		{
			BYTE NULLSOFT[] = {0xEF,0xBE,0xAD,0xDE,0x4E,0x75,0x6C,0x6C,0x73,0x6F,0x66,0x74,0x49,0x6E,0x73,0x74};
			BYTE STARTPAGE_SIG[] = {0x00,0x80,0x5D,0x00,0x00,0x80,0x00,0x00,0x50,0x00,0x30,0x05,0x80,0x18,0x03};
			BYTE STARTPAGE_SIG1[] = {0x00,0xA0,0x00,0x00,0x00,0x2C,0x01,0x00,0x00,0x05,0x00,0x00,0x00,0x6C,0x02,0x00,0x00};
			BYTE STARTPAGE_SIG2[] = {0x00,0x00,0xA0,0x00,0x00,0x00,0x2C,0x01,0x00,0x00,0x06,0x00,0x00,0x00,0xAC,0x02,0x00,0x00};
			if((memcmp(&m_pbyBuff[0x04],NULLSOFT,sizeof(NULLSOFT)) == 0) && ((memcmp(&m_pbyBuff[0x1E],STARTPAGE_SIG,sizeof(STARTPAGE_SIG)) == 0) || 
				(memcmp(&m_pbyBuff[0x1F],STARTPAGE_SIG1,sizeof(STARTPAGE_SIG1)) == 0) || 
				(memcmp(&m_pbyBuff[0x1E],STARTPAGE_SIG2,sizeof(STARTPAGE_SIG2)) == 0)))
			{
				DWORD dwValue = 0,dwOverlaySize = 0;
				dwValue = *(DWORD *)&m_pbyBuff[0x18];
				dwOverlaySize = m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData);
				if(dwValue > dwOverlaySize)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Startpage.m"));
					return VIRUS_FILE_DELETE;
				}
			}			
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRefroso
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Refroso Family
					   A. Installation:	
						- Recursive call it self.
						- Continuesly try to connect to li45-233.members.linode.com.
					
					   B. File Modification 
						- C:\Documents and Settings\admin\Local Settings\Temp\idemoodp0cetka.exe
						  
					   C. Registry Modifications:
						- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\MS Service Manager: "C:\DOCUME~1\admin\LOCALS~1\Temp\idemoodp0cetka.exe"
						   * All are VB samples.
					Intention  : 1. variable names    [Q6UTkE7HRFJQ8y0, HmAYTUGRYRXc6dYz]
								 2. String		  [Z.1.h.q.T.l.V.0.Y.0.J.5.N.F.o.3.]
					Detection  : 100%	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRefroso()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	//--------------------------------------------Backdoor.W32.Refroso.djjg----------------------------------------------
	if(( m_wNoOfSections > 1 &&
		((m_pSectionHeader[1].PointerToRawData >= 0x7400 && m_pSectionHeader[1].PointerToRawData <= 0x7410) || 
		(m_wNoOfSections == 0x02 && m_pSectionHeader[1].PointerToRawData == 0x7500) || 
		m_pSectionHeader[0].SizeOfRawData > m_pMaxPEFile->m_stPEHeader.SizeOfImage) && 
		((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)))		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];		
		if(GetBuffer(0x6E9A, 0x100, 0x100))
		{
			TCHAR szSig[] = {_T("8080341040004EF20FC1CAB9E908ABC2C1E12108C269C843FAD544B9F9D83B12*B9313033*F241FFC1C1E1D9*8034764000FB84*D1E14AC7C119785BB2648D0D2160A3DA0FC1CA69C82948")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(szSig, _T("Backdoor.W32.Refroso.djjg"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x100, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}		
	}

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	//----------------------------------------------Trojan.Win32.Refroso.ctrf----------------------------------------------
	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x10B0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int REFROSOCTRF_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[REFROSOCTRF_BUFF_SIZE];
		if(!m_pbyBuff)
			return iRetStatus;

		DWORD dwBuffOffset = 0x4150;	
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, REFROSOCTRF_BUFF_SIZE,REFROSOCTRF_BUFF_SIZE))
			return iRetStatus;

		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szSig[] = {_T("513655546B45374852464A51387930*486D415954554752595258633664597A*5A0031006800710054006C0056003000590030004A0035004E0046006F003300")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(szSig, _T("Trojan.Win32.Refroso.ctrf"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], REFROSOCTRF_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	//----------------------------------------------Trojan.Win32.Refroso.asbf---------------------------------------------- (m_wNoOfSections == 0x7 || m_wNoOfSections == 0x9 || m_wNoOfSections == 0xA || m_wNoOfSections == 0x10 || m_wNoOfSections == 0xC)
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x4FCC && 
		(((m_wNoOfSections == 0x8 || m_wNoOfSections == 0x9) && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize  == 0x3FF8 || m_pSectionHeader[m_wAEPSec].SizeOfRawData  == 0x4000))||
		 ((m_wNoOfSections >= 0x7 && m_wNoOfSections <= 0x10) && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x4000) ||
		  (m_wNoOfSections == 0x3 && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize >= 0xA000 && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0x0FFF) == 0x0))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int REFROSOASBF_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[REFROSOASBF_BUFF_SIZE];
		if(!m_pbyBuff)
			return iRetStatus;

		DWORD dwBuffOffset = 0x3EF7;	
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, REFROSOASBF_BUFF_SIZE,REFROSOASBF_BUFF_SIZE))
			return iRetStatus;

		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szSig[] = {_T("8B45FC0FB64438FF3345F88945F48D45F08A55F4E810F8FFFF8B55F08BC6E872*F8FFFF474B75D933")}; // Decryption loop
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(szSig, _T("Trojan.Win32.Refroso.asbf"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], REFROSOASBF_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	if( m_wAEPSec == 0 && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5 || m_wNoOfSections == 0x3) )
	{
		const int REFROSOKTW_BUFF_SIZE = 0x3000;
		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[REFROSOKTW_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwBuffOffset = m_pSectionHeader[0].PointerToRawData;	
		
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, REFROSOKTW_BUFF_SIZE,REFROSOKTW_BUFF_SIZE))
		{
			return iRetStatus;
		}

		TCHAR			szVirusName[MAX_PATH] = {0};
		TCHAR			szSig[] = {_T("8B450C33D2B9E80300000FB604060345FCF7F18B45080FB61C072BDA81FE742B0000*B8FF0000002BC3C1E808C1E00803D88B4508817D10C8000000881C07")}; // Decryption loop
		CSemiPolyDBScn	polydbObj;

		polydbObj.LoadSigDBEx(szSig, _T("Trojan.refroso.ktw"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], REFROSOKTW_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDybalom
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  Contain one exe in resource section
					  Drop that exe in "C:\Docu~settnigs\username\appdata\*.exe" folder and shall execute
					  keep watch on browing data
					  All samples are Armadillo packers
					  Sig : Contain descryption loop that create droping path and malicious URL 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDybalom()
{
	if((m_wAEPSec == 0) && (m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress == 0x90) &&
		(m_dwAEPUnmapped % 0x100 == 0x9B) && (m_wNoOfSections >= 4) && (memcmp(m_pSectionHeader[1].Name, ".rdata", 6) == 0) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3E00))
	{		
		BYTE DYBALOM_BUF[0x20] = {0};
		if(m_pMaxPEFile->ReadBuffer(DYBALOM_BUF, m_pSectionHeader[m_wAEPSec].PointerToRawData, 0x20, 0x20))
		{
			BYTE DYBALOM_SIG[] = {0xE9,0x00,0x00,0x00,0x00,0x6A,0x0C,0x68,0xB4,0x61,0x40,0x00,0xE8,0x49,0x08,0x00,0x00,0x59,0xA3,0x00,0x69,0x40,0x00,0x59,0xC3,0xE9,0x00,0x00,0x00,0x00,0x6A,0x0E};
			BYTE DYBALOM_SIG1[] = {0x0F,0xB6,0x04,0x07,0x03,0x44,0x24,0x14,0x89,0x4C,0x24,0x18,0xF7,0xF3,0x0F,0xB6,0x19,0x2B,0xDA,0x81,0xFF,0x74,0x2B,0x00,0x00,0x76,0x64,0x56,0x6A,0x0A,0xFF,0x35};
			BYTE DYBALOM_DATA[] = {0x7E,0x16,0x1D,0xC0,0x43,0xF9,0x6D,0x6E,0x20,0xA6,0x0E,0xE0,0xBA,0x00,0x00,0x00,0x7E,0x16,0x2D,0xC4,0x4B,0xFA,0x61,0x71,0x32,0xEB,0x05,0xDB,0xCE,0xC9,0x04,0xB5};
			if(memcmp(&DYBALOM_BUF[0x00], DYBALOM_SIG, sizeof(DYBALOM_SIG)) == 0)
			{
				if(m_pMaxPEFile->ReadBuffer(DYBALOM_BUF,m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x73F,0x20,0x20))
				{
					if(memcmp(&DYBALOM_BUF[0x00],DYBALOM_SIG1,sizeof(DYBALOM_SIG1)) == 0)
					{
						if(m_pMaxPEFile->ReadBuffer(DYBALOM_BUF,m_pSectionHeader[2].PointerToRawData + 0x4E4,0x20,0x20))
						{
							if(memcmp(&DYBALOM_BUF[0x00],DYBALOM_DATA,sizeof(DYBALOM_DATA)) == 0)
							{
								_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.PSW.Dybalom.idb"));
								return VIRUS_FILE_DELETE;
							}
						}
					}
				}
			}
		}
	}

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL &&
		(m_dwAEPUnmapped == 0x41175 || m_dwAEPUnmapped == 0x4117B || m_dwAEPUnmapped == 0x411CE) &&
		(m_pSectionHeader[0].SizeOfRawData >= 0x47000))		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x50];
		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x0C70, 0x50, 0x50))
		{		
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("59761A6A058BC633D259F7F157FEC230143E46E848*DC03003BF05972E68BC75F")};
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.PSW.Dybalom.dhc"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(m_pbyBuff, 0x50, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSwisyn
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Swisyn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSwisyn()
{
	int		iRetStatus = VIRUS_NOT_FOUND; 
	int		BUFF_SIZE = 0x0, iFlag = 0;
	DWORD	dwBuffOffset = 0x0;

	if (m_wAEPSec == 0 && m_dwAEPUnmapped == 0x14CC && m_pSectionHeader[0].SizeOfRawData == 0x5000 &&
		m_pSectionHeader[0].PointerToRawData == 0x1000 && m_pSectionHeader[0].VirtualAddress ==  0x1000)
	{
		BUFF_SIZE = 0x500;
		dwBuffOffset = 0x1000;
		iFlag = 0x1;
	}
	else if (m_wNoOfSections == 0x3 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1088 && 
		    (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000))
	{
		BUFF_SIZE = 0x70;
		dwBuffOffset = 0x8F8;
		iFlag = 0x2;
	}

	if(iFlag != 0x0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		m_pbyBuff = new BYTE[BUFF_SIZE];		
		if(GetBuffer(m_dwAEPMapped + dwBuffOffset, BUFF_SIZE, BUFF_SIZE))
		{
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			if(iFlag == 0x1)
			{
				TCHAR szSig[] = {_T("70686F746F7300706F6F727669727573*6469736B636C65616E6572*560049005200550053005C006C00610074006500730074002000760069007200750073")};
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.Swisyn.alai"), FALSE);
			}
			else 
			{
				TCHAR szSig[] = {_T("7400680065007000690072006100740065006200610079002E006F00720067*6D0069006E0069006E006F00760061002E006F00720067")};
							//(t.h.e.p.i.r.a.t.e.b.a.y...o.r.g*m.i.n.i.n.o.v.a...o.r.g)
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.Swisyn.jyb"), FALSE);
			}

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectArchSMS
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of ArchSMS Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectArchSMS()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections == 0x05) && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData <= 0xB000) &&
		(m_pMaxPEFile->m_stSectionHeader[0x02].SizeOfRawData == 0x1200 || m_pMaxPEFile->m_stSectionHeader[0x02].SizeOfRawData == 0xE00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		if(GetBuffer(0x600, BUFF_SIZE, BUFF_SIZE))
		{
			TCHAR szSig1[] = {_T("83F90A7C0233C98A140E3090*410040413DC90200007CE7")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(szSig1, _T("Hoax.ArchSMS.loaf"), TRUE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}	
		}
	}
	else if(m_wNoOfSections == 0x09 && m_dwAEPUnmapped == 0x109194 && (memcmp(m_pSectionHeader[0x01].Name, ".itext", 6) == 0) &&
		m_pSectionHeader[0].SizeOfRawData == 0x106600 && m_pSectionHeader[0x01].SizeOfRawData == 0x1400)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[0x200];
		if(!GetBuffer(0x104820, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("C05A595964891068CD5450008D857CFF*61006C0074005F007000610079*720075006C00650073005F*620061006E006E00650072005F")};

		if(polydbObj.LoadSigDBEx(szSig, _T("Hoax.ArchSMS.hzpg"), FALSE) <= 1)
			return iRetStatus;

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	
	if(m_wNoOfSections >= 0x08 && m_pSectionHeader[0].SizeOfRawData > 0xE0000 && 
		m_pSectionHeader[0x06].Misc.VirtualSize >= 0x10A00 && m_pSectionHeader[0x06].Misc.VirtualSize <= 0x11000 &&
		m_dwAEPUnmapped > 0xE1000 && m_pSectionHeader[0x01].SizeOfRawData >= 0x4000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x1100;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		DWORD dwReadOffset = m_dwAEPUnmapped - 0x5900;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOffset, &dwReadOffset))
		{
			return iRetStatus;
		}
		if(!GetBuffer(dwReadOffset, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		BYTE bySig[] = {0x7A,0x69,0x70,0x6D,0x6F,0x6E,0x73,0x74,0x65,0x72,0x2E,0x72,0x75}; //zipmonster.ru
		CMaxBMAlgo *pBMScan = new CMaxBMAlgo;
		if(pBMScan == NULL)
		{
			return iRetStatus;
		}
		if(pBMScan->AddPatetrn2Search(bySig, sizeof(bySig)))
		{
			if(pBMScan->Search4Pattern(m_pbyBuff, BUFF_SIZE))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Hoax.ArchSMS.pxm"));
				iRetStatus = VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAutoRun
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of AutoRun Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAutoRun()
{
	int		iRetStatus = VIRUS_NOT_FOUND;
	DWORD	dwBaseOfData = 0;
	
	m_pMaxPEFile->ReadBuffer(&dwBaseOfData, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x30, 4);

	if ((dwBaseOfData == 0x1C000) && (m_wNoOfSections == 0x02) && 
	   (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x27000 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x6C00))
	{
		BYTE byAutoBuff[0x15];
		BYTE bySig[] = {0x68,0x00,0x6F,0x00,0x6E,0x00,0x65,0x00,0x79,0x00,0x2E,0x00,0x65,0x00,0x78,0x00,0x65}; 
		if(m_pMaxPEFile->ReadBuffer(&byAutoBuff[0], 0x10178, 0x15, 0x15))
		{
			if(memcmp(&byAutoBuff[0], bySig, sizeof(bySig)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.W32.AutoRun.bkff"));
				return VIRUS_FILE_DELETE;
			}
			else if(m_pMaxPEFile->ReadBuffer(&byAutoBuff[0], 0x31378, 0x15, 0x15))
			{
				if(memcmp(&byAutoBuff[0], bySig, sizeof(bySig)) == 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.W32.AutoRun.bkff"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
		
	}
	else if (m_dwAEPUnmapped == 0x2220 && m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9C00 && 
		    (m_wNoOfSections >= 0x4 && m_wNoOfSections <= 0x7 ))
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}

		const int AUTO_BUFF_SIZE = 0x210;
		m_pbyBuff = new BYTE[AUTO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x1C0, AUTO_BUFF_SIZE, AUTO_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		
		TCHAR AUTO_SIG[] = {_T("433A5C646F6E6F74*47686F73742E6D7033*4D534F4361636865000000002E657865*47726F6F76652E657865*5C537973496E666F53657276")};
					  // (C:\donot*Ghost.mp3*MSOCache.....exe*Groove.exe*\SysInfoServ)
		
		polydbObj.LoadSigDBEx(AUTO_SIG,_T("Worm.Autorun.etjz"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AUTO_BUFF_SIZE, szVirusName) >= 0)
		{
			iRetStatus = VIRUS_FILE_DELETE;
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return iRetStatus;
		}

	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKapucenB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Kapucen Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKapucenB(void)
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
		(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress > 0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size > 0) &&
		(m_dwAEPUnmapped==0xB13D || m_dwAEPUnmapped==0xB10D || m_dwAEPUnmapped==0x1C000) ) 
	{
		BYTE byMutexbuff[0x90]={0};
		DWORD dwFileOffset;
		if(m_pMaxPEFile->Rva2FileOffset(0x4045CB-m_dwImageBase,&dwFileOffset)==0)
		{
			if(m_pMaxPEFile->ReadBuffer(byMutexbuff,dwFileOffset,0x08,0x08))
			{
				BYTE byXORKey=byMutexbuff[0]^0x54;
				for(int i=0;i<8;i++)
				{
					byMutexbuff[i]^=byXORKey;
				}
				//Mutex name
				BYTE bySig1KapucenB[]={0x54,0x49,0x4E,0x59,0x70,0x55,0x63,0x45};
				if(memcmp(byMutexbuff,bySig1KapucenB,sizeof(bySig1KapucenB))==0x00)
				{
					//Dropped text file signature
					BYTE bySig2KapucenB[]={0x50,0x52,0x45,0x2D,0x49,0x4E,0x53,0x54,0x41,0x4C,0x4C,0x20,0x76,0x31,0x2E,0x30,
						0x37,0x0D,0x0A,0x28,0x43,0x29,0x20,0x70,0x55,0x63,0x45,0x20,0x53,0x6F,0x66,
						0x74,0x77,0x61,0x72,0x65,0x20,0x32,0x30,0x30,0x36,0x0d,0x0a,0x50,0x72,0x65,
						0x2d,0x69,0x6e,0x73,0x74,0x61,0x6c,0x6c,0x20,0x68,0x61,0x73,0x20,0x63,0x68,
						0x65,0x63,0x6b,0x65,0x64,0x20,0x79,0x6f,0x75,0x72,0x20,0x63,0x6f,0x6e,0x66,
						0x69,0x67,0x2e,0x0d,0x0A,0x45,0x76,0x65};

					if(m_pMaxPEFile->ReadBuffer(byMutexbuff,dwFileOffset+0xD2,sizeof(bySig2KapucenB),sizeof(bySig2KapucenB)))
					{
						for(int i=0;i<sizeof(bySig2KapucenB);i++)
						{
							byMutexbuff[i]^=byXORKey;
						}
						if(memcmp(byMutexbuff,bySig2KapucenB,sizeof(bySig2KapucenB))==0x00)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Kapucen.B"));
							return VIRUS_FILE_DELETE;
						}
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSahatG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Sahat Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSahatG()
{
	if(m_dwAEPMapped == 0x1AF68 && m_dwAEPUnmapped == 0x1BB68 && m_wNoOfSections == 4)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;

		}
		const int BUFF_SAHAT_G = 0x500;
		m_pbyBuff = new BYTE[BUFF_SAHAT_G];

		if(GetBuffer(m_pSectionHeader[2].PointerToRawData, BUFF_SAHAT_G, BUFF_SAHAT_G))
		{
			DWORD dwSize = NormalizeBuffer(m_pbyBuff, m_dwNoOfBytes);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			TCHAR szSig_GEN1[] ={ _T("2D636F6F6B643A2E73686F706174686F6D652E636F6D2D677569643A7B*2D7375726C3A3F6F6C6473657373696F6E69643D*2D6575726C3A3F6F6C6473657373696F6E69643D")};
			TCHAR szSig_GEN2[] ={ _T("2D636F6F6B643A2E73686F706174686F6D652E636F6D2D677569643A7B*73686F706174686F6D652E636F6D2F746F6F6C626172706F7374696E7374616C6C2E617370783F*6F6C6473657373696F6E69643D")};
			CSemiPolyDBScn	polydbObj;
			polydbObj.LoadSigDBEx(szSig_GEN1, _T("not-a-Virus::WebToolbar.Sahat.G"), TRUE);
			polydbObj.LoadSigDBEx(szSig_GEN2, _T("not-a-Virus::WebToolbar.Sahat.G"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwSize, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}		
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: NormalizeBuffer
	In Parameters	: LPBYTE byBuffer, DWORD cbBuffer
	Out Parameters	: 
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function normalizes the buffer by removeing formating characters
--------------------------------------------------------------------------------------*/
DWORD CSemiPolyTrojans::NormalizeBuffer(LPBYTE byBuffer, DWORD cbBuffer)
{
	DWORD dwOut = 0;
	bool bFound = false;
	char arrList[] = {'\t', '\n', '\r', ' ', '\0'};

	if(!byBuffer || !cbBuffer)
	{
		return cbBuffer;
	}

	for(DWORD i = 0; i < cbBuffer; i++)
	{
		bFound = false;
		for(DWORD j = 0; j < sizeof(arrList); j++)
		{
			if(byBuffer[i] == arrList[j])
			{
				bFound = true;
				break;
			}
		}

		if(!bFound)
		{
			byBuffer[dwOut++] = byBuffer[i] >= 'A' && byBuffer[i] <= 'Z'? byBuffer[i] + 32: byBuffer[i];
		}
	}

	return dwOut;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentCP
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.CP Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentCP()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	/*if(m_wNoOfSections == 0x3 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x4C20 && m_dwAEPMapped == 0x3E20 &&
	m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x200 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA600 &&
	m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xA566 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
	(m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) == 0x60000020 &&
	m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x1647C && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x8C &&
	m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].VirtualAddress == 0x1669C && m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].Size == 0x194)*/ // Old Checks

	if(m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4 && m_wAEPSec == 0x00 || m_wAEPSec == 0x01 && m_dwAEPUnmapped == 0x4C20 && m_dwAEPMapped == 0x3E20 || m_dwAEPMapped == 0x4020 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x200 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11000 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xA566 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x11000  && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
		(m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) == 0x60000020 || (m_pSectionHeader[m_wAEPSec].Characteristics & 0xE00000A0) == 0xE00000A0 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x1647C || m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x1B000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x8C || m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x184 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].VirtualAddress == 0x1669C || m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].VirtualAddress == 0x0000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].Size == 0x194 || m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].Size == 0x0000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTCP_BUFF_SIZE = 0x170;
		m_pbyBuff = new BYTE[AGENTCP_BUFF_SIZE];
		DWORD dwBuffSize = 0x120;


		if( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA600 )
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x200, 0x120, 0x120))
			{
				return iRetStatus;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0xA35, 0x40, 0x40))
			{
				return iRetStatus;
			}

		}
		else if( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11000 )
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xB200, 0x120, 0x120))
			{
				return iRetStatus;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xBA35, 0x40, 0x40))
			{
				return iRetStatus;
			}

		}
		dwBuffSize += 0x40;

		TCHAR AGENTCP_SIG[] = {_T("6D737372762E657865*534F4654574152455C4D6963726F736F66745C57696E646F77735C43757272656E7456657273696F6E5C52756E006D737372763332*6D75746578363636*433A5C70617373776F72642E747874*433A5C64656275672E747874")};
		CSemiPolyDBScn polydbObj;		
		polydbObj.LoadSigDBEx(AGENTCP_SIG, _T("Poly.Worm.Agent.CP"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCinmus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Cinmus Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCinmus()
{
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL &&
		m_wNoOfSections == 5 && m_wAEPSec == 0 && ((m_dwAEPUnmapped & 0xD) == 0xD) && 
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 && 
		m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&  
		m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x1A000 &&  
		m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 &&
		(m_pSectionHeader[3].SizeOfRawData == 0x1000 || m_pSectionHeader[3].SizeOfRawData == 0x2000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x1500; 
		m_pbyBuff = new BYTE[BUFF_SIZE];		
		DWORD dwBytesToRead = m_pSectionHeader[3].SizeOfRawData - 0x500;
		if(dwBytesToRead > 0x1500)
		{
			dwBytesToRead  = 0x1500;
		}

		if(GetBuffer(m_pSectionHeader[3].PointerToRawData + 0x500, dwBytesToRead, dwBytesToRead))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			// Signature is CLSID of BHO: {285AB8C6-FB22-4D17-8834-064E2BA0A6F0}
			TCHAR szSig[] = {_T("7B32383541423843362D464232322D344431372D383833342D3036344532424130413646307D*4D534654020001")};
			polydbObj.LoadSigDBEx(szSig, _T("Adware.Cinmus.aiyk"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
			// If signature not found in 3rd section then try 4th section
			dwBytesToRead = m_pSectionHeader[4].SizeOfRawData - 0x500;
			if(dwBytesToRead > 0x1500)
			{
				dwBytesToRead  = 0x1500;
			}
			if(GetBuffer(m_pSectionHeader[4].PointerToRawData + 0x500, dwBytesToRead, dwBytesToRead))
			{
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRbotHyj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Rbot.hyj Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRbotHyj()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_pSectionHeader[0].VirtualAddress == 0x1000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		/*if( (m_wNoOfSections == 6 || m_wNoOfSections == 7) && m_wAEPSec == 0 && m_dwAEPUnmapped == 0x1280 && 
			memcmp(m_pSectionHeader[0].Name, ".text", 5) == 0 && memcmp(m_pSectionHeader[1].Name, ".data", 5) == 0 && 
			memcmp(m_pSectionHeader[2].Name, ".idata", 6) == 0 && memcmp(m_pSectionHeader[3].Name, ".rdata", 6) == 0 && 
			memcmp(m_pSectionHeader[4].Name, ".bss", 4) == 0 && memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".rsrc", 5) == 0)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BUFF_SIZE = 0x3000;
			m_pbyBuff = new BYTE[BUFF_SIZE];		
			if(GetBuffer(m_dwAEPMapped, BUFF_SIZE, BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szVirusName[MAX_PATH] = {0};
				TCHAR szSig[] = {_T("8B45088B750C8B7D100FB7C889C3C1EB10B80100000085F60F84F200000085FF0F84*E300000089FA81FFB01500007605BAB015000029D783FA0F0F8E8E0000000FB606*0FB6460F01C101CB83C61083EA1083FA0F0F8F72FFFFFF85D2740B0FB60601C14601CB4A75F5*B871800780F7E1C1EA0F69D2F1FF000029D1B871800780F7E3C1EA0F69D2F1FF000029D385FF0F")};
				polydbObj.LoadSigDBEx(szSig, _T("Poly.Backdoor.Rbot.hyj"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}*/
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x900;
		m_pbyBuff = new BYTE[BUFF_SIZE];		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOffset = m_pSectionHeader[0].PointerToRawData + m_pSectionHeader[0].SizeOfRawData - 0x600;	
		GetBuffer(dwReadOffset, 0x600, 0x600);

		if(m_wAEPSec == 0 && m_dwAEPMapped - 0x200 < dwReadOffset)
		{
			if(m_pMaxPEFile->ReadBuffer(&m_pbyBuff[m_dwNoOfBytes], m_dwAEPMapped - 0x200, 0x300, 0x300))
			{
				m_dwNoOfBytes += 0x300;
			}
		}
		CSemiPolyDBScn polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szSig[] = {_T("5F5E5B8BE55DC3006B65726E656C33322E646C6C*457C636F726B40676A6B4700FFFFFFFF*4F50454E00000000558BEC33C055*400064FF3064892033C05A595964*558BEC83C4EC33C08945ECB844244000E8*45ECE8*FFFFFFFF04000000616E6479")};
		polydbObj.LoadSigDBEx(szSig, _T("Poly.Backdoor.Rbot.hyj"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectTentRootkit
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Tent Family
					  driver files detection
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTentRootkit()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	DWORD dwBaseOfCode = 0;
	if(!m_pMaxPEFile->ReadBuffer(&dwBaseOfCode, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x2C, 4, 4))
	{
		return iRetStatus;
	}

	if(m_wNoOfSections == 6 && (m_dwAEPUnmapped % 0x10 == 5) && dwBaseOfCode == 0x480 && m_pMaxPEFile->m_stPEHeader.Subsystem == 1 &&
		(memcmp(m_pSectionHeader[0].Name, "page", 4) == 0) && m_pSectionHeader[0].SizeOfRawData > 0x6000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff  = NULL;
		}
		m_pbyBuff = new BYTE[0x3000];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, 0x3000);
		if(GetBuffer(m_pSectionHeader[0].PointerToRawData, 0x100, 0x100))
		{
			const BYTE bySignature1[] = {0x83, 0x65, 0xFC, 0x00, 0xB8, 0x68, 0x58, 0x4D, 0x56, 0xBB, 0x00, 0x00, 0x00, 0x00, 0xB9, 0x0A, 0x00, 0x00, 0x00,
				0xBA, 0x58, 0x56, 0x00, 0x00, 0xED, 0x81, 0xFB, 0x68, 0x58, 0x4D, 0x56, 0x75, 0x04, 0xC6, 0x45, 0xE7, 0x01, 0xEB,
				0x07, 0x33, 0xC0, 0x40, 0xC3, 0x8B, 0x65, 0xE8, 0xC7, 0x45, 0xFC, 0xFE, 0xFF, 0xFF, 0xFF, 0x8A, 0x45, 0xE7, 0xE8};

			for(DWORD dwIndex = 0; dwIndex < m_dwNoOfBytes - sizeof(bySignature1); dwIndex++)
			{
				if(memcmp(&m_pbyBuff[dwIndex], bySignature1, sizeof(bySignature1)) == 0)
				{
					if(GetBuffer(0x6000, 0x3000, 0x2000))
					{
						const BYTE bySignature2[]={0x8B, 0xFF, 0x55, 0x8B, 0xEC, 0x8B, 0x01, 0x6A, 0x00, 0x6A, 0x04, 0x8D, 0x55, 0x08, 0x52, 0xFF,
							0x50, 0x08, 0x5D, 0xC2, 0x04, 0x00};

						for(DWORD dwIndex = 0; dwIndex < m_dwNoOfBytes - sizeof(bySignature2); dwIndex++)
						{
							if(memcmp(&m_pbyBuff[dwIndex], bySignature2, sizeof(bySignature2))==0)
							{
								_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("RootKit.Tent.cjt"));
								return VIRUS_FILE_DELETE;
							}
						}
					}
					return iRetStatus;
				}
			}
		}
	}

	// driver dropper files detection
	WORD wMajorOSVersion = 0;
	m_pMaxPEFile->ReadBuffer(&wMajorOSVersion, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x42, 2, 2);
	if(m_pMaxPEFile->m_stPEHeader.SizeOfCode == 0x1A00 && m_pMaxPEFile->m_stPEHeader.SizeOfHeaders == 0x400 && 
		wMajorOSVersion == 0x4 &&	(memcmp(m_pSectionHeader[3].Name,"xdata",5)== 0) && 
		m_pSectionHeader[0].VirtualAddress == 0x1000 && m_pSectionHeader[1].VirtualAddress == 0x3000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff  = NULL;
		}
		m_pbyBuff = new BYTE[0x50];
		if(GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x60, 0x50,0x50))
		{
			const BYTE bySignature[]={0x22, 0x00, 0x64, 0x65, 0x6C, 0x20, 0x22, 0x00, 0x22, 0x20, 0x67, 0x6F, 0x74, 0x6F, 0x20, 0x74, 0x72, 0x79, 0x0D, 0x0A,
				0x00, 0x22, 0x0D, 0x0A, 0x69, 0x66, 0x20, 0x65, 0x78, 0x69, 0x73, 0x74, 0x20, 0x22, 0x00, 0x3A, 0x74, 0x72, 0x79, 0x0D,
				0x0A, 0x64, 0x65, 0x6C, 0x20, 0x22, 0x00, 0x2E, 0x62, 0x61, 0x74};
			if(memcmp(m_pbyBuff,bySignature,sizeof(bySignature))==0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("RootKit.Dropper.Tent"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSecurityShield
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of SecurityShield Family
					  Variants Covered Under 55 Semi-poly Signatures...
aua,atz,att,ats,atr,atm,ati,ath,atg,atf,atc,atb,asw,ash,asg,asd,asb,art,ari,are,arc,ara,aqv,aqn,aqm,aql,aqj,aqf,aqc,aqb,
apz,apw,apu,aph,anx,ans,ano,ami,amf,alv,alr,alq,akp,akm,akj,aki,akd,akc,ajy,ajw,aju,ajs,ajo,ajm,ajg,ajb,aja,ait,ais,air,
aiq,aii,aih,aib,aia,ahz,aht,ahm,ahl,ahi,ahh,ahf,agp,agn,agi,agh,agc,agb,afy,afw,aft,afo,afk,aes,aer,abl,abk,abj,abg,abf,
abd,abc,aba,aaz,aay,aax,aav,aau,aar,aaq,aam
bzv,bzl,bzi,bzh,byi,byd,bxv,bxo,bxl,bxj,bxf,bxa,bwy,bww,bwv,bwl,bwh,bwf,bwb,bvn,bvh,bvd,buz,buy,bux,buv,bun,bul,buk,buj,
btw,bte,btc,bsd,brz,bru,brt,brr,brp,brn,brl,brj,bri,brh,brg,brf,brd,brc,brb,bqv,bqt,bqr,bqq,bqo,bqj,bqa,bpw,bpn,bpm,bph,
bpe,bpb,boy
czw,czv,czu,czs,czr,czo,czm,czj,czi,czg,czf,cze,czc,czb,cza,cyz,cyx,cyw,cyv,cyu,cyq,cyp,cym,cyl,cyk,cyg,cyf,cyc,cxz,cxu,
cxs,cxr,cxq,cxo,cxn,cxm,cxl,cxi,cxh,cxg,cxe,cxd,cxa,cwy,cwx,cwu,cwq,cwp,cwo,cwn,cwm,cwl,cwk,cwj,cwh,cwe,cwd,cvz,cvx,cvt,
cvl,cvj,cvh,cvg,cvf,cvd,cvc,cvb,cux,cuu,cuo,cun,cui,cuf,cud,cuc,cub,cua,cty,ctx,ctw,ctv,ctu,ctr,ctp,ctj,ctg,cte,ctb,csx,
csw,csv,cst,css,csr,csp,csl,csh,csg,csa,crz,crw,crt,crr,cro,crn,crm,crl,crk,crj,crh,cre,crb,cra,cqz,cqy,cqv,cqu,cqt,cqr,
cqq,cqp,cqo,cqn,cql,cqk,cqi,cqh,cqg,cqe,cpz,cpy,cpw,cpv,cpu,cpt,cps,cpr,cpq,cpp,cpo,cpl,cpk,cpi,cph,cpg,cpe,cpc,cpa,coy,
cox,cow,cov,cou,cor,coq,coo,coj,coh,cog,cof,coe,cnz,cnv,cns,cnj,cnf,cnc,cmz,cmy,cmx,cmw,cmu,cms,cmo,cmi,cmg,cly,clw,clt,
cls,clq,clo,cll,cli,clh,clg,clc,clb,ckz,ckx,cks,ckq,ckn,ckm,ckk,ckj,ckg,cke,ckd,cix,cih,chg,cgt,cft,cfe,ceb,cdv,cdr,cdf,
cct,ccp,cch,ccd,cbw,cbv,cbt,cbs,cbr,cbo,cbn,cbm,cbl,cbd,cba,caz,cax,cas,caq,cap,cah
dzp,dwl,dwk,dvn,dvj,dum,due,dsv,dso,dqu,dqk,dpu,dpb,dop,doe,dnl,dmg,dmf,dlw,dlu,dln,dlj,dlh,dle,dlb,dkz,dkx,dkw,dkp,dko,
dkg,djw,djv,dju,djr,djp,djn,djh,djf,djd,djb,diy,diu,dis,dhr,dhk,dhh,dhg,dhf,dhb,dha,dgw,dgk,dft,dfp,dei,dds,dcp,dcc,dcb,
dca,dbz,dby,dbx,dbw,dbt,dbq,dbp,dbo,dbk,dbj,dbh,dbi,dbg,dbf,dbe,dbc,dbb,dar,daq,dap,dak,daj,dai,dah,dag,daf,d
ezz,ezy,ezw,ezr,ezp,eyt,eyr,eyo,eyh,eyc,exu,ext,ewt,ewp,ewj,eut,eul,euc,etl,etk,etj,eth,erc,era,equ,eqo,eph,eon,emz,ely,
elq,eli,ekl,ekj,ekh,ejr,eil,ehx,ehp,eet,eee,edu,edr,ecv,eby,ebo,ead,e
fzq,fzg,fyp,fxf,fwy,fwn,fwh,fvg,fux,ftk,fsy,fsd,fsc,frw,frv,frp,frk,frg,frd,frc,fpu,foq,fon,fom,fok,foh,fma,flp,fkl,fhq,
fhg,ffv,ffs,ffl,ffb,fet,fdm,fdi,fcz,fcu,fcp,fcc,fcb,fbz,fbo,fbm,fax,faw,fat,fas,faq,fao,fan,fak,faj,fae,f
gyr,gyf,gxm,gxk,gxj,gxd,gxb,gwv,gwz,gwt,gwr,gwp,gwo,gwl,gwj,gwi,gwd,gvp,gvq,gvo,gvm,gvk,gvi,gvg,gvd,gvc,gva,guz,guy,guo,
gui,guh,gua,gtv,gtn,gt,gsx,gsq,gso,gse,gs,grv,grq,gpl,gru,grs,gpi,gpf,gpa,goy,gow,gol,goc,gnd,gmz,gmt,gms,gmr,gmp,gly,glw,
gjv,gjt,gjs,giu,gic,gib,ghy,ghg,ggk,ggd,gfy,gfs,geb,gdm,gdg,gcg,gcf,gbm,gbj,gar,gad,g	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSecurityShield()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections >= 0x3 && m_wAEPSec == 0x0 &&
		(m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 || m_pSectionHeader[m_wAEPSec].Characteristics == 0xE0000060)&& 
		 (m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x28 || m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size >= 0x50)
		 || m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x3C)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SECURITYSHIELD_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[SECURITYSHIELD_BUFF_SIZE];		
		DWORD dwBuffSize = 0x0;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], 0x0, 0x400, 0x400))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x400;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_dwAEPMapped, 0x150, 0x150))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x150;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData, 0x200, 0x200))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x200;
		if(m_wNoOfSections > 3)
		{
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x3].PointerToRawData - 0x1200, 0x1000, 0x1000))
			{
				return iRetStatus;
			}
			dwBuffSize += 0x1000;
			if(m_dwAEPUnmapped != 0x1416)
			{
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData , 0x200, 0x200))
				{
					return iRetStatus;
				}
				dwBuffSize += 0x200;
			}
		}
		
		TCHAR ATM_SIG[] = {_T("8B483B8D040883C0288B0060B4132AC40F8F*FFFF61C300*6B0065007200610067006800650074006A006F00700079006C006F00610072006300610074007300720076002E0064006C006C0000006B006F006B0065006A0073006F00700068006A00730065006B006C007A0070")};
		TCHAR ASH_SIG1[]= {_T("4DFC8941188B55FC8B45FC8B4A143B481873188B55FC8B45FC8B4A1C3B481875086A0AFF15*1F2F3A778A3222*73646C676839303332343536376C61736972742E78676D6C6B5F3872000000004EE640BB")};
		TCHAR ASH_SIG2[]= {_T("4DFC8941188B55FC8B45FC8B4A143B481873188B55FC8B45FC8B4A1C3B481875086A0AFF15*1F2F3A778A3222*7379732072656374D181206C747236376C617346582E78676D6C725F387200004EE640BB")};
		TCHAR ASD_SIG[]= {_T("8BFF558BEC83EC*750070006E00700063006F006E0074002E006500780065")};
		TCHAR ASB_SIG[] = {_T("F54B454F*2E78766461*2E72656C63*736A6466732E6A6577")};
		TCHAR ART_SIG[] = {_T("2E7876657461*2E6E67617461*26313B46505B65707A858F9AA4AFB9C4CED9E3EEF8030D18222D37424C57616C76*48535D68727D87929CA7B1BCC6D1DBE6F0FB05101A252F3A444F59646E79")};
		TCHAR AAM_SIG[] = {_T("740C81CE008000008935*751F8B483C03C881395045000075120FB741183D0B010000741F3D0B02000074058975E4*6170702E696E6900386165332D363332613533003838376A686E65455645")};
		TCHAR AAU_SIG[] = {_T("740C81CE008000008935*751F8B483C03C881395045000075120FB741183D0B010000741F3D0B02000074058975E4*736C782E73746E006C73686434323233342D323300000000386165332D3633326135330037386A686A6B7453594E43")};
		TCHAR ABF_SIG[] = {_T("740C81CE008000008935*751F8B483C03C881395045000075120FB741183D0B010000741F3D0B02000074058975E4*7B38392D333253594E4F55547D0000007B38392D333253594E494E7D000000003733344556")};
		TCHAR APZ_SIG[] = {_T("2E7664617461*2E7376617461*2E7867617461*626466686A6C6E70727476787A7C7E*222426282A2C2E30323436383A3C3E40424446484A4C4E50525456585A5C5E60")};
		TCHAR AGH_SIG[] = {_T("0164FF3064892050FFD158648F005950E8*FFFF61C3FF74240C5883C0748B4C240883E9*636C65616E6D67722E657865")};
		TCHAR ASG_SIG[] = {_T("EB1E8B4DFC8B511483C2018B45FC8950148B4DFC8B511883C2018B45FC8950188B4DFC*1F2F3A778A3222*666E6A6B6A34353637386C6F72786A2E786C6B5F697200004EE640BB")};
		TCHAR APU_SIG[] = {_T("2350394F*2E6D64617461*2E7864617461*EB1E8B4DFC8B511483C2018B45FC8950148B4DFC8B511883C2018B45FC8950188B4DFC*06060707080809090A0A0B0B0C0C0D0D0E0E0F0F1010111112121313")};
		TCHAR APW_SIG[] = {_T("2A653B4F*2E6C64617461*2E7764617461*75086A00FF155CA001016A0A6A006A00FF1534A001016A00E8*06060707080809090A0A0B0B0C0C0D0D0E0E0F0F1010111112121313")};
		TCHAR ATR_SIG[] = {_T("740C81CE008000008935*751F8B483C03C881395045000075120FB741183D0B010000741F3D0B02000074058975E4*304900010000000000000000DE3200015C3C0001*1F1F0A117000000000000000000001030101")};
		TCHAR AER_SIG[] = {_T("6A026A006850E00901E8*586003403B8D40288B002C400F87*D00901FF62FF008D15*7400610073006B006D00670072002E006500780065")};
		TCHAR A_SIG[] = {_T("6A026A006850E00901E8*586003403B8D40288B002C200F87*D00901FF62FF008D15*6D007300690065007800650063002E006500780065")};
		TCHAR BUZZ_SIG[] = {_T("6A3C598B0C0883E9AF8B0408C1E8*FFFF61FF1424*61007A0072006F006C00650073007E0064006C006C")};
		TCHAR D_SIG[] = {_T("5E000164A100000000506489250000000083EC585356578965E8FF15C480000133D28AD48915*64736D663A5C70623F6E7344584758005A6F667459617265")};//D+E
		TCHAR DIS_SIG[] = {_T("740C81CE008000008935*751F8B483C03C881395045000075120FB741183D0B010000741F3D0B02000074058975E4*0D010A0A33122100C00B1A")};
		TCHAR F_SIG[] = {_T("5E000164A100000000506489250000000083EC585356578965E8FF15*736C796D783A5C70623F676B4758*6F667446617265")};//F+G
		TCHAR GEN_SIG[] = {_T("81342402300001*C1E010FF703A59C1E910807C081D50720F83C11D803C088077065BE8")};
		TCHAR HDC_SIG[] = {_T("00B00601*30000166832100FF31588BD06A3C010424*8B54101CC1CA0833C0")};
		TCHAR APP_SIG[] = {_T("A54A354F*16140000*2E7764617461*2E6664617461*506A00FF1554A001018B4DF451FF155CA001016A00E81AFFFFFF83C4046A0068E80300006A0A8B55F852FF1564A001016A016A006A00E81A82010033C08BE55D*78787878")};

		CSemiPolyDBScn polydbObj;	
		TCHAR szVirusName[MAX_PATH] = {0};
		
		polydbObj.LoadSigDBEx(ATM_SIG, _T("Trojan.FakeAV.SecurityShield.atm"), TRUE);
		polydbObj.LoadSigDBEx(ASH_SIG1, _T("Trojan.FakeAV.SecurityShield.ash"), TRUE);
		polydbObj.LoadSigDBEx(ASH_SIG2, _T("Trojan.FakeAV.SecurityShield.ash"), TRUE);
		polydbObj.LoadSigDBEx(ASD_SIG, _T("Trojan.FakeAV.SecurityShield.asd"), TRUE);
		polydbObj.LoadSigDBEx(ASB_SIG, _T("Trojan.FakeAV.SecurityShield.asb"), TRUE);
		polydbObj.LoadSigDBEx(ART_SIG, _T("Trojan.FakeAV.SecurityShield.art"), TRUE);
		polydbObj.LoadSigDBEx(AAM_SIG, _T("Trojan.FakeAV.SecurityShield.aam"), TRUE);
		polydbObj.LoadSigDBEx(AAU_SIG, _T("Trojan.FakeAV.SecurityShield.aau"), TRUE);
		polydbObj.LoadSigDBEx(ABF_SIG, _T("Trojan.FakeAV.SecurityShield.abf"), TRUE);
		polydbObj.LoadSigDBEx(APZ_SIG, _T("Trojan.FakeAV.SecurityShield.apz"), TRUE);
		polydbObj.LoadSigDBEx(AGH_SIG, _T("Trojan.FakeAV.SecurityShield.agh"), TRUE);
		polydbObj.LoadSigDBEx(ASG_SIG, _T("Trojan.FakeAV.SecurityShield.asg"), TRUE);
		polydbObj.LoadSigDBEx(APU_SIG, _T("Trojan.FakeAV.SecurityShield.apu"), TRUE);
		polydbObj.LoadSigDBEx(APW_SIG, _T("Trojan.FakeAV.SecurityShield.apw"), TRUE);
		polydbObj.LoadSigDBEx(AER_SIG, _T("Trojan.FakeAV.SecurityShield.aer"), TRUE);
		polydbObj.LoadSigDBEx(ATR_SIG, _T("Trojan.FakeAV.SecurityShield.atr"), TRUE);
		polydbObj.LoadSigDBEx(A_SIG, _T("Trojan.FakeAV.SecurityShield.a"), TRUE);
		polydbObj.LoadSigDBEx(BUZZ_SIG, _T("Trojan.FakeAV.SecurityShield.buzz"), TRUE);
		polydbObj.LoadSigDBEx(D_SIG, _T("Trojan.FakeAV.SecurityShield.d"), TRUE);
		polydbObj.LoadSigDBEx(DIS_SIG, _T("Trojan.FakeAV.SecurityShield.dis"), TRUE);
		polydbObj.LoadSigDBEx(F_SIG, _T("Trojan.FakeAV.SecurityShield.f"), TRUE);
		polydbObj.LoadSigDBEx(GEN_SIG, _T("Trojan.FakeAV.SecurityShield"), TRUE);
		polydbObj.LoadSigDBEx(HDC_SIG, _T("Trojan.FakeAV.SecurityShield.hdc"), TRUE);
		polydbObj.LoadSigDBEx(APP_SIG, _T("Trojan.FakeAV.SecurityShield.app"), FALSE);		

		if((polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0))
		{					
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectHIGEN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Higen Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectHIGEN()
{
	if((memcmp(m_pSectionHeader[2].Name, ".data", 5) == 0) &&
		((m_pSectionHeader[2].Characteristics & 0xC0000040) == 0xC0000040) &&
		((m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) == 0x60000020) &&
		((m_pSectionHeader[m_wNoOfSections - 1].Characteristics & 0x42000040) == 0x42000040) &&
		((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL))
	{
		DWORD dwSizeOfRawData = 0;
		DWORD dwPointerToRawData = 0;
		dwSizeOfRawData = m_pSectionHeader[2].SizeOfRawData;
		dwPointerToRawData = m_pSectionHeader[2].PointerToRawData;
		if(dwSizeOfRawData != 0 && dwSizeOfRawData <= 0x1000)
		{
			if(m_pbyBuff)
			{
				delete[] m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int HI_GEN_BUFF = dwSizeOfRawData;
			m_pbyBuff = new BYTE[HI_GEN_BUFF];
			if(GetBuffer(dwPointerToRawData, HI_GEN_BUFF, HI_GEN_BUFF))
			{
				CSemiPolyDBScn polydbObj;	 
				const TCHAR HI_GEN_SIG2[] = {_T("79756D6964696D61702E646C6C00000079756B73757365722E646C6C00000000*4B73437265617465546F706F6C6F67794E6F6465000000004B73437265617465")};
				polydbObj.LoadSigDBEx(HI_GEN_SIG2, _T("Trojan.HI.GEN"), FALSE);
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;	
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanBHO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Trojan.BHO Family
					  Trojan.BHO.cbdw
					  Trojan.BHO.cbdy
					  Trojan.BHO.amuo
					  Sig Region  : .rsrc section, Overlay
					  A. Installation:
					  - Most of DLLs makes registry entrys.
					  * 3 Samples are exe not done detection for them.
						Intention  : 	1. CLSID + MFTS
						Detection  : 100% (342/342)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanBHO()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0 && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL))		
	{
		//-----------------------------Trojan.BHO.CACX---------------------------------------
		if(m_dwAEPUnmapped == 0xCBA0 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 && 		
			m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000 &&
			m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x117FA && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
			m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x1E000)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCACX_BUFF_SIZE = 0x700;
			m_pbyBuff = new BYTE[BHOCACX_BUFF_SIZE];
			
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x3A00, BHOCACX_BUFF_SIZE, BHOCACX_BUFF_SIZE))
			{
				TCHAR szSig[] = {_T("73006100660065006D006F006E0020002E0064006C006C*41363732343836322D393539362D344334412D413334392D313232334544373045434143*4D534654")};
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CACX"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCACX_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CECL---------------------------------------
		else if((m_dwAEPUnmapped == 0x9147) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11600) && 
			(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x11418) && (m_pSectionHeader[1].SizeOfRawData == 0x5000))
		{
			BYTE BHOCECL_BUF[0x10] = {0};
			BYTE BHOCECL[] = {0x68,0x74,0x74,0x70,0x3A,0x2F,0x2F,0x6A,0x75,0x79,0x68,0x31,0x32,0x2E,0x6D,0x65};
			if(m_pMaxPEFile->ReadBuffer(BHOCECL_BUF,m_pSectionHeader[1].PointerToRawData + 0x574,0x10,0x10))
			{
				if(memcmp(&BHOCECL_BUF[0x00],BHOCECL,sizeof(BHOCECL)) == 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.BHO.CECL"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
		//-----------------------------Trojan.BHO.CGOZ---------------------------------------
		else if((m_dwAEPUnmapped == 0x18806) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22000) && 
			(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x21B89) && (m_pSectionHeader[4].Misc.VirtualSize == 0x2EBE ))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCGOZ_BUFF_SIZE = 0x70;
			m_pbyBuff = new BYTE[BHOCGOZ_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0xBF0, BHOCGOZ_BUFF_SIZE, BHOCGOZ_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("7B31314630394146452D373541442D344535322D414234332D4530394539333531434531377D*6370757368")}; // CLSID Key and Cpush name of dll
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CGOZ"), FALSE);
			
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCGOZ_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Adware.BHO.GeN---------------------------------------
		else if((((m_dwAEPUnmapped & 0xF000) == 0x4000 || (m_dwAEPUnmapped & 0xF000) == 0x3000) &&
			     ((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xF000) == 0x5000 || (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xF000) == 0x6000)) ||
			    ((m_dwAEPUnmapped & 0xFF00F) == 0x14005 && 
			     (((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xFF000) == 0x1E000) || ((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xFF000) == 0x1F000)))) 
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}

			bool byGetBuffStatus = false;
			DWORD dwOverlayStart = 0x0;

			if((m_dwAEPUnmapped & 0xFF000) == 0x14000)
			{
				 m_pbyBuff = new BYTE [0x150];
				 dwOverlayStart   = m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData;
				 if((m_pMaxPEFile->m_dwFileSize - dwOverlayStart) == 0x0)
					 return iRetStatus;

				 if(GetBuffer(dwOverlayStart, 0x150, 0x150))
					byGetBuffStatus = true;
			}
			else
			{
				m_pbyBuff = new BYTE [0x1000];
				if(!FindResorce(0x1000))
				{
					return iRetStatus;
				}
				else
					byGetBuffStatus = true;
			}
			
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			if(byGetBuffStatus == true)
			{
				TCHAR szSig1[] = {_T("43453743334346302D344231352D313144312D414245442D373039353439433130303030*4D534654")}; // CLSID Key and MSFT
				TCHAR szSig2[] = {_T("9273414B4B4C4E5B879495924C81A23331A384525C5C5D606C9193A1A8A85E93*1B250A134869FAF86A4B192325242A3334215677080678592731333239412B2F")};// OverLay Encrypted Data 
				polydbObj.LoadSigDBEx(szSig1, _T("Adware.BHO.GeN"), TRUE);
				polydbObj.LoadSigDBEx(szSig2, _T("Adware.BHO.GeN"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CBDY---------------------------------------
		else if((m_dwAEPUnmapped == 0x11877) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11000) && 
			(m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData == 0x23000) && (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2000 ))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCGOZ_BUFF_SIZE = 0xE0;
			m_pbyBuff = new BYTE[BHOCGOZ_BUFF_SIZE];
			
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0], m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x75E5, 0x70, 0x70))
				return iRetStatus;

			m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x70], m_pSectionHeader[m_wNoOfSections - 0x1].PointerToRawData + 0x15E5, 0x70, 0x70);	// if Sign at last section.
	
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("43354343344443322D354343452D343841312D413030462D3738363530374537413633417D*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.cbdy"), FALSE);
		
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCGOZ_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
			
		}//-----------------------------Trojan.BHO.CBDW---------------------------------------
		else if(m_dwAEPUnmapped == 0x15325 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15000 && 
			(m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData == 0x27000) && (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2000 ))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHO_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHO_BUFF_SIZE];
			
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0], m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x75E5, BHO_BUFF_SIZE, BHO_BUFF_SIZE))
				return iRetStatus;
	
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("42463344424646322D314230322D344641322D384241332D4530354542333334384141357D*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.cbdw"), FALSE);
		
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHO_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	} 
	else if((m_wNoOfSections == 0x13) && (m_wAEPSec == 0x0) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL))
	{
		//-----------------------------Trojan.BHO.CKFQ---------------------------------------
		if((m_dwAEPUnmapped == 0x2717F) && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x356B4))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKFQ_BUFF_SIZE = 0x60;
			m_pbyBuff = new BYTE[BHOCKFQ_BUFF_SIZE];
			
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0xA640, BHOCKFQ_BUFF_SIZE, BHOCKFQ_BUFF_SIZE))
			{
				TCHAR szSig[] = {_T("7B41423730353632322D423235422D343931422D413642462D3441343646444442433838457D*4D534654")}; // CLSID Key and MSFT
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfq"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKFQ_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CKFS---------------------------------------
		else if((m_dwAEPUnmapped == 0x270CF) && ((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x35614)||(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3561A))
			&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35800)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKFS_BUFF_SIZE = 0x1000;
			m_pbyBuff = new BYTE [BHOCKFS_BUFF_SIZE];
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			
			if(!FindResorce(BHOCKFS_BUFF_SIZE))
			{
				return iRetStatus;
			}
			TCHAR szSig[] = {_T("7B41423730353632322D423235422D343931422D413642462D3441343646444442433838457D*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfs"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
		//-----------------------------Trojan.BHO.CKKN---------------------------------------
		else if((m_dwAEPUnmapped == 0x2266F)&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x30400)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKKS_BUFF_SIZE = 0x60;
			m_pbyBuff = new BYTE [BHOCKKS_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			if(!GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x447C, BHOCKKS_BUFF_SIZE, BHOCKKS_BUFF_SIZE))
			{
				return iRetStatus;
			}
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			TCHAR szSig[] = {_T("7B41423730353632322D423235422D343931422D413642462D3441343646444442433838457D*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckkn"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//-----------------------------Trojan.BHO.CI** & CJ**---------------------------------------
	else if((m_wNoOfSections == 0x11) && (m_wAEPSec == 0x0) && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		//-----------------------------Trojan.BHO.CJTP---------------------------------------
		if(m_dwAEPUnmapped == 0x1FEFF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2C600)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKFQ_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCKFQ_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x4ED, BHOCKFQ_BUFF_SIZE, BHOCKFQ_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CJTP"), FALSE);
				
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKFQ_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CJZA---------------------------------------
		else if(m_dwAEPUnmapped == 0x26C8F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35000)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCJZA_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCJZA_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x1C3D, BHOCJZA_BUFF_SIZE, BHOCJZA_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CJZA"), FALSE);
				
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCJZA_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CIOM---------------------------------------
		else if(m_dwAEPUnmapped == 0x212FF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2D600)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCIOM_BUFF_SIZE = 0x1000;
			m_pbyBuff = new BYTE[BHOCIOM_BUFF_SIZE];
			
			if(!FindResorce(BHOCIOM_BUFF_SIZE))
			{
				return iRetStatus;
			}			
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CIOM"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCIOM_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
		//-----------------------------Trojan.BHO.cjqf---------------------------------------
		else if(m_dwAEPUnmapped == 0x2123F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2E600)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCJQF_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCJQF_BUFF_SIZE];
					
			if(!GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x147D, BHOCJQF_BUFF_SIZE, BHOCJQF_BUFF_SIZE))
			{
				return iRetStatus;
			}
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CJQF"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCJQF_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}//-----------------------------Trojan.BHO.cjvz---------------------------------------
		else if(m_dwAEPUnmapped == 0x2563F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x32C00)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCJVZ_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCJVZ_BUFF_SIZE];
				
			DWORD dwBuffOffset = m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x1C3D;
			if(m_pSectionHeader[m_wNoOfSections - 0x2].SizeOfRawData == 0x1600)
				dwBuffOffset = m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0xEBD;

			if(!GetBuffer(dwBuffOffset, BHOCJVZ_BUFF_SIZE, BHOCJVZ_BUFF_SIZE))
			{
				return iRetStatus;
			}
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CJVZ"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCJVZ_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}//-----------------------------Trojan.BHO.ckcw---------------------------------------
		else if(m_dwAEPUnmapped == 0x232BF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x30A00)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKCW_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCKCW_BUFF_SIZE];
				
			DWORD dwBuffOffset = m_pSectionHeader[m_wNoOfSections - 0x2].VirtualAddress + 0x129D;
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
				return iRetStatus;

			if(!GetBuffer(dwBuffOffset, BHOCKCW_BUFF_SIZE, BHOCKCW_BUFF_SIZE))
				return iRetStatus;

			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckcw"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKCW_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
		//-----------------------------Trojan.BHO.chqm---------------------------------------
		else if(m_dwAEPUnmapped == 0x1B92F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x27C00)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKCW_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCKCW_BUFF_SIZE];
				
			DWORD dwBuffOffset = m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x190D;
			if(m_pSectionHeader[m_wNoOfSections - 1].VirtualAddress == 0x3E000)
				dwBuffOffset += 0x1128;

			if(!GetBuffer(dwBuffOffset, BHOCKCW_BUFF_SIZE, BHOCKCW_BUFF_SIZE))
				return iRetStatus;

			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.chqm"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKCW_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//-----------------------------Trojan.BHO.CK** & CH**---------------------------------------
	else if(m_wNoOfSections == 0x12 && m_wAEPSec == 0x0 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		//-----------------------------Trojan.BHO.CKDI---------------------------------------
		if(m_dwAEPUnmapped == 0x2728F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35000)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKDI_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCKDI_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x3155, BHOCKDI_BUFF_SIZE, BHOCKDI_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckdi"), FALSE);
				
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKDI_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CKFB & Trojan.BHO.CKFD---------------------------------------
		else if((m_dwAEPUnmapped == 0x2776F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35E00 ) ||
			(m_dwAEPUnmapped == 0x2783F && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x35E0B))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCKFB_BUFF_SIZE = 0xC0;
			m_pbyBuff = new BYTE[BHOCKFB_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x766A, BHOCKFB_BUFF_SIZE, BHOCKFB_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
				if(m_dwAEPUnmapped == 0x2776F)
					polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfb"), FALSE);
				else
					polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfd"), FALSE);
				
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKFB_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		//-----------------------------Trojan.BHO.CHXA---------------------------------------
		else if(m_dwAEPUnmapped == 0x1EBFF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B400)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BHOCHXA_BUFF_SIZE = 0x57;
			m_pbyBuff = new BYTE[BHOCHXA_BUFF_SIZE];
			
			if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x5EF5, BHOCHXA_BUFF_SIZE, BHOCHXA_BUFF_SIZE))
			{
				CSemiPolyDBScn polydbObj;
				TCHAR szSig[] = {_T("41423730353632322D423235422D343931422D413642462D344134364644444243383845*4D534654")}; // CLSID Key and MSFT
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.chxa"), FALSE);
				
				TCHAR szVirusName[MAX_PATH] = {0};
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCHXA_BUFF_SIZE, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	//-------------------------------------- BHO - Installers -------------------------------------
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL))
	{
		return iRetStatus;
	}
		//---------------------------------- Trojan.BHO.CKKN --------------------------------------
	if(m_wNoOfSections == 0x04 && m_wAEPSec == 0x01 && m_dwAEPUnmapped == 0xD7034 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD89)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BHOCKKN_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[BHOCKKN_BUFF_SIZE];
		DWORD dwBuffOffset = 0x11A909;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		
		if(GetBuffer(dwBuffOffset, BHOCKKN_BUFF_SIZE, BHOCKKN_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("B9CB170000*03C323C751253656072C2BC2B96E155146010EA9064CBA5B3D7E72EF48598BC6*492D634C300F1BC183C60425547E052003C485C975CA")}; // decryption data size and loop
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckkn"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKKN_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	//---------------------------------- Trojan.BHO.CKFB & Trojan.BHO.CKFD--------------------------------------
	else if(m_wNoOfSections == 0x04 && m_wAEPSec == 0x01 && ((m_dwAEPUnmapped == 0xEF070 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD9C) || 
		(m_dwAEPUnmapped == 0xF0057 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD7F)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BHOCKFB_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[BHOCKFB_BUFF_SIZE];
		DWORD dwBuffOffset = 0x1350E1;
		
		if(m_dwAEPUnmapped == 0xF0057)
			dwBuffOffset = 0x136579;
		
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		
		if(GetBuffer(dwBuffOffset, BHOCKFB_BUFF_SIZE, BHOCKFB_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			LPCTSTR szSig = {_T("B9B0170000*33C683C06E5123C2B9AF0E7B9B010FA9DD2D6F0A8BC25905BE15773535E470BC*4D492BC735F26E2C2D83C7048BC01BC285C975CC")}; // decryption data size and loop
			if(m_dwAEPUnmapped == 0xF0057)
			{
				SecureZeroMemory(&szSig, sizeof(szSig));
				szSig = (_T("BAB8170000*8BC2C1D804520BC5BA0E701C7601162DBB62D35183E0A95A23C64A1BC583C604*33C6F8726985D275D7")); //Decryption loop
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfd"), FALSE);
			}else
				polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.ckfb"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCKFB_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	//-------------------------------Trojan.BHO.CJVZ-------------------------------------
	else if(m_wNoOfSections == 0x04 && m_wAEPSec == 0x01 && (m_dwAEPUnmapped == 0xCF06F || m_dwAEPUnmapped == 0xCFDAA) && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xDA8 && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x163D)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BHOCJVZ_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[BHOCJVZ_BUFF_SIZE];
		DWORD dwBuffOffset = 0x111294;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		
		if(GetBuffer(dwBuffOffset, BHOCJVZ_BUFF_SIZE, BHOCJVZ_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("B979170000*C1C01633C05183C8A08BC7B9C6417B51010B33C305401A8334598BC449F8721F*33C283C304B8AB5E212EA9584B4A6785C975D02D")}; // decryption data size and loop
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.CJVZ"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCJVZ_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//-------------------------------Trojan.BHO.chxa-------------------------------------
	else if(m_wNoOfSections == 0x05 && m_wAEPSec == 0x01 && m_dwAEPUnmapped == 0xA3D97 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD5E && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BHOCJVZ_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[BHOCJVZ_BUFF_SIZE];
		DWORD dwBuffOffset = 0xD47C2;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		
		if(GetBuffer(dwBuffOffset, BHOCJVZ_BUFF_SIZE, BHOCJVZ_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("BECD170000*562D1E71D51F33C0BE6B61BBA801320D61664F798BC65E2BC2*B8AD7A78034E0D2A2B0F7323C583C20483E0518BC285F675CE")}; // decryption data size and loop
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.chxa"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCJVZ_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//-------------------------------Trojan.BHO.amuo-------------------------------------
	else if(m_wNoOfSections == 0x04 && m_wAEPSec == 0x0 && (m_dwAEPUnmapped == 0x1364E || m_dwAEPUnmapped == 0x1361E) && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2C000 && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x5000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pMaxPEFile->m_dwFileSizeHigh;

		const int BHOCAMUO_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BHOCAMUO_BUFF_SIZE];
		DWORD dwBuffOffset = m_pSectionHeader[0x1].PointerToRawData + 0xE80;
		if(GetBuffer(dwBuffOffset, BHOCAMUO_BUFF_SIZE, BHOCAMUO_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[] = {_T("67616D6576657273696F6E757064617465315C74656D702E657865*7075622E687967616D65383838382E636E2F6338635F696E692F")}; // gameversionupdate1\temp.exe * pub.hygame8888.cn/c8c_ini/
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.BHO.amuo"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOCAMUO_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCoolMirageLtd
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Mirage Family	
					  A. Installation:	
						- Installs the video downloader and Toolbar.
						- Downloads forcefuly.
						  B. File Modification 
						- Create files related to video downloader and Toolbar.
						- into %Temp% folder.
						C. Registry Modifications:
						- Adds the registry entry for video downloader and toolbar.
				      * NSIS packed. 
  
						Intention  : 
								 1.Trojan.CoolMirage Ltd
								   Company name 	[Cool Mirage ltd, Terra Firma Internet Consulting LTD1, goldple ltd] 
								   Email-id 	[info@coolmirage.com] 
								   Serial no
							
								 2.Trojan.DomaIQ 
									   Company Website link 	[http://www.domaiq.com]  
								   Company Name		[TUGUU SL, Awimba LLC]
						  		
						Detection  : 1.Trojan.CoolMirage Ltd :  98.80% (491/499)
									 2.Trojan.DomaIQ	     :	98.94% (3653/3692)		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCoolMirageLtd()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if	((m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && (((m_dwAEPUnmapped == 0x323C || m_dwAEPUnmapped == 0x30DE) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5C00)|| 
		(m_dwAEPUnmapped == 0x30CB && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5A00) ||
		(m_dwAEPUnmapped == 0x21375 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x32E00)||
		((m_dwAEPUnmapped == 0x30FA || m_dwAEPUnmapped == 0x325E) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5E00)) 
		&& (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".ndata", 6)==0))
		|| (m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && (m_dwAEPUnmapped & 0xF000F) == 0x3000E && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF00FF) == 0x30000 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x2000))
	{

		if(m_wNoOfSections != 0x3)
		{
			// -----------File size chk-----------------
			bool	bFileSize = false, bNSISverion = false, bDomaIQ = false;
			DWORD	dwFileSize = m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData;

			if	(dwFileSize == 0xCE00 || dwFileSize == 0xB400|| dwFileSize == 0xB600|| dwFileSize == 0xB800 || dwFileSize == 0xBA00 ||dwFileSize == 0x7E00 || dwFileSize == 0x10800 || dwFileSize == 0x1C200 || dwFileSize == 0xE000)
			{
				bFileSize = true;
			}
			else
			{
				return iRetStatus;
			}
			
			if(m_pbyBuff)
			{
				delete[] m_pbyBuff;
				m_pbyBuff = NULL;
			}

			int		COOLM_BUFF_SIZE = 0x1A00;
			
			m_pbyBuff = new BYTE[COOLM_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			//-------------NSIS Version chk-----------------
			DWORD	dwType = 0x018, dwNameID = 0x01 , dwLangID = 0x0409, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;
			if(FindRes(LPCTSTR(&dwType), LPCTSTR(&dwNameID), LPCTSTR(&dwLangID), dwRVA, dwSize))
			{
				const BYTE bCoolM[]   = {0x4E, 0x75, 0x6C, 0x6C, 0x73, 0x6F, 0x66, 0x74, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x20, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x20, 0x76, 0x32, 0x2E, 0x34, 0x36}; // Nullsoft Install System v2.46
				const BYTE bDomaIQ0[] = {0x4E, 0x75, 0x6C, 0x6C, 0x73, 0x6F, 0x66, 0x74, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x20, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x20, 0x76, 0x31, 0x34, 0x2D, 0x4F, 0x63, 0x74, 0x2D, 0x32, 0x30, 0x31, 0x32, 0x2E, 0x63, 0x76, 0x73}; //Nullsoft Install System v14-Oct-2012.cvs
				const BYTE bDomaIQ1[] = {0x4E, 0x75, 0x6C, 0x6C, 0x73, 0x6F, 0x66, 0x74, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x20, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x20, 0x76, 0x31, 0x33, 0x2D, 0x4F, 0x63, 0x74, 0x2D, 0x32, 0x30, 0x31, 0x32, 0x2E, 0x63, 0x76, 0x73}; //Nullsoft Install System v13-Oct-2012.cvs
				const BYTE bDomaIQ2[] = {0x4E, 0x75, 0x6C, 0x6C, 0x73, 0x6F, 0x66, 0x74, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x20, 0x53, 0x79, 0x73, 0x74, 0x65, 0x6D, 0x20, 0x76, 0x30, 0x36, 0x2D, 0x4F, 0x63, 0x74, 0x2D, 0x32, 0x30, 0x31, 0x31, 0x2E, 0x63, 0x76, 0x73}; //Nullsoft Install System v06-Oct-2012.cvs
				
				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
				{
					return iRetStatus;
				}

				if(!GetBuffer(dwReadOffset + 0xF8, 0x40, 0x40))
				{
					return iRetStatus;
				}

				if(memcmp(&m_pbyBuff[0x0], bCoolM, sizeof(bCoolM)) == 0)
				{
					bNSISverion = true;
				}
				else if(memcmp(&m_pbyBuff[0x0], bDomaIQ0, sizeof(bDomaIQ0)) == 0 || memcmp(&m_pbyBuff[0x0], bDomaIQ1, sizeof(bDomaIQ1)) == 0 ||memcmp(&m_pbyBuff[0x0], bDomaIQ2, sizeof(bDomaIQ2)) == 0)
				{
					bNSISverion = true;
					bDomaIQ		= true;
				}
			}
			
			if(bNSISverion == true || bFileSize == true)
			{
				DWORD	dwBuffOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress + 0x100;
				if((dwBuffOffset + COOLM_BUFF_SIZE) > m_pMaxPEFile->m_dwFileSize)
				{
					COOLM_BUFF_SIZE = m_pMaxPEFile->m_dwFileSize - dwBuffOffset;
				}
				bool	bCorrupt = false;
				if(!GetBuffer(dwBuffOffset, COOLM_BUFF_SIZE,COOLM_BUFF_SIZE))
				{
					bCorrupt = true;
				}

				CSemiPolyDBScn	objdbscan;
				TCHAR			szVirusName[MAX_PATH] = {0};
				
				if(bCorrupt == false)
				{
					if(bDomaIQ == false)
					{
						LPCTSTR  szCoolMirage  = (_T("436F6F6C204D6972616765206C7464*696E666F40636F6F6C6D69726167652E636F6D*00FC28659CC8073606EF4D09A1994B1AD0"));	//Cool Mirage ltd * info@coolmirage.com * Serial no
						LPCTSTR  szCoolMirage1 = (_T("0A1E86793244EC30F46537E0AE0F0FB3*5465727261204669726D6120496E7465726E657420436F6E73756C74696E67"));			//Serial no * Terra Firma Internet Consulting LTD1
						LPCTSTR  szCoolMirage2 = (_T("676F6C64706C65206C7464*696E666F40636F6F6C6D69726167652E636F6D"));												// goldple ltd * info@coolmirage.com
						LPCTSTR  szDomaIQ3  = (_T("545547555520534C*5045467864576C46625842705A5870685257785159586C73"));
						LPCTSTR  szDomaIQ4  = (_T("4C756E61636F6D20496E746572616374697665204C7464*5045467864576C46625842705A5870685257785159586C")); // Lunacom Interactive Ltd * PEFxdWlFbXBpZXphRWxQYXl
						LPCTSTR  szDomaIQ5  = (_T("54756775752053*5045467864576C46625842705A5870685257785159586C"));								 //Tuguu S * PEFxdWlFbXBpZXphRWxQYXl
						
						objdbscan.LoadSigDBEx(szCoolMirage,  _T("not-a-virus:Trojan.CoolMirage Ltd"), TRUE);
						objdbscan.LoadSigDBEx(szCoolMirage1, _T("not-a-virus:Trojan.CoolMirage Ltd"), TRUE);
						objdbscan.LoadSigDBEx(szCoolMirage2, _T("not-a-virus:Trojan.CoolMirage Ltd"), TRUE);
						objdbscan.LoadSigDBEx(szDomaIQ3, _T("not-a-virus:Trojan.DomaIQ"), TRUE);
						objdbscan.LoadSigDBEx(szDomaIQ4, _T("not-a-virus:Trojan.DomaIQ"), TRUE);
						objdbscan.LoadSigDBEx(szDomaIQ5, _T("not-a-virus:Trojan.DomaIQ"), FALSE);
						if(objdbscan.ScanBuffer(&m_pbyBuff[0], COOLM_BUFF_SIZE, szVirusName)>= 0)
						{
							if(_tcslen(szVirusName)>0)
							{
								_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
								return VIRUS_FILE_DELETE;
							}
						}
					}
					else 
					{
						BYTE	bDomaIQ[] = {0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x77, 0x77, 0x77, 0x2E, 0x64, 0x6F, 0x6D, 0x61, 0x69, 0x71, 0x2E, 0x63, 0x6F, 0x6D}; //http://www.domaiq.com
						if(OffSetBasedSignature(bDomaIQ,sizeof(bDomaIQ),NULL))
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Trojan.DomaIQ"));
							return VIRUS_FILE_DELETE;
						}
					}
				}
				else if(dwFileSize == 0xBA00) // for Corrupt samples
				{
					DWORD	dwBuffOffset = dwFileSize + 0x2A50;
					if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x200, 0x200))
					{
						return iRetStatus;
					}
					LPCTSTR  szDomaIQ  = (_T("446F6D6149512E657865*42616E6E65722E646C6C"));	 //DomaIQ.exe * Banner.dll
					objdbscan.LoadSigDBEx(szDomaIQ,  _T("not-a-virus:Trojan.DomaIQ"), FALSE);
					if(objdbscan.ScanBuffer(&m_pbyBuff[0], 0x200, szVirusName)>= 0)
					{
						if(_tcslen(szVirusName)>0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
							return VIRUS_FILE_DELETE;
						}
					}

				}
				
			}
		}
		else										// For DLL samples DomaIQ
		{
			if(m_pbyBuff)
			{
				delete[] m_pbyBuff;
				m_pbyBuff = NULL;
			}
			int		COOLM_BUFF_SIZE = 0x300;
			m_pbyBuff = new BYTE[COOLM_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			
			DWORD dwBuffOffset = 0x0;
			DWORD dwType = 0x010, dwNameID = 0x01 , dwLangID = 0x0, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;
			
			if(FindRes(LPCTSTR(&dwType), LPCTSTR(&dwNameID), LPCTSTR(&dwLangID), dwRVA, dwSize))
			{
				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
					return iRetStatus;
				
				if(dwSize > COOLM_BUFF_SIZE)
					dwSize = COOLM_BUFF_SIZE;

				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadOffset, COOLM_BUFF_SIZE, COOLM_BUFF_SIZE))
					return iRetStatus;
			}
			
			CSemiPolyDBScn	objdbscan;
			TCHAR			szVirusName[MAX_PATH] = {0};
			LPCTSTR			szDomaIQ3  = (_T("5400750067007500750053002E004C002E0055*44006F006D0061004900510032*44006F006D006100490051002E006500780065"));		// T.u.g.u.u.S...L...U * D.o.m.a.I.Q.2 * D.o.m.a.I.Q.2 * D.o.m.a.I.Q...e.x.e
			
			objdbscan.LoadSigDBEx(szDomaIQ3, _T("not-a-virus:Trojan.DomaIQ"), FALSE);
			if(objdbscan.ScanBuffer(&m_pbyBuff[0], COOLM_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectiBryteX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of IBryte.X Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectiBryteX()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections == 4) && (memcmp(m_pSectionHeader[1].Name, ".rdata", 5) == 0) && ((m_pSectionHeader[1].Characteristics & 0x40000040) == 0x40000040) &&
		(m_pSectionHeader[1].SizeOfRawData > 0x10000) && (m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size != 0))
	{
		const int iBRYTE_BUFF_SIZE = 0x600;
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE [iBRYTE_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x800, 0x300, 0x300) && m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x300], m_pSectionHeader[1].PointerToRawData + 0x1100, 0x300, 0x300))
		{
			TCHAR szSig3[] = {_T("41504E2D53747562*41706E537475622E657865*636865636B5F6F666665725F72702E646C6C")};
			CSemiPolyDBScn polydbObj;			
			polydbObj.LoadSigDBEx(szSig3, _T("Trojan.iBryte.X"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], iBRYTE_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}	
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectProrat
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Prorat Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectProrat()
{
	int iRetStatus = VIRUS_NOT_FOUND;
        if((m_dwAEPUnmapped == 0x1000) &&
		((m_wNoOfSections >= 8) &&
		((m_pSectionHeader[0].SizeOfRawData == 0xB8600) || (m_pSectionHeader[0].SizeOfRawData == 0xB9000))) ||
		(((m_wNoOfSections <= 6)) && ((m_pSectionHeader[0].SizeOfRawData >= 0x1A7000) && (m_pSectionHeader[0].SizeOfRawData <= 0x1FE000))))
	{

		DWORD dwOffset = 0;
		if(!m_pMaxPEFile->ReadBuffer(&dwOffset,m_dwAEPMapped + 0x13, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if (dwOffset < m_dwImageBase)
		{
			return iRetStatus;
		}
		if(dwOffset != 0x004BA3EB)
		{
			return iRetStatus;
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		const int PRORAT_BUFF = 0x100;
		m_pbyBuff = new BYTE[PRORAT_BUFF];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer(0xBF670, PRORAT_BUFF, PRORAT_BUFF))
		{
			return iRetStatus;
		}

	
		TCHAR szSig[] = {_T("50726F526174*54726F6A616E20486F727365")};
		polydbObj.LoadSigDBEx(szSig, _T("Backdoor.W32.Prorat"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PRORAT_BUFF, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
		else
		{
			
			DWORD dwProSec = m_pMaxPEFile->Rva2FileOffset(dwOffset - m_dwImageBase, &dwOffset);
			memset(m_pbyBuff, 0, PRORAT_BUFF);
			if(!GetBuffer(dwOffset + 0x8760, PRORAT_BUFF, PRORAT_BUFF))
			{			
					return iRetStatus;		
			}
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], PRORAT_BUFF, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}		
		}
	}
		
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentSdpu
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Sdpu Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentSdpu()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x2827 && m_dwAEPMapped == 0x1C27 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1A00 &&
		m_pSectionHeader[0].Characteristics == 0x60000020 && m_pSectionHeader[1].Characteristics == 0x40000040 &&
		m_pSectionHeader[2].Characteristics == 0xC0000040 && m_pSectionHeader[3].Characteristics == 0x40000040 &&
		m_pSectionHeader[4].Characteristics == 0x42000040 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress != 0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size != 0)
	{
		DWORD dwReserved = 0; 
		m_pMaxPEFile->ReadBuffer(&dwReserved, 0x1C, 0x4, 0x4);
		if(dwReserved == 0x00)
		{
			return iRetStatus;
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x600];
		if(!GetBuffer(m_dwAEPMapped, 0xA0, 0xA0))
		{			
			return iRetStatus;		
		}
		DWORD dwBuffSize = 0xA0;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x400, 0x100, 0x100))
		{			
			return iRetStatus;		
		}
		dwBuffSize += 0x100;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x3].PointerToRawData + m_pSectionHeader[0x3].SizeOfRawData - 0x400, 0x400, 0x400))
		{			
			return iRetStatus;		
		}
		dwBuffSize += 0x400;

		TCHAR AGENT_SIG[] = {_T("558BEC538B5D08568B750C578B7D1085F67509833D5C45001000EB2683FE0174*4C006F00670069006E004100630063006F0075006E0074004C006900730074*55736572735C416C6C2055736572735C51515C52656769737472792E6462*41006C0065006E00200053006F00660074*5400540050004100640076004300740072006C")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(AGENT_SIG, _T("Poly.Trojan.Agent.SDPU"), FALSE);
		
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMultplugA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Multiplug.A Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMultplugA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x14B04 && m_dwAEPMapped == 0x13F04 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19A00 &&
		m_pSectionHeader[0].Characteristics == 0x60000020 && m_pSectionHeader[1].Characteristics == 0x40000040 &&
		m_pSectionHeader[2].Characteristics == 0xC0000040 && m_pSectionHeader[3].Characteristics == 0xC0000240 &&
		m_pSectionHeader[4].Characteristics == 0x40000040 && memcmp(m_pSectionHeader[0x3].Name, ".sxdata", 7) == 0 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData >= m_pSectionHeader[m_wAEPSec].Misc.VirtualSize  &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x2].VirtualAddress != 0x0000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x2].Size != 0x0000 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].VirtualAddress == 0x1B000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].Size == 0x1F8 &&
		m_pSectionHeader[0x2].SizeOfRawData >= 0x500 && m_pSectionHeader[0x4].SizeOfRawData >= 0x7A0 && m_pSectionHeader[0x4].SizeOfRawData <= 0x10000)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = m_pSectionHeader[0x4].SizeOfRawData;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		
		if(!FindResorce(BUFF_SIZE, true))
		{
			return iRetStatus;
		}
		
		TCHAR MULTPLUG_SIG1[] = {_T("3333333333333330000000000000008F7B7B7B7B7B7B7B33*7B7B7B7B7B333330888880000083333333333333330333307777*444FFFF030F780000000878F1111FFF6664FFF4444*6E6FFFFCE4F780000000878FF991FFFF666F*4444477077077080000000874444444444444770770770800000008744444444")};
		TCHAR szVirusName[MAX_PATH] = {0};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(MULTPLUG_SIG1, _T("AdWare.Multplug.a"), FALSE);
		
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUFF_SIZE, szVirusName) >= 0)
		{
			if(!GetBuffer(m_dwAEPMapped, 0xA0, 0xA0))
			{			
				return iRetStatus;		
			}
			DWORD dwBuffSize = 0xA0;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData , 0x500, 0x500))
			{			
				return iRetStatus;		
			}
			dwBuffSize += 0x500;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x4].PointerToRawData + 0x200, 0x300, 0x300))
			{			
				return iRetStatus;		
			}
			dwBuffSize += 0x300;
		
			TCHAR MULTPLUG_SIG[] = {_T("558BEC6AFF68E0B94100682C4A410064A100000000506489250000000083EC585356578965E8FF1574B0410033D28AD48915D03342008BC881E1FF000000890DCC*496E7374616C6C40215554462D382100002C2140496E7374616C6C456E64402100377A5300250025*42006F7574206F66206D656D6F7279*490067006F00720020005000610076006C006F0076*37007A0020005300650074007500700020005300460058*37007A0053002E007300660078*37007A0053002E007300660078002E006500780065*37002D005A00690070")};
			
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(MULTPLUG_SIG, _T("not-a-virus:AdWare.Win32.Multplug.a"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMSILPetunA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of PetunA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMSILPetunA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections >= 0x3  && 
		m_pSectionHeader[m_wAEPSec].PointerToRawData >= 0x200 && m_pSectionHeader[m_wAEPSec].Characteristics >= 0x60000020 &&
		m_pSectionHeader[1].Characteristics >= 0x40000040 && m_pSectionHeader[2].Characteristics >= 0x40000040 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData >= m_pSectionHeader[m_wAEPSec].Misc.VirtualSize &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x100000 && m_pSectionHeader[0].SizeOfRawData >= 0x50 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress != 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].Size != 0x0)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int PETUN_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[PETUN_BUFF_SIZE];

		if(!GetBuffer(m_dwAEPMapped, 0x2, 0x2))
		{			
			return iRetStatus;		
		}
		if(*(WORD *)&m_pbyBuff[0x0] != 0x25FF)
		{
			return iRetStatus;
		}
		DWORD dwBuffSize = 0,dwBuffOffSet = 0x0, dwCLITableAdd = 0;;
		m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress, &dwCLITableAdd);
		if(OUT_OF_FILE == dwCLITableAdd || dwCLITableAdd == 0x0)
		{
			return iRetStatus;
		}
		if(m_pMaxPEFile->ReadBuffer(m_pbyBuff, dwCLITableAdd + 0x8 , 0x8,0x8))
		{ 	
			dwBuffOffSet=*(DWORD *)&m_pbyBuff[0x0];
			dwBuffSize=*(DWORD *)&m_pbyBuff[0x04];
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffSet, &dwBuffOffSet))
			{
				return iRetStatus;
			}
			if(m_pMaxPEFile->m_dwFileSize < dwBuffSize)
			{
				return iRetStatus;
			}
		}
		if(dwBuffSize > PETUN_BUFF_SIZE)
		{
			if(!GetBuffer(dwBuffOffSet + dwBuffSize - PETUN_BUFF_SIZE, PETUN_BUFF_SIZE, PETUN_BUFF_SIZE))
			{			
				return iRetStatus;		
			}
			dwBuffSize = PETUN_BUFF_SIZE;
		}
		else
		{
			if(!GetBuffer(dwBuffOffSet, dwBuffSize, dwBuffSize))
			{			
				return iRetStatus;		
			}
		}
		dwBuffSize = NormalizeBuffer(m_pbyBuff, m_dwNoOfBytes);
		TCHAR MULTPLUG_SIG[] = {_T("5c73797374656d3332*6d736766616c73652b2d5b666972737472756e5d6e657074756e65*68656c6c6f2c746869736973616e656d61696c6c657474696e67796f756b6e6f7774686174796f75726b65796c6f67676572686173")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(MULTPLUG_SIG, _T("Poly.Trojan.MSIL.Petun.a"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentDywo
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Dywo Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentDywo()
{
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) && 
		(m_wNoOfSections == 4) && (memcmp(m_pSectionHeader[0].Name, "UPX0", 4) == 0) && 
		(m_pSectionHeader[2].SizeOfRawData == 0x400))
	{
		DWORD dwMark = 0;
		if(m_pMaxPEFile->ReadBuffer(&dwMark, m_pSectionHeader[3].PointerToRawData, 4, 4))
		{
			if(dwMark == 0x41CA30)
			{
				BYTE DYWO_SIG[] = {0x44, 0x6C, 0x6C, 0x46, 0x69, 0x6C, 0x65, 0x2E, 0x64, 0x6C, 0x6C, 0x00, 0x4D, 0x79, 0x4C, 0x6F, 0x76, 0x65}; //dllfile.dll mylove
				BYTE byBuff[sizeof(DYWO_SIG)] = {0};		
				if(m_pMaxPEFile->ReadBuffer(byBuff, m_pSectionHeader[2].PointerToRawData + 0x2A6, sizeof(DYWO_SIG), sizeof(DYWO_SIG)))
				{
					if(memcmp(byBuff, DYWO_SIG, sizeof(DYWO_SIG)) == 0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.dywo"));
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVBca
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of VB.CA Family
					  A. Installation:(KeyLogger)
						- Copy itself to C:\Windows\ in many files.
					  B. Files modifications :
						- Copy itself to  C:\Documents and Settings\admin\
				      C. Registry Modifications:
						- makes entry into windows startup.
						HKU\S-1-5-21-842925246-879983540-839522115-1003\Software\Microsoft\Windows\CurrentVersion\Run\
			  	      * 225 samples are detected by Worm.VB.ceo so i have a just added sign to this code and primery checks.
					 Intention  : Bytes from Datea section.
					 Detection  : 100%
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBca()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".rsrc", 5) != 0 && 
		memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".rsrc", 5) != 0 )
	{
		return iRetStatus;
	}

	if(m_wNoOfSections == 0x02 && m_dwAEPUnmapped >= 0x1178 && m_dwAEPUnmapped <= 0x1204 && 
		m_pSectionHeader[0].SizeOfRawData == m_pSectionHeader[0].Misc.VirtualSize &&
		m_pSectionHeader[0].PointerToRawData == 0x1000 && m_pSectionHeader[0].Characteristics == 0xE0000060)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x500];		
		if(GetBuffer(m_dwAEPUnmapped + 0x15B0, 0x500, 0x500))
		{		
			CSemiPolyDBScn polydbObj;

			TCHAR szSig1[] = {_T("450040006D006D005C004800610076006F0063*57006F0072006D")};
			TCHAR szSig2[] = {_T("5700330032002E004800610056006F0043*57006F0072004D")};
			polydbObj.LoadSigDBEx(szSig1, _T("Worm.VB.ca"), TRUE);
			polydbObj.LoadSigDBEx(szSig2, _T("Worm.VB.ca"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x500, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	if((m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04) &&	((m_dwAEPUnmapped % 0x10) == 4) &&
		(m_pMaxPEFile->m_stPEHeader.FileAlignment == 0x1000) &&	
		(m_pSectionHeader[0x01].SizeOfRawData == 0x1000 || m_pSectionHeader[0x01].SizeOfRawData == 0x60C) &&
		((m_pSectionHeader[0x01].Misc.VirtualSize > 0x600) && 
		(m_pSectionHeader[0x01].Misc.VirtualSize < 0x700)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];

		if(GetBuffer(0x1140, 0x100, 0x100))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szSig[]  = {_T("7C5073C9045173FA0151*B8DF4F73930D5073137552732D8E50*7A0251738E6A50732FD94F73456A507364955273A0C0*507351DB5073667A5073306A5073FB9D*736D4C50")};
			TCHAR szSig3[] = {_T("C150731D6651734E635173903E5073016350737F9D5273E3D250*73CE635173F64444739E385073B04844731DBB52734B20*5073350F51731CBF5073FE474473D7504473709550")};
			polydbObj.LoadSigDBEx(szSig, _T("Worm.VB.ceo"), FALSE);
			polydbObj.LoadSigDBEx(szSig3, _T("Trojan.Delf.ccvc"), TRUE);
		
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(m_pbyBuff, 0x100, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormJuched
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Juched Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormJuched()
{
	int iRetStatus = VIRUS_NOT_FOUND;	
	if(m_wAEPSec == 0x0 && (m_dwAEPMapped == 0x7570 || m_dwAEPMapped == 0x7740) && m_wNoOfSections >= 0x6  && 
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x500 && 
		m_pSectionHeader[m_wAEPSec + 0x4].Characteristics == 0x40000040 && 
		m_pSectionHeader[m_wAEPSec + 0x4].PointerToRawData >= 0x300 && 
		memcmp(m_pSectionHeader[m_wAEPSec + 0x4].Name, ".rsrc", 5)== 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	JUCHED_BUFF_SIZE = 0x550;
		m_pbyBuff = new BYTE[JUCHED_BUFF_SIZE];
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData, 0x50, 0x50))
		{		
			return iRetStatus;		
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x50], m_dwAEPMapped, 0x500, 0x500))
		{
			return iRetStatus;
		}

		TCHAR szJuchedSig[] = {_T("E906300000E981240000E93C450000E977200000E9D2310000E9DD290000E9*E9933B0000E90E030000E959050000E9D41C0000E99F470000E94A010000E9*558BEC51837D08007C06837D08037C0583C8FFEB3E837D0CFF750C8B45088B04859C9A4200EB2C8B4D0C83E1F885C974")};
		CSemiPolyDBScn	polydbObj;
		polydbObj.LoadSigDBEx(szJuchedSig, _T("Worm.Juched.djh"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], JUCHED_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSmartFake
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of SmartFake (Fortress) Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmartFake()
{
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL && m_wAEPSec == 0 &&
		(m_wNoOfSections == 4 || m_wNoOfSections == 5 || m_wNoOfSections == 6) &&
		m_pSectionHeader[m_wNoOfSections-1].VirtualAddress == 0xC4000 &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16000) &&
		m_dwAEPUnmapped == m_dwAEPMapped &&  (m_pSectionHeader[m_wNoOfSections-1].Characteristics & 0x40000040) == 0x40000040)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SMARTFORTRESS_BUFF = 0x100;
		m_pbyBuff = new BYTE[SMARTFORTRESS_BUFF];
		if(GetBuffer(m_dwAEPMapped - 0x55, SMARTFORTRESS_BUFF, SMARTFORTRESS_BUFF))
		{
			for(DWORD dwOffset = 0; dwOffset < (SMARTFORTRESS_BUFF - 6); dwOffset++)
			{
				if(m_pbyBuff[dwOffset] == 0xE8)
				{
					DWORD dwJmpOffset = *(DWORD *)&m_pbyBuff[dwOffset + 1] + m_dwAEPUnmapped - (0x55 - dwOffset) + 5;
					if(m_pMaxPEFile->Rva2FileOffset(dwJmpOffset , &dwJmpOffset) == m_wAEPSec)
					{
						memset(m_pbyBuff, 0, SMARTFORTRESS_BUFF);
						if(GetBuffer(dwJmpOffset, SMARTFORTRESS_BUFF, SMARTFORTRESS_BUFF))
						{
							CSemiPolyDBScn polydbObj;	 
							const TCHAR FORT_SIG[] = _T("8B45FC83C0028945FC8B4DE4034DFC8A51018855EF8B45FC83C0018945FC*8A4D");
							polydbObj.LoadSigDBEx(FORT_SIG, _T("Trojan.SmartFortress.C"), FALSE);

							TCHAR szVirusName[MAX_PATH] = {0};
							if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
							{
								_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
								return VIRUS_FILE_DELETE;
							}
						}
					}
					break;
				}
			}
		}		
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderGaur
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Downloader.Gaur Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderGaur()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(((m_wNoOfSections == 3) && ((memcmp(m_pSectionHeader[0].Name, "UPX0", 4) == 0) && (memcmp(m_pSectionHeader[1].Name, "UPX1", 4) == 0) && 
		(m_pSectionHeader[0].SizeOfRawData > 0x30000) && (m_pSectionHeader[0].SizeOfRawData > 0x25000)) || ((memcmp(m_pSectionHeader[1].Name, ".Pav", 4) == 0)))||
		((m_wNoOfSections == 4) && (m_wAEPSec == 0x00) && (memcmp(m_pSectionHeader[2].Name, ".data", 5) == 0)))
	{		
		DWORD dwBytesToRead = 0; 
		if(m_wNoOfSections == 3)
		{
			dwBytesToRead = m_pSectionHeader[1].PointerToRawData + 0x171EC;
		}
		else
		{
			dwBytesToRead = m_pSectionHeader[2].PointerToRawData + 0x1EC;
		}

		const int GAUR_BUFF_SIZE = 0x30;
		BYTE byBuff[GAUR_BUFF_SIZE] = {0};
		if(!m_pMaxPEFile->ReadBuffer(byBuff, dwBytesToRead, GAUR_BUFF_SIZE, GAUR_BUFF_SIZE))
		{
			return iRetStatus;
		}
		//http://www.niudoudou.com/web/download
		BYTE byGaurSign[] = {0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x77, 0x77, 0x77, 0x2E, 0x6E, 0x69, 0x75, 0x64, 0x6F, 
			0x75, 0x64, 0x6F, 0x75, 0x2E, 0x63, 0x6F, 0x6D, 0x2F, 0x77, 0x65, 0x62, 0x2F, 0x64, 0x6F, 0x77, 0x6E, 0x6C, 0x6F, 0x61, 0x64, 0x2F};
		if(memcmp(byBuff, byGaurSign, sizeof(byGaurSign)) == 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Downloader.Agent.Gaur"));
			iRetStatus = VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Eorezo Family
					  A : Eorezo.gp are having UPX Packed and UPX unpacked files.
					  B : Eorezo.gp shows Command Promt Window with Following String. "Update Done Successfully"
					  C : Eorezo.gp contains address of Website in Encrypted Form.
					  D : Eorezo.gp gives POP-up of above encrypted Website.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectEorezoGP()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
		m_wNoOfSections == 3 && m_dwAEPUnmapped == 0x1274 &&
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000 && memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0) ||
		(m_pSectionHeader[m_wNoOfSections-1].SizeOfRawData == 0x1000 && memcmp(m_pSectionHeader[m_wNoOfSections-1].Name, ".data", 5) == 0)))
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	EOREZO_BUFF = 0x100;
		m_pbyBuff = new BYTE[EOREZO_BUFF];

		DWORD dwReadPos = m_pSectionHeader[m_wNoOfSections-1].PointerToRawData;
		if(memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)
		{
			dwReadPos = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x2000;
		}

		if(GetBuffer(dwReadPos, EOREZO_BUFF, EOREZO_BUFF))
		{		
			//http://ads.regiedepub.com*/cgi-bin/advert/get
			const TCHAR EOREZO_SIG[] = {_T("687474703a2f2f6164732e726567696564657075622e636f6d*2f6367692d62696e2f6164766572742f676574")};
			CSemiPolyDBScn	polydbObj;	 
			polydbObj.LoadSigDBEx(EOREZO_SIG, _T("not-a-virus:Adware.Eorezo.gp"), FALSE);

			BYTE bKey = 0;
			if(!m_pMaxPEFile->ReadBuffer(&bKey, m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x16F, 1, 1))
			{
				return iRetStatus;
			}			
			for(DWORD dwOffset = 0x00; dwOffset < EOREZO_BUFF; dwOffset++)
			{
				m_pbyBuff[dwOffset] = m_pbyBuff[dwOffset] - bKey;
			}

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{				
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)&&
		((m_wNoOfSections == 3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0x00 && memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0) ||
		(m_wNoOfSections == 4 && m_pSectionHeader[m_wNoOfSections-1].SizeOfRawData == 0x1000 && memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".data", 5) == 0) ||
		(m_wNoOfSections == 3 && m_pSectionHeader[m_wNoOfSections-1].SizeOfRawData == 0x1000 && memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".data", 5) == 0)))
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	EOREZO_BUFF = 0x100;
		m_pbyBuff = new BYTE[EOREZO_BUFF];

		DWORD dwReadPos = 0x0;
		if(memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)
		{
			dwReadPos = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x2000;
		}
		else if(memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".data", 5) == 0)
		{
			dwReadPos = m_pSectionHeader[m_wNoOfSections-1].PointerToRawData;
		}
		else if(memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".data", 5) == 0)
		{
			dwReadPos = m_pSectionHeader[m_wNoOfSections-2].PointerToRawData;
		}
		if(dwReadPos == 0)
		{
			return iRetStatus;
		}
		if(GetBuffer(dwReadPos, EOREZO_BUFF, EOREZO_BUFF))
		{		
			//http://ads.alpha00001.com*/cgi-bin/advert/get
			//http://ads.xorxzo.com*/cgi-bin/advert/get
			//http://dload.ipbill.com
			const TCHAR EOREZO_SIG1[] = {_T("6967632B6D6F632E31303030307968706C792E7364792B2B3A702A2A68*3D6469643F7364792A78672B2A72787664792B6E69622D00")};
			const TCHAR EOREZO_SIG2[] = {_T("2D6967632B6D6F632E6F7A78726F782E7364792B2B3A702A2A680000*6469643F7364792A78672B2A72787664792B2B6E696200")};
			const TCHAR EOREZO_SIG3[] = {_T("687474703A2F2F646C6F61642E*697062696C6C2E636F6D")};


			CSemiPolyDBScn	polydbObj;	 
			polydbObj.LoadSigDBEx(EOREZO_SIG1, _T("not-a-virus:Adware.Eorezo.ao"), TRUE);
			polydbObj.LoadSigDBEx(EOREZO_SIG2, _T("not-a-virus:Adware.Eorezo.ao"), TRUE);
			polydbObj.LoadSigDBEx(EOREZO_SIG3, _T("Downloader.Small.J"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{				
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;		
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFujackAA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Fujack Family
					  A : It Infects .exe files, Infected file is CORRUPT
					  B : also drop .exe at system32
					  C : Spreads in network,
					  D : Create Run time Registry entry for drop sample
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFujackAA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	
	if((m_pSectionHeader[0].Misc.VirtualSize >= m_pSectionHeader[0].SizeOfRawData) &&
		(m_dwAEPUnmapped % 0x10 != 0x00) &&
		(m_wNoOfSections == 3 || m_wNoOfSections == 4) &&
		(m_dwAEPUnmapped > 0x1E000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x1000];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_dwAEPMapped - 0x1F00, 0x1000, 0))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		// Siganture contain abusing string
		TCHAR	Fujack_Sig[] = {_T("7061747269636B00FFFFFFFF03000000706174*6675636B796F75")};
		
		polydbObj.LoadSigDBEx(Fujack_Sig, _T("Trojan.Fujack.AA"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x1000, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  A. Initially this trojan creates hidden folders with names Cerberus & TMNs in system32 & drops 
							copies of itself with names server.exe & TMNs.exe with hidden file attributes into those folders
							respectively.
					  B. Displays a dialog box with following text on execution:
							"A cerberus server is currently running on your computer.At the end of your remote assistance
							click OK to remove server from your computer".
					  C: Registry Modifications:
						HKLM\Software\Microsoft\Windows\CurrentVersion\Run
						Value Name : Cerberus
						Value Data : C:\Windows\system32\Cerberus\server.exe

						Value Name : TMNs
						Value Data : TMNs.exe
						so that server.exe & TMNs.exe runs every time Windows starts

						HKCU\Software\Cerberus -> Value Name : StartPersist
						HKCU\Software\TMNs -> Value Names : FileName, FirstExecution,HKCU,HKLM,IE7

					2. Trojan-Spy.Agent.bpxo
						A. Creates folder with name sysdata at C:\Documents and Settings\<User>\Application Data
						& drops copy of itself witn name syssvc.exe & sys.dat into that folder.

						B. Registry Modifications:
						HKCU\Software\Microsoft\Windows\CurrentVersion\Run
						Value Name : syssvc.exe
						Value Data : C:\Documents and Settings\<User>\Application Data\sysdata\syssvc.exe
					Signature in text format:
					Trojan-Dropper.Agent.bpxo --: "SOFTWARE\Cerberus...StartPersist*SOFTWARE\...........IE7*FileNameAtual...PERSIST"
					Trojan-Spy.Agent.bpxo --: "\sysdata*\autoinstaller.exe*\syssvc.exe......spi931"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentBPXO()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if ((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x2 || m_wNoOfSections == 0x8) && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x7AF8 &&
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x70EC || (m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].Misc.VirtualSize)))
	{
		return IsDropperAgentBPXO(); // Dropper.Agent.bpxo
	}		
	else if (m_wNoOfSections == 0x4 && (m_dwAEPUnmapped == 0x1000 || m_dwAEPUnmapped == 0x51F3) && 
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x41C0  && (m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) == 0x60000020)
	{
		return IsSpyAgentBPXO(); //Spy.Agent.bpxo
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: IsDropperAgentBPXO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.BPXO Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::IsDropperAgentBPXO() 
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	
	const int AGENTBPXO_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[AGENTBPXO_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;	
	}

	DWORD dwBuffOffset = 0x0;
	if(!m_pMaxPEFile->ReadBuffer(&dwBuffOffset, m_dwAEPMapped + 0x4E, sizeof(DWORD), sizeof(DWORD)))
	{
		return iRetStatus;
	}
	if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset - m_dwImageBase, &dwBuffOffset))
	{
		return iRetStatus;
	}
	if(!GetBuffer(dwBuffOffset, AGENTBPXO_BUFF_SIZE, AGENTBPXO_BUFF_SIZE))
	{
		return iRetStatus;
	}

	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	DROPPERAGENTBPXO_SIG[] = {_T("534F4654574152455C4365726265727573000000537461727450657273697374*534F4654574152455C000000FFFFFFFF03000000494537*46696C654E616D65417475616C00000050455253495354")};
	
	polydbObj.LoadSigDBEx(DROPPERAGENTBPXO_SIG, _T("Trojan.Dropper.Agent.BPXO"), FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENTBPXO_BUFF_SIZE, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: IsSpyAgentBPXO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agen.tBPXO Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::IsSpyAgentBPXO()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int AGENTBPXO_BUFF_SIZE = 0x340;
	m_pbyBuff = new BYTE[AGENTBPXO_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	const BYTE	SPYSIG[] = {0x73,0x79,0x73,0x2E,0x64,0x61,0x74}; //sys.dat
	if(!GetBuffer(0x7380, 0x10, 0x10))
	{
		return iRetStatus;
	}
	if(memcmp(&m_pbyBuff[0x0], SPYSIG, sizeof(SPYSIG)) == 0x00)
	{
		if(!GetBuffer(0x80F2, AGENTBPXO_BUFF_SIZE, AGENTBPXO_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		TCHAR			SPYAGENTBPXO_SIG[] = {_T("5C73797364617461*5C6175746F696E7374616C6C65722E657865*5C7379737376632E657865000000010000737069393331")};
		
		polydbObj.LoadSigDBEx(SPYAGENTBPXO_SIG, _T("Trojan-Spy.Agent.BPXO"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENTBPXO_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSpySCKeyLog
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of SCKeyLog.au Family
					  A: Spyware program that logs keystrokes, mouse events, passwords, stores a log & then intends to email
						this log to predefined addresses.
					  B: Initially when this trojan is triggered, it creates fake system files with random names & hidden file attributes.
						For E.g -> csrs.exe & csrs.dll
						 secsrvrc.exe & secsrvrc.dll
						 123123.exe & 123123.dll 
					  C: To enable this trojan to run every time Windows starts	it creates following registry entry:
						  [HKLM\Software\Microsoft\Windows\CurrentVersion\Run]
		  					Value Name : csrs
		  					Value Data : C:\Windows\system32\csrs.exe
				  	  D: Also adds following registry keys: 
						  [HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\csrs]
							Asynchronous = 0x0			
							DllName = csrs.dll 
							Impersonate =  0x0
							Lock = WLELock
							Logoff = WLELogoff
							Logon = WLELogon
							Shutdown = WLEShutdown
							StartScreenSaver = WLEStartScreenSaver
							Startup = WLEStartup
							StopScreenSaver = WLEStopScreenSaver
							Unlock = WLEUnlock
					  E: Trojan saves its log file in temp folder which it attempts to email to predefined addresses.
						  For E.g -> dismemayhack.com@gmail.com
								 BugBac@gmail.com
									 nicolas.cage1@gmail.com				
					  Note: Samples packed with Armadillo packer, hence detection taken on packed samples.
					  Signature: Contains names of registry keys newly added, function names from dropped library, & 
							last part (TD.LfzMph) bytes on decrementing by 1 gives SC-KeyLog 	  
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSpySCKeyLog()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(!((m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && m_wAEPSec == 0x0 && 
		(m_dwAEPUnmapped == 0x862E || m_dwAEPUnmapped == 0x5A7D)))
	{
		return iRetStatus;
	}
	DWORD dwChk = 0x0, dwBuffSize = 0x0;
	//exe 
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x49D2 &&
		m_pSectionHeader[m_wNoOfSections -1].Misc.VirtualSize == 0x10 && m_pSectionHeader[m_wNoOfSections -1].SizeOfRawData == 0x200 &&
		(m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData)!= 0x0))
	{
		dwChk = 0x1;
	}
	//dll
	else if((memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, "Shared", 6) == 0) && 
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1C8A &&
		m_pSectionHeader[m_wNoOfSections -1].Misc.VirtualSize == 0x38E)
	{
		dwChk = 0x2;
	}
	if(dwChk == 0)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int SPYSCKEYLOG_BUFF_SIZE = 0x270;
	m_pbyBuff = new BYTE[SPYSCKEYLOG_BUFF_SIZE];
	
	if(dwChk == 1)
	{
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x470, 0x250, 0x250))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x250;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x900, 0x20, 0x20))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x20;
	}
	else if(dwChk == 2)
	{
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x1].PointerToRawData + 0x9C0, 0xA0, 0xA0))
		{
			return iRetStatus;
		}
		dwBuffSize += 0xA0;
	}

	TCHAR SPYSCKEYLOG_SIG1[] = {_T("496D706572736F6E617465004173796E6368726F6E6F757300000000446C6C4E616D65004E6F74696679*5365744C4F707400536176654500000053746172744C000053746F704C*54442E4C667A4D7068")}; //exe
	TCHAR SPYSCKEYLOG_SIG2[] = {_T("6B6C6C6E412E646C6C00466C757368427566666572005361766545005365744C4F70740053746172744C0053746F704C*574C454C6F636B00574C454C6F676F666600574C454C6F676F6E*574C45537461727453637265656E536176657200574C455374617274757000574C4553746F7053637265656E536176657200574C45556E6C6F636B")}; //dll
	CSemiPolyDBScn polydbObj;
	polydbObj.LoadSigDBEx(SPYSCKEYLOG_SIG1, _T("Trojan.Spy.SCKeyLog.au"), TRUE);
	polydbObj.LoadSigDBEx(SPYSCKEYLOG_SIG2, _T("Trojan.Spy.SCKeyLog.at"), FALSE);
	TCHAR szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			iRetStatus = VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKoutodoorAIHC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  A. Backdoor.Koutodoor.aihc drops following files when triggered:
						  C:\Windows\system32\<random_name>.dll
						  C:\windows\system32\drivers\<random_name>.sys
					  B. Also temporarily drops & launches 2 <random_name>.bat (batch files) & <random_name>.exe in 
						 temp folder to delete itself.
					  C. Creates folder in "C:\Documents and Settings\<user>\Favorites" which has Internet Shortcuts to connect to 
						 remote server.
						 For E.g : http://www.baidu.com
							   http://www.go2000.com
							   http://www.haote.com
					  D. Registry Modifications:
						  HKLM\Software\Microsoft\Windows\CurrentVersion\DateTime\
						   Value Names added -> Fav,index,Last Time,Modify,Reboot,SID
					  Signature: Contains Decryption loop which decrypts 3rd section's data to obtain URL's of remote server.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKoutodoorAIHC()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (m_wNoOfSections < 0x04 || m_wAEPSec != 0x00)
	{
		return iRetStatus;
	}

	if (m_pSectionHeader[m_wAEPSec].PointerToRawData != 0x1000 ||  
	    m_pSectionHeader[m_wAEPSec].VirtualAddress != 0x1000 ||
		m_pSectionHeader[m_wAEPSec + 0x1].PointerToRawData != m_pMaxPEFile->m_stPEHeader.DataDirectory[0xC].VirtualAddress)
	{
		return iRetStatus;
	}

	if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int KOUTODOOR_BUFF_SIZE = 0x36;
		m_pbyBuff = new BYTE[KOUTODOOR_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData, KOUTODOOR_BUFF_SIZE, KOUTODOOR_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		TCHAR			KOUTODOORAIHC_SIG[] = {_T("538B5C241433C985DB7E29558B6C240C568B742418578B7C2418*8BC199F7FF8A042A8A143132C232C3880431413BCB7CE95F5E5D5BC3")};
	
		polydbObj.LoadSigDBEx(KOUTODOORAIHC_SIG, _T("Backdoor.Koutodoor.aihc"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], KOUTODOOR_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectTepfer
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Tepfer Family
					  A VC++ Compile files
					  B Checksum is set
					  C No Infection and droping files,
					  D Decrypt data and copy to virtual alloc memory
					  E Siganture contain encrypted data of files.	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTepfer()
{
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
		m_wNoOfSections == 0x05 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0xBF11 && m_dwAEPUnmapped == 0x5D87 &&
		m_pSectionHeader[0].Misc.VirtualSize == 0x938E && m_pSectionHeader[1].Misc.VirtualSize == 0x1944)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x20];
		if(GetBuffer(0xAFD0, 0x20, 0x20))
		{
			BYTE bSig[]		= {0xE1,0xE4,0x0E,0xE1,0x35,0x78,0xFA,0x6D,0x99,0xD1,0xA5,0x74,0x99,0x6B,0x0E,0xDF,
							   0xEB,0xEF,0x71,0x8C,0xD1,0x68,0xB6,0x93,0xDB,0xB3,0xA8,0x05,0xE6,0x4E,0x12,0x9D};

			if(memcmp(&m_pbyBuff[0], bSig, sizeof(bSig)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.PSW.Tepfer.auyy"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAvalod
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Avalod Family
					  A : All files are DLL files
					  B : These files are dropped by some trojan 
					  C : it contains Following Unicode string.
					  E : This Unicode string is file name of original trojan. 
							which uses this dll to perform there action.
--------------------------------------------------------------------------------------*/
/******************************************************************************
Name        : Downloader.Avalod.ai
Type        : Downloader
Describtion : if "b9i76jn1tf" by this name of file found on hard disk at system32 
			then trojan trying to replace with "34d6t8hjvgutrr", and take backup 
			by this name "b9i76jn1tf.backup" of file	 
Intension 	: "b.9.i.7.6.j.n.1.t.f * b.a.c.k.u.p...Spiegel"  First 2 random 
			strings are the file name which was used by 'FileReplaceW' API 
			so both file name are constant in all the files
******************************************************************************/
int CSemiPolyTrojans::DetectAvalod()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) &&
		(m_wNoOfSections == 4 || m_wNoOfSections == 5) && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0xE000 && m_wAEPSec == 0 && 
		memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".rdata", 6) == 0)
	{
		DWORD dwDataVirtAdd = m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress;
		DWORD dwDataVirtSiz = m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size;
		if(dwDataVirtAdd && dwDataVirtSiz)
		{
			if(m_wAEPSec + 1 != m_pMaxPEFile->Rva2FileOffset(dwDataVirtAdd, &dwDataVirtAdd))
			{
				return iRetStatus;
			}
		}

		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AVALOD_BUFF = 0x100;
		m_pbyBuff = new BYTE[AVALOD_BUFF];
		if(GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData, AVALOD_BUFF, AVALOD_BUFF))
		{
			CSemiPolyDBScn polydbObj;	 
			const TCHAR AVALOD_SIG[] = _T("656431637831703839753165*66332D3872666876646C68303235");
			const TCHAR AVALOD_SIG1[] = _T("6E393233726675766C616C2E647479*66332D3872666876646C68303235");
			const TCHAR AVALOD_SIG2[] = _T("7667767579323375656971646E6B6A7363*66332D3872666876646C68303235");

			polydbObj.LoadSigDBEx(AVALOD_SIG, _T("Trojan.Avalod.QW"), TRUE);
			polydbObj.LoadSigDBEx(AVALOD_SIG1, _T("Trojan.Avalod.QW"), TRUE);
			polydbObj.LoadSigDBEx(AVALOD_SIG2, _T("Trojan.Avalod.QW"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}		
	}

	if(!((m_dwAEPUnmapped == m_dwAEPMapped) && m_wAEPSec == 0))
	{
		return iRetStatus;
	}
	if((((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) && m_wNoOfSections == 4 && 
		(m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x1000)) ||
		(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_wNoOfSections == 3) &&
		(m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x3000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AvalodAI_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[AvalodAI_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer((m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x100), AvalodAI_BUFF_SIZE, AvalodAI_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szAvalodAI[] = {_T("620039006900370036006A006E003100740066*33003400640036007400380068006A00760067007500740072007200*6200610063006B007500700000005370696567656C")};
		polydbObj.LoadSigDBEx(szAvalodAI, _T("Downloader.Avalod.ai"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x300, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectJorikSkor
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of skor.fs Family
					  These are Vb setup files which is built by inno setup and 
					  setup is of PhotoInstrument software.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJorikSkor()
{
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
		m_dwAEPMapped == 0x10B0 && memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".data", 5) == 0 &&
		memcmp(m_pSectionHeader[m_wAEPSec + 2].Name, ".rsrc", 5) == 0 && memcmp(m_pSectionHeader[m_wAEPSec].Name, ".text", 5) == 0 &&
		m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0 && m_pSectionHeader[m_wAEPSec + 1].PointerToRawData == 0)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int JORIK_BUFF = 0x200;
		m_pbyBuff = new BYTE[JORIK_BUFF];
		if(GetBuffer(0x5D00, JORIK_BUFF, JORIK_BUFF))
		{
			CSemiPolyDBScn polydbObj;	 
			const TCHAR JORIK_SIG[] = _T("50180057416F774E6B00005835466C4F4D5A00516A576600*554C793372566F72694B00004A676C5978674533");
			polydbObj.LoadSigDBEx(JORIK_SIG, _T("Trojan.Jorik.Skor.fs"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}						
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentGUPX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.GUPX Family
					  1)after unpacking in resource section 2 Pe files  are there which 
							are executed by process name "PPsave".
					  2)it creates two process by name "ppsave". took signature string as ("P.P.S.a.v.e")
					  A) it drops alexa_uninstall.exe in "menu programs/alexa"
					  B) it drops a lnk file for alexa uninstall file.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentGUPX()
{
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
		m_wNoOfSections == 7 && m_wAEPSec == 0 && 
		(memcmp(m_pSectionHeader[4].Name, m_pSectionHeader[5].Name, 0x04) == 0) &&
		(memcmp(m_pSectionHeader[3].Name, ".rsrc", 0x05) == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTGUPX_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE [AGENTGUPX_BUFF_SIZE];
		if(GetBuffer(m_pSectionHeader[3].PointerToRawData + m_pSectionHeader[3].SizeOfRawData - AGENTGUPX_BUFF_SIZE, AGENTGUPX_BUFF_SIZE, AGENTGUPX_BUFF_SIZE))
		{
			/* P.P.S.a.v.e * P.P.S.a.v.e */
			TCHAR szSig[] = {_T("8765F64E28002600460029000000800069000090FA512800260058002900000090002E5EA95228002600480029*06005000500053006100760065*06005000500053006100760065")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(szSig, _T("Trojan.Agent.gupx"), FALSE);
			
			TCHAR szVirusName[MAX_PATH] = {0};			
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGameVance
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Virus Analysis Team
	Description		: Detection routine for different varients of Gamevance Family
					  A : not-a-virus:AdWare.W32.Gamevance: Game Installer files.
					  B : It creates a folder at "%\Program file\Gamevance" and on installation drops 3-4 files in this folder.
					  C : It Downloads malicious files and installs them on the computer. 
					  D : not-a-virus:AdWare.W32.Gamevance is included in a list of programs which will run automatically when Windows operating system starts up.
 					  E : Signature -> Taken Game Downloding Site Name and Dropped file Name ...
					  F : Site name use for download -> epicplay.com ,freeworkz.com ,freeworkzgames.com ,gamevance.com ,livingplay.com ,mimagoo.com ,plpickle.com ,spworkz.com              
					  ( But no malicious activity found on installing/infection.)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGameVance()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec != 0x0 || ((m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) != 0x60000020))
	{
		return iRetStatus;
	}
	if(m_wNoOfSections >= 0x4 && m_wNoOfSections < 0x7 && m_pSectionHeader[m_wAEPSec].SizeOfRawData > 0x1000 &&
		m_pSectionHeader[0x1].SizeOfRawData > 0x100)
	{
		BYTE pbyBuff[0xA]= {0};
		if(!m_pMaxPEFile->ReadBuffer(pbyBuff, m_dwAEPMapped, 0xA , 0xA))
		{
			return iRetStatus;
		}
		if(pbyBuff[0x0] != 0xE8 || pbyBuff[0x05] != 0xE9)
		{
			return iRetStatus;
		}
		//Calculate Call Offset
		DWORD dwCallOffSet= *(DWORD *)&pbyBuff[0x1] + m_dwAEPUnmapped +0x5;
		WORD wSec = m_pMaxPEFile->Rva2FileOffset(dwCallOffSet, &dwCallOffSet);
		if(OUT_OF_FILE == wSec || wSec != m_wAEPSec )
		{
			return iRetStatus;
		}
		if(!IsGameVanceFile(dwCallOffSet))
		{
			return iRetStatus;
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int GAME_BUFF_SIZE = 0x5000;
		m_pbyBuff = new BYTE[GAME_BUFF_SIZE];		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
	
		DWORD dwBuffSize = 0x0, dwNoOfReadByte = 0x0;
		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress != 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size >0x100
			&& m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress + m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size <= m_pMaxPEFile->m_dwFileSize)//Corrupt file handling
		{
			dwNoOfReadByte=0x500;
			if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size < dwNoOfReadByte)
			{
				dwNoOfReadByte = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], (m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress + m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size)- dwNoOfReadByte , dwNoOfReadByte, dwNoOfReadByte))
			{
				return iRetStatus;
			}
			dwBuffSize += dwNoOfReadByte;
		}
		if(memcmp(m_pSectionHeader[0x3].Name, ".cdata", 6) == 0 && m_pSectionHeader[0x3].SizeOfRawData > 0x1000)
		{			
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x3].PointerToRawData, 0x500, 0x500))
			{
				return iRetStatus;
			}
			dwBuffSize += 0x500;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], (m_pSectionHeader[0x3].PointerToRawData + m_pSectionHeader[0x3].SizeOfRawData)- 0x500 , 0x500, 0x500))
			{
				return iRetStatus;
			}
			dwBuffSize += 0x500;
		}
		else 
		{
			dwNoOfReadByte =0x00;
			if( m_pSectionHeader[0x1].SizeOfRawData < 0x4000 && m_pSectionHeader[0x1].SizeOfRawData > 0x500)
			{
				dwNoOfReadByte=m_pSectionHeader[0x1].SizeOfRawData;
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x1].PointerToRawData, dwNoOfReadByte, dwNoOfReadByte))
				{
					return iRetStatus;
				}
				dwBuffSize += dwNoOfReadByte;
			}
			else if(m_pSectionHeader[0x1].SizeOfRawData >= 0x4000)
			{
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize],m_pSectionHeader[0x1].PointerToRawData, 0x3000, 0x3000))
				{
					return iRetStatus;
				}
				dwBuffSize += 0x3000;
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize],m_pSectionHeader[0x1].PointerToRawData + m_pSectionHeader[0x1].SizeOfRawData - 0x1000 , 0x1000, 0x1000))
				{
					return iRetStatus;
				}
				dwBuffSize += 0x1000;
			}
		}

		TCHAR GameVanceSig[] = {_T("67766133322E646C6C*67616D6576616E63656C696233322E646C6C*69636F6E2E69636F*67616D6576616E63652E636F6D")};//GSR.gva32.dll*gamevancelib32.dll*icon.ico*gamevance.com
		TCHAR GameVanceSig1[] = {_T("470061006D006500760061006E00630065*470061006D00650073*67616D6576616E63652E636F6D")};//G.a.m.e.v.a.n.c.e*G.a.m.e.s*gamevance.com
		TCHAR GameVanceSig2[] = {_T("41726520796F75207375726520746F2063616E63656C20446F6750696C6520746F6F6C626172*66726565776F726B7A67616D65732E636F6D")}; //Are you sure to cancel DogPile toolbar*freeworkzgames.com
		TCHAR GameVanceSig3[] = {_T("460072006500650077006F0072006B007A*66726565776F726B7A67616D65732E636F6D")};//F.r.e.e.w.o.r.k.z*freeworkzgames.com
		TCHAR GameVanceSig4[] = {_T("73746172742E66726565776F726B7A2D67616D65732E636F6D*75706466772E706870")};//start.freeworkz-games.com*updfw.php
		TCHAR GameVanceSig5[] = {_T("41706E49432E646C6C*65706963706C61792E636F6D*65702E776C2E666163646E2E636F6D2F65702F646F776E6C6F61642F")};//ApnIC.dll*epicplay.com*ep.wl.facdn.com/ep/download/

		TCHAR GameVanceSig6[] = {_T("450070006900630050006C0061007900470061006D00650073*65706963706C61792E636F6D")};//E.p.i.c.P.l.a.y.G.a.m.e.s*epicplay.com
		TCHAR GameVanceSig7[] = {_T("776562312E706C7363646E2E636F6D*706C617973757368692E636F6D")};//web1.plscdn.com*playsushi.com
		TCHAR GameVanceSig8[] = {_T("410072006300610064006500430061006E00640079002000470061006D00650073*61726361646563616E64792E636F6D2F")};//A.r.c.a.d.e.C.a.n.d.y. .G.a.m.e.s*arcadecandy.com/
		TCHAR GameVanceSig9[] = {_T("50006C006100790073007500730068006900470061006D00650073*706C617973757368692E636F6D")};//P.l.a.y.s.u.s.h.i.G.a.m.e.s*playsushi.com
		TCHAR GameVanceSig10[] = {_T("506C6179737573686920736F667477617265*706C617973757368692E636F6D")};//Playsushi software*playsushi.com

		TCHAR GameVanceSig11[] = {_T("7777772E6D656D7465737438362E636F6D*77696E696D6167652E636F6D2F7A4C6962446C6C")};//www.memtest86.com*winimage.com/zLibDll
		TCHAR GameVanceSig12[] = {_T("6C706C6179756E006C706C6179756E2E657865*706C6179696E672067616D6573*6C6976696E67706C61792E636F6D")};//lplayun.lplayun.exe*playing games*livingplay.com
		TCHAR GameVanceSig13[] = {_T("45706963506C61792047616D6573*65706963706C61792E636F6D*45706963506C6179446973706C6179")};//EpicPlay Games*epicplay.com*EpicPlayDisplay
		TCHAR GameVanceSig14[] = {_T("70776F726B7A2E636F6D*46726565576F726B7A2047616D657320457874656E73696F6E*46726565576F726B7A47432E646C6C")};//pworkz.com*FreeWorkz Games Extension*FreeWorkzGC.dll
		TCHAR GameVanceSig15[] = {_T("46726565576F726B7A50452E646C6C*46726565576F726B7A4672616D652E646C6C*66726565776F726B7A67616D65732E636F6D")};//FreeWorkzPE.dll*FreeWorkzFrame.dll*freeworkzgames.com
		TCHAR GameVanceSig16[] = {_T("67616D6576616E63652E6E6574*67616D6576616E63656C696233322E646C6C*67616D6576616E63652E636F6D")};//gamevance.net*gamevancelib32.dll*gamevance.com
		TCHAR GameVanceSig17[] = {_T("646F776E6C6F61642E6672776F726B7A2E636F6D*46726565576F726B7A*706C6179696E672067616D6573")};//download.frworkz.com*FreeWorkz*playing games
		TCHAR GameVanceSig18[] = {_T("46726565576F726B7A*41726520796F75207375726520746F2063616E63656C20446F6750696C65*46726565776F726B7A20536F66747761726520")};//FreeWorkz*Are you sure to cancel DogPile*Freeworkz Software 
		TCHAR GameVanceSig19[] = {_T("6C6F6164696E672067616D65*65706963706C61792E636F6D")};//loading game*epicplay.com
		TCHAR GameVanceSig20[] = {_T("52006900760061006C00470061006D0069006E0067*470061006D00650073*726976616C67616D696E672E636F6D")};//R.i.v.a.l.G.a.m.i.n.g*G.a.m.e.s*rivalgaming.com
		TCHAR GameVanceSig21[] = {_T("726976616C67616D696E672E636F6D*70616765732E726976616C67616D696E672E636F6D")};//rivalgaming.com*pages.rivalgaming.com
		TCHAR GameVanceSig22[] = {_T("61726361646577656266697265666F782E787074*61726361646577656266697265666F782E646C6C*61726361646577656233322E646C6C")};//arcadewebfirefox.xpt*arcadewebfirefox.dll*arcadeweb32.dll
		TCHAR GameVanceSig23[] = {_T("61726361646577656262617233322E646C6C*6177756E2E657865*6172636164657765622E636F6D")};//arcadewebbar32.dll*awun.exe*arcadeweb.com
		TCHAR GameVanceSig24[] = {_T("706C617973757368692E636F6D*6C696E6B7340706C617973757368692E636F6D")};//playsushi.com*links@playsushi.com
		TCHAR GameVanceSig25[] = {_T("706C6179696E672067616D6573*70616765732E6D696D61676F6F2E636F6D")};//playing games*pages.mimagoo.com
		TCHAR GameVanceSig26[] = {_T("4D006900670068007400790020004D00610067006F006F*4D69676874794D61676F6F2E636F6D")};//M.i.g.h.t.y. .M.a.g.o.o*MightyMagoo.com
		TCHAR GameVanceSig27[] = {_T("65706963706C61792E636F6D*666167616D65736672616D65776F726B2E636F6D")};//epicplay.com*fagamesframework.com
		TCHAR GameVanceSig28[] = {_T("61626F72742045706963506C6179*45706963506C6179*446F6770696C652E636F6D")};//abort EpicPlay*EpicPlay*Dogpile.com

		TCHAR GameVanceSig29[] = {_T("687474703A2F2F706C61797069636B6C652E636F6D2F70726976616379*706F6C6963792F30")};
		TCHAR GameVanceSig30[] = {_T("706C61797069636B6C652E636F6D*436F6F6B69652052656D6F766572*706C61797069636B6C656C696233322E646C6C*706C61797069636B6C6533322E657865*7070746C2E646C6C")};
		TCHAR GameVanceSig31[] = {_T("687474703A2F2F706C61797069636B6C652E636F6D*706C61797069636B6C65776E616D65*506C6179205069636B6C652047616D6573")};
		TCHAR GameVanceSig32[] = {_T("506C6179205069636B6C652047616D6573*706C61797069636B6C652E6E6574*706C61797069636B6C652E636F6D")};

		CSemiPolyDBScn polydbObj;	
		//Gamevance Varient not-a-virus:AdWare.W32.Gamevance (ijtf,ao)
		polydbObj.LoadSigDBEx(GameVanceSig, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig1, _T("not-a-virus:AdWare.W32.Gamevance.heru"),TRUE );
		polydbObj.LoadSigDBEx(GameVanceSig8, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig11, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig12, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig16, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig21, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig25, _T("not-a-virus:AdWare.W32.Gamevance.gen"), TRUE);

		//Freeworkzgames Varient 
		polydbObj.LoadSigDBEx(GameVanceSig2, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig3, _T("not-a-virus:AdWare.W32.Freeworkzgames.heru"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig4, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig14, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig15, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig17, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig18, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig27, _T("not-a-virus:AdWare.W32.Freeworkzgames.gen"), TRUE);

		//Playsushi Varient 
		polydbObj.LoadSigDBEx(GameVanceSig7, _T("not-a-virus:AdWare.W32.Playsushi.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig9, _T("not-a-virus:AdWare.W32.Playsushi.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig10, _T("not-a-virus:AdWare.W32.Playsushi.gen"),TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig24, _T("not-a-virus:AdWare.W32.Playsushi.gen"), TRUE);

		//Epicplay Varient 
		polydbObj.LoadSigDBEx(GameVanceSig5, _T("not-a-virus:AdWare.W32.Epicplay.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig6, _T("not-a-virus:AdWare.W32.Epicplay.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig13, _T("not-a-virus:AdWare.W32.Epicplay.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig19, _T("not-a-virus:AdWare.W32.Epicplay.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig28, _T("not-a-virus:AdWare.W32.Epicplay.gen"), TRUE);

		//Gamevance Varient not-a-virus:Adware.Gamevance.kae
		polydbObj.LoadSigDBEx(GameVanceSig29, _T("not-a-virus:Adware.Gamevance.kae"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig30, _T("not-a-virus:Adware.Gamevance.kae"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig31, _T("not-a-virus:Adware.Gamevance.kae"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig32, _T("not-a-virus:Adware.Gamevance.kae"), TRUE);

		//Others Varient Win32.RivalGame(aev,afo,afp,afq,aes)
		polydbObj.LoadSigDBEx(GameVanceSig20, _T("not-a-virus:AdWare.W32.Rivalgaming.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig26, _T("not-a-virus:AdWare.W32.MightyMagoo.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig22, _T("not-a-virus:AdWare.W32.Arcadeweb.gen"), TRUE);
		polydbObj.LoadSigDBEx(GameVanceSig23, _T("not-a-virus:AdWare.W32.Arcadeweb.gen"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if((polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0))
		{					
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: IsGameVanceFile
	In Parameters	: DWORD dwCallOffSet
	Out Parameters	: true if success else false
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function finds the infector executable
--------------------------------------------------------------------------------------*/
bool CSemiPolyTrojans::IsGameVanceFile(DWORD dwCallOffSet)
{
	BYTE pbyBuff[0x100 + MAX_INSTRUCTION_LEN]= {0};
	if(!m_pMaxPEFile->ReadBuffer(pbyBuff, dwCallOffSet, 0x100, 0x100))
	{
		return false;
	}
	const BYTE bySig[] = {0x8B,0xFF,0x55,0x8B,0xEC,0x83,0xEC};
	if(memcmp(&pbyBuff[0x0], bySig, sizeof(bySig)) != 0)
	{
		return false;
	}
	DWORD	dwLength = 0, dwOffset = 0, dwInstCount = 0;
	t_disasm da = {0};
	while(dwOffset < 0x100 && dwInstCount < 0xA)
	{
		dwLength = m_objMaxDisassem.Disasm((char *)&pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);   
		if(dwLength > 0x100 - dwOffset)
		{
			break;
		}
		if(dwInstCount <= 0x1 && dwLength == 4  && strstr(da.result,"AND DWORD PTR [E"))
		{
			dwInstCount++;
		}
		else if(dwInstCount <= 0x06 && dwInstCount > 0x1 && dwLength == 6  && strstr(da.result,"CALL"))
		{				
			dwInstCount++;
		}
		else if((dwInstCount == 0x07 || dwInstCount == 0x8) && dwLength == 6 && strstr(da.result,"MOV"))
		{ 
			dwInstCount++;
		}				
		else if(dwInstCount == 0x9 && dwLength == 1 && strstr(da.result,"POP"))
		{				
			dwInstCount++;
			return true;							
		}
		dwOffset += dwLength;
	}
	return false;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickRun
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of ClickRun Family
					  Files are setup files
					  No malicious activeity found
					  These files are delphi compiled	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickRun()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if((m_wNoOfSections == 0x08) && (m_wAEPSec == 0) && //Files should have certificate table
		(memcmp(m_pSectionHeader[2].Name, "BSS", 3) == 0) && (m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size > 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CLICKRUN_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[CLICKRUN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, CLICKRUN_BUFF_SIZE);

		DWORD MinBytesReq = m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size > CLICKRUN_BUFF_SIZE + 0x600 ? CLICKRUN_BUFF_SIZE : m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size - 0x600;
		
		if(!GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress + 0x600, CLICKRUN_BUFF_SIZE, MinBytesReq))
		{
			return iRetStatus;
		}
		TCHAR szSig[] ={_T("436C69636B2072756E20736F66747761726530*61646D696E40636C69636B72756E736F6674776172652E636F6D30")};
		CSemiPolyDBScn	polydbObj;
		polydbObj.LoadSigDBEx(szSig, _T("not-a-virus.ClickRun"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectAgentBJEV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of tAgent.BJEV Family
					  A. Once launched makes copies of itself at following locations with hidden file attributes:
						  C:\Temp\svchost.exe
						  C:\Windows\system32\Windupdt\winupdate.exe
					  B. Runs the following files:
						  C:\Windows\system32\notepad.exe
 						  C:\Windows\explorer.exe
						  C:\Windows\notepad.exe
				      C. Also Disables Registry tools on infection.
				      D. Registry Modifications:
						 -> [HKCU\Software\Microsoft\Windows\CurrentVersion\Run] 
							winupdater = "C:\Windows\system32\Windupdt\winupdate.exe"
						 -> [HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon] 
							UserInit = "C:\Windows\system32\userinit.exe, C:\Windows\system32\Windupdt\winupdate.exe,
									C:\Temp\svchost.exe"

					 Signature: Contains a loop which attempts to generate an IP address to establish connection with the remote host &
								also creation of Windupdt\winupdate.exe in system32.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentBJEV()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if((m_wNoOfSections < 0x3) || m_wAEPSec > 0x1  || m_dwAEPUnmapped != 0x908B4 || m_dwImageBase != 0x13140000)
	{
		return iRetStatus;
	}
	if(((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1BB4 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2000)
		&& m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x90000) ||
		((memcmp(m_pSectionHeader[m_wAEPSec].Name, ".MPRESS1", 8) == 0 || 
		  memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX", 3) == 0 ||
		  memcmp(m_pSectionHeader[m_wAEPSec].Name, ".petite", 7) == 0) 
		&& 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == m_pSectionHeader[m_wAEPSec].SizeOfRawData ||
		 m_pSectionHeader[0].Misc.VirtualSize == m_pSectionHeader[0].SizeOfRawData)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTBJEV_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[AGENTBJEV_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_dwAEPMapped + 0x695, AGENTBJEV_BUFF_SIZE, AGENTBJEV_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	AGENTBJEV_SIG[] = {_T("7412A1E04F1D138B15D44E1D138B12E86645F7FFA19C4C1D13833800750FA19C4C1D13BA601B1D13E84D45F7FF8D9528FFFFFF*750FA1A84F1D13BA701B1D13E82345F7FF8D8D24FFFFFF8B15BC4E1D138B12A1DC4E1D138B00E8")};
	
		polydbObj.LoadSigDBEx(AGENTBJEV_SIG, _T("Backdoor.Agent.bjev"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENTBJEV_BUFF_SIZE, szVirusName) >= 0)
		{
			//notepad.exe.open
			const BYTE AGENTBJEV_SIG1[] = {0x6E,0x6F,0x74,0x65,0x70,0x61,0x64,0x2E,0x65,0x78,0x65,0x00,0x6F,0x70,0x65,0x6E}; 
			if(!GetBuffer(m_dwAEPMapped + 0x12EC, 0x10, 0x10))
			{
				return iRetStatus;
			}
			if(memcmp(&m_pbyBuff[0],AGENTBJEV_SIG1,sizeof(AGENTBJEV_SIG1))== 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBHOBENF
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of BHO.BENF Family
					 A. All DLL Files
					 B. A 'BHO' trojan refers to a trojan that disguises itself as a legitimate 'Browser Help Object'.
					 C. Attempts to redirect the browser to random websites by changing current Internet settings.
						For E.g: kuha0123.com
						xingyundao.com
                        wenz-x.com
                        haishans.com
						chaojihu.com
						kuku123.com
					 Signature:  h.t.t.p.:././.h.a.o...n.e.w.v.n.b.c...i.n.f.o...9.1.8.7.8...c.o.m * 
								 r.e.n.c.t...n.e.t...g.a.m.e...h.a.o.k.a.n.1.2.3...c.o.m
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBHOBENF()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections != 0x3 || m_wAEPSec != 0x0 || m_dwAEPUnmapped != 0x702E || m_dwImageBase != 0x10000000 ||
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x14000 &&
		(memcmp(m_pSectionHeader[0x1].Name, ".sedata", 7) == 0)&&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress == 0xCB40 && //Export Table
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size == 0xA8)
	{
		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BHOBENF_BUFF_SIZE = 0x550;
		m_pbyBuff = new BYTE[BHOBENF_BUFF_SIZE];
		if(!GetBuffer(0xD030, BHOBENF_BUFF_SIZE, BHOBENF_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	BHOBENF_SIG1[] = {_T("68007400740070003A002F002F00680061006F002E006E006500770076006E00620063002E0069006E0066006F000000390031003800370038002E0063006F006D*720065006E00630074002E006E00650074000000670061006D0065002E00680061006F006B0061006E003100320033002E0063006F006D")};
		//h.t.t.p.:././.h.a.o...n.e.w.v.n.b.c...i.n.f.o...9.1.8.7.8...c.o.m
		//r.e.n.c.t...n.e.t...g.a.m.e...h.a.o.k.a.n.1.2.3...c.o.m

		polydbObj.LoadSigDBEx(BHOBENF_SIG1, _T("Trojan.BHO.BENF"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BHOBENF_BUFF_SIZE, szVirusName) >= 0)
		{
			const BYTE BHOBENF_SIG2[] = {0x4D,0x00,0x65,0x00,0x64,0x00,0x69,0x00,0x61,0x00,0x50,0x00,0x6C,0x00,0x61,
						     0x00,0x79,0x00,0x65,0x00,0x72,0x00,0x2E,0x00,0x44,0x00,0x4C,0x00,0x4C}; 
						     //M.e.d.i.a.P.l.a.y.e.r...D.L.L

			if(!GetBuffer(0x12344, sizeof(BHOBENF_SIG2), sizeof(BHOBENF_SIG2)))
			{
				return iRetStatus;
			}
			if(memcmp(&m_pbyBuff[0],BHOBENF_SIG2,sizeof(BHOBENF_SIG2))== 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentAirs
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Airs Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentAirs()
{
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && 
		m_dwAEPUnmapped == 0x87D0 && m_pSectionHeader[0].SizeOfRawData > 0x7C00)
	{
		BYTE byBuff[0x100] = {0};

		if(m_pMaxPEFile->ReadBuffer(byBuff, m_dwAEPMapped + 0x4D0, 0x100, 0x100))
		{
			const BYTE bySig1[] = {0x53, 0x4F, 0x46, 0x54, 0x57, 0x41, 0x52, 0x45, 0x5C, 0x53, 0x70, 0x79, 0x4E, 0x65, 0x74, 0x00, 0x53, 0x74, 0x61, 0x72, 0x74,
				                   0x50, 0x65, 0x72, 0x73, 0x69, 0x73, 0x74};
			const BYTE bySig2[] = {0x46, 0x69, 0x6C, 0x65, 0x4E, 0x61, 0x6D, 0x65, 0x41, 0x74, 0x75, 0x61, 0x6C, 0x00, 0x00, 0x00, 0x50, 0x45, 0x52, 0x53, 0x49,
				                   0x53, 0x54, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0x03, 0x00, 0x00, 0x00, 0x61, 0x30, 0x32};

			if((memcmp(byBuff, bySig1, sizeof(bySig1)) == 0) && (memcmp(&byBuff[0x64], bySig2, sizeof(bySig2)) == 0))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Droper.Agent.Airs"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPWSOnlineGames
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Virus Analysis Team
	Description		: Detection routine for different varients of OnlineGames Family
						A : It Downloads malicious files and installs them on the computer. 
						B : Downloaded malicious files name include Game.exe ,QQlogic.exe,DNS.exe,Zfered.dat etc. 
						C : not-a-virus.PSW-OnlineGames: is included in a list of programs which will run automatically when Windows operating system starts up.
 						D : After installation the trojan locates the Explorer.exe process,
							drops a DLL from its body onto a hard drive and injects the dropped DLL into the Windows Explorer process.
							The dropped DLL is the main spying component. 
						Note: All dll samples, no malware activity found.

						Variants Covered:	Trojan-GameThief.Win32.OnLineGames(AANLN,XSGQ,XSGS,XSGT)
											Trojan.PSW-OnlineGames.KE
											Trojan-PSW.Win32.Kykymber(ADXR,AKMV,AMZJ)
											Trojan-PSW.Win32.Kykymber(BNVG,BRYY,BSUI,BSWN,BSXF,BSXT,BTMJ,BUOS,BWXJ,BWYF,BYXG)
											Trojan-PSW.Win32.Kykymber(CDOL,CDQX,CDQZ,CDWF,CDXV,CEVS,CEXU,CEYA,CEYO,CEYX,CFAB,CFAN,CFBP,CFDW,CFEV,CFGR,CGEK,CGQQ,CGRC,CGRY,CJBD,CJJA,CKUP,CKVPH,CKWN,CMWQ)
											Trojan-PSW.Win32.Kykymber(DJF,DJO,DJY,DKB,DKI,DKL,DKP,DLA,DLF,DLG,DMD,DMZ,DNK,DNN,DNP,DNV,DNZ,DOM,DOW,DPB,DPD,DPN,DEW,DTY)
											Trojan-PSW.Win32.Kykymber(JZL,JZN,JZO,JZP,JZK)
											Trojan-PSW.Win32.Kykymber(KPS,KUP,KYD,KYE,KYS,KYU,KYZ)
											Trojan-PSW.Win32.Kykymber(LBW,LCD,LEH,LMS,LUL,LUO,LUS,LUV,LVT,LVU,LVV,LXB)
											Trojan-PSW.Win32.Kykymber(MCX,MDP,MDY,MQB,MQC)
											Trojan-PSW.Win32.Kykymber(NYT)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPWSOnlineGames()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_dwImageBase != 0x10000000 || 
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		return iRetStatus;		
	}

	if(m_wNoOfSections >= 0x3 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x5].VirtualAddress !=0x00 && 
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x5].Size !=0x00 && m_pMaxPEFile->m_stPEHeader.Subsystem == 0x02 )
		
	{
		DWORD dwExportTableOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].VirtualAddress;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwExportTableOffset, &dwExportTableOffset))
		{
			return iRetStatus;
		}
		DWORD dwDllNameOffset=0x0;
		if(!m_pMaxPEFile->ReadBuffer(&dwDllNameOffset, dwExportTableOffset + 0xC, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if((OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDllNameOffset, &dwDllNameOffset)) || dwDllNameOffset == 0x0)
		{
			return iRetStatus;
		}

		const BYTE bySig[] = {0x6D,0x73,0x63,0x72,0x6F,0x73,0x6F,0x66,0x74,0x2E,0x64,0x6C,0x6C};//mscrosoft.dll
		const BYTE bySig1[] = {0x77,0x73,0x73,0x6F,0x63,0x6B,0x2E,0x64,0x6C,0x6C};//wssock.dll
		//Added By Tushar to Handle : PSW.Kykymber.JZL
		const BYTE bySig2[] = {0x77,0x6D,0x61,0x2E,0x64,0x6C,0x6C};//wma.dll
		//Added By Tushar to Handle : PSW.Kykymber.NYT
		const BYTE bySig3[] = {0x74,0x74,0x70,0x63,0x6F,0x6D,0x6D,0x2E,0x64,0x6C,0x6C};//ttpcomm.dll

		BYTE pbyBuff[0x20]= {0};
		if(!m_pMaxPEFile->ReadBuffer(pbyBuff, dwDllNameOffset, sizeof(bySig), sizeof(bySig1)))
		{
			return iRetStatus;
		}
		if((!memcmp(&pbyBuff[0x0], bySig, sizeof(bySig))== 0) && 
		   (!memcmp(&pbyBuff[0x0], bySig1, sizeof(bySig1))== 0) && 
		   (!memcmp(&pbyBuff[0x0], bySig2, sizeof(bySig2))== 0) && 
		   (!memcmp(&pbyBuff[0x0], bySig3, sizeof(bySig3))== 0))
		{
			//Added By Tushar to Handle : PSW.Kykymber.JZP (DLL Export Name is NULL)
			if (pbyBuff[0x00] != 0x00 && pbyBuff[0x01] != 0x00 && pbyBuff[0x02] != 0x00)
			{
				return iRetStatus;
			}
		}
		DWORD dwExportNamePointerOffset=0x0;
		if(!m_pMaxPEFile->ReadBuffer(&dwExportNamePointerOffset, dwExportTableOffset + 0x20, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if((OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwExportNamePointerOffset, &dwExportNamePointerOffset)) || dwExportNamePointerOffset ==0x0)
		{
			return iRetStatus;
		}
		dwDllNameOffset=0x0;
		if(!m_pMaxPEFile->ReadBuffer(&dwDllNameOffset, dwExportNamePointerOffset, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if((OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDllNameOffset, &dwDllNameOffset)) || dwDllNameOffset ==0x0)
		{
			return iRetStatus;
		}
		const BYTE byDllSig[] = {0x43,0x61,0x6E,0x63,0x65,0x6C,0x44,0x6C,0x6C,0x00,0x4C,0x6F,0x61,0x64,0x44,0x6C,0x6C};//CancelDll.LoadDll
		const BYTE byDllSig1[] = {0x4F,0x75,0x74,0x74,0x00,0x53,0x65,0x74,0x74};//Outt.Sett
		const BYTE byDllSig2[] = {0x52,0x75,0x6E,0x44,0x6C,0x6C,0x48,0x6F,0x73,0x74,0x43,0x61,0x6C,0x6C,0x42,0x61,0x63,0x6B};//RunDllHostCallBack
		if(!m_pMaxPEFile->ReadBuffer(pbyBuff, dwDllNameOffset, sizeof(byDllSig2), sizeof(byDllSig1)))
		{
			return iRetStatus;
		}
		if(memcmp(&pbyBuff[0x0], byDllSig, sizeof(byDllSig))== 0 || 
		   memcmp(&pbyBuff[0x0], byDllSig1, sizeof(byDllSig1))== 0 ||
		   memcmp(&pbyBuff[0x0], byDllSig2, sizeof(byDllSig2))== 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus-PSW-OnlineGames.Gen"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperDecayFVR
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  A. Process Operation: Creates & starts(run) process IExplore.exe (C:\Program Files\Internet Explorer).
					  B. Folder/File Operations: C:\Program Files\Bifrost
						 C:\Program Files\Bifrost\server.exe (copy of trojan)
						 C:\Program Files\Bifrost\logg.dat
						 C:\Program Files\Bifrost\klog.dat
						 C:\Documents and Settings\<USER>\Application Data\addons.dat
				      C. Registry Operation: Creates & sets key value for "Bifrost" under HKLM\SOFTWARE.
						Signature: Contains a loop which decrypts encrypted PE file stored in the file which it attempts to drop.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperDecayFVR()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections < 0x3 || m_wAEPSec != 0x0 || m_pSectionHeader[m_wAEPSec].VirtualAddress !=0x1000)
	{
		return iRetStatus;
	}
	BYTE bInstChk[8] = {0};
	if(m_pMaxPEFile->ReadBuffer(bInstChk, m_dwAEPMapped, 8, 8))
	{
		if((bInstChk[0x0] == 0xE8 && bInstChk[0x5] == 0xE9) || 
			(bInstChk[0x2] == 0x68 && bInstChk[0x7] == 0xE8) || 
			(bInstChk[0x0] == 0x55 && bInstChk[0x1] == 0x8B && bInstChk[0x3] == 0x83) ||
			bInstChk[0x5] == 0xE9)
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int DECAYFVR_BUFF_SIZE = 0x550;
			m_pbyBuff = new BYTE[DECAYFVR_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x600, DECAYFVR_BUFF_SIZE, DECAYFVR_BUFF_SIZE))
			{
				return iRetStatus;
			}
			CSemiPolyDBScn	polydbObj;
			TCHAR	szVirusName[MAX_PATH] = {0};
			TCHAR	szDROPPERDECAYFVR[] = {_T("4181E1FF00008079084981C900FFFFFF418B548C0C03FA81E7FF000080*79084F81CF00FFFFFF478B74BC0C0FB6D289748C0C8954BC0C8B748C0C03F281E6FF000080*79084E81CE00FFFFFF460FB654B40C8BB42410040000301430403BC572A0")};
			polydbObj.LoadSigDBEx(szDROPPERDECAYFVR, _T("Dropper.Decay.fvr"), FALSE);

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DECAYFVR_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCodecPackAFBF
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of CodecPack Family
					  Contains strings either
						"Dear BitDefender, please call my exe [Delfi.Crypt], but not [Delfi.3] okay?"
						or
						"BitDefender please call my exe [Delfi.Crypt], but not Delfi.3 okay?"	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCodecPackAFBF()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	BYTE byBuff[0x50] = {0};
	if(!m_pMaxPEFile->ReadBuffer(byBuff, m_dwAEPMapped - 0x30, 0x30, 0x30))
	{
		return iRetStatus;
	}
	DWORD dwPtrToStrOffset = 0;
	bool bFlag = 0;
	for(int i = 5; i < 0x25; i++)		
	{
		if(byBuff[i] == 0xE8)
		{
			if(*(WORD *)&byBuff[i + 5] == 0x058D)
			{
				dwPtrToStrOffset = *(DWORD *)&byBuff[i + 7];	//If string found below call it will start from bitdefender else start with dear
				bFlag = 1;
				break;
			}
			else if((byBuff[i - 5] == 0xA1))
			{
				dwPtrToStrOffset = *(DWORD *) &byBuff[i - 4];
				break;
			}
		}
	}
	if(!dwPtrToStrOffset || (OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwPtrToStrOffset - m_dwImageBase, &dwPtrToStrOffset)))
	{
		return iRetStatus;
	}
		
	DWORD dwStrOffset = 0;
	if((m_pMaxPEFile->ReadBuffer(&dwStrOffset, dwPtrToStrOffset, 4, 4)) && 
		(OUT_OF_FILE != m_pMaxPEFile->Rva2FileOffset(dwStrOffset - m_dwImageBase, &dwStrOffset)))
	{
		memset(byBuff, 0, 0x50);
		if(m_pMaxPEFile->ReadBuffer(byBuff, dwStrOffset, 0x50, 0x50))
		{
			BYTE bySig1[] = {0x42, 0x69, 0x74, 0x44, 0x65, 0x66, 0x65, 0x6E, 0x64, 0x65, 0x72};				//bitdefender
			BYTE bySig2[] = {0x5B, 0x44, 0x65, 0x6C, 0x66, 0x69, 0x2E, 0x43, 0x72, 0x79, 0x70, 0x74, 0x5D};	//[Delfi.Crypt]

			BYTE bResult = bFlag ? memcmp(bySig1, byBuff, sizeof(bySig1)) : memcmp(bySig1, &byBuff[5], sizeof(bySig1));

			if(!bResult)
			{
				bResult = bFlag ? memcmp(bySig2, &byBuff[0x1F], sizeof(bySig2)) :  memcmp(bySig2, &byBuff[0x25], sizeof(bySig2));
				if(!bResult)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, L"Trojan.CodecPack.AFBF");
					return VIRUS_FILE_DELETE;
				}
			}						
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Bisht + Virus Analysis Team
	Description		: Detection routine for different varients of Small.brus Family
					  A. Try to connect o the remote address 69.50.192.250:8000
					  B. Has a decryption loop from where it is accessing the files used by it.  
					  Signature: Pick from the decrypted section.
						Note:- Define a variable m_dwSectionAlignment and assign it "m_dwSectionAlignment = m_pMaxPEFile->m_stPEHeader.SectionAlignment;" 
						in PolyBase.cpp in "CPolyBase::CPolyBase(CMaxPEFile *pMaxPEFile)"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmallBrus()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)&&
		m_wNoOfSections == 2 && m_dwAEPUnmapped == 0x200 && m_dwAEPMapped == m_dwAEPUnmapped &&
		m_pMaxPEFile->m_stPEHeader.SectionAlignment == 0x40 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7C0)
	{	
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SMALLBRUS_BUFF = 0x100;
		m_pbyBuff = new BYTE[SMALLBRUS_BUFF];		
		if(GetBuffer(m_dwAEPUnmapped + 5 , SMALLBRUS_BUFF, SMALLBRUS_BUFF))
		{		
			DWORD dwKey = 0;			
			if(!m_pMaxPEFile->ReadBuffer(&dwKey, m_dwAEPMapped + 0x6C0, 0x04, 0x04))
			{
				return iRetStatus;
			}

			DWORD dwKey1 = 0, dwTempKey = 0, dwIndex = 0;			
			for(dwIndex = 0; dwIndex < 0x100; dwIndex++)
			{
				dwKey1	= dwKey;
				dwKey	= dwKey<<1;
				dwKey	= dwKey ^ dwKey1;
				dwKey	+= 0x1E + 3;
				dwKey1	= dwKey;
				dwKey	= dwKey >> 0x10;
				dwKey	= dwKey >> 8;
				BYTE temp = *(BYTE *)&dwKey;
				m_pbyBuff[dwIndex] = m_pbyBuff[dwIndex] ^ temp;
				dwKey = dwKey1;
			}
		}
		
		const TCHAR SMALLBRUS_SIG[] = {_T("7773325F33322E646C6C0000000000736F636B6574*636F6E6E656374000000000072656376000000000073656E6400")};
		CSemiPolyDBScn	polydbObj;	 
		polydbObj.LoadSigDBEx(SMALLBRUS_SIG, _T("Downloader.Small.Brus"), FALSE);
		
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{				
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
		return iRetStatus;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSpyKeyloggerQZP
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Keylogger.QZP Family
					  A: A keylogger program that can capture all user keystrokes which includes confidential details 
						 such as username, password, credit card number,etc
					  B: File System Modifications:
	 					C:\Windows\win32\svchost.exe
						C:\Windows\InstallDir\crack.exe
						C:\Windows\InstallDir\Server.exe (all are copies of trojan)
					  C: Registry Modifications: 
						1. To enable this trojan to run every time Windows starts it creates following registry entry:
							[HKLM\Software\Microsoft\Windows\CurrentVersion\Run]
		  					Value Name : HKLM
		  					Value Data : C:\Windows\InstallDir\Server.exe
				         2. Also adds following registry keys: 
							[HKEY_CURRENT_USER\Software\--((Mutex))--]
							ServerStarted = "13/09/2012 10:20:22"
							
							[HKEY_CURRENT_USER\Software\XtremeRAT]
							Mutex = "--((Mutex))--"    
					 D. Following Mutex objects were created:
						 TPq1iG41ExC3V
						 2APmxaRtZE
						 SlfMd0xkqW8N
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSpyKeyloggerQZP()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec != 0x0 || m_dwAEPUnmapped != 0xD0F4 || m_dwImageBase != 0x10000000)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int KEYLOGGERQZP_BUFF_SIZE = 0x80;
	m_pbyBuff = new BYTE[KEYLOGGERQZP_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	const BYTE bSig[] = {0x53,0x00,0x65,0x00,0x72,0x00,0x76,0x00,0x65,0x00,0x72,0x00,0x53,0x00,0x74,0x00,0x61,0x00,
			     0x72,0x00,0x74,0x00,0x65,0x00,0x64}; //S.e.r.v.e.r.S.t.a.r.t.e.d
	if(!GetBuffer(m_dwAEPMapped - 0x780, sizeof(bSig), sizeof(bSig)))
	{
		return iRetStatus;
	}
	if(memcmp(&m_pbyBuff[0], bSig, sizeof(bSig)) == 0)
	{
		if(!GetBuffer(m_dwAEPMapped + 0x6BC, 0x40, 0x40))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szSPYKEYLOGGERQZP[] = {_T("53004F004600540057004100520045005C0058007400720065006D0065005200410054*0A0000004D0075007400650078")};
		//S.O.F.T.W.A.R.E.\.X.t.r.e.m.e.R.A.T*...M.u.t.e.x
		
		polydbObj.LoadSigDBEx(szSPYKEYLOGGERQZP, _T("Trojan.Spy.Keylogger.qzp"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

int CSemiPolyTrojans::DetectArtuaVladislav()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections >= 0x4 && m_wAEPSec == 0x0 && 
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 &&
		m_pSectionHeader[m_wAEPSec].Characteristics >= 0x60000020 && 
		m_pSectionHeader[m_wNoOfSections - 1].Characteristics >= 0x40000040 && 
		m_pSectionHeader[m_wNoOfSections - 2].Characteristics  >= 0x42000040 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress != 0 && 
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size != 0)
	{		
		DWORD dwOverLayStart = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress;
		DWORD dwOverLaySize = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size;
		DWORD dwCorruptFile = 0;
		
		const int ARTUL_BUFF_SIZE = 0x2000;
		if(dwOverLaySize > ARTUL_BUFF_SIZE)
		{
			dwOverLaySize = ARTUL_BUFF_SIZE;			
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[ARTUL_BUFF_SIZE];
		bool bConDetection = false;
		if(m_wNoOfSections > 0x6)
		{
			if((memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".tsustub", 8) == 0)&&
				(memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".tsuarch", 8) == 0))
			{
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0], m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData  + 0x10 , 0x8,0x8))
				{ 
					return iRetStatus;	
				}
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x8], m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData  + 0x10, 0x8,0x8))
				{ 
					return iRetStatus;	
				}
				if(*(DWORD *)&m_pbyBuff[0x00] == 0x337a6974 || ( *(DWORD *)&m_pbyBuff[0x00] == *(DWORD *)&m_pbyBuff[0x08] ) || (*(DWORD *)&m_pbyBuff[0x04] == *(DWORD *)&m_pbyBuff[0x0C] ))
				{
					bConDetection = true;
				}
			}
		}
		
		if(!GetBuffer(dwOverLayStart, dwOverLaySize, dwOverLaySize))
		{		
			return iRetStatus;		
		}			
		TCHAR ARTUA_SIG[] = {_T("53616C74204C616B652043697479*7777772E7573657274727573742E636F6D*426E65692042726171*417274756120566C616469736C6176*687474703A2F2F6F6373702E636F6D6F646F63612E636F6D*61646D696E40616C6C7072656D69756D736F66742E636F6D")};
		TCHAR ARTUA_SIG2[] = {_T("53616C74204C616B652043697479*7777772E7573657274727573742E636F6D*47726561746572204D616E63686573746572*53616C666F7264*4E6174616E205269736D616E")};
		//TCHAR ARTUA_SIG3[] = {_T("53616C74204C616B652043697479*7777772E7573657274727573742E636F6D")};
		
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(ARTUA_SIG, _T("not-a-virus.Artua.Vladislav1"), TRUE);
		/*if(bConDetection)
		{
			polydbObj.LoadSigDBEx(ARTUA_SIG3, _T("not-a-virus.Artua.Vladislav"), TRUE);
		}*/
		polydbObj.LoadSigDBEx(ARTUA_SIG2, _T("not-a-virus.Artua.Vladislav3"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwOverLaySize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMahato
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Virus Analysis Team
	Description		: Detection routine for different varients of Mahato Family
					  A : Trojan.Mahato.caj: Installer files.
					  B : It creates a folder at "%Windir%\cJFoqbysvw" .
					  C : Injects its code into the following processes:IEXPLORE.EXE
					  D : It Downloads malicious files and installs them on the computer. 
					  E : Trojan.Mahato.caj: is Modifies the system registry keys. for ex 
						[ HKCU\Software\cJFoqbysvw ] "Sifre" = "connect"
						[HKCU\Software\cJFoqbysvw ] "Baglantilar" = "127.0.0.1:1453;" etc..
 					  F : Signature -> Taken loop for Modification in registry ,software name with key Name and setting for disable Start PC in safe Mode ...	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMahato()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x6458 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress == 0 && 
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0xB].VirtualAddress == 0)
	{		
		if(m_dwAEPMapped > m_pMaxPEFile->m_dwFileSize)
		{
			return iRetStatus;	
		}
		const int MAHATO_BUFF_SIZE = 0x2000;
		DWORD dwReadByte = (m_pSectionHeader[m_wAEPSec].PointerToRawData + m_pSectionHeader[m_wAEPSec].SizeOfRawData) - m_dwAEPMapped ;
		if(dwReadByte > MAHATO_BUFF_SIZE)
		{
			dwReadByte = MAHATO_BUFF_SIZE;			
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[MAHATO_BUFF_SIZE];
		if(!GetBuffer(m_dwAEPMapped, dwReadByte, dwReadByte))
		{		
			return iRetStatus;		
		}			
		TCHAR MAHATO_SIG1[] = {_T("5369667265*4261676C616E74696C6172*4261736C616E676963*59756B6C656E656E44697A696E*44697361626C65536166654D6F6465")};
		TCHAR MAHATO_SIG2[] = {_T("64FF30648920E8CFFEFFFFE8D2FEFFFF84C074076A00E8E3CBFFFFE8DEFEFFFF681801*6835010000683601000066B9BE01B201B001E83BE6FFFF*68686F40006851")};
		
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(MAHATO_SIG1, _T("Trojan.Mahato.caj"), TRUE);
		polydbObj.LoadSigDBEx(MAHATO_SIG2, _T("Trojan.Mahato.caj"), FALSE);
	

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwReadByte, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorRipinipOTB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Ripinip Family
					  A. File size = 249856 bytes.
					  B. Installation: Creates following malicious files
					   C:\Windows\system32\fsutk.dll
					   C:\Windows\system32\liprip.dll
					   C:\Windows\Kentgo.log
					   C:\Windows\inf\optkec.inf
					   $Temp%\aho.exe,ryf.exe
					 C. Registry Modifications:
						1.[HKLM\SOFTWARE\Classes\CLSID\{BF50AC63-19DA-487E-AD4A-0B452D823B59}		
		 				2.Adds foll.value to ensure autorun of installed files.
						   [HKLM\SOFTWARE\Classes\CLSID\{BF50AC63-19DA-487E-AD4A-0B452D823B59}\InprocServer32] 
						   default = "C:\Windows\system32\fsutk.dll"
						3.[HKCU\Software\Microsoft\Windows\CurrentVersion\Ext\Settings\{BF50AC63-19DA-487E-AD4A-0B452D823B59}] 
							Flags = "0x0"
						4.[HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Browser Helper Objects\{BF50AC63-19DA-487E-AD4A-0B452D823B59}] 
							default = ""
			
					Signature: Loop which attempts to create & drop copy of trojan itself.
					(Note: Samples packed with Armadillo packer) 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorRipinipOTB()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwChk = 0x0;
	if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x2C6E && 
		m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1FF6)
	{
		dwChk = 0x1;
	}
	// for dropped samples
	else if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x0 && m_dwAEPMapped == 0x108A5 &&
		m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1339C)
	{
		dwChk = 0x2;
	}
	if(dwChk == 0)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int RIPINIPOTB_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[RIPINIPOTB_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	if(dwChk == 0x1)
	{
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xF50, RIPINIPOTB_BUFF_SIZE, RIPINIPOTB_BUFF_SIZE))
		{
			return iRetStatus;
		}
	}
	else if(dwChk == 0x2)
	{
		const BYTE bDLLCHK[] = {0x46,0x53,0x55,0x54,0x4B,0x2E,0x44,0x4C,0x4C}; // FSUTK.DLL
		if(!GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress + 0x50, sizeof(bDLLCHK), sizeof(bDLLCHK)))
		{
			return iRetStatus;
		}
		if(memcmp(&m_pbyBuff[0x0], bDLLCHK, sizeof(bDLLCHK)) == 0)
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0x1E30, 0x50, 0x50))
			{
				return iRetStatus;
			}
		}
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	szBACKDOORRIPINIPOTB[] = {_T("74198B5424108B42F885C00F84D20600008B44244450E9BF0600008D4C3711*8D143B894C24388D4C32118D542474894C24308B4408B08B4C246C51528BCD8944247C*E8130C00008D4C2458C684242807000006E8A80B00006848B943008D4C2414E8880B00008B4C2410")};
	TCHAR   szADWAREBHOQBI[] = {_T("6C69707269702E646C6C*42463530414336332D313944412D343837452D414434412D304234353244383233423539")};
				   //liprip.dll*BF50AC63-19DA-487E-AD4A-0B452D823B59
	polydbObj.LoadSigDBEx(szBACKDOORRIPINIPOTB, _T("Backdoor.Ripinip.otb"), TRUE);
	polydbObj.LoadSigDBEx(szADWAREBHOQBI, _T("not-a-virus:Adware.BHO.qbi"), FALSE); //for dropped samples
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectZhelatinvg
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Zhelatin Family
					  It drops a driver and creates a service corresponding to it
						  -This code detects only the dropper samples
						  -Driver dropped by each sample is same and already detecting in PE so no action taken.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectZhelatinvg()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections != 5)
	{
		return iRetStatus;
	}
	if((memcmp(m_pSectionHeader[2].Name, ".rdata", 5) == 0) && (memcmp(m_pSectionHeader[3].Name, ".bss", 4) == 0) && m_pSectionHeader[2].SizeOfRawData < 0x500)
	{
		BYTE byBuff[0x70] = {0};
		if(!m_pMaxPEFile->ReadBuffer(byBuff, m_pSectionHeader[2].PointerToRawData + 0x20, 0x70, 0x70))
		{
			return iRetStatus;
		}
		TCHAR ZhelatinSig[] = {_T("2D4C49424743435733322D45482D332D534A4C4A2D475448522D4D494E47573332*722D3E73697A65203D3D2073697A656F66285733325F45485F53484152454429")};	
		
		CSemiPolyDBScn	polydbObj;
		polydbObj.LoadSigDBEx(ZhelatinSig, _T("Trojan.Zhelatin.vg"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};
		
		if(polydbObj.ScanBuffer(&byBuff[0], 0x70, szVirusName) >= 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			iRetStatus = VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperInegeryCQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Inegery.CQ Family
					  A. Temporarily drops following files when triggered which were later removed:
						  C:\start.bat
						  %Temp%\jnduf.bat
						  %Temp%\jnduf~.tmp					
		 			  B. Registry Modifications: 
						  [HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Associations]
						   ModRiskFileTypes = ".exe"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperInegeryCQ()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(!(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x2AAA &&  
	    (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x16A66 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x84000)))
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int INEGERYCQ_BUFF_SIZE = 0x60;
	m_pbyBuff = new BYTE[INEGERYCQ_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	if(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x84000 && 
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0) &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0x0)
	{
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 0x1].PointerToRawData + 0x160, INEGERYCQ_BUFF_SIZE, INEGERYCQ_BUFF_SIZE))
		{
			return iRetStatus;
		}
	}
	else if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0x68160, INEGERYCQ_BUFF_SIZE, INEGERYCQ_BUFF_SIZE))
	{
		return iRetStatus;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	szDROPPERINEGERYCQ[] = {_T("64656C20253000006A6E6475667E2E746D700A006A6E6475667E2E746D70*6563686F206F66660A00006A6E6475662E6261740000006A6E6475667E2E746D70")};
					//del %0..jnduf~.tmp..jnduf~.tmp*echo off...jnduf.bat...jnduf~.tmp

	polydbObj.LoadSigDBEx(szDROPPERINEGERYCQ, _T("Trojan.Dropper.Inegery.cq"), FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], INEGERYCQ_BUFF_SIZE, szVirusName) >= 0)
	{
		DWORD dwNameID = 0x10, dwLang = 0x0001 , dwLangID = 0x804, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;
		if(FindRes(LPCTSTR(&dwNameID), LPCTSTR(&dwLang), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			const BYTE bSig[] = {0x44,0x00,0x65,0x00,0x73,0x00,0x6B,0x00,0x4D,0x00,0x61,0x00,0x74,0x00,0x65,0x00,
				             0x2E,0x00,0x65,0x00,0x78,0x00,0x65}; // D.e.s.k.M.a.t.e...e.x.e
			
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
			{
				return iRetStatus;
			}
			if(!GetBuffer(dwReadOffset + 0x21C, 0x20, 0x20))
			{
				return iRetStatus;
			}
			if(memcmp(&m_pbyBuff[0x0], bSig, sizeof(bSig)) == 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: FindRes
	In Parameters	: LPCTSTR lpstNameID, LPCTSTR lpstLaunguage, LPCTSTR lpstLangID, DWORD &dwRVA, DWORD &dwSize
	Out Parameters	: 1 if success elase 0
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function finds the resource data from resource section
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::FindRes(LPCTSTR lpstNameID, LPCTSTR lpstLaunguage, LPCTSTR lpstLangID, DWORD &dwRVA, DWORD &dwSize)
{
	int iRetStatus = 0x00;
	
	DWORD dwRsrcTableOffset = 0;
	if(m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress, &dwRsrcTableOffset) == OUT_OF_FILE)
	{
		return iRetStatus;
	}
	
	DWORD dwOffset = FindResourceEx(lpstNameID, dwRsrcTableOffset);
	if(dwOffset == 0x00)
	{
		return iRetStatus;
	}
	DWORD dwReadOffset = dwRsrcTableOffset + dwOffset;
	dwOffset = FindResourceEx(lpstLaunguage,dwReadOffset); 
	if(dwOffset == 0x00)
	{
		return iRetStatus;
	}
	dwReadOffset = dwRsrcTableOffset + dwOffset;
	dwOffset = FindResourceEx(lpstLangID,dwReadOffset); 
	if(dwOffset == 0x00)
	{
		return iRetStatus;
	}
	BYTE byBuffer[0x08] = {0x00};
	dwReadOffset = dwOffset + dwRsrcTableOffset;
			
	if(!m_pMaxPEFile->ReadBuffer(byBuffer, dwReadOffset, 8, 8))
	{
		return iRetStatus;
	}
	dwRVA = *((DWORD*)&byBuffer[0]);
	dwSize = *((DWORD*)&byBuffer[4]);
	return 0x01;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDarkComet
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Mangesh + Virus Analysis Team
	Description		: Detection routine for different varients of DarkComet Family
					  It is Remote Administration Tool file known as server files.
					  On execution it grant permission to access host remotly.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDarkComet()
{
	if((m_dwAEPUnmapped == 0x8F888 || m_dwAEPUnmapped == 0x9E90C || m_dwAEPUnmapped == 0x8E85C || m_dwAEPUnmapped == 0x9F92C)) // delphi compiled file
	{
		DWORD dwSigOffset1 = 0, dwSigOffset2 = 0, dwSigOffset3 = 0, dwCount = 0;

		if(m_dwAEPUnmapped == 0x8F888 && (memcmp(m_pSectionHeader[0].Name, ".MPRESS1", 8) == 0))// Darkcoment.eku  
		{
			dwSigOffset1 = 0x6D1C0, dwSigOffset2 = 0x86445, dwSigOffset3 = 0x7D510;
		}
		else if(m_dwAEPUnmapped == 0x8F888 )// Darkcoment.eku  
		{
			dwSigOffset1 = 0x6C5C0, dwSigOffset2 = 0x85845, dwSigOffset3 = 0x7C910;
		}
		else if(m_dwAEPUnmapped == 0x9E90C)//Siscos.aos
		{
			dwSigOffset1 = 0x81674, dwSigOffset2 = 0x81754, dwSigOffset3 = 0x81924; 
		}
		else if(m_dwAEPUnmapped == 0x8E85C )//Siscos.bph
		{
			dwSigOffset1 = 0x72048, dwSigOffset2 = 0x72128, dwSigOffset3 = 0x72310; 			
		}
		else if(m_dwAEPUnmapped == 0x9F92C)// Darkcoment.a
		{
			dwSigOffset1 = 0x2FBB4 , dwSigOffset2 =  0x92388, dwSigOffset3 = 0x92558; 			
		}

		if(CheckDarkComet(dwSigOffset1, dwSigOffset2, dwSigOffset3))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.DarkComet"));
			return VIRUS_FILE_DELETE;
		}
		if(m_dwAEPUnmapped == 0x8E85C)
		{
			dwSigOffset1 = 0x71448 , dwSigOffset2 =  0x71528, dwSigOffset3 = 0x71710; 
		
		}
		else if(m_dwAEPUnmapped == 0x9F92C) //MPRESS packed n PECompact packed files
		{
			dwSigOffset1 = 0x307B4 , dwSigOffset2 =  0x92F88, dwSigOffset3 = 0x93158; 
		}
		if(CheckDarkComet(dwSigOffset1,dwSigOffset2,dwSigOffset3))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.DarkComet"));
			return VIRUS_FILE_DELETE;
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDarkComet
	In Parameters	: 
	Out Parameters	: true if success else false
	Purpose			: 
	Author			: Tushar Kadam + Mangesh + Virus Analysis Team
	Description		: Reads buffer from given location and searches for DarkComet Signature.
--------------------------------------------------------------------------------------*/
bool CSemiPolyTrojans::CheckDarkComet(DWORD dwSigOffset1, DWORD dwSigOffset2, DWORD dwSigOffset3)
{
	BYTE byBuff[0x11] = {00};
	m_pMaxPEFile->ReadBuffer(byBuff, dwSigOffset1, 0x7, 0x7);
	
	BYTE bySig1[] = {0x23, 0x4B, 0x43, 0x4D, 0x44, 0x44, 0x43};//#KCMDDC key
	if(memcmp(byBuff, bySig1, sizeof(bySig1))== 0)
	{		
		m_pMaxPEFile->ReadBuffer(byBuff, dwSigOffset3, 0x11, 0x11);
		BYTE bySig3[] = {0x70, 0x69, 0x6E, 0x67, 0x20, 0x31, 0x32, 0x37, 0x2E, 0x30, 0x2E, 0x30, 0x2E, 0x31, 0x20, 0x2D, 0x6E};//ping to host
		if(memcmp(byBuff, bySig3, sizeof(bySig3))== 0)
		{
			m_pMaxPEFile->ReadBuffer(byBuff, dwSigOffset2, 0x9, 0x9);
			BYTE bySig2[] = {0x4B, 0x45, 0x45, 0x50, 0x41, 0x4C, 0x49, 0x56, 0x45};//KEEPALIVE ippacket string
			if(memcmp(byBuff, bySig2, sizeof(bySig2))== 0)
			{
				return true;
			}
		}
	}
	return false;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDialerSmallE
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Small Family
					  A. Dialer.Small.E attempts to dial adult content phone services/telephone numbers using computer's modem 
						& also notifies the user of the services that will be provided & then tries to establish a connection to a remote server
						& incurs the service charges on the telephone bill.
					  B. UPX packed samples.
					  C. Installs itself in C:\Windows & creates shortcuts & pins them to start menu.
					  D. Registry Operations: 
							1. [HKCU\Software\WebDialer]
							2. [HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall\WebDialer]
							3. Also adds registry entries to enable its automatic execution at every system startup.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDialerSmallE()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(!(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && (m_dwAEPUnmapped % 0x10) == 0xC))
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int DIALERSMALLE_BUFF_SIZE = 0x400;
	m_pbyBuff = new BYTE[DIALERSMALLE_BUFF_SIZE];
	DWORD dwBuffSize = 0x0;
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	if(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData == 0x10000 && (memcmp(m_pSectionHeader[m_wAEPSec + 0x2].Name, ".data", 5) == 0))
	{
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x180, 0x255, 0x255))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x255;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x990, 0x90, 0x90))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x90;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x2360, 0x80, 0x80))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x80;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[0x2].PointerToRawData + 0x2D00, 0x80, 0x80))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x80;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	szDIALERSMALLE[] = {_T("536F6674776172655C5765626469616C6572*43757272656E7456657273696F6E5C556E696E7374616C6C5C5765626469616C6572*5741524E494E473A20594F55204D55535420424520454947485445454E2028313829205945415253200D0A204F4620414745204F52204F4C444552")};
				   //Software\Webdialer*CurrentVersion\Uninstall\Webdialer*WARNING: YOU MUST BE EIGHTEEN (18) YEARS .. OF AGE OR OLDER
	
	TCHAR	szDIALERSMALLE1[] = {_T("536F6674776172655C5765626469616C6572*43757272656E7456657273696F6E5C556E696E7374616C6C5C5765626469616C6572*5741524E494E472A2A2A2A0A596F75206D75737420626520656967687465656E2028313829207965617273206F6620616765206F72206F6C64657220746F2075736520746869732073657276696365")};
				   //Software\Webdialer*CurrentVersion\Uninstall\Webdialer*WARNING****.You must be eighteen (18) years of age or older to use this service
	
	polydbObj.LoadSigDBEx(szDIALERSMALLE, _T("not-a-virus:Porn.Dialer.Small.E"), TRUE);
	polydbObj.LoadSigDBEx(szDIALERSMALLE1, _T("not-a-virus:Porn.Dialer.Small.E"), FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickerAutoItO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Virus Analysis Team
	Description		: Detection routine for different varients of AutoIt.O Family
					  A. Process Operation: Creates & starts(run) process IExplore.exe (C:\Program Files\Internet Explorer).
					  B. Internet Operations: To redirect few malicious site
								1:-www.baidu.com 
								2:-www.hao123.com 
								3:-www.hao9991.net 
								4:-www.go2000.cn ..etc
					  C. Registry Operation: 
								1:- CHKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Associations
									LowRiskFileTypes = /{hq:/s`s:/ogn:/uyu:/dyd:/c`u:/bnl:/ble:/sdf:/lrh:/iul:/iulm:/fhg:/clq:/kqf:/`wh:/lqf:/lqdf:/lnw:/lq2:/l2t:/v`w:/rbs:
								2:- HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Attachments 
									SaveZoneInformation = 1'
								3:- HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System 
									DisableTaskMgr = 1'
						Signature: Taken malicious site Name and CompanyName (bcz it's a IExplore.exe file and CompanyName/TR Internet not a microsoft Explorer so Taken as Signature...
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerAutoItO()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections >= 0x3 && m_wAEPSec == 0x0)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AUTOITO_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[AUTOITO_BUFF_SIZE];
		const BYTE HEADER_CHECK[] = {0x35,0x64,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x34,0x34,0x32,0x32};
		if(!GetBuffer(0x10, 0x20, 0x20))
		{
			return iRetStatus;
		}
		for(DWORD dwOffset = 0x0 ; dwOffset < 0x20 - sizeof(HEADER_CHECK); dwOffset++)
		{
			if(memcmp(&m_pbyBuff[dwOffset],HEADER_CHECK,sizeof(HEADER_CHECK))== 0)
			{
				DWORD dwReadByte = m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData;
				if(dwReadByte < 0x1000)
				{
					return iRetStatus;
				}
				if(dwReadByte > 0x2000)
				{
					dwReadByte = 0x2000;
				}
				if(!GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData - dwReadByte , AUTOITO_BUFF_SIZE, AUTOITO_BUFF_SIZE))
				{
					return iRetStatus;
				}
				CSemiPolyDBScn	polydbObj;
				TCHAR	szVirusName[MAX_PATH] = {0};
				TCHAR	AUTOITO_SIG[] = {_T("62616964752E636F6D*68616F3132332E636F6D*68616F393939312E6E6574*7777772E676F323030302E636E")};
				//baidu.com*hao123.com*hao9991.net*www.go2000.cn
				TCHAR	AUTOITO_SIG1[] = {_T("43006F006D00700061006E0079004E0061006D006500000000002F54A852200049006E007400650072006E006500740020004500780070006C006F0072*00650072")};
				//C.o.m.p.a.n.y.N.a.m.e...../T.R .I.n.t.e.r.n.e.t. .E.x.p.l.o.r*.e.r
				polydbObj.LoadSigDBEx(AUTOITO_SIG, _T("Trojan-Clicker.AutoIt.O"), TRUE);
				polydbObj.LoadSigDBEx(AUTOITO_SIG1, _T("Trojan-Clicker.AutoIt.O"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwReadByte, szVirusName) >= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentDJ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.DJ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentDJ()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x03 && m_dwAEPUnmapped == 0x2B8B &&
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		m_pbyBuff = new BYTE[0x7F];
		if(!GetBuffer(0x2618, 0x05, 0x05))
		{
			return iRetStatus;
		}

		//String asdas in last section
		if(*(DWORD*)&m_pbyBuff[0] == 0x61647361 && m_pbyBuff[4] == 0x73)
		{
			//Size==0x3ABF
			if(!GetBuffer(0x937, 0x04, 0x04))
			{
				return iRetStatus;
			}
			if(*(WORD*)&m_pbyBuff[0] == 0x3ABF)
			{
				//String "STARTING"
				if(!GetBuffer(0x62E8, 0x08, 0x08))
				{
					return iRetStatus;
				}
				if(*(DWORD *)&m_pbyBuff[0] == 0x52415453 && *(DWORD *)&m_pbyBuff[4] == 0x474E4954)
				{
					//Hash Keys used
					BYTE byHashKeys[4]={0};
					if(!m_pMaxPEFile->ReadBuffer(byHashKeys, 0x2620, 0x04, 0x04))
					{
						return iRetStatus;
					}
					if(*(DWORD*)&byHashKeys[0] == 0xC66F7E0A)
					{
						if(!GetBuffer(0x60E0, 0x7F, 0x7F))
						{
							return iRetStatus;
						}
						//Checking whether the hash key returns the appropriate values
						if(m_pbyBuff[byHashKeys[0]] == 0xE6 &&
							m_pbyBuff[byHashKeys[1]] == 0x4D &&
							m_pbyBuff[byHashKeys[2]] == 0x5A)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Agent.dj"));
							return VIRUS_FILE_DELETE;
						}
					}
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareLook2MeAB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Look2Me.AB Family
					  A. Installation:
						  Installer files drop following files when triggered:
						  %system32%\<random_name>.dll (2 copies of dll)
						  %system32%\guard.tmp
					  B. Process Operation: Kills Explorer.exe when launched.
					  C. Files packed using "Neolite" packer.
				      D. Look2Me is a downloadable application designed by Nictech Networks which allows the user to chat,email
					     or search for other singles around the world.
					  E. Requests following host name: www.ad-w-a-r-e.com
				      F. Registry Modifications:
						1.[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Notify\PhotoPropertyHandler]
							 Asynchronous = 0x00000000
							 DllName = "%System%\<random_name>.dll"
							 Impersonate = 0x00000000
									 Logon = "WinLogon"
									 Logoff = "WinLogoff"
									 Shutdown = "WinShutdown"
	                   so that <random_name>.dll is installed as a Winlogon notification package.

						2.[HKLM\SOFTWARE\Classes\CLSID\{D1BF5AFB-6BEA-4DBB-B404-0CAE5D6A4E6A}\InprocServer32]
							 Default = "%System%\<random_name>.dll"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareLook2MeAB()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections > 0x5 || m_wAEPSec > 0x1)
	{
		return iRetStatus;
	}
	if(((m_dwAEPUnmapped % 0x10) == 0xC || m_dwAEPUnmapped == 0x8949 || (m_dwAEPUnmapped / 0x1000) == 0x2A) &&
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, "EPb", 3) == 0 || (memcmp(m_pSectionHeader[m_wAEPSec].Name, "EPa", 3) == 0)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int LOOK2MEAB_BUFF_SIZE = 0x2300;
		m_pbyBuff = new BYTE[LOOK2MEAB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_pSectionHeader[0x1].PointerToRawData == 0x3D000 && 
			(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) //dll
		{
			if(!GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0xB9A0,LOOK2MEAB_BUFF_SIZE,LOOK2MEAB_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		else if(m_pSectionHeader[0x1].PointerToRawData == 0x1B000) //exe
		{
			if(!GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x4B2F0, 0xD00, 0xD00))
			{
				return iRetStatus;
			}
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szADWARELOOK2MEAB_DLL1[] = {_T("67756172642E746D70*7777772E61642D772D612D722D652E636F6D")};
						    //guard.tmp*www.ad-w-a-r-e.com
		TCHAR   szADWARELOOK2MEAB_DLL2[] = {_T("7777772E61642D772D612D722D652E636F6D*67756172642E746D70")};
						   //www.ad-w-a-r-e.com*guard.tmp
		TCHAR   szADWARELOOK2MEAB_EXE[]  = {_T("4C006F006F006B0032004D0065*687474703A2F2F7777772E61642D772D612D722D652E636F6D")};
						   //L.o.o.k.2.M.e*http://www.ad-w-a-r-e.com

		polydbObj.LoadSigDBEx(szADWARELOOK2MEAB_DLL1, _T("not-a-virus:Adware.Look2Me.ab"), TRUE);
		polydbObj.LoadSigDBEx(szADWARELOOK2MEAB_DLL2, _T("not-a-virus:Adware.Look2Me.ab"), TRUE);
		polydbObj.LoadSigDBEx(szADWARELOOK2MEAB_EXE, _T("not-a-virus:Adware.Look2Me.ab"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorAgentBULO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.BULO Family
					  A. Once launched makes copy of itself at following location with hidden file attributes:
						C:\Windows\system32\Windupdt\winupdate.exe
					  B. Runs the following files:
						C:\Windows\system32\cmd.exe
					  C. Also Disables Regedit & Task Manager on infection.
					  D. Registry Modifications:
						 -> [HKCU\Software\Microsoft\Windows\CurrentVersion\Run] 
							winupdater = "C:\Windows\system32\Windupdt\winupdate.exe"
						 -> [HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon] 
							UserInit = "C:\Windows\system32\userinit.exe, C:\Windows\system32\Windupdt\winupdate.exe"
						Signature: Contains a loop which attempts to generate an IP address to establish connection with the remote host &
						also creation of Windupdt\winupdate.exe in system32.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorAgentBULO()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec > 0x1 || m_dwAEPUnmapped != 0x8E828) 
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int AGENTBULO_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[AGENTBULO_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	const BYTE AGENTBULO_SIG[] = {0x63,0x6D,0x64,0x2E,0x65,0x78,0x65,0x00,0x6F,0x70,0x65,0x6E};
				     //cmd.exe.open
	if(!GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x63624, sizeof(AGENTBULO_SIG), sizeof(AGENTBULO_SIG)))
	{
		return iRetStatus;
	}
	if(memcmp(&m_pbyBuff[0x0], AGENTBULO_SIG, sizeof(AGENTBULO_SIG)) == 0)
	{
		if(!GetBuffer(m_dwAEPMapped + 0x650, AGENTBULO_BUFF_SIZE, AGENTBULO_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szBACKDOORAGENTBULO[] = {_T("7412A1C82B49008B15AC2A49008B12E82F66F7FFA14C284900833800750FA14C284900BA84F84800E8*750FA18C2B4900BA94F84800E8EC65F7FF8D8D20FFFFFF8B15942A49008B12A1B42A49008B00E8")};
		polydbObj.LoadSigDBEx(szBACKDOORAGENTBULO, _T("Backdoor.Agent.bulo"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScarEXXU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Scar Family	
					  A: File System Modifications:
						C:\Windows\InstallDir\Server.exe (copy of trojan)
					  B. Creates new process in the system:
						iexplore.exe	[%ProgramFiles%\Internet Explorer\iexplore.exe]
					  C: Registry Modifications: 
						 1. To enable this trojan to run every time Windows starts it creates following registry entry:
							[HKLM\Software\Microsoft\Windows\CurrentVersion\Run]
		  					Value Name : HKLM
		  					Value Data : C:\Windows\InstallDir\Server.exe
						 2. Also adds following registry keys: 
							[HKEY_CURRENT_USER\Software\((Mutex))]
	  						InstalledServer = "C:\Windows\InstallDir\Server.exe"
	 						ServerStarted = "10/30/2012 10:30:00"

							[HKEY_CURRENT_USER\Software\FakeMessage]
							FakeMessage = "OK"
					 D. Following Mutex objects were created:
						XTREMEUPDATE
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarEXXU()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec != 0x0 || m_dwAEPUnmapped != 0x7D44 || m_dwImageBase != 0xC80000)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int SCAREXXU_BUFF_SIZE = 0x200;
	m_pbyBuff = new BYTE[SCAREXXU_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	const BYTE bSig[] = {0x53,0x00,0x4F,0x00,0x46,0x00,0x54,0x00,0x57,0x00,0x41,0x00,0x52,0x00,0x45,0x00,0x5C,0x00,
			     0x46,0x00,0x61,0x00,0x6B,0x00,0x65,0x00,0x4D,0x00,0x65,0x00,0x73,0x00,0x73,0x00,0x61,0x00,0x67,0x00,0x65};
			    //S.O.F.T.W.A.R.E.\.F.a.k.e.M.e.s.s.a.g.e
					
	if(!GetBuffer(m_dwAEPMapped - 0x160, sizeof(bSig), sizeof(bSig)))
	{
		return iRetStatus;
	}
	if(memcmp(&m_pbyBuff[0], bSig, sizeof(bSig)) == 0)
	{
		if(!GetBuffer(m_dwAEPMapped + 0x900, SCAREXXU_BUFF_SIZE, SCAREXXU_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTROJANSCAREXXU[] = {_T("6F00700065006E000000000058005400520045004D0045005500500044004100540045*530065007200760065007200530074006100720074006500640000000000000049006E007300740061006C006C00650064005300650072007600650072*53004F004600540057004100520045005C0000004D0075007400650078")};
		//o.p.e.n.....X.T.R.E.M.E.U.P.D.A.T.E*S.e.r.v.e.r.S.t.a.r.t.e.d.......I.n.s.t.a.l.l.e.d.S.e.r.v.e.r*S.O.F.T.W.A.R.E.\...M.u.t.e.x
		
		polydbObj.LoadSigDBEx(szTROJANSCAREXXU, _T("Poly.Trojan.Scar.exxu"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorXtremeAZC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Prakash Mishra + Virus Analysis Team
	Description		: Detection routine for different varients of Xtreme Family
					  Signature: Loop which attempts to create own folder for installing itself software & add registry entry.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorXtremeAZC()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec != 0x0 || (m_dwAEPUnmapped != 0x88F4 && m_dwAEPUnmapped != 0x8ABC) || m_pSectionHeader[m_wAEPSec].SizeOfRawData < 0x1000)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	DWORD NoofReadByte=0x0;
	const int XTREAM_BUFF_SIZE = 0x2000;
	m_pbyBuff = new BYTE[XTREAM_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	NoofReadByte = (m_pSectionHeader[m_wAEPSec].SizeOfRawData  + m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x500) - m_dwAEPMapped;
	if( NoofReadByte  > XTREAM_BUFF_SIZE)
	{
		NoofReadByte = XTREAM_BUFF_SIZE;
	}
	if(!GetBuffer( m_dwAEPMapped - 0x500 , NoofReadByte, NoofReadByte))
	{
		return iRetStatus;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	szBACKDOOR_Sig[] = {_T("460061006B0065004D00650073007300610067006500000053004F004600540057004100520045005C00460061006B0065004D006500730073006100670065*72006500730074006100720074*4E004F0049004E004A0045004300540025")};
								//F.a.k.e.M.e.s.s.a.g.e...S.O.F.T.W.A.R.E.\.F.a.k.e.M.e.s.s.a.g.e*r.e.s.t.a.r.t*I.N.J.E.C.T.%
	TCHAR	szBACKDOOR_Sig1[] = {_T("6F00700065006E000000000058005400520045004D0045*45005C0058007400720065006D0065005200410054*73007600630068006F00730074002E0065007800650000006500780070006C006F007200")};
								//o.p.e.n.....X.T.R.E.M.E*E.\.X.t.r.e.m.e.R.A.T*s.v.c.h.o.s.t...e.x.e...e.x.p.l.o.r.e.r...e.x.e
	polydbObj.LoadSigDBEx(szBACKDOOR_Sig, _T("Backdoor.Xtreme.azc"), TRUE); 
	polydbObj.LoadSigDBEx(szBACKDOOR_Sig1, _T("Backdoor.Xtreme.azc"), FALSE); 
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], NoofReadByte, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: CheckForVBFiles
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Bisht + Virus Analysis Team
	Description		: Detection routine for different varients of VB.ln Family
					  A. Same file is dropped in the %temp% folder with a log file and delete itself.
					  B. Puts its entry in the run registry 
						 HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run\chdxq: "C:\DOCUME~1\admin\LOCALS~1\Temp\sqnh8.exe"
					  C. Modify registry
						 HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-19\RefCount: 0x00000002
						 HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList\S-1-5-19\RefCount: 0x00000001
						 HKLM\SYSTEM\CurrentControlSet\Control\ServiceCurrent\: 0x0000000A
						 HKLM\SYSTEM\CurrentControlSet\Control\ServiceCurrent\: 0x0000000B
						 HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Start: 0x00000002
						 HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Start: 0x00000004
						 HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Epoch\Epoch: 0x0000004C
						 HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Epoch\Epoch: 0x0000004D
						 HKLM\SYSTEM\CurrentControlSet\Services\wscsvc\Start: 0x00000002
						 HKLM\SYSTEM\CurrentControlSet\Services\wscsvc\Start: 0x00000004
					  D. Delete registy entry
						 HKLM\SOFTWARE\Microsoft\WBEM\WDM\C:\WINDOWS\System32\DRIVERS\ipnat.sys[IPNATMofResource]: "LowDateTime:1215513088,HighDateTime:29653422***Binary mof compiled successfully" 
--------------------------------------------------------------------------------------*/
bool CSemiPolyTrojans::CheckForVBFiles()
{
	DWORD OffSet = 0;

	if(m_pMaxPEFile->ReadBuffer(&OffSet, m_dwAEPMapped,0x01,0x01))
	{ 
		if(OffSet != 0x68)
		{
			return false;
		}
		if(m_pMaxPEFile->ReadBuffer(&OffSet, m_dwAEPMapped + 0x01,0x04,0x04))
		{

			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(OffSet - m_dwImageBase, &OffSet)) 
			{
				return false;
			}
			if(m_pMaxPEFile->ReadBuffer(&OffSet, OffSet,0x04,0x04))
			{
				if(OffSet == 0x21354256)
				{
					return true;
				}
			}
		}
	}

	return false;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorVBLVN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ravi Bisht + Virus Analysis Team
	Description		: Detection routine for different varients of VB.lvn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorVBLVN()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(!((m_dwAEPUnmapped == 0x1240) && 
		((m_pSectionHeader[1].VirtualAddress== 0x29000) || (m_pSectionHeader[1].VirtualAddress == 0x2D000) || (m_pSectionHeader[1].VirtualAddress== 0x28000))))
	{
		return iRetStatus;
	}

	if(!CheckForVBFiles())
	{
		return iRetStatus;
	}	

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int BUFF_SIZE	= 0x1200;
	m_pbyBuff = new BYTE[BUFF_SIZE];
	if(!GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
	{
		return iRetStatus;
	}

	TCHAR szSig1[] ={_T("3A4FAD339966CF11B70C00AA0060D393*4621547200699B0275A7076A9B273F4E3221193126222F28*57007335CF11AE6908002B2E1262*400000F8300000FFFFFF080000000100000001000100E9000000142140*40004C12400078000000810000008A0000008B")};

	CSemiPolyDBScn	polydbObj;
	polydbObj.LoadSigDBEx(szSig1, _T("Backdoor.VB.lvn"), FALSE);

	TCHAR	szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName)>0)
		{
			iRetStatus = VIRUS_FILE_DELETE;
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentSXPQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.SXPQ Family
					  A. Following non-malicious file added to the system:
						%TEMP%\replace.xml
   					  B. The applications attempted the following network connections:
						1. http://www.niudoudou.com/web/
						2. http://www.aimergroup.com
					  C. Foll. registry key created:
						HKCU\SOFTWARE\LOCAL APPWIZARD-GENERATED APPLICATIONS\MICROSOFT INTERNET EXPLORER\SETTINGS\	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentSXPQ()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == m_dwAEPUnmapped && 
		(m_dwAEPUnmapped == 0x164AE || m_dwAEPUnmapped == 0x1638E) &&
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x4105A || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x40E8A))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTSXPQ_BUFF_SIZE = 0x160;
		m_pbyBuff = new BYTE[AGENTSXPQ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		if(m_dwAEPUnmapped == 0x164AE)
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x1660, AGENTSXPQ_BUFF_SIZE, AGENTSXPQ_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		else if(m_dwAEPUnmapped == 0x1638E)
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xA30, 0x50, 0x50))
			{
				return iRetStatus;
			}
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szDOWNLOADERAGENTSXPQ[] = {_T("E9DD0200008B3D14334400BB3C33450053FFD785C08945F00F85A700000068083345008D4DECE8*68B4324500508D45E450C645FC08E89D470200508D4DE8C645FC09E8344602008D4DE4C645FC08E8EF44020068803245008D4DF0E8")};
		TCHAR	szDOWNLOADERAGENTSTGB[] = {_T("E91A3F03008B4424045080482301E861660300F7D81BC0F7D8C2*81EC900100008D4424006A4768A421450050FF15442644006A015881C49C010000C3B831F84300E8CC2B0100516A78E8924D0200")};
		polydbObj.LoadSigDBEx(szDOWNLOADERAGENTSXPQ, _T("Trojan.Downloader.Agent.SXPQ"), TRUE);
		polydbObj.LoadSigDBEx(szDOWNLOADERAGENTSTGB, _T("Trojan.Downloader.Agent.STGB"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKillav
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep + Virus Analysis Team
	Description		: Detection routine for different varients of KillAV Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKillav()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	DWORD dwBaseOfData = 0;
	m_pMaxPEFile->ReadBuffer(&dwBaseOfData, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x30, 4);
	
	if(m_pMaxPEFile->m_dwFileSize < m_dwAEPUnmapped &&
		((m_wNoOfSections == 0x03 && m_pSectionHeader[0].PointerToRelocations == 0x32434550) ||
		(m_wNoOfSections == 0x06 && m_pSectionHeader[0].Misc.VirtualSize == 0x20F75 && m_pSectionHeader[0].SizeOfRawData == 0x10200)) &&
		m_pMaxPEFile->m_stPEHeader.CheckSum != 0x00 && dwBaseOfData == 0x22000)		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		CSemiPolyDBScn polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szSig1[] = {_T("749B477894DA6F4374DE6F319CACB00DE36E*7448C97366B7A5D38A7EFD5A79B976AC5E9443")};		//packed
		TCHAR szSig2[] = {_T("252C736DF8ABC076787BD87BC9324D*45D750CA0A4D93370AE3FD523F1FFE8C68287DEE8D144DD8")};	//unpacked

		polydbObj.LoadSigDBEx(szSig1, _T("Trojan.Killav.crpt"), TRUE);
		polydbObj.LoadSigDBEx(szSig2, _T("Trojan.Killav.crpt"), FALSE);

		if(!GetBuffer(m_pSectionHeader[0].PointerToRawData, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		if(polydbObj.ScanBuffer(m_pbyBuff, BUFF_SIZE, szVirusName) >= 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVBNA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of VBNA Family
					  Makes copies of itself with the following names once launched:
							%Windir%\winlogon.exe	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBNA()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	
	if(m_dwAEPUnmapped == 0x1184 && m_pSectionHeader[1].SizeOfRawData == 0x00 &&
		m_pSectionHeader[1].Misc.VirtualSize == 0x14C0 && m_pSectionHeader[0].SizeOfRawData == 0x7000 &&
		m_pMaxPEFile->m_stPEHeader.FileAlignment == 0x1000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		CSemiPolyDBScn polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		TCHAR szSig[] = {_T("7A72FB6E7872E4737872169B777281D9777251CB777286CB*244678721B7C7972B1877972930D7872D65A77721D9677722D8E*7872C24077722FD97772BAED7772A4356A72DE6B7872F16B7872")};
		polydbObj.LoadSigDBEx(szSig, _T("Worm.VBNA.appj"), FALSE);

		if(!GetBuffer(0x1000, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}

		if(polydbObj.ScanBuffer(m_pbyBuff, BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectArdamax
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Ardamax Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectArdamax()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections >= 0x04) &&
		((m_pSectionHeader[0].SizeOfRawData == 0x2600)  || (m_pSectionHeader[0].SizeOfRawData == 0x24A6) || (m_pSectionHeader[0].SizeOfRawData == 0x3000))&&
		((m_pSectionHeader[1].Misc.VirtualSize == 0x7B6) || ((m_pSectionHeader[1].SizeOfRawData >= 0x7B8) && (m_pSectionHeader[1].SizeOfRawData <= 0x1000))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		BYTE dwPmrCheck[0x5];
		
		DWORD dwBuffOffset = m_pSectionHeader[0].PointerToRawData + 0x241D;			
		if(m_wAEPSec == 0x00)
		{
			dwBuffOffset = m_dwAEPMapped + 0x12F;			
		}
		
		if(!m_pMaxPEFile->ReadBuffer(&dwPmrCheck[0], dwBuffOffset, 5, 5))
		{
			return iRetStatus;
		}

		if((dwPmrCheck[0] == 0xE8) && (dwPmrCheck[2] == 0xDF) && (dwPmrCheck[3] == 0xFF) && (dwPmrCheck[4] == 0xFF))
		{			
			const int BUFF_SIZE = 0x170;
			m_pbyBuff = new BYTE[BUFF_SIZE];
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			TCHAR szSig[] = {_T("4140008946208B450C83C0FD6AFDE95CFFFFFFC16D08036A03*57FF75E4FF75E0FF75DCFF75D8E8AB06*836D0C038B4D0C8B450883E107C1E803D3E8294D0CC70601000000894508E9E4040000")};
			polydbObj.LoadSigDBEx(szSig, _T("Spy.Ardamax.t"), FALSE);

			dwBuffOffset = m_pSectionHeader[0].PointerToRawData + 0x6E0;
			if(!GetBuffer(dwBuffOffset, BUFF_SIZE, BUFF_SIZE))
				return iRetStatus;

			if(polydbObj.ScanBuffer(m_pbyBuff, BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBrontok
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of Brontok Family
					  1. Set two schedular task, 1st @11.03AM and 2nd @5.08PM everyday of week, execute drop exe
					  2. Drop winlogon.exe, csrss.exe, lsass.exe, smss.exe @ system32,
					  3. Disable regedit, all running program, explorer, folder option and cmd
					  Variants	: Email.Worm.Brontok.N, Email.Worm.Brontok.Q, Email.Worm.Brontok.JX
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBrontok()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	DWORD	dwResID = 0x03, dwLangID = 0x000, dwSize = 0, dwRVA = 0;
	DWORD	dwFileOffset = 0x00, dwDummy = 0x7532;
	
	if(!FindRes(LPCTSTR(&dwResID), LPCTSTR(&dwDummy), LPCTSTR(&dwLangID), dwRVA, dwSize))
	{
		dwLangID = 0x0409;
		dwDummy = 0x0002;
		if(!FindRes(LPCTSTR(&dwResID), LPCTSTR(&dwDummy), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			return iRetStatus;
		}
	}


	if (dwRVA == 0x00 || dwSize > 0x2000)
	{
		return iRetStatus;
	}

	if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwFileOffset))
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	m_pbyBuff = new BYTE[dwSize];
	if(!GetBuffer(dwFileOffset, dwSize, dwSize))
	{
		return iRetStatus;
	}

	TCHAR			szVirusName[MAX_PATH] = {0};
	CSemiPolyDBScn	polydbObj;
	TCHAR			szSig[] = {_T("28000000200000004000000001001800*297994297994297994297994297994*9ECE31B2DE8CE7FF73DBFF7BDFFF7BDFFF7BDFFF7BDFFF7BDFFF7BDFFF7BDFFF7B*9ECE009ECE009ECE009ECE009ECE009ECE009ECE")};
	polydbObj.LoadSigDBEx(szSig, _T("Email-Worm.Brontok.Gen"), FALSE);

	if(polydbObj.ScanBuffer(m_pbyBuff, dwSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	/*
	if((m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04) &&
		m_pSectionHeader[0].PointerToRawData == 0x1000 && m_pSectionHeader[0].Misc.VirtualSize >= 0x7000)		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		
		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("53746F70204672656520536578*476F20546F2048454C4C")};
		polydbObj.LoadSigDBEx(szSig, _T("Email-Worm.Brontok.n"), FALSE);
	
		if(m_wNoOfSections == 3)
		{
			if(!GetBuffer(0xA880, BUFF_SIZE, BUFF_SIZE))
				return iRetStatus;
		}
		else
		{
			if(!GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x1880, BUFF_SIZE, BUFF_SIZE))
				return iRetStatus;
		}

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(m_pbyBuff, BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	*/
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPSWAccPhishEU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of AccPhish.EU Family
					  A. Written using 'PHP'
				      B. On installation displays a login-password dialog box & attempts to send out email messages with 
							built-in SMTP client engine.
						 SMTP settings done in php.ini specifies capability to send out messages applicable through smtp port=25
						 & for Win32 only.
					  C. File System Modifications: 
						 Foll.directories along with files created in the system:
							 %Temp%\devels\0F350A2CE93F5189E38DBD88CCC15AF5\php.ini 
							 %Temp%\PSE11\php\modules\php_bcompiler.dll 
							 %Temp%\PSE11\php\modules\php_bz2.dll
							 %Temp%\PSE11\php\php5ts.dll 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPSWAccPhishEU()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections != 0xA || m_wAEPSec != 0x1 || memcmp(m_pSectionHeader[m_wAEPSec].Name, ".itext", 6) != 0)
	{
		return iRetStatus;
	}
	if(((m_dwAEPUnmapped % 0x1000) == 0xEB8 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x100C)
		|| (m_dwAEPUnmapped == 0x24A284 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x23F0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PSWACCPHISH_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[PSWACCPHISH_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, 0);

		DWORD dwReadOff = 0;
		if(!m_pMaxPEFile->ReadBuffer(&dwReadOff , m_dwAEPMapped + 0x67, sizeof(DWORD), sizeof(DWORD)))
		{
			return iRetStatus;
		}
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOff - m_dwImageBase, &dwReadOff))
		{
			return iRetStatus;
		}
		if(!GetBuffer(dwReadOff, 0x4, 0x4))
		{
			return iRetStatus;
		}
		
		BYTE bChkSig[] = {0x2E,0x70,0x73,0x65}; //.pse
		if(memcmp(&m_pbyBuff[0] , bChkSig, sizeof(bChkSig)) != 0)
		{
			return iRetStatus;
		}

		if((m_dwAEPUnmapped % 0x1000) == 0xEB8)
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData - 0xA50, PSWACCPHISH_BUFF_SIZE, PSWACCPHISH_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		else if(m_dwAEPUnmapped == 0x24A284)
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData - 0x1360, PSWACCPHISH_BUFF_SIZE, PSWACCPHISH_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szPSWACCPHISHEU[] = {_T("5C50534531315C*7B74656D707D0000FFFFFFFF0D0000005C7068705C6D6F64756C65735C*5C7068703574732E646C6C*5C7068702E696E69")};
					    // \PSE11\*{temp}..........\php\modules\*\php5ts.dll*\php.ini
		polydbObj.LoadSigDBEx(szPSWACCPHISHEU, _T("Trojan-PSW.PHP.AccPhish.eu"), FALSE);
		
		TCHAR	szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorAgentBYKX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.BYKX Family
					  A. Dropping Routine:
						This Trojan drops the following files:
    					%System%\UrvaqpakCifs.dll (Trojan.Win32.Genome.aarlb)
					  B. Registry Modifications:
						  [HKEY_LOCAL_MACHINE\SYSTEM\ControlSet\Control\SecurityProviders]
						  SecurityProviders = "msapsspc.dll, schannel.dll, digest.dll, msnsspc.dll, UrvaqpakCifs.dll"
					  C. The applications also attempted to establish connection with a remote host.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorAgentBYKX()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections > 0x5 || m_wAEPSec != 0x0 || m_dwAEPUnmapped != 0x2950 ||
		m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0x2600)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int AGENTBYKX_BUFF_SIZE = 0x200;
	m_pbyBuff = new BYTE[AGENTBYKX_BUFF_SIZE];
	if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x280,AGENTBYKX_BUFF_SIZE,AGENTBYKX_BUFF_SIZE))
	{
		return iRetStatus;
	}
	
	CSemiPolyDBScn	polydbObj;
	TCHAR	szBACKDOORAGENTBYKX[] = {_T("7B00330061006400300035003500370035002D0038003800350037002D0034003800350030002D0039003200370037002D003100310062003800350062006400620038006500300039007D*737973707265702E657865*436F6E74726F6C5C536563757269747950726F76696465727300002E646C6C")};
					//{.3.a.d.0.5.5.7.5.-.8.8.5.7.-.4.8.5.0.-.9.2.7.7.-.1.1.b.8.5.b.d.b.8.e.0.9.}*sysprep.exe*Control\SecurityProviders...dll
	polydbObj.LoadSigDBEx(szBACKDOORAGENTBYKX, _T("Backdoor.Agent.BYKX"), FALSE);
	
	TCHAR	szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMapler
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Mapler Family
					  All samples are dll
					  stolen password of game
					  this dll files drop by GameThief trojan
					  Signature	: contain game name(MapleStory)and blacklist ip address(211.39.155.77) 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMapler()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;

	DWORD dwBaseOfData = 0;
	m_pMaxPEFile->ReadBuffer(&dwBaseOfData, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x30, 4);
	
	if(m_wNoOfSections >= 0x08 && dwBaseOfData >= 0x21000 &&
		(m_pSectionHeader[1].SizeOfRawData == 0x3600) &&
		(m_pSectionHeader[1].Misc.VirtualSize == 0x34D0) &&
		(m_pMaxPEFile->m_stPEHeader.Subsystem == 0x02) &&
		(m_pSectionHeader[2].Misc.VirtualSize == m_pSectionHeader[3].Misc.VirtualSize))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x200];		
		if(!GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x280, 0x200, 0x200))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("4D61706C6553746F72790000456C73776F7264*446961626C6F204949492E657865*3231312E33392E3135352E3737")};				
		polydbObj.LoadSigDBEx(szSig, _T("PSW.Mapler.mdd"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(m_pbyBuff, 0x200, szVirusName) >= 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDialerQN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Dialer.QN Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDialerQN()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwBaseOfData = 0;
	m_pMaxPEFile->ReadBuffer(&dwBaseOfData, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x30, 4);
	if( m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData >= 0x5500 && m_pSectionHeader[0].PointerToLinenumbers == 0x4F17)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUFF_SIZE = 0x500;

		m_pbyBuff = new BYTE[BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer(dwBaseOfData, 0x500, 0x500))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szDialerQN1_Sig[] = {_T("6D33643572743130*52657472790D0A64656C20222573220D0A696620657869737420*2225732220676F746F2052657472790D0A64656C20222573220D0A65786974")};// Dialer.QN for dropped DLL files
		TCHAR   szDialerQN2_Sig[] = {_T("534F4654574152455C4D6963726F736F66745C4D53534D4752*756964313D307825582C20756964323D30782558")};//Small.isb
		TCHAR   szDialerQN3_Sig[] = {_T("52657472790D0A64656C20222573220D0A6966206578697374202225732220676F746F2052657472790D0A64656C20222573220D0A65786974*2D74657374*676F7300696E7374*746573")};//Agent.Blh
		TCHAR   szDialerQN4_Sig[] = {_T("534F4654574152455C4D6963726F736F66745C50535256*7777772E637261636B64622E62697A")};//Trojan.Mezzia

		polydbObj.LoadSigDBEx(szDialerQN1_Sig, _T("Trojan.Dialer.QN"), TRUE); 
		polydbObj.LoadSigDBEx(szDialerQN2_Sig, _T("Trojan.Small.isb"), TRUE); 
		polydbObj.LoadSigDBEx(szDialerQN3_Sig, _T("Trojan.Agent.blh"), TRUE);
		polydbObj.LoadSigDBEx(szDialerQN4_Sig, _T("Trojan.Mezzia"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x500, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectBybz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Mangesh + Virus Analysis Team
	Description		: Detection routine for different varients of Bybz Family
					  Worm.Bybz.s, Worm.Bybz.eoq
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBybz()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x15A4 && m_pSectionHeader[0].SizeOfRawData >=0xB000)
	{
		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
	
		m_pbyBuff = new BYTE[0x100];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		if(!GetBuffer(0xA740, 0x100, 0x100))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szBybz_Sig[] = {_T("681E40008D8D50FDFFFFE8FF6DFFFF8D854CFDFFFF508D8550FDFFFF50E8CB2800*008BD08D8D38FDFFFFE8E56DFFFFBAF41E40008D8D44FDFFFFE8CF6DFFFFBAB81E*40008D8D48FDFFFFE8BF6DFFFF8D8544FDFFFF508D8548FDFFFF50E88B2800008BD08D8D34FDFFFFE8A56DFFFF566A026A01568D8530FDFFFF506A106880")};
		
		polydbObj.LoadSigDBEx(szBybz_Sig, _T("Worm.Bybz.s"), FALSE); 
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x100, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPalevo
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Palevo Family
					  A : It is Net-Worm which uses on of the following sharing Networks for spreading
							1 : BearShare
							2 : iMesh
							3 : ShareAza
							4 : Kazaa (Same used in Sytro Family)
							5 : DC++
							6 : eMule
							7 : eMul Plus
						B : The Other means of spreading are Removable drives and media...
						C : It communincates to the malicous server and can convey status using following strings
								1 : Spread Started
								2 : USB Spreader Running
								3 : Copy To USB : %S (Path of File)
								4 : Drive Infected... Etc....
						D : It creates a copy of itself in Recycler Folder and puts Registry entry at following locatopn
								HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon
								"Taskman"	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPalevo(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if (m_pMaxPEFile->m_stPEHeader.NumberOfSections < 0x03 || m_pMaxPEFile->m_stPEHeader.NumberOfSections > 0x05)
		return iRetStatus;

	if ((m_pSectionHeader[0x02].Characteristics & IMAGE_SCN_MEM_WRITE) != IMAGE_SCN_MEM_WRITE)
		return iRetStatus;

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int PALEVO_BUFF_SIZE	= 0x400;
	m_pbyBuff = new BYTE[PALEVO_BUFF_SIZE];
	memset(m_pbyBuff,0x00,sizeof(m_pbyBuff));

	if(!GetBuffer(m_dwAEPMapped,0x15,0x15))
		return iRetStatus;

	DWORD	dwJumpOffSet = 0x00;
	BYTE	bPrimarySigAYAL0[] = {0x55, 0x8B, 0xEC, 0x83, 0xEC}; // .AYAL
	BYTE	bPrimarySigAYAL1[] = {0x55, 0x8B, 0xEC, 0x81, 0xEC}; // .AYAL
	bool	bAYALchk = false;
	if (m_pbyBuff[0x00] == 0xE8 || m_pbyBuff[0x05] == 0xE9)
	{
		dwJumpOffSet = *((DWORD *)&m_pbyBuff[0x06]);
		dwJumpOffSet = m_dwAEPMapped + dwJumpOffSet + 0x0A;
		NEGATIVE_JUMP(dwJumpOffSet);
	}
	else if (m_pbyBuff[0x00] == 0x6A)
	{
		dwJumpOffSet = m_dwAEPMapped;
	}
	else
	{
		for(int i = 0x0; i < (0x15 - sizeof(bPrimarySigAYAL0)); i++)
		{
			if(memcmp(&m_pbyBuff[i], bPrimarySigAYAL0, sizeof(bPrimarySigAYAL0))== 0 || memcmp(&m_pbyBuff[i], bPrimarySigAYAL1, sizeof(bPrimarySigAYAL1))== 0)
			{
				bAYALchk = true;
				break;
			}
		}
		if(bAYALchk == false)
			return iRetStatus;
	}
	if(bAYALchk == false)
	{
		if(!GetBuffer(dwJumpOffSet,PALEVO_BUFF_SIZE,0x150))
			return iRetStatus;

		if (m_pbyBuff[0x00] != 0x6A)
			return iRetStatus;

		DWORD	i = 0x00, dwCallOffSet = 0x00;
		bool	bFound = false;
		BYTE	bPrimarySig[] = {0x68, 0x00, 0x00, 0x40, 0x00, 0xE8};
		BYTE	bPrimarySig1[] = {0x68, 0x00, 0x00, 0x60, 0x01, 0xE8}; // for BHNC
		BYTE	bPrimarySig2[] = {0x68, 0x00, 0x00, 0x40, 0x02, 0xE8}; // for BHNC
		for(i = 0x00; i < m_dwNoOfBytes - sizeof(bPrimarySig);i++)
		{
			if (memcmp(&m_pbyBuff[i],&bPrimarySig[0x00],sizeof(bPrimarySig)) == 0x00 || memcmp(&m_pbyBuff[i],&bPrimarySig1[0x00],sizeof(bPrimarySig1)) == 0x00
				|| memcmp(&m_pbyBuff[i],&bPrimarySig2[0x00],sizeof(bPrimarySig1)) == 0x00)
			{
				bFound = true;
				break;
			}
		}
		if (!bFound)
			return iRetStatus;

		dwCallOffSet = *((DWORD *)&m_pbyBuff[i + sizeof(bPrimarySig)]);
		dwCallOffSet = dwJumpOffSet + dwCallOffSet + i + sizeof(bPrimarySig) + 0x04;
		NEGATIVE_JUMP(dwCallOffSet);
		
		bool bBHNC = false;
		if (dwCallOffSet != m_pSectionHeader[0x00].PointerToRawData)
			bBHNC = true;

		if(!GetBuffer(dwCallOffSet,0x150,0x150))
			return iRetStatus;
		if(bBHNC == false)
		{
			//-------------------------------------Poly.Net-Worm.Palevo.ANN------------------------------------------
			/*
			CALL 00000000
			:
			:
			POP ESI (Start Offset)
			:
			:
			:
			MOV ECX,XXXXXXXX (Counter)
			:
			:
			:
			MOVE BL, BYTE PTR DS:[ECX + ESI]
			ADD BL,AL
			XOR BL,AH
			INC AL
			MOV BYTE PTR SS:[ECX + ESP -1],BL
			LOOP SHORT
			*/
			TCHAR			szVirusName[MAX_PATH] = {0};
			TCHAR			szPalevo_ANN[] ={_T("43803B00743DE8000000005E83C64AB9*F6D002C4D0F88A1C0E02D832DCFEC0885C0CFFE2F1BA*2BD68BDC03DA4B54FFD333C050")};
			CSemiPolyDBScn	polydbObj;

			if(polydbObj.LoadSigDBEx(szPalevo_ANN, _T("Poly.Net-Worm.Palevo.ANN"), FALSE) <= 1)
				return iRetStatus;

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					iRetStatus = VIRUS_FILE_DELETE;
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				}
			}
		}else //------------------------------------P2P-Worm.Palevo.BHNC------------------------------------------
		{
			/*
			PUSH EBP
			.
			.
			PUSH 0
			.
			.
			PUSH offset										-+
			PUSH 0											- 5 times
			CALL <find windo> ar Register<findWindo>		-+
			*/

			DWORD dwOffset = 0, dwLength = 0, dwHits = 0;
			t_disasm dasm;
			bool bSearchCallSequence = false;
			bool bCallOffset		 = false;
			bool bPush68Found		 = false;
			bool bPush6AFound		 = false;
			ulong CallOffset		 = 0x0;
			DWORD dwIsItOffset		 = 0x0;
			WORD wSec				 = 0x0;
			while(dwOffset < PALEVO_BUFF_SIZE)
			{
				memset(&dasm, 0x00, sizeof(struct t_disasm));
				dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset] , MAX_INSTRUCTION_LEN, 0x400000, &dasm, DISASM_CODE);
				if(dwOffset > (PALEVO_BUFF_SIZE - dwLength))
				{
					break;
				}
				if((dwLength == 0x1) && strstr(dasm.result,"PUSH EBP") && dwHits == 0x0)
					dwHits++;
				else if((dwLength == 0x2) && strstr(dasm.result,"PUSH 0") && dwHits == 0x01 && bSearchCallSequence == false)
				{
					dwHits++;
					bSearchCallSequence = true;
				}
				else if(bSearchCallSequence == true && dwHits <= 0x07)
				{
					if((dwLength == 0x5) && strstr(dasm.result,"PUSH") && bPush68Found == false)
					{	
						dwIsItOffset = dasm.immconst - m_dwImageBase;
						wSec = m_pMaxPEFile->Rva2FileOffset(dwIsItOffset, &dwIsItOffset);
						if( 0x01!= wSec && 0x00!= wSec)
						{	
							dwOffset += dwLength;
							continue;
						}
						bPush68Found = true;
					}else if((dwLength == 0x2) && strstr(dasm.result,"PUSH 0") && bPush68Found == true)
					{
						bPush6AFound = true;
					}
					else if((dwLength == 0x6) && strstr(dasm.result,"CALL [") && bPush6AFound == true  && bPush68Found == true)
					{
						if(bCallOffset == false)
						{
							CallOffset = dasm.adrconst;
							bCallOffset  = true;
							dwHits++;
						}else if(CallOffset == dasm.adrconst)
							dwHits++;
						else 
							return iRetStatus;
						bPush6AFound = false;
						bPush68Found = false;
					}else if((dwLength == 0x2) && strstr(dasm.result,"CALL E") && bCallOffset == false && bPush6AFound == true && bPush68Found == true)
					{
						dwHits++;
						bPush6AFound = false;
						bPush68Found = false;
					}else
					{
						bPush6AFound = false;
						bPush68Found = false;
					}
				}
				if(dwHits == 0x07 && bPush6AFound == false)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("P2P-Worm.Palevo.bhnc"));
					return VIRUS_FILE_DELETE;
				}
				dwOffset += dwLength;			
			}
		}
	}//------------------------------------P2P-Worm.Palevo.AYAL------------------------------------------
	else
	{
		if(!GetBuffer(m_dwAEPMapped, PALEVO_BUFF_SIZE, 0x150))
			return iRetStatus;
	
		DWORD dwOffset	   = 0x0, 
			  dwLength	   = 0x0, 
			  dwHits	   = 0x0,
			  dwCallOffset = 0x0,
			  dwInstrucCnt = 0x0,
			  dwTempInsCnt = 0x0,
			  dwRestCalOff = 0x0,
			  dwRestJmpOff = 0x0;
		WORD  wCallChk	   = 0x0;
		char *cRegisterSearch;
		char cReg1[0x10] = {0};
		char cReg2[0x10] = {0};
		t_disasm dasm;

		while(dwOffset < PALEVO_BUFF_SIZE)
		{
			memset(&dasm, 0x00, sizeof(struct t_disasm));
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset] , MAX_INSTRUCTION_LEN, 0x400000, &dasm, DISASM_CODE);
			if(dwOffset > (PALEVO_BUFF_SIZE - dwLength))
			{
				break;
			}
			dwInstrucCnt++;
			if(strstr(dasm.result,"???") && (m_pbyBuff[dwOffset] == 0xD2 || m_pbyBuff[dwOffset] == 0xD3))
				dwOffset++;
			else if(dwLength == 0xA && strstr(dasm.result,"MOV DWORD PTR") && dwHits == 0x0)
				dwHits++;
			else if((strstr(dasm.result,"CMP") || strstr(dasm.result,"TEST")) && dwHits == 0x1)
				dwHits++;
			else if(dwLength == 0x2 && strstr(dasm.result,"PUSH 0") && dwHits == 0x02)
				dwHits++;
			else if((((dwLength == 0x6 || dwLength == 0x2) && strstr(dasm.result,"TEST")) || ((dwLength == 0x2 || dwLength == 0x3 || dwLength == 0x6) && strstr(dasm.result,"CMP") || (dwLength == 0x6 && strstr(dasm.result,"AND")))) && dwHits == 0x03)
			{	
				
				cRegisterSearch = strchr(dasm.result,','); // AL || BH Reg detection
				cRegisterSearch ++;
				memset(&cRegisterSearch[2],0,1);
				sprintf_s(cReg1, 0x10,"%s",cRegisterSearch);
				cRegisterSearch -= 0x3;
				memset(&cRegisterSearch[2],0,1);
				sprintf_s(cReg2, 0x10,"%s",cRegisterSearch);
				if(strstr(cReg1, "BH") || strstr(cReg2,"AL") || strstr(cReg1, "AL") || strstr(cReg2,"BH"))
					dwHits++; 
			}
			else if(dwLength == 0x5 && strstr(dasm.result,"CALL 0") && dwHits == 0x04)
			{
				dwCallOffset = m_dwAEPUnmapped + dwOffset + *(DWORD *)&m_pbyBuff[dwOffset + 1] + dwLength;
				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwCallOffset, &dwCallOffset))
					return iRetStatus;
				if(!m_pMaxPEFile->ReadBuffer(&wCallChk, dwCallOffset, 0x02, 0x02))
					return iRetStatus;
				if(wCallChk != 0x25FF)
				{	
					dwHits++;
					dwTempInsCnt = dwInstrucCnt;
					dwRestCalOff = dwOffset + dwLength;
				}
			}
			else if(dwHits == 0x05 )
			{
				if((strstr(dasm.result,"TEST") || strstr(dasm.result,"CMP")) && (dwInstrucCnt - dwTempInsCnt == 0x1))
				{
					dwHits++;
					dwTempInsCnt = dwInstrucCnt;
				}
				else //--------------Reset------- 
				{
					dwHits -= 0x01;
					dwOffset = dwRestCalOff;
					continue;
				}
			}
			else if(dwHits == 0x06)
			{
				if(dwLength == 0x2 && strstr(dasm.result,"SHORT 00") && (dwInstrucCnt - dwTempInsCnt == 0x1))
				{
					dwHits++;
					dwRestJmpOff = dwLength + dwOffset;
					dwOffset += m_pbyBuff[dwOffset + 1];				
					dwTempInsCnt = dwInstrucCnt;
				}
				else //--------------Reset------- 
				{
					dwHits -= 0x02;
					dwOffset = dwRestCalOff;
					continue;
				}
			}
			else if(dwHits == 0x07)
			{
				if(dwLength == 0x5 && strstr(dasm.result,"PUSH") && dwHits == 0x07 && (dwInstrucCnt - dwTempInsCnt <= 0x2))
				{

					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("P2P-Worm.Palevo.ayal"));
					return VIRUS_FILE_DELETE;
				}
				else //--------------Reset------- 
				{	
					dwHits -= 0x03;
					dwOffset = dwRestJmpOff;
					continue;
				}
			}
			dwOffset += dwLength;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSmall_EDB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Small Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmall_EDB(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if (((m_pMaxPEFile->m_stPEHeader.NumberOfSections != 0x01) || (memcmp(m_pSectionHeader[0x00].Name, ".maxs01", 7) != 0)) && 
		((m_pMaxPEFile->m_stPEHeader.NumberOfSections != 0x03) && (m_pSectionHeader[0x02].PointerToRawData != 0x4000)))
	{
		return iRetStatus;
	}

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int SMALL_BUFF_SIZE	= 0x300;
	m_pbyBuff = new BYTE[SMALL_BUFF_SIZE];

	memset(m_pbyBuff,0x00,sizeof(m_pbyBuff));
	DWORD	dwReadPtr = 0x00;
	if (m_pMaxPEFile->m_stPEHeader.NumberOfSections == 0x01)
		dwReadPtr = 0x3200;
	else
		dwReadPtr = 0x4000;
	if(!GetBuffer(dwReadPtr,SMALL_BUFF_SIZE,0x100))
		return iRetStatus;

	TCHAR			szVirusName[MAX_PATH] = {0};
	TCHAR			szSmall_EDB[] ={_T("77696E696E65742E646C6C*4F70656E*6E756C00002F632064656C2000434F4D53504543*687474703A2F2F*2E657865*2E657865")};
	CSemiPolyDBScn	polydbObj;

	if(polydbObj.LoadSigDBEx(szSmall_EDB, _T("Poly.Dwonloader.Small.EDB"), FALSE) <= 1)
		return iRetStatus;

	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName)>0)
		{
			iRetStatus = VIRUS_FILE_DELETE;
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
		}
	}

	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of NrgBot Family
					  1 : Create Remote connection with following server
							5:109:113:2 using 3460 Port
					  2 : First Instance of Trojan creates a Mutex : "qqq" for checking single parent instance
					  3 : Parent process new process of iteslf with high priviledges and limited access to others.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectNrgBot(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if (m_pMaxPEFile->m_stPEHeader.NumberOfSections < 0x05 || m_pMaxPEFile->m_dwAEPMapped != 0x510)
		return iRetStatus;

	if (m_pMaxPEFile->m_stSectionHeader[0x00].SizeOfRawData < 0x4000)
		return iRetStatus;

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int NRGBOT_BUFF_SIZE	= 0x200;
	m_pbyBuff = new BYTE[NRGBOT_BUFF_SIZE];
	memset(m_pbyBuff,0x00,sizeof(m_pbyBuff));

	if(!GetBuffer(0x3F00,NRGBOT_BUFF_SIZE,0x100))
		return iRetStatus;

	TCHAR			szVirusName[MAX_PATH] = {0};
	TCHAR			szNrgBot_BZM[] ={_T("5589E557565381EC5C060000*C744240400000000C7042401001F00E8*83EC0C85C0740D31C08D65F45B5E5FC9C21000*C744240400000000C7042400000000E8")};
	CSemiPolyDBScn	polydbObj;

	if(polydbObj.LoadSigDBEx(szNrgBot_BZM, _T("Worm.NrgBot.Bzm"), FALSE) <= 1)
		return iRetStatus;

	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName)>0)
		{
			iRetStatus = VIRUS_FILE_DELETE;
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanVBEZU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of VB Family
					  A. On installation drops copies of itself with random names at various locations .
						For e.g:winlogon.exe,Found.006.exe,B1uv3nth3x1.diz,AE 0124 BE.ani,AE 0124 BE.msi,AE 0124 BE.bmp,etc.
					  B. Also drops non-malicious Msvbvm60.dll.
					  C. Also uses Autoplay so that "Found.006.exe" executes when user tries to open any drive.
					  Signature: Names of dropped files.
	   				  Varients : Trojan.VB.ezu,Dropper.Dorifel.adtx,Worm.Vobfus.dvpo,Trojan.Jorik.Vobfus.gush,
								 Trojan.SmartFortress2012.wxf,Worm.Vobfus.ekip
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanVBEZU()
{
	// Trojan.VB.ezu,Dropper.Dorifel.adtx,Worm.Vobfus.dvpo,Trojan.Jorik.Vobfus.gush,Trojan.SmartFortress2012.wxf,Worm.Vobfus.ekip
	int	iRetStatus = VIRUS_NOT_FOUND;
	
	if  (m_pMaxPEFile->m_bIsVBFile && 
		(m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && m_wAEPSec == 0x0 && 
		((m_dwAEPMapped == 0x10E0 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2AA4 && m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0x0) //Trojan.VB.EZU
		|| (m_dwAEPMapped == 0x54C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x29A00 && (m_pMaxPEFile->m_stPEHeader.CheckSum == 0x33E6F || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x0) &&  m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0x0) //Dropper.Dorifel.adtx
		|| (m_dwAEPMapped == 0x550 && m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0x0 && (m_pMaxPEFile->m_stPEHeader.CheckSum == 0x00 || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x2BAF3)) //Worm.Vobfus.dvpo
		|| (m_dwAEPMapped == 0x10BC && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 && (m_pMaxPEFile->m_stPEHeader.CheckSum == 0x00 || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x10DB0)) //Trojan.Jorik.Vobfus.gush
		|| (m_dwAEPMapped == 0x1254 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25000 && m_pSectionHeader[m_wAEPSec + 0x2].SizeOfRawData == 0x1000) //Trojan.SmartFortress2012.wxf
		|| (m_dwAEPMapped == 0x654 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1D800)) //Worm.Vobfus.ekip
		||  (m_dwAEPMapped == 0x11A0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000)
		|| (m_dwAEPMapped == 0x12B4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	VBEZU_BUFF_SIZE = 0x400;
		DWORD		dwReadOff = 0x0,dwBytes2Read = 0x0;

		m_pbyBuff = new BYTE[VBEZU_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_dwVBSigOff, &dwReadOff))
		{
			return iRetStatus;
		}
		dwBytes2Read = VBEZU_BUFF_SIZE;
		if(m_dwAEPMapped == 0x10E0)		// For Trojan.VB.EZU
		{
			dwReadOff = dwReadOff + 0xB40;
			dwBytes2Read = 0x200;
		}
		else if(m_dwAEPMapped == 0x12B4)		// For Worm.VB.fer
		{
			dwReadOff = m_pSectionHeader[0].PointerToRawData+0x66E0;
			dwBytes2Read = 0x300;
		}
		else if(m_dwAEPMapped == 0x550)	// For Worm.Vobfus.dvpo
		{
			BYTE	bCHECKVOBFUS[] = {0x67,0x77,0x6E,0x7A,0x76,0x6F,0x62,0x70,0x73,0x6A,0x00,0x00,0x6E,0x64,0x74,0x71,0x61,0x6D,0x68,0x64,0x66,0x72,0x74};
			if(!GetBuffer(m_dwAEPMapped + 0x1A7D4,sizeof(bCHECKVOBFUS) ,sizeof(bCHECKVOBFUS)))
			{
				return iRetStatus;
			}
			if(memcmp(m_pbyBuff,bCHECKVOBFUS,sizeof(bCHECKVOBFUS)) != 0)
			{
				return iRetStatus;
			}
		}

		if(m_dwAEPMapped == 0x11A0)		// For trojan.vobfus.qvc
		{
			dwReadOff = m_pSectionHeader[0].PointerToRawData+0x230;
			dwBytes2Read = 0x40;
		}		
		
		
		if(!GetBuffer(dwReadOff, dwBytes2Read , dwBytes2Read))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;

		TCHAR	szVBFCSSig[] = {_T("181A4000*B8134000F0114000AC114000")}; //trojan.vobfus.qvc
		polydbObj.LoadSigDBEx(szVBFCSSig, _T("trojan.vobfus.qvc"),TRUE);

		TCHAR	szVBFERSig[] = {_T("70794000*6C76400064764000C0124000*E0824000F0")}; //Worm.vb.fer
		polydbObj.LoadSigDBEx(szVBFERSig, _T("Worm.Vb.fer"),TRUE);

		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTROJANVBEZU[] = {_T("63003A005C00420031007500760033006E00740068003300780031002E00640069007A*41004500200030003100320034002000420045*46004F0055004E0044002E003000300036002E006500780065")};	// Sign of Trojan.VB.EZU
						//c.:.\.B.1.u.v.3.n.t.h.3.x.1...d.i.z*A.E. .0.1.2.4. .B.E*F.O.U.N.D...0.0.6...e.x.e
		
		TCHAR	szDORIFELADTXSig[] = {_T("E900000008214000C41D40005811400078*B860410000000000D0A64200E0A64200A055000000B04200201140*50000000B39B5294A352EF4F828B70CBF5EB0FCC")};	// Sign of Dropper.Dorifel.adtx
		TCHAR	szVOBFUSDVPOSig[] = {_T("E90000000C214000C81D40005C11400078*C060410000000000C0A74200D0A74200A055000000B04200261140*500000005EDF645B82A56D4B8708099544879F1D")};		// Sign of Worm.Vobfus.dvpo
		TCHAR	szVOBFUSGUSHSig[] = {_T("E9000000A015400040164000C8104000*50000000A8A5AEC901879C45896B42D9CDD30106*7E01000000000000F559CAE5C457D84D9BD61DEEEDD27AF497*842C400000000000E0824000F0824000")};
		TCHAR   szSMARTFORTRESS2012WXFSig[] = {_T("E9000000281A40001C17400060124000*F4010000386740000000000070204200E05A420058490000087042000610400000704200*50000000D8001AD69395CD40BDEC953D5C2AE9DD")};//Trojan.SmartFortress2012.wxf
		TCHAR	szVOBFUSEKIPSig[] = {_T("E9000000C8184000C817400060124000*5000000093CC2A0C460DD24E969B959D83C3DE6C*5852400000000000F09B410020E64100")}; //Worm.Vobfus.ekip


		polydbObj.LoadSigDBEx(szTROJANVBEZU, _T("Trojan.VB.EZU"), TRUE);
		polydbObj.LoadSigDBEx(szDORIFELADTXSig, _T("Dropper.Dorifel.adtx"),TRUE);
		polydbObj.LoadSigDBEx(szVOBFUSDVPOSig, _T("Worm.Vobfus.dvpo"),TRUE);
		polydbObj.LoadSigDBEx(szVOBFUSGUSHSig, _T("Trojan.Jorik.Vobfus.gush"),TRUE);
		polydbObj.LoadSigDBEx(szSMARTFORTRESS2012WXFSig, _T("Trojan.SmartFortress2012.wxf"),TRUE);
		polydbObj.LoadSigDBEx(szVOBFUSEKIPSig, _T("Worm.Vobfus.ekip"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentEVQG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.EVQG Family
					  A : This is file droper type of trojan.
					  B : Dropps files in "Temp"  Folder.
 					  C	: file is encrypted form and decryption is following type
						: ROR [ESI+EAX],3 	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentEVQG(void)
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if (m_pMaxPEFile->m_stPEHeader.NumberOfSections != 0x02)
		return iRetStatus;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_dwAEPUnmapped == 0x13E4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x600)
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int AGENTEVQG_BUFF_SIZE	= 0x300;
		m_pbyBuff = new BYTE[AGENTEVQG_BUFF_SIZE];

		if(!GetBuffer(m_dwAEPMapped - 0x200,AGENTEVQG_BUFF_SIZE,AGENTEVQG_BUFF_SIZE))
			return iRetStatus;
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szAGENTEVQG[] = {_T("8B75588BC88BC148C00C300375F9*33C083C4785D6896104000E858000000*BB84144000C6830004000000BE")};
		polydbObj.LoadSigDBEx(szAGENTEVQG, _T("Backdoor.Agent.EVQG"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectZopfodA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Zopfod.A Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectZopfodA(void)
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_dwAEPUnmapped == 0x22B93 && m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x28000)
	{
		if(!(memcmp(m_pSectionHeader[2].Name, ".data", 5) == 0))
			return iRetStatus;

		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int ZOPFOG_BUFF_SIZE	= 0x300;
		m_pbyBuff = new BYTE[ZOPFOG_BUFF_SIZE];

		if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + 0x1D000, ZOPFOG_BUFF_SIZE, ZOPFOG_BUFF_SIZE))
			return iRetStatus;

		CSemiPolyDBScn	polydbObj;
		TCHAR	szZEPFOD[] = {_T("6964696F74*6E696365206173733A2A200A6D75686168616861616168616861")};		
		polydbObj.LoadSigDBEx(szZEPFOD, _T("Backdoor.Zepfod.A"), FALSE);
		
		TCHAR	szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	if(m_dwAEPMapped == m_dwAEPUnmapped && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && m_dwAEPMapped == 0x5B42 && m_wAEPSec == 0 && m_pSectionHeader[2].SizeOfRawData == 0x62000)
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int ZEPFOD_BUFF_SIZE	= 0x70;
		m_pbyBuff = new BYTE[ZEPFOD_BUFF_SIZE];
		memset(m_pbyBuff,0,ZEPFOD_BUFF_SIZE);
		if(!GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x4485, ZEPFOD_BUFF_SIZE, ZEPFOD_BUFF_SIZE))
			return iRetStatus;

		TCHAR szZepfodSign[]={_T("B06FB0FFB0F5B0F5B038B070B06FB049B0C0B089B047B072B070B04EB0C0B086*03C233D2B91A000000F7F18B4508")};  // looop that making name of Mutex
		CSemiPolyDBScn	polydbObj;
		polydbObj.LoadSigDBEx(szZepfodSign, _T("Backdoor.Zepfod.yy"), FALSE);

		TCHAR	szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], ZEPFOD_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLoadwar
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of Loadwar Family
					  1. Droping RavenbleuSA.exe
					  2. Its Game application
					  3. Also Install proper software like 7-zip, Windows media player etc...
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLoadwar()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x77E0 && m_wNoOfSections == 0x05 && m_pSectionHeader[0].SizeOfRawData == 0x13400)		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];

		if(!GetBuffer(0x2850, 0x100, 0x100))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("8A140E02110090010100008A118890020100000FB6*7E18568B450C8D34078B4508E879FFFFFF3006473B7D107CEA5E5F5D")};
		TCHAR szVirusName[MAX_PATH] = {0};
		polydbObj.LoadSigDBEx(szSig, _T("Trojan.Jorik.Loadwar.d"), FALSE);

		if(polydbObj.ScanBuffer(m_pbyBuff, 0x100, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorXtremeA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Xtreme.A Family
					  A. Creates new process in the system:
						  iexplore.exe	[%ProgramFiles%\Internet Explorer\iexplore.exe]
						  svchost.exe   [%system%svchost.exe]
					  B: Registry Modifications: 
						[HKEY_CURRENT_USER\Software\Server]
						ServerStarted = "08/01/2013 12:22:26"
						  [HKEY_CURRENT_USER\Software\XtremeRAT]
						  Mutex = "--((Mutex))--"
					 C: Following Mutex objects were created:
						XTREMEUPDATE
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorXtremeA()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections < 0x2 || m_wAEPSec != 0x0 || m_dwImageBase != 0x10000000)
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int XTREMEA_BUFF_SIZE = 0x150;
	m_pbyBuff = new BYTE[XTREMEA_BUFF_SIZE];
	if(!GetBuffer(m_dwAEPMapped + 0x550, XTREMEA_BUFF_SIZE, XTREMEA_BUFF_SIZE))
	{
		return iRetStatus;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR	szVirusName[MAX_PATH] = {0};
	TCHAR	szBACKDOORXTREMEA[] = {_T("43004F004E004600490047*53004F004600540057004100520045005C0058007400720065006D0065005200410054*4D0075007400650078000000020000005C000000080000002E006300660067")};
	//C.O.N.F.I.G*S.O.F.T.W.A.R.E.\.X.t.r.e.m.e.R.A.T*M.u.t.e.x.......\.........c.f.g
	polydbObj.LoadSigDBEx(szBACKDOORXTREMEA, _T("Backdoor.Xtreme.A"), FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanMicroFakeBA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of MicroFake.BA Family
					  A. On installation this trojan drops following copy of itself in all folders and .RAR archives 
						 that contain an .EXE file:
						->lpk.dll
					  B. Also attempts to connect to few possibly malicious URL's.
					  C. Registers itself as a system service to ensure its automatic execution at every system startup.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanMicroFakeBA()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections >= 0x4)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
	
		if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) &&
			m_pSectionHeader[0x3].SizeOfRawData >= 0x2000)
		{
			DWORD dwNameID = 0x0A, dwLang = 0x21 , dwLangID = 0x0000, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;
			if(FindRes(LPCTSTR(&dwNameID), LPCTSTR(&dwLang), LPCTSTR(&dwLangID), dwRVA, dwSize))
			{
				if(dwSize > 0x10000 || OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
				{
					return iRetStatus;
				}

				m_pbyBuff = new BYTE[dwSize];
				if(!m_pbyBuff)
				{
					return iRetStatus;
				}
				if(!GetBuffer(dwReadOffset, dwSize, dwSize))
				{
					return iRetStatus;
				}
			}
		}
		else if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) &&
			m_pSectionHeader[0x1].SizeOfRawData == 0xA00 && 
			m_pSectionHeader[0x2].PointerToRawData == 0x0 && m_pSectionHeader[0x2].SizeOfRawData == 0x0)
		{
			m_pbyBuff = new BYTE[m_pSectionHeader[0x1].SizeOfRawData - 0x500];
			if(!GetBuffer(m_pSectionHeader[0x1].PointerToRawData, 0x400, 0x400))
			{
				return iRetStatus;
			}
		}
		else
		{
			return iRetStatus;
		}

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTROJANMICROFAKEBA[] = {_T("680072006C0000006C0070006B002E0064006C006C0000002E0054004D0050*6C0070006B002E0064006C006C007C00660069006E0064*520041005200000000002E004500580045")};
		//h.r.l...l.p.k...d.l.l.....T.M.P*l.p.k...d.l.l.|.f.i.n.d*R.A.R.......E.X.E
		polydbObj.LoadSigDBEx(szTROJANMICROFAKEBA, _T("Trojan.Microfake.ba"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentCbot
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Cbot Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentCbot()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_pMaxPEFile->m_stPEHeader.SizeOfCode == 0x1400 && (m_dwAEPUnmapped == 0x1ED8 || m_dwAEPUnmapped == 0x1ED9 || m_dwAEPUnmapped == 0x1E9C))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CBOT_BUFF_SIZE = 0x250;
		m_pbyBuff = new BYTE[CBOT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pSectionHeader[0].PointerToRawData + 0xDD0, CBOT_BUFF_SIZE, CBOT_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTAgentCbot[] = {_T("6840404000E88BFFFFFF9090909090909068404040*8B45085056E8DCFCFFFF83C40885C07418*9056E857FDFFFF83C4045E5DC390558BEC51*EBF56A0A5850565353*4030400050E844FEFFFF")};
		polydbObj.LoadSigDBEx(szTAgentCbot, _T("Trojan.Agent.Cbot"),FALSE);

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x250, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareFlvTubeBT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of FlvTubeBT Family	
					  A. Includes installer files such as All Access,FlvTube,VLC Player,Xvid,Chameleon Sam,Babelfish 
							designed by "Design and Marketing D.M.S.A"
					  B. Included under "potentially unwanted programs" (PUP) which are made by legitimate corporate entities
							but which on installation alter the security state of the computer which makes the user to be aware 
							of such programs.
					 C. On installation displays a dialog box "This installer is expired.Please download the new version"
							On clicking OK allows the user to download new version by connecting to following URL's:
						For e.g: http://www.flvtube.net
		 				http://www.babelfish.com
					 D. Also creates empty folder's with name "inst<random_no>.tmp" in %Temp%		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareFlvTubeBT()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections < 0x6 || m_wAEPSec != 0x0 || (m_dwAEPUnmapped % 0x10) != 0xB ||
		(m_dwAEPUnmapped / 0x10000) != 0x3 || (memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, "ATL", 3) != 0))
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	const int FLVTUBEBT_BUFF_SIZE = 0x80;
	m_pbyBuff = new BYTE[FLVTUBEBT_BUFF_SIZE];
	DWORD dwBuffSize = 0x0;
	if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x250, 0x30, 0x30))
	{
		return iRetStatus;
	}
	dwBuffSize += 0x30;
	if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xA00, 0x50, 0x50))
	{
		return iRetStatus;
	}
	dwBuffSize += 0x50;
	
	CSemiPolyDBScn	polydbObj;
	TCHAR	szADWAREFLVTUBEBT[] = {_T("C1E00833C62500FF000033F033D28D4703F7F38B5D080FBE040A33C625FF00000033F08B45FC8D0483313083C704*C745B8886A3F24C745BCD308A385C745C02E8A1913C745C444737003C745C8223809A4*C745CCD0319F29C745D098FA2E08C745D4896C4EECC745D8E6212845C745DC7713D038")};
	polydbObj.LoadSigDBEx(szADWAREFLVTUBEBT, _T("not-a-virus:Adware.FlvTube.BT"), FALSE);
	
	TCHAR	szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBancos
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Bancos Family
					  Drop itself @windows
					  Download "winLockDll.dll" from net
					  Stoles confidential bank information and creates one text file with .bat extension
					  (Covered Trojan.bancod.ha, Trojan.Bancos.u and Banker.Bancos.ha)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBancos()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	DWORD dwBaseOfData = 0;
	m_pMaxPEFile->ReadBuffer(&dwBaseOfData, m_pMaxPEFile->m_stPEHeader.e_lfanew + 0x30, 4);
	
	if((((dwBaseOfData >= 0x100000) && (dwBaseOfData <= 0x1C9000)) || ((dwBaseOfData >= 0x870000) && (dwBaseOfData <= 0xBD0000)) || (dwBaseOfData == 0x0C) ||
		((dwBaseOfData >= 0x7A000) && (dwBaseOfData <= 0x90000))) && 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize >= m_pSectionHeader[m_wAEPSec].SizeOfRawData))   // 4th OR condition For Bancos.U
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		DWORD dwBuffSize = 0x1A00;
		DWORD dwOffset = 0xA400;

		if((dwBaseOfData >= 0x870000 && dwBaseOfData <= 0xBD0000) || dwBaseOfData == 0x0C)
		{
			dwBuffSize = 0x6A00;
			dwOffset = 0x25C00;
		}

		if((dwBaseOfData >= 0x7A000) && (dwBaseOfData <= 0x90000))  // For Bancos.U
		{
			dwBuffSize = 0x400;
			dwOffset = 0x9700;
		}
		
		if(dwBuffSize + dwOffset > m_pMaxPEFile->m_dwFileSize)
		{
			return iRetStatus;
		}

		m_pbyBuff = new BYTE[dwBuffSize];
		if(!GetBuffer(dwOffset, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szSig1[] = {_T("620061006E0063006F00620072006100730069006C002E0063006F006D*0062007200")};
		TCHAR szSig2[] = {_T("420061006E0063006F0020004900740061*46006500690074006F0020005000610072006100200056006F0063")};
		
		polydbObj.LoadSigDBEx(szSig1, _T("Trojan.bancos.ha"), TRUE);
		polydbObj.LoadSigDBEx(szSig2, _T("Trojan.bancos.mz"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(m_pbyBuff, dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPinballCorporation
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of PinballCorporation Family
					  1. Contains xvid video codec setup files which tries to download the Xvid codec pack installer 
						and saves it as:%Temp%\_t<random number>.exe & then the installer is launched for execution.
    				  2. Tries to download updated version of the software & saves it as:%Temp%\upg<random 2 digit number>.tmp
						This file in turn tries to extract VBScript & launches it for execution using the "wscript.exe" 
						Windows process.
					  3. The launched script downloads a file from the URL: http://b.greenpipesky.com & launches it.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPinballCorporation()
{
	//Covers Trojan.Pinball Corporation & Downloader.Genome.deph
	int	iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x5) && m_wAEPSec == 0 && 
		((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x15215 && m_dwAEPUnmapped == 0x8FE5) || 
		((m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x13241 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x14000)
		&& m_dwAEPUnmapped == 0x7800)))
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PINBALLCORPORATION_BUFF_SIZE = 0x95;
		m_pbyBuff = new BYTE[PINBALLCORPORATION_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x22C5,PINBALLCORPORATION_BUFF_SIZE,PINBALLCORPORATION_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szGameThiefOnlineGamesAJLGT[] = {_T("2E746D70*687474703A2F2F622E677265656E70697065736B792E636F6D2F476574536F66747761726546726F6D4943532E617370783F64643D677265656E70697065736B79266E616D653D*2F7570673D79")};
		//.tmp*http://b.greenpipesky.com/GetSoftwareFromICS.aspx?dd=greenpipesky&name=*/upg=y
		polydbObj.LoadSigDBEx(szGameThiefOnlineGamesAJLGT, _T("Trojan.Pinball Corporation"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectIRCNite
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep + Virus Analysis Team
	Description		: Detection routine for different varients of IRCNite Family
				      This malware works as stub (downloader/infector) for Nimnul Virus 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIRCNite()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if((m_dwAEPUnmapped == 0x1DF9) &&
		((m_pSectionHeader[0].Misc.VirtualSize == 0xE4A) || (m_pSectionHeader[0].Misc.VirtualSize == 0x39000)) &&
		(m_pSectionHeader[1].Misc.VirtualSize >= m_pSectionHeader[1].SizeOfRawData))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];
		if(!GetBuffer(m_dwAEPMapped - 0x100, 0x100, 0x100))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("498BD903CF4FF7D38B4C2400474E8BD98B70*8BD98B70008BF84B03FE81F6E90000008BFEF7DF4B897100474046F7DE*F8F7D6434103F18BDF4A75D442F7D35EF7D958F7")};
		polydbObj.LoadSigDBEx(szSig, _T("Backdoor.IRCNite.ckw"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(m_pbyBuff, m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFosniw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Mangesh + Virus Analysis Team
	Description		: Detection routine for different varients of Fosniw Family
					  This is Network Worm.
						: Dropps samples in admin folder
						: Tries to coonect following malecious site.
							"http://www.koreasys1.com"
						: keeps on creating different threads inwhich it creates socket which is
						in nonblocking mode
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFosniw()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_dwAEPUnmapped == 0x1114))
	{
		BYTE byBuff[0x20] = {0};
		BYTE bySig[] = {0x8B, 0x55, 0xF4, 0x03, 0xD0, 0x8A, 0x0C, 0x97, 0x80, 0xF1};//, 0x7C, 0x88, 0x0C, 0x03, 0x40, 0x3B, 0x45, 0xF8};
		if(m_pMaxPEFile->ReadBuffer(byBuff, 0x1425, 0x20, 0x20, &m_dwNoOfBytes))//PECompact packed files
		{
			if((memcmp(byBuff, bySig, sizeof(bySig)) == 0))
			{
				if(CheckFosniwSig(0x28779, byBuff[0xA]))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,_T("Downloader.Fosniw"));
					return VIRUS_FILE_DELETE;
				}
			}
		}

		if(m_pMaxPEFile->ReadBuffer(byBuff, 0x625, 0x20, 0x20, &m_dwNoOfBytes))//FSG packed files
		{
			if((memcmp(byBuff, bySig, sizeof(bySig)) == 0))
			{
				if(CheckFosniwSig(0x27979, byBuff[0xA]))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,_T("Downloader.Fosniw"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL &&
		(m_dwAEPUnmapped == 0xE2E8) && m_wAEPSec == 0 && m_wNoOfSections == 4 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2AA00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int FOSNIW_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[FOSNIW_BUFF_SIZE];
		
		if(GetBuffer((m_pSectionHeader[1].PointerToRawData + 0x500), FOSNIW_BUFF_SIZE, FOSNIW_BUFF_SIZE))
		{
			CSemiPolyDBScn	polydbObj;
			TCHAR	szFOSNIW[] = {_T("536F6674776172655C2573004443*6B6F72656173797325642E636F6D0000312E302E302E")};
			polydbObj.LoadSigDBEx(szFOSNIW, _T("Downloader.Fosniw.bfc"),FALSE);

			TCHAR	szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], FOSNIW_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}		
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: CheckFosniwSig
	In Parameters	: DWORD dwDecOffset,BYTE byKey
	Out Parameters	: true if success else false
	Purpose			: 
	Author			: Tushar Kadam + Mangesh + Virus Analysis Team
	Description		: This function searches for binary pattern in file
--------------------------------------------------------------------------------------*/
bool CSemiPolyTrojans::CheckFosniwSig(DWORD dwDecOffset,BYTE byKey)
{
	BYTE byBuff[0x34] = {0};
	BYTE byDecBuff[0xF] = {0};
	BYTE bySig[] = {0x77, 0x69, 0x6E, 0x73, 0x6F, 0x66, 0x74, 0x25, 0x64, 0x2E, 0x63, 0x6F, 0x6D};

	if(m_pMaxPEFile->ReadBuffer(byBuff, dwDecOffset, 0x34, 0x34, &m_dwNoOfBytes))
	{
		for(int i=0, j=0; i<=0x34; i=i+4, j++)
		{
			byDecBuff[j] = byBuff[i] ^ byKey;
		}
		if((memcmp(byDecBuff, bySig, sizeof(bySig)) == 0))
		{
			return true;
		}
	}
	return false;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCodraEQM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Codra.EQM Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCodraEQM()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections >= 2 && m_wNoOfSections <= 5 && (m_dwAEPUnmapped > 0x15000 && (m_dwAEPUnmapped % 0x10) == 0xD) && m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x20000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		m_pMaxPEFile->Rva2FileOffset((m_dwAEPUnmapped + 0x2800), &dwBuffOffset);
		if(!GetBuffer(dwBuffOffset, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szProstiAP_Sign[] = {_T("8B45C0FF4DC085C07F068BC30BC774248B45B8*9952505753E8*83C13083F939895D8C8BD88BFA7E03034D98880E4EEBCC")}; // Decryption loop for Mutex name
		polydbObj.LoadSigDBEx(szProstiAP_Sign, _T("Dropper.Codra.eqm"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentAJV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.ajv Family
					  A. Installation:	
						- Drop 1.exe, 2.exe and 2.bat files in Temp folder and execute(Diff-Diff trojans).
					  B. File Modification 
						- Drop Files at Temp folder.
					  C. Registry Modifications:
						- Makes entry into windows startup.
					  HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
					  HKU\S-1-5-21-842925246-879983540-839522115-1003\Software\Microsoft\Windows\CurrentVersion\Run\ 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentAJV()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && ((m_dwAEPUnmapped & 0xF) == 0xE) && m_wNoOfSections == 0x3 && 
		m_pSectionHeader[m_wNoOfSections - 1].Misc.VirtualSize == 0xC )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		m_pMaxPEFile->Rva2FileOffset((m_dwAEPUnmapped - 0x300), &dwBuffOffset);
		if(!GetBuffer(dwBuffOffset, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR szAgentAjv_Sign[]  = {_T("540045004D005000000D5C0031002E006A0070006700000D5C0031002E00*6D0070003300000D5C0031002E00650078006500000D5C0032002E006200610074*5C0032002E006500780065")};
		TCHAR szAgentAjv_Sign1[] = {_T("7A006900700000094E0061006D0065*7A002E0064006C006C*4BA05FE84BA7C946B8CE253C250008B77A5C56")};
		polydbObj.LoadSigDBEx(szAgentAjv_Sign, _T("Dropper.Agent.ajv"), TRUE);
		polydbObj.LoadSigDBEx(szAgentAjv_Sign1, _T("Dropper.Agent.ajv"), FALSE);
		
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAzbregPYV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Azbreg.pyv Family
					  Backdoor.Azbreg.pyv
					  This file drops nimmnul stub and which bring "Virus.Nimmul.A" infection which is 
						repaired by us properly
					  opens the backdoor uses mailslot api to send the mails
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAzbregPYV()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if((memcmp(m_pSectionHeader[m_wAEPSec].Name, ".text", 5) == 0) && (m_dwAEPUnmapped == 0x162D))
	{
		const int AZBREG_BUFF_SIZE = 0x200;
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[AZBREG_BUFF_SIZE];
		memset(m_pbyBuff, 0, AZBREG_BUFF_SIZE);
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x200, AZBREG_BUFF_SIZE, AZBREG_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szAzbreg[] = {_T("8A18881C01404E75F78BF28975F0B81AC6D02C813E74FA3A6B750539*46EBF08975F0C745B028400123C745B49E687F43C745B8210D1A49C745")};
		polydbObj.LoadSigDBEx(szAzbreg, _T("Backdoor.Azbreg.pyv"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AZBREG_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdloadAQDQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Adload Family
					  This is downloader trojan it tries to open port else non infecting and non dropping samples
					  Creates pipe of following fixed name signature is taken from that
					  "plhc....kduef*94asdf3711"	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdloadAQDQ()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if((m_dwAEPUnmapped == 0xDD66) && m_wAEPSec == 0 && m_wNoOfSections == 3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	ADLOAD_BUFF_SIZE = 0x500;

		m_pbyBuff = new BYTE[ADLOAD_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer((m_pSectionHeader[1].PointerToRawData + 0x200), ADLOAD_BUFF_SIZE, ADLOAD_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};

		TCHAR	szADLOAD[] = {_T("706C6863000000006B64756566*39346173646633373131")};
		polydbObj.LoadSigDBEx(szADLOAD, _T("Downloader.Adload.dqzq"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], ADLOAD_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if( m_wNoOfSections == 0x6 && m_dwAEPUnmapped==0x903E && m_wAEPSec == 3 && m_pMaxPEFile->m_stPEHeader.Subsystem == 0x1 
    && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00 )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		int ADLOADA_BUFF_SIZE = 0x1860;
		DWORD dwReadOff = m_pSectionHeader[4].PointerToRawData + 0x260;

		m_pbyBuff = new BYTE[ADLOADA_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		
		if(!GetBuffer(dwReadOff, ADLOADA_BUFF_SIZE, ADLOADA_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szAdloadA = (_T("6E0065007400680066006400720076002E007300790073*46656E69782D616D70204C544431*46656E69782D616D70204C544430")); //n.e.t.h.f.d.r.v...s.y.s  *  Fenix-amp LTD1  *  Fenix-amp LTD0 
		
		polydbObj.LoadSigDBEx(szAdloadA, _T("Trojan-Downloader.Adload.a"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], ADLOADA_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wAEPSec == 0 && m_wNoOfSections == 3 && m_dwAEPUnmapped >= 0x1000 && m_dwAEPUnmapped <= 0x1310 && (m_dwAEPUnmapped % 0x2) == 0x0 &&
		   (m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData == 0x1000 || m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData == 0x2000 || m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData == 0x7000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int ADLOAD_BUFF_SIZE = 0xB00;
		m_pbyBuff = new BYTE[ADLOAD_BUFF_SIZE];

		BYTE bSignChk[] = {0x44, 0x6F, 0x77, 0x6E, 0x6C, 0x6F, 0x61, 0x64, 0x46, 0x69, 0x6C, 0x65}; // DownloadFile
		BYTE bSign1[]   = {0x68, 0x74, 0x74, 0x70, 0x3A, 0x2F, 0x2F, 0x70, 0x72, 0x6F, 0x6D, 0x6F, 0x2E, 0x64, 0x6F, 0x6C, 0x6C, 0x61, 0x72, 0x72, 0x65, 0x76, 0x65, 0x6E, 0x75, 0x65, 0x2E, 0x63, 0x6F, 0x6D, 0x2F, 0x62, 0x75, 0x6E, 0x64, 0x6C, 0x65, 0x2F, 0x6C, 0x6F, 0x61, 0x64, 0x65, 0x72, 0x2E, 0x65, 0x78, 0x65};// http://promo.dollarrevenue.com/bundle/loader.exe
		BYTE bSign2[]   = {0x63, 0x3A, 0x5C, 0x64, 0x72, 0x73, 0x6D, 0x61, 0x72, 0x74, 0x6C, 0x6F, 0x61, 0x64, 0x2E, 0x65, 0x78, 0x65}; //c:\drsmartload.exe
		
		DWORD	dwSignStart = 0x0;
		bool	bSign1Detect = false;
		bool	bSign2Detect = false;
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//------------------------------VB5! CHK--------------------------------
		DWORD	dwBuffOffset = m_dwAEPMapped;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x05, 0x05))
		{
			return iRetStatus;
		}
		
		if(m_pbyBuff[0] == 0x68)
		{
			dwBuffOffset = *(DWORD *)&m_pbyBuff[0x1] - m_pMaxPEFile->m_stPEHeader.ImageBase;
		}
		else
		{
			return iRetStatus;
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x05, 0x05))
		{
			return iRetStatus;
		}

		if(*(DWORD *)&m_pbyBuff[0x0] !=  0x21354256)			// VB5! Chk
		{
			return iRetStatus;
		}
		//------------------------------End VB5! CHK-----------------------------
		if(!GetBuffer((m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x700), ADLOAD_BUFF_SIZE, 0x300))
		{
			return iRetStatus;
		}

		if(!OffSetBasedSignature(bSignChk, sizeof(bSignChk), &dwSignStart))
		{
			return iRetStatus;
		}

		dwSignStart += sizeof(bSignChk);
		for(int i = 0x0, j = 0x0; i < (ADLOAD_BUFF_SIZE - dwSignStart); i++)
		{
			if(m_pbyBuff[dwSignStart + i] == bSign1[j] && bSign1Detect == false)
			{	

				if(j == (sizeof(bSign1) - 0x1))
				{	
					bSign1Detect = true;
					j = 0x0;
				}
				j++;
			}else if(m_pbyBuff[dwSignStart + i] == bSign2[j] && bSign1Detect == true)
			{
				if(j == (sizeof(bSign2) - 0x1))
					bSign2Detect = true;
				j++;
			}
		}

		if( bSign2Detect == true)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Adload.tft"));
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderAgentEDBQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.edbq Family
					  On infection drops non-malicious file Mscorlib.dll in %temp% with name "System.exe"
					  Performs decryption twice on resource data in chunks of 0x400 bytes.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderAgentEDBQ()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0 && m_dwAEPUnmapped == 0x10384 &&
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x19ACF || 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == m_pSectionHeader[m_wAEPSec].SizeOfRawData)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTEDBQ_BUFF_SIZE = 0x70;
		m_pbyBuff = new BYTE[AGENTEDBQ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x1AC0,AGENTEDBQ_BUFF_SIZE,AGENTEDBQ_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szDownloaderAgentEDBQ[] = {_T("0FB614300FB65C300181C200010000C1E20803D78A1413881430403BC17CE1*0FB614300FB64C30FF81C200010000C1E20803CF8A0C0A880C304883F8017DE0")};
		polydbObj.LoadSigDBEx(szDownloaderAgentEDBQ, _T("Trojan-Downloader.Agent.EDBQ"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperAgentBCZN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.bczn Family
					  A. Dropper.Agent.bczn drops following files when triggered:
					  %system32%\fservice.exe,Incom.exe,Incom_.jpg,reginv.dll,winkey.dll
					  %Windir%services.exe
							  %Windir%\system\sservice.exe
					  B. Registry Modifications:
						It adds registry entries to enable automatic execution of %system32%\fservice.exe
						every time Windows starts.
					  C. The following system services were modified i.e services were disabled:
						SharedAccess->Windows Firewall/Internet Connection Sharing (ICS)	 
						wscsvc->Security Center
							  srservice->System Restore Service
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperAgentBCZN()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0 && m_dwAEPUnmapped == 0x1690 && m_wNoOfSections == 0x3 && m_dwAEPMapped == m_dwAEPUnmapped &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTBCZN_BUFF_SIZE = 0x85;
		m_pbyBuff = new BYTE[AGENTBCZN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffSize = 0x0;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize],m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x5C,0x65,0x65))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x65;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize],m_dwAEPUnmapped,0x20,0x20))
		{
			return iRetStatus;
		}
		dwBuffSize += 0x20;
		
		CSemiPolyDBScn	polydbObj;
		TCHAR	szDropperAgentBCZN[] = {_T("5C6C6E636F6D5F2E000000005C6C6E636F6D2E657865*6261740000000077000000630000006578650065*81EC4003000083C9FF33C08D5424005657BFC010400068BC104000")};
		polydbObj.LoadSigDBEx(szDropperAgentBCZN, _T("Trojan-Dropper.Agent.BCZN"),FALSE);

		TCHAR	szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKnigsfot
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Knigsfot Family
					  Opens various websites without the user's knowledge to raise the 
						hit-count of those sites
					  Installs the Kingsoft Antivirus WebShield system service,
					  Creating files  %Temp%\lnk.bat
					          %Temp%\ico.cab
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKnigsfot()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(((m_dwAEPUnmapped % 0x10) == 0x09) &&
		(m_pSectionHeader[0].Misc.VirtualSize == 0xEC000) &&
		(m_pSectionHeader[1].Misc.VirtualSize == 0x45000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x300];
		CMaxBMAlgo *pBMScan = new CMaxBMAlgo;
		if(pBMScan == NULL)
		{
			return iRetStatus;
		}
		BYTE bySig[] = {0x77,0x77,0x77,0x2E,0x37,0x37,0x39,0x64,0x68,0x2E,0x63,0x6F,0x6D}; //www.779dh.com
		if(pBMScan->AddPatetrn2Search(bySig, sizeof(bySig)))
		{
			if(GetBuffer(0x8CE20, 0x300, 0x300))	
			{
				if(pBMScan->Search4Pattern(m_pbyBuff, 0x300))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Knigsfot.av"));
					iRetStatus = VIRUS_FILE_DELETE;
				}
			}
		}
		delete pBMScan;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentAzCj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.AZCJ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentAzCj()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if((m_wNoOfSections == 0x02 || m_wNoOfSections == 0x03)&& m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xDC6E && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x21000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTAZCJ_BUFF_SIZE = 0x2D0;
		m_pbyBuff = new BYTE[AGENTAZCJ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(0x198F0, AGENTAZCJ_BUFF_SIZE, AGENTAZCJ_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szAgentAzCj[] = {_T("3031444538324630000000323831304242394434363644*77696E696F2E737973")}; //winio.sys
		polydbObj.LoadSigDBEx(szAgentAzCj, _T("Backdoor.Agent.azcj"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENTAZCJ_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectPlaygameA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of PlayGames.A Family
					  1. Makes entry in to RasPhonbook.
					  2. Decrypt link and pass it to iExplorer.exe
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlaygameA()
{
	int iRetStatus =VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if((m_wNoOfSections == 0x1 || (m_wNoOfSections == 0x2 && m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x0)) && 
		m_wAEPSec == 0x0 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData == 0x200 && 
	    (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x800 || m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00) && 
	    ((m_dwAEPUnmapped >= 0x1200) || (m_dwAEPUnmapped <= 0x1400)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PLAYGAMEA_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[PLAYGAMEA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData, 0x22, 0x22))
		{
			return iRetStatus;
		}
		
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x22], m_dwAEPMapped + 0x14, 0x0D, 0x0D))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szPlayGameA[] = {_T("633A5C70726F6772617E315C696E7465726E7E315C696578706C6F72652E657865*8A04112C*880411413BCB75F3")}; //Decryption Loop
		polydbObj.LoadSigDBEx(szPlayGameA, _T("not-a-virus:Dialer.Win32.PlayGames.a"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PLAYGAMEA_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentACW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of agent.acw Family
					  1. Drop generator.exe, directx.exe and in other case shows message.
					  * All samples are Armadillo v1.7
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentACW()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if(m_wNoOfSections == 0x3 && m_wAEPSec == 0x0 && 
	  (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xE00 && (m_dwAEPUnmapped & 0xFF0F) == 0x1802 || 
	  (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x800) && m_dwAEPUnmapped == 0x1256 ||
	  (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xC00) && m_dwAEPUnmapped == 0x15E0) &&
	  (m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x400 || m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x3A0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int AGENTACW_BUFF = 0x100;
		m_pbyBuff = new BYTE[AGENTACW_BUFF];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		DWORD dwBufferOffset = 0x0;     //0x1050
		DWORD dwDecryptionLoopOffset = 0x10E3;
		bool bySignMsg = false;
		int  iKeyLength = 0x0;

		if(m_dwAEPUnmapped == 0x1256)
		{
			dwDecryptionLoopOffset = 0x1083;
			bySignMsg = true;
		}

		m_pMaxPEFile->Rva2FileOffset(dwDecryptionLoopOffset, &dwBufferOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBufferOffset, AGENTACW_BUFF, AGENTACW_BUFF))
		{
			return iRetStatus;
		}
		iKeyLength = m_pbyBuff[0xE];

		CSemiPolyDBScn polydbobj;
		TCHAR szAgentACW0[] = (_T("8A90102040008A1C312ADA4083F8*881C31750233C0413BCF72"));//Decryption LOOP
		TCHAR szVirusName[MAX_PATH]  = {0};
		polydbobj.LoadSigDBEx(szAgentACW0, _T("Trojan.Agent.acw"), TRUE);
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], AGENTACW_BUFF, szVirusName) >= 0)
		{
			
			m_pMaxPEFile->Rva2FileOffset( 0x2010, &dwBufferOffset);
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBufferOffset, AGENTACW_BUFF, AGENTACW_BUFF))
			{
				return iRetStatus;
			}
			
			int iKey  = 0x0;
			int iByteCount = 0x0;
			bool bDataSwithch = false;
			BYTE byEndOfKey[] = {0x77, 0x62, 0x00, 0x00};
			DWORD dwDataOffset = 0x0;
			DWORD dwScanOffset = 0x0;
			bool bDoneWithZero = false;
			
			if(bySignMsg == true) 
			{
				int i = 0x0;
				dwDataOffset = iKeyLength;
				while(i < 0x8)								// to Skeep Zeros
				{
					if(m_pbyBuff[iKeyLength + i] == 0x0)
					{
						dwDataOffset++;
						bDoneWithZero = true;
					}
					if(bDoneWithZero == true && (m_pbyBuff[iKeyLength + i] != 0x0))
						break;
					i++;
				}
			}
			else
			{
				if(!OffSetBasedSignature(byEndOfKey, sizeof(byEndOfKey), &dwDataOffset)) // to get Start offset of data.
				{
					return iRetStatus;
				}
				dwScanOffset = dwDataOffset = dwDataOffset + 4;
			}

 			for(int i = 0x0; i < 0x60; i++)
			{
				m_pbyBuff[dwDataOffset] = m_pbyBuff[dwDataOffset] - m_pbyBuff[iKey];
				
				if(iKey == (iKeyLength - 1))
					iKey = 0x0;
				else
					iKey++;
				if(bySignMsg == true)			// Message Decryption
				{
					if(iByteCount == 0x2E)
						break;
					iByteCount++;
					dwDataOffset++;
				}
				else							// File Name Decryption
				{
					if(iByteCount == 0xB && bDataSwithch == false)
					{
						iByteCount = 0x0;
						dwDataOffset = dwDataOffset + 0x9;
						iKey  = 0x0;
						bDataSwithch = true;
					}
					else
					{
						dwDataOffset++;
						iByteCount++;
					}

					if(bDataSwithch == true && iByteCount == 0xE)
						break;
				}
			}
			LPCTSTR szAgentACW1 = (_T("646972656374782E657865*67656E657261746F722E657865"));  // Droped Files Name generator.exe & directx.exe
			if(bySignMsg == true)
			{
				SecureZeroMemory(&szAgentACW1, sizeof(szAgentACW1));
				szAgentACW1 = (_T("656E747279*53556E4D61704C535F49505F4542505F38"));		  // entry & SUnMapLS_IP_EBP_8		
			}
			polydbobj.LoadSigDBEx(szAgentACW1, _T("Trojan.Agent.acw"), FALSE);
			if(polydbobj.ScanBuffer(&m_pbyBuff[dwScanOffset], AGENTACW_BUFF, szVirusName) >= 0)
			{		
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanAgent2LDT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Agent2.LDT Family
					  A. Trojan drops copy of itself when triggered at foll location with hidden attributes:
						%Application Data%\Start\update.exe
					  B. Also creates the following folders:
						%Application Data%\S-1-5-31-1286970278978-5713669491-166975984-320
    					%Application Data%\S-1-5-31-1286970278978-5713669491-166975984-320\dmc
    					%Application Data%\S-1-5-31-1286970278978-5713669491-166975984-320\tlsr
    					%Application Data%\S-1-5-31-1286970278978-5713669491-166975984-320\Rotinom
					  C. Mutex created with name: "LDLLMAIN"
					  D. Registry Modifications:
						HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders
						Startup = "%Application Data%\Start"
					    HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders
					    Startup = "%Application Data%\Start"
						Also Modifies registry to hide file extension & adds startup entry for dropped file(update.exe)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanAgent2LDT()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0 && (m_dwAEPUnmapped == 0x4189 || m_dwAEPUnmapped == 0x4022) && m_wNoOfSections >= 0x4 && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBA00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBC00 ||
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC000))
	{
		const int AGENT2LDT_BUFF_SIZE = 0x60;
		BYTE pbyBuff[AGENT2LDT_BUFF_SIZE] = {0};
		
		if(!m_pMaxPEFile->ReadBuffer(pbyBuff, m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x5B0,AGENT2LDT_BUFF_SIZE,AGENT2LDT_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTrojanAgent2LDT[] = {_T("4C0044004C004C004D00410049004E*5C00530074006100720074005C007500700064006100740065002E006500780065*74006C00730072*5C0064006D0063")};
						//L.D.L.L.M.A.I.N*\.S.t.a.r.t.\.u.p.d.a.t.e...e.x.e*t.l.s.r*\.d.m.c
									
		polydbObj.LoadSigDBEx(szTrojanAgent2LDT, _T("Trojan.Agent2.LDT"),FALSE);

		if(polydbObj.ScanBuffer(&pbyBuff[0], AGENT2LDT_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  A. Installation:	
						- Copy it self to windows, msagent, system32 dir. 
					  B. File Modification 
						- C:\WINDOWS\svchost.exe
						- C:\WINDOWS\system32\msbhuh.com (Random Names)
						- C:\WINDOWS\msagent\msjqva.com  (Random Names)
					  C. Registry Modifications:
						- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\explorer\run\COM Service: "C:\WINDOWS\msagent\msjqva.com"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBeastdoorL()
{
	int iRetStatus =VIRUS_NOT_FOUND;

	if((m_wNoOfSections == 0x7 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xF18C && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xEAEA)
		|| (m_wNoOfSections == 0x7 && m_wAEPSec == 0x1 && m_dwAEPUnmapped == 0x10000)
		|| (m_wNoOfSections == 0x3 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x101A))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BEASTDOORL_BUFF = 0x30;
		m_pbyBuff = new BYTE[BEASTDOORL_BUFF];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwSignOffset = m_dwAEPMapped + 0x6FC;
		
		if(m_wAEPSec == 0x1)
			dwSignOffset = m_dwAEPMapped - 0x378;
		if(m_wNoOfSections == 0x3)
			dwSignOffset = 0xEAE2;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwSignOffset, 0x20, 0x20))
		{
			return iRetStatus;
		}

		DWORD dwOverlayOffset = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections -1].PointerToRawData;
		
		if((dwOverlayOffset + 0x12D) < m_pMaxPEFile->m_dwFileSize)
		{
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x20], dwOverlayOffset + 0x11D, 0x10, 0x10))
			{
				return iRetStatus;
			}
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szBeastdoorL0[] = (_T("A6CAD1DAEFE2*53414D5C41"));
		TCHAR szBeastdoorL1[] = (_T("53414D5C41*24545459D7DBD3CFEADCE899D1E5D36E"));
		
		TCHAR szVirusName[MAX_PATH]  = {0};
		polydbobj.LoadSigDBEx(szBeastdoorL0, _T("Backdoor.Beastdoor.L"), TRUE);
		polydbobj.LoadSigDBEx(szBeastdoorL1, _T("Backdoor.Beastdoor.L"), FALSE);
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BEASTDOORL_BUFF, szVirusName) >= 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBinderRz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of binder.RZ Family
					  - insert handel in to iExplorer.exe process.	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBinderRz()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && ((m_dwAEPUnmapped == 0x30EC && (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x2600 || ( m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].Misc.VirtualSize)))|| 
		(m_dwAEPUnmapped == 0xA1E48 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xA1200) || 
		(m_dwAEPUnmapped == 0x2158 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x2404 )))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BINDER_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE [BINDER_BUFF_SIZE];		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, BINDER_BUFF_SIZE);

		DWORD dwBuffOff = 0x0;
		if(m_dwAEPUnmapped == 0x30EC || m_dwAEPUnmapped == 0x2158)
		{
			m_pMaxPEFile->Rva2FileOffset(0x02CCD, &dwBuffOff);
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOff, BINDER_BUFF_SIZE, BINDER_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		else
		{
			if(m_dwAEPUnmapped == 0xA1E48)
			{				
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], 0x9C0C8, 0x10, 0x10))
				{
					return iRetStatus;
				}
				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x10], 0xA0B04, 0x20, 0x20))
				{
					return iRetStatus;
				}
			}
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		LPCTSTR 	szBinderRz = {_T("8B45F88BD88A0419349050588804198B45F88B55FC83C00183D2008945F88955*FC8B45F88B55FC3B550C75073B450872CFEB027CCB")}; // Decryption loop
		if(m_dwAEPUnmapped == 0xA1E48)
		{
			SecureZeroMemory(&szBinderRz, sizeof(szBinderRz));
			szBinderRz = (_T("3230303530313031*756E696E7374616C2E626174"));	//20050101 * uninsatl.bat
		}	
		polydbObj.LoadSigDBEx(szBinderRz, _T("Dropper.Binder.Rz"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BINDER_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectDipleDmqa
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Diple + Beebone Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDipleDmqa()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && 
		((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4)&& 
		(m_dwAEPUnmapped == 0x3A1C && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B000) ||
		(m_wNoOfSections == 0x3 && m_dwAEPUnmapped == 0x1E00 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0xC000 && m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2000)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int DIPLEDMQA_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[DIPLEDMQA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, DIPLEDMQA_BUFF_SIZE);

		DWORD dwBuffOffset = 0x764A;
		if(m_dwAEPUnmapped == 0x1E00)
		{
			dwBuffOffset = 0x2510;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x50, 0x50))
			{
				return iRetStatus;
			}
			dwBuffOffset = 0x2B20;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x50], dwBuffOffset, 0x10, 0x10))
			{
				return iRetStatus;
			}
		}
		else
		{
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, DIPLEDMQA_BUFF_SIZE, DIPLEDMQA_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		
		CSemiPolyDBScn	polydbObj;
		TCHAR	szDipleDmqa[] = {_T("41007200690073*4200750065006E006100760065006E0074007500720061*72006100760065006D006100730074")}; //Name of Developer and Email ID 
		TCHAR   szBeeBoneD[]  = {_T("360035003100410038003900340030*38003700430035002D0031003100640031*44004F004D00410049")};	// OCX object ID * D.O.M.A.I
		
		if(m_dwAEPUnmapped == 0x1E00)
			polydbObj.LoadSigDBEx(szBeeBoneD, _T("Trojan.Beebone.d"), FALSE);
		else
			polydbObj.LoadSigDBEx(szDipleDmqa, _T("Trojan.Diple.dmqa"), FALSE);
		
		TCHAR	szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], DIPLEDMQA_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFraudPackCpMz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of FraudPack Family
				      Install it self.
					  Change internet Zone Setings.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFraudPackCpMz()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x3B98 &&
	  ((m_wNoOfSections == 0x6 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000)|| 
	  (m_wNoOfSections == 0x3 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x35000)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int FRAUDPACK_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[FRAUDPACK_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		m_pMaxPEFile->Rva2FileOffset(0x1244, &dwBuffOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x9, 0x9))
		{
			return iRetStatus;
		}
		m_pMaxPEFile->Rva2FileOffset(0x3F64, &dwBuffOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x9], dwBuffOffset, 0x27, 0x27))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szFraudPack[] = {_T("3533626161386534*3100330036003000300034003400370035*3700390031003600370034003700320039")}; //53baa8e4*136004475*791674729
		polydbObj.LoadSigDBEx(szFraudPack, _T("Trojan.FraudPack.cpnz"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], FRAUDPACK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectNilageBXY
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Rushikesh + Virus Analysis Team
	Description		: Detection routine for different varients of Nilage Family
					  A : These are dll files
					  B : contains name of DLL which is malecious
					  C	: Signature is taken as name of DLL which unique all the files.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectNilageBXY()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;

	if((m_wAEPSec == 0 && memcmp(m_pSectionHeader[m_wAEPSec].Name, ".Upack", 6) == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BXY_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[BXY_BUFF_SIZE];
		if(!GetBuffer((m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9DB0), BXY_BUFF_SIZE, BXY_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szBXY[] = {_T("566572434C5349442E657865*484848436F6D70726573732E646C6C*484D5F54434C574F574E424E534A5F494E464F")};
		polydbObj.LoadSigDBEx(szBXY, _T("GameThief.Nilage.bxy"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BXY_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropAgentAyqa
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Ayqa Family
					  A. Installation:	
						- Drope two files in to windows\Tasks.
						- dropped *.ini file is diff trojan.
					  B. File Modification 
						- Drop 2 files *.inf and *.ico
						- C:\Regshot\LOG\MaxSystemMonitor\
					  C. Registry Modifications:
						- HKLM\SOFTWARE\Classes\CLSID\{8E9996DB-D66A-4C4C-9002-38E5CC2551EE}\InprocServer32\: "C:\WINDOWS\Tasks\zXaFgYqRJXUkR72Dk.inf"
						- HKLM\SOFTWARE\Classes\CLSID\{8E9996DB-D66A-4C4C-9002-38E5CC2551EE}\InprocServer32\ThreadingModel: "Apartment"
						- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\ShellExecuteHooks\{8E9996DB-D66A-4C4C-9002-38E5CC2551EE}: ""
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropAgentAyqa()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x2071 &&  
		((m_wNoOfSections >= 0x03 && m_wNoOfSections <= 0x06) &&  
		((m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000) || (m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int AGENTAYQA_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[AGENTAYQA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwBuffOffset = 0x0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x4020,&dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0],dwBuffOffset,AGENTAYQA_BUFF_SIZE,AGENTAYQA_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szAgentLTA[] = (_T("5AC71A9F4372CA7377C7E0C543FBFFFA*78000000650000002E0000004400000069000000530000004C00000043000000720000004500000056*564352004A55466E644234704152534A"));//
		objdbscan.LoadSigDBEx(szAgentLTA,_T("Dropper.Agent.ayqa"),FALSE);
		
		TCHAR szVirusName[MAX_PATH] = {0};
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTAYQA_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x4C20,&dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0],dwBuffOffset,AGENTAYQA_BUFF_SIZE,AGENTAYQA_BUFF_SIZE))
		{
			return iRetStatus;
		}
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTAYQA_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentLTA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.LTA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentLTA()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections >= 0x3 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x39FA && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData >= 0x2B00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTLTA_BUFF_SIZE = 0x60;
		m_pbyBuff = new BYTE[AGENTLTA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		m_pMaxPEFile->Rva2FileOffset(0x512C,&dwBuffOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0],dwBuffOffset,0x20,0x20))
		{
			return iRetStatus;
		}
		m_pMaxPEFile->Rva2FileOffset(0x547C,&dwBuffOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x20],dwBuffOffset,0x20,0x20))
		{
			return iRetStatus;
		}
		m_pMaxPEFile->Rva2FileOffset(0x59F0,&dwBuffOffset);
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x40],dwBuffOffset,0x20,0x20))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szAgentLTA[] = (_T("54656D705C7531366576656E742E68746D6C*5472696C6C69616E5C7573657273*537472696E67496E646578006531363132353561"));//Temp\u16event.html * Trillian\users * StringIndex.e161255a
		objdbscan.LoadSigDBEx(szAgentLTA,_T("PSW.Agent.lta"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTLTA_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGamupFR
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Gamup.fr Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGamupFR()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x30632 && m_wNoOfSections >= 0x05 && 
		m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x4A000 &&
		(memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, "dsfddfs_", 8)==0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int GAMUP_BUFF_SIZE = 0x530;
		m_pbyBuff = new BYTE[GAMUP_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x4BD60, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, GAMUP_BUFF_SIZE, GAMUP_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szGamup[] = (_T("22333332303122*4E657747616D655570646174655C47616D65557064617465312E657865*77696E646F77735C4B423937383937382E6C6F67"));//"33201" * NewGameUpdate\GameUpdate1.exe *windows\KB978978.log
		objdbscan.LoadSigDBEx(szGamup,_T("Downloader.Gamup.fr"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], GAMUP_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPakesTyi
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Pakes.tyi Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPakesTyi()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x01 &&  m_dwAEPUnmapped == 0x4D240 && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x03) &&
		m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x12400)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PAKESTYI_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[PAKESTYI_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(0x3BA80, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, PAKESTYI_BUFF_SIZE, PAKESTYI_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szPakesTYI[] = (_T("BB3C0B1C03*4F8B5100AF6FDBF617C46003FB4F89560ADF75D013FB42464B6DFFDBF7D237D7")); // size of decryption * decryption loop
		objdbscan.LoadSigDBEx(szPakesTYI,_T("Trojan.Pakes.tyi"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PAKESTYI_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomBlockerJGB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Blocker.JGB Family
					  - Start Internet Explorer with link eb2a.com
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomBlockerJGB()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && m_dwAEPUnmapped == 0x1240 && 
		m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x6E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int BLOCKERGJB_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[BLOCKERGJB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0xA059;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, BLOCKERGJB_BUFF_SIZE, BLOCKERGJB_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szBlockerJGB = (_T("526172244558372E737263373737*706970652E457863373737*61636873762E65786500434F4D372E455845*466F78")); //Rar$EX7.src777 * pipe.Exc777 * achsv.exe COM7.EXE * Fox
		objdbscan.LoadSigDBEx(szBlockerJGB, _T("Trojan-Ransom.Win32.Blocker.jgb"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], BLOCKERGJB_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectIRCNiteCBV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of IRCNite Family
					  Files are Krypt Packed and drops file which are responsible for Nimnul Infection.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIRCNiteCBV(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	//1 : No. of Section should be 4 or 5 or 6
	if (m_wNoOfSections < 0x04 )
	{
		return iRetStatus;
	}
	//2 : Third section should be .rsrc.
	if (memcmp(m_pSectionHeader[0x02].Name, ".rsrc", 5) != 0)
	{
		return iRetStatus;
	}
	//3 : Size of raw data of First Section should be greater than 0xA00
	if (m_pSectionHeader[0x00].SizeOfRawData < 0xA00)
	{
		return iRetStatus;
	}

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int IRCNITE_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[IRCNITE_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	if(!GetBuffer(0x890,IRCNITE_BUFF_SIZE,IRCNITE_BUFF_SIZE))
	{
		return iRetStatus;
	}

	CSemiPolyDBScn	polydbObj;
	TCHAR			szVirusName[MAX_PATH] = {0};
	TCHAR			szIRCNiteCBV[] = {_T("76022BDEBFE4000000313AF7D3C1E3E48B3221F3*B0628AC381C60A000000893233DE1BDF83C2FF8D198AD98ACB83E901")};

	polydbObj.LoadSigDBEx(szIRCNiteCBV, _T("Trojan.W32.IRCNite.CBV"),FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScarEAML
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Scar.EAML Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarEAML(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if (m_dwAEPUnmapped != 0x1CF5)
		return iRetStatus;

	if (m_pMaxPEFile->m_dwFileSize < (m_pSectionHeader[0x00].PointerToRawData + 0x250))
		return iRetStatus;

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int SCAREAML_BUFF_SIZE = 0x250;
	m_pbyBuff = new BYTE[SCAREAML_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	if (!GetBuffer(m_pSectionHeader[0x00].PointerToRawData,SCAREAML_BUFF_SIZE,SCAREAML_BUFF_SIZE))
	{
		return iRetStatus;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR			szVirusName[MAX_PATH] = {0};
	TCHAR			szScanEAML[] = {_T("2573000000476D61496C2E634F4D000000484F746D61496C2E634F4D007941686F4F2E436F6D00000041505044415441*50726F78792D436F6E6E656374696F6E3A")};

	polydbObj.LoadSigDBEx(szScanEAML, _T("Worm.Scar.EAML"),FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDrpAgentEMLQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.EMLQ Family
					  All are NSIS samples
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDrpAgentEMLQ()
{
	int iRetStatus =VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x05 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x3150 && 
		m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x5E00 &&
		m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData == 0x7A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTEMLQ_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[AGENTEMLQ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
		if(OUT_OF_FILE == dwBuffOffset || dwBuffOffset == 0x0)
		{
			return iRetStatus;
		}
		if(m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x400)
		{
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset + 0xB00, 0x400, 0x400))
				return iRetStatus;
		}
		else
		{
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset + 0x2400, 0x1000, 0x1000))
				return iRetStatus;
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x1000], dwBuffOffset + 0x16000, 0x1000, 0x1000))
				return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szAgentEmlq1 = (_T("44A5CE4E89894F8B49C03505DDB3A444CD6537524AD98CCBCFB72DB32759*56525850C48EFAE0478CD2FC589DCAF9E4E29CB6599DD3EA52DDD8D695*650C38371EE238")); //from Overlay
		LPCTSTR	szAgentEmlq  = (_T("28ED50B6417918CA3350764379174A1F943350528BB4312E4BD65EA8CB*2465416BC3EA242D506C418AEAD6D5424BA3A761DDEA9646800929D542*366E4B233024")); //from Overlay
		if(m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x400)
		{
			SecureZeroMemory(&szAgentEmlq, sizeof(szAgentEmlq));
			szAgentEmlq = (_T("2A2B2B2D4D2B332B2A3F*B97C4580D2FDE0450C72FFF9F177041845BD4271C08B215364B6A348E4*5B555E9CB04B2DDD61EB616B33D47A35DD5227B591FC6C")); //from Overlay
		}
		objdbscan.LoadSigDBEx(szAgentEmlq, _T("Trojan-Dropper.Win32.Agent.emlq"), TRUE);
		objdbscan.LoadSigDBEx(szAgentEmlq1, _T("Trojan-Dropper.Win32.Agent.emlq"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTEMLQ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackDooorCZP
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Door.CZP Family
					  Themida packed samples
					  1)it loads file from resource section and executes in memory
					  2)it drops one dll in system32
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackDooorCZP()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress >= 0x3F000 && m_pMaxPEFile->m_stPEHeader.SizeOfStackCommit >= 0x4000)
	{
		DWORD dwResSecOffset = 0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress,&dwResSecOffset))
		{
			return iRetStatus;
		}
		const int BackDoorCZPSize = 0x400;
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[BackDoorCZPSize];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff,0x00,BackDoorCZPSize);
		if(GetBuffer(dwResSecOffset,BackDoorCZPSize,BackDoorCZPSize))
		{
			TCHAR CZP_SIG[] = {_T("440045004E0045004D00450006004400560043004C0041004C0003004500440054*52004F004F0054004B00490054")};
						/*D.E.N.E.M.E...D.V.C.L.A.L...E.D.T * R.O.O.T.K.I.T*/
			CSemiPolyDBScn pobjScn;
			pobjScn.LoadSigDBEx(CZP_SIG,_T("Trojan.BackDoor-CZP.Dr"),FALSE);
			TCHAR szVirusName[0x1024] = {0};
			if(pobjScn.ScanBuffer(&m_pbyBuff[0],BackDoorCZPSize,szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectStudALB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Stud.ALB Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectStudALB(void)
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if (m_dwAEPUnmapped != 0x22A0 || m_wNoOfSections < 0x03)
		return iRetStatus;

	if (m_pSectionHeader[0x01].PointerToRawData != 0x1400)
		return iRetStatus;

	if (m_pMaxPEFile->m_dwFileSize < (m_pSectionHeader[0x01].PointerToRawData + 0x250))
		return iRetStatus;

	if (m_pbyBuff)
	{
		delete []m_pbyBuff; 
		m_pbyBuff = NULL;
	}
	const int STUDALB_BUFF_SIZE = 0x250;
	m_pbyBuff = new BYTE[STUDALB_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}
	if (!GetBuffer(m_pSectionHeader[0x01].PointerToRawData,STUDALB_BUFF_SIZE,STUDALB_BUFF_SIZE))
	{
		return iRetStatus;
	}
	CSemiPolyDBScn	polydbObj;
	TCHAR			szVirusName[MAX_PATH] = {0};
	TCHAR			szStudALB[] = {_T("26773D256400000026763D25642E2564*757272656E7456657273696F6E5C52756E4F6E6365*257300006F70656E*436F6D53706563002F632022257322203E3E204E554C*676F746F20780D0A000064656C202225*70696E67203132372E302E302E31202D6E2032202D772031303030")};

	polydbObj.LoadSigDBEx(szStudALB, _T("not-a-virus.Adware.Stud.ALB"),FALSE);
	if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderAndromedaEBJ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Andromeda.ebj Family
					  A. Installation:
							- copy itself to following paths.
					  B. File Modification
						  Dropped files 
						  - C:\Documents and Settings\admin\Application Data\A-1742181516.exe
						  - C:\Documents and Settings\admin\Start Menu\Programs\Startup\A-1742181516.exe
						  - C:\Documents and Settings\All Users\Start Menu\Programs\Startup\A-1742181516.exe
						  - C:\WINDOWS\ppdrive32.exe
					  C. Registry modification:
							- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\explorer\run\A-1742181516: 
							- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\A-1742181516: 
							- HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\explorer\run\Microsoft Driver Setup: "C:\WINDOWS\ppdrive32.exe"
							- HKU\S-1-5-21-842925246-879983540-839522115-1003\Software\Microsoft\Windows\CurrentVersion\Run\A-1742181516:
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderAndromedaEBJ()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_wNoOfSections ==0x05 && m_dwAEPUnmapped == 0x3493 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6800)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int ANDROMEDIAEBJ_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[ANDROMEDIAEBJ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = m_pSectionHeader[0x1].VirtualAddress + 0x2220;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, ANDROMEDIAEBJ_BUFF_SIZE, ANDROMEDIAEBJ_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szAndromediEBJ = (_T("565C5459735A595150476554415D74006464666667696B0048484A4A4C4D4D00*5C5B515A42466976404747505B41635047465C5A5B6967405B0000004C4C4E4E50")); //Message Text and Caption
		objdbscan.LoadSigDBEx(szAndromediEBJ, _T("Downloader.Win32.Andromeda.ebj"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], ANDROMEDIAEBJ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickerCyclerAJSZ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Cycler.AJSZ + Virus Analysis Team
	Description		: Detection routine for different varients of Cycler.AJSZ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerCyclerAJSZ()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPUnmapped == 0x3955 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int CYCLERAJSZ_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[CYCLERAJSZ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x1595;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, CYCLERAJSZ_BUFF_SIZE, CYCLERAJSZ_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szCyclerAJSZ = (_T("8B85F4FCFFFF408985F4FCFFFF8B85F4FCFFFF3B0594DD4100734B6820F34000*8885F8FDFFFFA140804000C1E003*8B1590DD41008A04028801EB9A")); //Decryption loop
		objdbscan.LoadSigDBEx(szCyclerAJSZ, _T("Clicker.Win32.Cycler.ajsz"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], CYCLERAJSZ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectJorikVobfusCqaz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Jorik.Vobfus.Cqaz Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJorikVobfusCqaz()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && m_dwAEPUnmapped == 0x1224 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2C000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int VOBFUSCQAZ_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[VOBFUSCQAZ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x91E4;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, VOBFUSCQAZ_BUFF_SIZE, VOBFUSCQAZ_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szVobfusCQAZ = (_T("5C0073006E0064005C0065006E00670069006E00650070002E007700610076*79006F0075007200200066006900670068007400650072*6F007500740020006F00660020006600750065006C")); // \.s.n.d.\.e.n.g.i.n.e.p...w.a.v * y.o.u.r. .f.i.g.h.t.e.r * o.u.t. .o.f. .f.u.e.l
		objdbscan.LoadSigDBEx(szVobfusCQAZ, _T("Trojan.Win32.Jorik.Vobfus.cqaz"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], VOBFUSCQAZ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAutorunCxps
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Autorun.Cxps Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAutorunCxps()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x1198C && m_wAEPSec == 0 && m_pSectionHeader[0].SizeOfRawData == 0x16600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x80];
		if(!GetBuffer(0x960, 0x80, 0x80))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("8B5424108A140AB10184C9742184CA74058B4010EB038B400C02C9803800740A*8A400C880433468BC54F85FF77DB8B4C241041894C241081F9EDC9000072B9")};
		TCHAR szVirusName[MAX_PATH] = {0};
		polydbObj.LoadSigDBEx(szSig, _T("Worm.Autorun.Cxps"), FALSE);

		if(polydbObj.ScanBuffer(m_pbyBuff, 0x80, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentRzr
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Rzr Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentRzr()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if (m_wAEPSec == 0x0 && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x2) &&  ((m_dwAEPUnmapped & 0xF00F) == 0x700E || (m_dwAEPUnmapped & 0xF00F) == 0xA00E || (m_dwAEPUnmapped & 0xF00F) == 0x800E || (m_dwAEPUnmapped & 0xF00F) == 0xB00E) && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x5C00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x9A00) && 
		(m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x200 || (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x246 && m_wNoOfSections == 0x2)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	BLADBINDI_BUFF_SIZE = 0x1100;
		m_pbyBuff = new BYTE[BLADBINDI_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		DWORD	dwMetaDatRVA     = 0x0;
		DWORD	dwReadBuffOffset = 0x0;
		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress == 0x0)
		{
			return iRetStatus;
		}
		else
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress + 0x8, &dwReadBuffOffset))
			{
				return iRetStatus;
			}
			if(GetBuffer(dwReadBuffOffset, 0x08, 0x08))
			{
				dwMetaDatRVA   = *(DWORD*)&m_pbyBuff[0x0];
			}
			else
			{
				return iRetStatus;
			}
		}
		if(dwMetaDatRVA != 0x0)
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwMetaDatRVA + 0x2150, &dwReadBuffOffset)) 
			{
				return iRetStatus;
			}

			if(GetBuffer(dwReadBuffOffset, BLADBINDI_BUFF_SIZE, BLADBINDI_BUFF_SIZE))
			{
				CSemiPolyDBScn		objdbscan;
				TCHAR				szVirusName[MAX_PATH] = {0};

				LPCTSTR  szAgent = (_T("5B0065006E0064006F0066005D*540072006F006A0061006E002E006500780065*540045004D0050"));
				LPCTSTR  szBladBindiB = (_T("2E00650078006500*62006C0061000009740065006D0070*3363006D0064002E006500780065*476E0065007400730068")); //e.x.e.*b.l.a...t.e.m.p*3c.m.d...e.x.e*Gn.e.t.s.h
				objdbscan.LoadSigDBEx(szAgent, _T("Trojan.MSIL.Agent.Rzr"), TRUE);
				objdbscan.LoadSigDBEx(szBladBindiB, _T("Trojan.MSIL.Bladabindi.b"), FALSE);
				if(objdbscan.ScanBuffer(&m_pbyBuff[0], BLADBINDI_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGameThiefMaganiaBIHT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of GameThief.Magania Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGameThiefMaganiaBIHT()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0 && (m_dwAEPUnmapped == 0x1FD1 || m_dwAEPUnmapped == 0x2045) && (((m_wNoOfSections == 0x2 || m_wNoOfSections == 0x3) && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x5000) 
		|| (m_wNoOfSections == 0x4 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1172)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int MAGANIABIHT_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[MAGANIABIHT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0],m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x351,0x20,0x20))
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x0;
		if(m_wNoOfSections == 0x2 || m_wNoOfSections == 0x3)
			dwBuffOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x3198;
		else	
			dwBuffOffset = m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0x198;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x20],dwBuffOffset ,0x20,0x20))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szGameThiefMaganiaBIHT[] = {_T("3985C4FEFFFF73188B95C4FEFFFF8D343A8A1683F2378816FF85C4FEFFFFEBE0*4A55466E644234704152534A")};
													
		polydbObj.LoadSigDBEx(szGameThiefMaganiaBIHT, _T("Trojan.GameThief.Magania.biht"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDeeceeG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Deecee.G Family
					  A. Process Operation: Creates/drops copy of itself with name %UserName%.exe in %UserProfile%	 
					  B. Attempts to establish connection to foll. URL's[http://www.<....>/void.php]:
							  http://www.Lliantgar.x10hosting.com/void.php
							  http://www.Kuipnys.elementfx.com/void.php
							  http://www.Vesenem.pcriot.com/void.php
							  http://www.Placeholder.x10hosting.com/void.php	
					  C. Registry Modifications:
						  1. Ensures automatic execution of dropped sample at every system startup.
						  2. [HKEY_CURRENT_USER\AppEvents\Schemes\Apps\Explorer\Navigating\.Current]
						 (Default) = "%SystemRoot%\media\Windows XP Start.wav"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDeeceeG()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x62170 && (((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && m_wAEPSec == 0x1 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x33000) 
		|| (m_wNoOfSections >= 0x8 && m_wAEPSec == 0x0 && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x61520 ||
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].Misc.VirtualSize))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int DEECEEG_BUFF_SIZE = 0x250;
		m_pbyBuff = new BYTE[DEECEEG_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0],m_dwAEPMapped - 0x13C0,0x150,0x150))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x150],m_dwAEPMapped + 0x2E5,0x100,0x100))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szWormDeeceeG[] = {_T("5C54656D705C7570646174652E657865*687474703A2F2F7777772E00FFFFFFFF090000002F766F69642E706870*555345524E414D45*417070735C4578706C6F7265725C4E617669676174696E675C2E63757272656E74")};
								
		polydbObj.LoadSigDBEx(szWormDeeceeG, _T("Worm.Deecee.G"),FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], DEECEEG_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanMalwareBSM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Malware.bsm Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanMalwareBSM()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x11000 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x20000) && m_dwAEPMapped == m_dwAEPUnmapped &&
	   (m_dwAEPMapped % 0x10) == 0x8 || (m_dwAEPMapped % 0x10) == 0x0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int MALWAREBSM_BUFF_SIZE = 0x700;
		m_pbyBuff = new BYTE[MALWAREBSM_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0xA00;
		if(m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData >= 0x14000 && m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData < 0x15000)
			dwReadOff = m_pSectionHeader[m_wAEPSec + 0x2].PointerToRawData + 0x200;

		if(!GetBuffer(dwReadOff,MALWAREBSM_BUFF_SIZE,MALWAREBSM_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szTrojanMalwareBSM[] = {_T("63646E5F6D757465785F63646E756E696E7377696E*687474703A2F2F7777772E636E6E69632E636E2F68746D6C2F4469722F323030342F30382F32302F323434362E68746D*63646E7072682E646C6C")};
						//cdn_mutex_cdnuninswin*http://www.cnnic.cn/html/Dir/2004/08/20/2446.htm*cdnprh.dll

		TCHAR	szTrojanMalwareBSM1[] = {_T("63646E5F6D757465785F63646E757077696E*636E6E69632E68746D*5C63646E72657265672E646174")};
						//cdn_mutex_cdnupwin*cnnic.htm*\cdnrereg.dat
		
		polydbObj.LoadSigDBEx(szTrojanMalwareBSM, _T("Trojan.Malware.bsm"),TRUE);
		polydbObj.LoadSigDBEx(szTrojanMalwareBSM1, _T("Trojan.Malware.bsm"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], MALWAREBSM_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
		
			
	}
	else if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && 
		(m_dwAEPUnmapped == 0x1079D || m_dwAEPUnmapped == 0xD4B4 || (m_dwAEPUnmapped / 0x1000) == 0x19 && (m_dwAEPUnmapped % 0x10) == 0x9))
	{
		DWORD dwNameID = 0x06, dwLang = 0x0001 , dwLangID = 0x0000, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;
		if(FindRes(LPCTSTR(&dwNameID), LPCTSTR(&dwLang), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			const BYTE bMALWAREBSM_SIG[] = {0x68,0x00,0x74,0x00,0x74,0x00,0x70,0x00,0x3A,0x00,0x2F,0x00,0x2F,0x00,0x77,0x00,
			                        0x77,0x00,0x77,0x00,0x2E,0x00,0x74,0x00,0x72,0x00,0x79,0x00,0x67,0x00,0x61,0x00,
									0x6D,0x00,0x65,0x00,0x73,0x00,0x2E,0x00,0x63,0x00,0x6F,0x00,0x6D};
		                           //h.t.t.p.:././.w.w.w...t.r.y.g.a.m.e.s...c.o.m

			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
			{
				return iRetStatus;
			}
			BYTE *bTempBuff = new BYTE[dwSize];
			if(!m_pMaxPEFile->ReadBuffer(&bTempBuff[0x0],dwReadOffset, dwSize, dwSize))
			{
				return iRetStatus;
			}
			if(memcmp(&bTempBuff[0x04], bMALWAREBSM_SIG, sizeof(bMALWAREBSM_SIG)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Malware.bsm"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUrelas
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Urelas Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUrelas()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	if(m_wAEPSec == 0x1 && (m_wNoOfSections == 0xA || m_wNoOfSections == 0xC) && 
		(m_dwAEPUnmapped >= 0xF2E00 && m_dwAEPUnmapped <= 0x194000) && 
		( m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x1000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x2000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int URELAS_BUFF_SIZE = 0x4500;
		m_pbyBuff = new BYTE[URELAS_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = m_dwAEPUnmapped - 0xD000;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, URELAS_BUFF_SIZE, URELAS_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szUrelasA = (_T("68006900670068006C006F00770032002E006500780065*70006F006B006500720037002E006500780065*42006100640075006B0069*4400750065006C0050006F006B00650072002E006500780065"));// h.i.g.h.l.o.w.2...e.x.e * p.o.k.e.r.7...e.x.e * B.a.d.u.k.i * F.R.N...e.x.e
		objdbscan.LoadSigDBEx(szUrelasA, _T("Trojan.Win32.Urelas.a"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], URELAS_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectIRCmirc603
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of IRC.mirc Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIRCmirc603()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1000 && (((
		(m_wNoOfSections >= 0x7 && m_wNoOfSections <= 0x9 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15C600 ||  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15D000)) ||
		((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1CF000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C9000)))&& 
		m_pSectionHeader[m_wAEPSec].PointerToRelocations == 0x44064154 && m_pSectionHeader[m_wAEPSec].PointerToLinenumbers == 0x554F5247) || 
		(m_wNoOfSections == 0x3 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF00FFF) == 0x100000 && memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4)== 0)))	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int IRCMIRC_BUFF_SIZE = 0x80;
		m_pbyBuff = new BYTE[IRCMIRC_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = m_dwAEPUnmapped + 0x269;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, IRCMIRC_BUFF_SIZE, IRCMIRC_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szVobfusCQAZ = (_T("E82AD2140083C40CC6465A0066BE01005753E8D0D1140083C40885C0750966BE*E8B6D1140083C40885C0750966BE1000E9190300008D470D5053E89CD1140083*E882D1140083C40885C0750966BE0300E9E50200008D47155053E868D1140083")); //Call sequence
		objdbscan.LoadSigDBEx(szVobfusCQAZ, _T("not-a-virus:Client-IRC.Win32.mIRC.603"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], IRCMIRC_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectQhostsAF
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Qhosts.AF Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectQhostsAF()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPUnmapped == 0x17D64 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16E00 &&
		(m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x11400 || m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x11800))
	{
		DWORD dwStartOfOverlay = m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData;
		if((m_pMaxPEFile->m_dwFileSize - dwStartOfOverlay) < 0x2800) // to skeep qhosts.bm
			return iRetStatus;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int QHOSTS_BUFF_SIZE = 0x1200;
		m_pbyBuff = new BYTE[QHOSTS_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = dwStartOfOverlay + 0x1650;
		if(OUT_OF_FILE == dwBuffOffset)
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, QHOSTS_BUFF_SIZE, QHOSTS_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szVobfusCQAZ = (_T("6D2E6D792E6D61696C*7777772E6F646E6F6B6C617373*382C20747275652C202D32*3139312E3232323A3433")); //m.my.mail * www.odnoklass *  8, true, -2 * 191.222:43
		LPCTSTR  szVobfusCQAZ1 = (_T("382C20747275652C202D32*6D2E6D792E6D61696C*7777772E6F646E6F6B6C617373*3139312E3232323A3433"));
		objdbscan.LoadSigDBEx(szVobfusCQAZ, _T("Trojan.Win32.Qhosts.af"), TRUE);
		objdbscan.LoadSigDBEx(szVobfusCQAZ1, _T("Trojan.Win32.Qhosts.af"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], QHOSTS_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectQhost
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Qhost Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectQhost()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xB2BB && ((m_wNoOfSections == 0x3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C000) || 
		(m_wNoOfSections == 0x5 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11000)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int QHOST_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[QHOST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = 0x12460;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, QHOST_BUFF_SIZE, QHOST_BUFF_SIZE))
			return iRetStatus;

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szQhostQye0 = (_T("42484F2E547474506C61796572*36333033353838312D413734392D343133392D394341422D383244434646413746313036")); //CLSID
		LPCTSTR  szQhostQye1 = (_T("42484F2E547474506C61796572*33463045304234362D383434322D346362362D393346362D323435343330343938393931"));
		objdbscan.LoadSigDBEx(szQhostQye0, _T("Trojan.Qhost.qye"), TRUE);
		objdbscan.LoadSigDBEx(szQhostQye1, _T("Trojan.Qhost.qye"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], QHOST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAirInstaller
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of AirInstaller Family
					  A. Installation:	
						- Download application.
						- Isntall it and ask user to register it.
					  B. File Modification 
						- According to Installed Application.
					  C. Registry Modifications:
						- According to installed application.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAirInstaller()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	//(Packed || UnPacked)	unpacked samples are more than 2mbs UPX
	if((m_wAEPSec == 0x1 && m_wNoOfSections == 0x03 && (((m_dwAEPUnmapped & 0xFF000F) == 0x240000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF00FF) == 0x100000 && (m_pSectionHeader[m_wNoOfSections - 1].VirtualAddress & 0xFF0FFF) == 0x240000)||
		((m_dwAEPUnmapped & 0xFF000F) == 0x220000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF00FF) == 0xE0000 && (m_pSectionHeader[m_wNoOfSections - 1].VirtualAddress & 0xFF0FFF) == 0x220000)) && m_pSectionHeader[m_wAEPSec].Characteristics == 0xE0000040)
		||
		(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && (((m_dwAEPUnmapped & 0xFF0000) == 0x150000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF00FF) == 0x180000 && (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData & 0xFF0FF) == 0x2C000) ||
		((m_dwAEPUnmapped & 0xFF0000) == 0x130000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF00FF) == 0x170000 && (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData & 0xFF0FF) == 0x2B000) || 
		(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x15AD8D && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x193800)))) // added
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AIRINSTALLER_BUFF_SIZE = 0x400;
		m_pbyBuff = new BYTE[AIRINSTALLER_BUFF_SIZE];
		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwType = 0x010, dwNameID = 0x01 , dwLangID = 0x0409, dwRVA = 0x0 , dwSize = 0x0, dwReadOffset = 0x0;

		if(FindRes(LPCTSTR(&dwType), LPCTSTR(&dwNameID), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwReadOffset))
			{
				return iRetStatus;
			}

			if(dwSize > AIRINSTALLER_BUFF_SIZE)
			{
				dwSize = AIRINSTALLER_BUFF_SIZE;
			}

			if(!GetBuffer(dwReadOffset, dwSize, dwSize))
			{
				return iRetStatus;
			}
		}
		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szAirInstall = (_T("41006900720049006E007300740061006C006C0065007200200049006E0063*41006900720049006E007300740061006C006C00650072002E006500780065*2800630029002000410069007200")); // A.i.r.I.n.s.t.a.l.l.e.r. .I.n.c * A.i.r.I.n.s.t.a.l.l.e.r...e.x.e * (.c.). .A.i.r.

		objdbscan.LoadSigDBEx(szAirInstall, _T("not-a-virus: Trojan.Airinstaller"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AIRINSTALLER_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDebris
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Debris Family
					  Covered variants : 1. Worm.Win32.Debris.ad, 2. Worm.Win32.Debris.ag, 3. Worm.Win32.Debris.aq
					  4. Worm.Win32.Debris.id, 5. Worm.Win32.Debris.iq, 6. Worm.Win32.Debris.abl, 7. Worm.Win32.Debris.aj
					  8. Worm.Win32.Debris.al, 9. Worm.Win32.Debris.ye		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDebris()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;
	if((m_wNoOfSections == 0x4 || (m_wNoOfSections == 0x5 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x21E))  && m_wAEPSec == 0x0 
	  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400 || (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x600 && (m_dwAEPUnmapped == 0x10AB || m_dwAEPUnmapped == 0x11E0 || m_dwAEPUnmapped == 0x1250)) || (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800 && (m_dwAEPUnmapped == 0x10AB || m_dwAEPUnmapped == 0x1440)) || (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00 && m_dwAEPUnmapped == 0x10AB)|| (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1200 && m_dwAEPUnmapped == 0x2030)) 
	  && (m_dwAEPUnmapped == 0x1040 || m_dwAEPUnmapped == 0x10AB || m_dwAEPUnmapped == 0x11E0 || m_dwAEPUnmapped == 0x1250 || m_dwAEPUnmapped == 0x12E0 || m_dwAEPUnmapped == 0x1330 || m_dwAEPUnmapped == 0x1360 || m_dwAEPUnmapped == 0x1380 || m_dwAEPUnmapped == 0x1390 || m_dwAEPUnmapped == 0x13C0 || m_dwAEPUnmapped == 0x1440 || m_dwAEPUnmapped == 0x2030))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DEBRIS_BUFF_SIZE = 0x180;
		m_pbyBuff = new BYTE[DEBRIS_BUFF_SIZE];
		if(!m_pbyBuff)
			return iRetStatus;

		CSemiPolyDBScn objdbscan;
		DWORD dwReadOffset = 0x0;	
		switch (m_dwAEPUnmapped)
		{
		case 0x1040 :{	
						objdbscan.LoadSigDBEx(_T("EB098B55C883C2018955C88B45C83B059C310010731E8B0D94310010034DC80F*B6113355E00355FCA1943100100345C88810EBCEFF15943100108BE55DC21000"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x135C;
					 }
					 break;
		case 0x10AB :{
						
						if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400)
						{
							if(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x21E)
							{
								objdbscan.LoadSigDBEx(_T("76148A143032D180C242881430463B354030001072EC*FFD05F5E5BC9C2100033C040C20C00"), _T("Worm.Debris.Gen"), FALSE);
								dwReadOffset = 0x11F9; 
							}
							else
							{
								objdbscan.LoadSigDBEx(_T("7619A15C3000108A143032D180C242881430463B356430001072E7*6681F2730F6681F2C57C*FF155C3000105F5E5BC9C21000"), _T("Worm.Debris.Gen"), TRUE);
								objdbscan.LoadSigDBEx(_T("EB098B55E083C2018955E08B45E03B05A4300010731E8B0D9C300010034DE00F*B6113355EC0355FCA19C3000100345E08810EBCEFF159C3000108BE55DC21000"), _T("Worm.Debris.Gen"), FALSE);
								dwReadOffset = 0x127C;
							}
						}
						else if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00)
						{
							objdbscan.LoadSigDBEx(_T("EB0F8B8D70FFFFFF83C101898D70FFFFFF8B9570FFFFFF3B15343000107324A1*2C300010038570FFFFFF0FB608334DEC034DFC8B152C300010039570FFFFFF880AEBBF"), _T("Worm.Debris.Gen"), FALSE);
							dwReadOffset = 0x1640;
							if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00)
								dwReadOffset = 0x17B9;
						}
						else if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x600)
						{
							objdbscan.LoadSigDBEx(_T("7619A15C3000108A143032D180C242881430463B356430001072E7*6681F2730F6681F2C57C*FF155C3000105F5E5BC9C21000"), _T("Worm.Debris.Gen"), TRUE);
							objdbscan.LoadSigDBEx(_T("7619A1683000108A143032D180C242881430463B357030001072E7*6681F2730F6681F2C57C*FF15683000105F5E5BC9C21000"), _T("Worm.Debris.Gen"), TRUE);
							objdbscan.LoadSigDBEx(_T("7619A12C3000108A143032D180C242881430463B353430001072E7*FF152C3000105F5E5BC9C21000"), _T("Worm.Debris.Gen"), FALSE);
							dwReadOffset = 0x144E;
						}
					 }
					break;
		case 0x11E0 :{
						objdbscan.LoadSigDBEx(_T("EB098B4DB883C101894DB88B55B83B15EC300010731EA1E03000100345B80FB6*08334DCC034DFC8B15E03000100355B8880AEBCEFF15E0300010"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x14AE;
					 }
					break;
		case 0x1250 :{
						objdbscan.LoadSigDBEx(_T("EB098B45C483C0018945C48B4DC43B0DEC300010731F8B15E03000100355C40F*B6023345D80345FC8B0DE0300010034DC48801EBCDFF15E0300010"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x1546;
					 }
					break;
		case 0x12E0 :{
						objdbscan.LoadSigDBEx(_T("EB098B55E083C2018955E08B45E03B05A4310010731E8B0D9C310010034DE00F*B6113355EC0355FCA19C3100100345E08810EBCEFF159C3100108BE55DC21000"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x11C6;
					 }
					break;
		case 0x1330 :{
						objdbscan.LoadSigDBEx(_T("EB098B45D483C0018945D48B4DD43B0DBC300010731F8B15B43000100355D40F*B6023345EC0345FC8B0DB4300010034DD48801EBCDFF15B43000108BE55DC21000"), _T("Worm.Debris.Gen"), TRUE);
						objdbscan.LoadSigDBEx(_T("EB098B45D083C0018945D08B4DD03B0DBC300010731F8B15AC3000100355D00F*B6023345E40345FC8B0DAC300010034DD08801EBCDFF15AC3000108BE55DC21000"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x1180;
					 }
					break;
		case 0x1360 :{
						objdbscan.LoadSigDBEx(_T("EB098B45D083C0018945D08B4DD03B0DBC300010731F8B15AC3000100355D00F*B6023345E40345FC8B0DAC300010034DD08801EBCDFF15AC3000108BE55DC21000"), _T("Worm.Debris.Gen"), TRUE);
						objdbscan.LoadSigDBEx(_T("EB098B45D883C0018945D88B4DD83B0DBC30001073258B15AC3000100355D80F*B6023305C03000100305B03000108B0DAC300010034DD88801EBC7FF15AC300010"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x11B0;
					 }
					break;
		case 0x1380 :{													//Worm.Debris.al
						objdbscan.LoadSigDBEx(_T("EB098B55C883C2018955C88B45C83B059C310010731E8B0D94310010034DC80F*B6113355E00355FCA1943100100345C88810EBCEFF15943100108BE55DC21000"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x121F;
					 }
					break;
		case 0x1390 :{
						objdbscan.LoadSigDBEx(_T("EB098B45D883C0018945D88B4DD83B0DBC30001073258B15AC3000100355D80F*B6023305C03000100305B03000108B0DAC300010034DD88801EBC7FF15AC300010"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x11F3;
					 }
					break;
		case 0x13C0 :{
						objdbscan.LoadSigDBEx(_T("EB098B45D483C0018945D48B4DD43B0DBC300010731F8B15B43000100355D40F*B6023345EC0345FC8B0DB4300010034DD48801EBCDFF15B4300010"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x118F;
					 }
					break;
		case 0x1440 :{
	 					objdbscan.LoadSigDBEx(_T("EB098B4DC083C101894DC08B55C03B1518410010731EA10C4100100345C00FB6*08334DD4034DFC8B150C4100100355C0880AEBCEFF150C410010817D1488888808"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x175F;
					 }
					break;
		case 0x2030 :{
						objdbscan.LoadSigDBEx(_T("EB098B45D483C0018945D48B4DD43B0DBC700010731F8B15B47000100355D40F*B6023345EC0345FC8B0DB4700010034DD48801EBCDFF15B4700010817D14FFFFFF07"), _T("Worm.Debris.Gen"), FALSE);
						dwReadOffset = 0x1E75;
					 }
					break;
		 default :	dwReadOffset = 0x0;
					break;
		}
		if(dwReadOffset != 0x0)
		{	
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOffset, &dwReadOffset))
				return iRetStatus;
		}
		else
			return iRetStatus;
		
		if(!GetBuffer(dwReadOffset, DEBRIS_BUFF_SIZE, DEBRIS_BUFF_SIZE))
			return iRetStatus;

		TCHAR szVirusName[MAX_PATH] = {0};
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DEBRIS_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: Detect4Shared
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of 4Shared Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::Detect4Shared()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x05 && m_pSectionHeader[2].SizeOfRawData == 0x1600 &&
		m_pSectionHeader[4].SizeOfRawData >= 0x2800 && m_pSectionHeader[4].SizeOfRawData <= 0x2E00 &&
		(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1570 || m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1D70 ))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x50];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress + 0xC10, 0x50, 0x50))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		// Siganture contain trojan name 4Shared.com
		TCHAR	Shared_Sig[] = {_T("3880360034007300680061007200650064002E0063006F006D*44006F0077006E006C006F00610064002000480065006C007000650072")};
		
		polydbObj.LoadSigDBEx(Shared_Sig, _T("not-a-virus:Adware.4Shared"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x50, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDelfDuy
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Saneep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of Delf Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDelfDuy()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(((m_pSectionHeader[0].SizeOfRawData >= 0x3800) && (m_pSectionHeader[0].SizeOfRawData <= 0x5A00) &&
		(m_pSectionHeader[2].SizeOfRawData == 0x00) && (m_wNoOfSections >= 0x08) && 
		(m_pSectionHeader[3].SizeOfRawData >= 0x5F0 || m_pSectionHeader[3].SizeOfRawData <= 0x800)) ||
		((m_pSectionHeader[0].SizeOfRawData == m_pSectionHeader[0].Misc.VirtualSize) &&
		(m_pSectionHeader[1].SizeOfRawData == m_pSectionHeader[1].Misc.VirtualSize)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int DelfBuff = 0x150;
		m_pbyBuff = new BYTE[DelfBuff];
		if(!GetBuffer(m_dwAEPMapped - 0x200, DelfBuff, DelfBuff))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("046B69626F8D4000558BEC83C4E8535633C9894DE8894DEC89*400064FF30648920C645F7006A0A8B45FC*6A006A006A026A006A0168000000C08B45")};
		TCHAR szVirusName[MAX_PATH] = {0};
		polydbObj.LoadSigDBEx(szSig, _T("Droper.delf.duy"), TRUE);

		if(polydbObj.ScanBuffer(m_pbyBuff, DelfBuff, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperMetalA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Satish + Virus Analysis Team
	Description		: Detection routine for different varients of Metal Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperMetalA()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size < 0x9000 || ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL))
	{
		return iRetStatus;
	}
	if(m_pbyBuff)
	{
		delete[] m_pbyBuff;
		m_pbyBuff = NULL;
	}
	DWORD dwBufSize = 0x180;

	m_pbyBuff = new BYTE[dwBufSize];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	memset(m_pbyBuff, 0x00, dwBufSize);

	if(!GetBuffer(m_dwAEPMapped - 0x130, dwBufSize, dwBufSize))
	{
		return iRetStatus;
	}
	if((*(DWORD *)&m_pbyBuff[0x130] != 0x824448B) || (*(WORD *)&m_pbyBuff[0x134] != 0x7548))// 8B4424084875
	{
		return iRetStatus;
	}

	CSemiPolyDBScn polydbObj;
	TCHAR szSig[] = {_T("535657609CBB*4000E800000000582BC38945*BEA9124000*40002BCE03FB6A405157FF10*5F5E5BC9C20C006A01FF74240CFF74240CE8*8B4424084875*FFFF6A0158C20C006A036A006A00E8")};	
	polydbObj.LoadSigDBEx(szSig, _T("Dropper.Metal.a"), FALSE);
	TCHAR szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(m_pbyBuff, dwBufSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormBundpil
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Bundpil Family
					  Variaents	:	Worm.W32.Bundpil.abr,Worm.W32.Bundpil.atg,Worm.W32.Bundpil.ath,Worm.Agent.bti,Worm.Agent.bua,Worm.W32.Bundpil.abt
					  Worm.Autorun.ics
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormBundpil()
{
	// Covers Worm.W32.Bundpil.abr,Worm.W32.Bundpil.atg,Worm.W32.Bundpil.ath,Worm.Agent.bti,Trojan.Zapchast.affu,Worm.Agent.bua,Worm.Autorun.ics
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (m_wAEPSec == 0x0 && (m_dwAEPUnmapped == 0x10AB || m_dwAEPUnmapped == 0x12BD || m_dwAEPUnmapped == 0x1755) &&
	   ((m_wNoOfSections == 0x4 && 
	    (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800 ||
	    m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8A00)) || 
		(m_wNoOfSections == 0x3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000)) && 
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL)== IMAGE_FILE_DLL)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	BUNDPIL_BUFF_SIZE = 0x200;
		DWORD		dwReadOffset = 0x0;

		m_pbyBuff = new BYTE[BUNDPIL_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_dwAEPUnmapped == 0x10AB || m_dwAEPUnmapped == 0x1755)
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData;
			if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800)
			{
				dwReadOffset = m_dwAEPMapped + 0x4B0;
			}
		}
		else
		{
			dwReadOffset = m_dwAEPMapped + 0x4215;
		}
		
		if(!GetBuffer(dwReadOffset, BUNDPIL_BUFF_SIZE, BUNDPIL_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
		TCHAR	szWormBundpilABR[] = {_T("750E3905103000107E2EFF0D103000108B0D3020001083F8018B09890D38320010753F*33C066A33630001033DB0FB788402000106689883030001083C002663BCB75EA")};
		TCHAR	szWormBundpilATG[] = {_T("750E3905103000107E2EFF0D103000108B0D1C20001083F8018B09890D30320010753F*33C00FB788302000106689882830001083C002663BCE75EA6A40BB00100000535356FF")};
		TCHAR	szWormBundpilATH[] = {_T("BE79820081F58A26000081F52603820081F5125C0000584381EB0139FFFF81C3*0FB6C183F04E33C939356C3000108B356430001076148A140E32D080C24288140E413B0D6C30001072EC")};
		TCHAR   szWormAgentBTI[] = {_T("8D45FC5068287800106801000080FF1500600010BF0401000057BEA8A7001056FF3598A70010*680C78001033C0575666A3AEA70010E8E7BAFFFF83C40C6A0133DB*681078001033C0575666A3AEA70010E8C1BAFFFF83C40C6A40BF00100000")};//Worm.Agent.bti + Trojan.Zapchast.affu
		TCHAR   szWormAgentBUA[]= {_T("750E3905103000107E2EFF0D103000108B0D2820001083F8018B09890D30320010753F*33C0668945FC33DB0FB788302000106689882830001083C002663BCB75EA")};					
		TCHAR   szWormBundpilABT[] = {_T("750E3905103000107E2EFF0D103000108B0D2420001083F8018B09890D38320010753F*33C066A33630001033FF0FB788342000106689883030001083C002663BCF75EA")};  // Sign of Bundpil.abt
		TCHAR   szWormAutorunICS[] = {_T("83EC2CA170D1001033C58945FC8B45108B4D0856*8A160FB6CA8BC123CFB301D2E3C1E8038D4405DC08184684D275E5*84C07418428A020FB6F033DB8BCE23CF43D3E3C1EE03845C35DC75E4*E803080000C700160000006AFE8D45F0506870D10010E8B90F000083C40C")};

		polydbObj.LoadSigDBEx(szWormBundpilABR, _T("Worm.W32.Bundpil.abr"),true);
		polydbObj.LoadSigDBEx(szWormBundpilATG,_T("Worm.W32.Bundpil.atg"),true);
		polydbObj.LoadSigDBEx(szWormBundpilATH,_T("Worm.W32.Bundpil.ath"),true);
		polydbObj.LoadSigDBEx(szWormAgentBTI,_T("Worm.Agent.bti"),true);
		polydbObj.LoadSigDBEx(szWormAgentBUA,_T("Worm.Agent.bua"),true);
		polydbObj.LoadSigDBEx(szWormBundpilABT,_T("Worm.W32.Bundpil.abt"),true);
		polydbObj.LoadSigDBEx(szWormAutorunICS,_T("Worm.Autorun.ics"),false);


		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BUNDPIL_BUFF_SIZE, szVirusName) >= 0)
		{
			const BYTE bSigABR[] = {0x6F,0x6D,0x67,0x2E,0x64,0x6C,0x6C,0x00,0x63,0x72,0x79,0x73}; //omg.dll.crys
			const BYTE bSigABR1[] = {0x64,0x61,0x66,0x61,0x6B,0x2E,0x64,0x6C,0x6C,0x00,0x63,0x72,0x79,0x73}; //dafak.dll.crys
			const BYTE bSigATG[] = {0x73,0x78,0x72,0x73,0x68,0x64,0x2E,0x64,0x6C,0x6C,0x00,0x6B,0x72,0x6E,0x6C};// sxrshd.dll.krnl
			const BYTE bSigATH[] = {0x63,0x6F,0x6D,0x63,0x61,0x73,0x74,0x2E,0x64,0x6C,0x6C};//comcast.dll
			const BYTE bSigBTI[] = {0x64,0x6C,0x6C,0x5F,0x64,0x6F,0x77,0x6E,0x5F,0x65,0x78,0x65,0x63,0x2E,0x64,0x6C,0x6C,0x00,0x62,0x6C,0x61,0x68};//dll_down_exec.dll.blah
			const BYTE bSigBUA[] = {0x36,0x32,0x36,0x35,0x36,0x2E,0x64,0x6C,0x6C};//62656.dll
			const BYTE bSigABT[] = {0x66,0x77,0x66,0x77,0x65,0x2E,0x64,0x6C,0x6C,0x00,0x63,0x72,0x79,0x73}; //fwfwe.dll.crys
			const BYTE bSigICS[] = {0x64,0x6C,0x6C,0x5F,0x64,0x6F,0x77,0x6E,0x5F,0x65,0x78,0x65,0x63,0x2E,0x64,0x6C,0x6C,0x00,0x5F,0x6C,0x64,0x72,0x40,0x31,0x36};//dll_down_exec.dll._ldr@16

			DWORD dwExportTableOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].VirtualAddress;
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwExportTableOff, &dwExportTableOff))
			{
				return iRetStatus;
			}
			DWORD dwDllNameOff=0x0;
			if(!m_pMaxPEFile->ReadBuffer(&dwDllNameOff, dwExportTableOff + 0xC, 0x04, 0x04))
			{
				return iRetStatus;
			}
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDllNameOff, &dwDllNameOff))
			{
				return iRetStatus;
			}
			if(GetBuffer(dwDllNameOff,sizeof(bSigICS),sizeof(bSigICS)))
			{
				if(memcmp(&m_pbyBuff[0x0],bSigABR,sizeof(bSigABR)) == 0 || memcmp(&m_pbyBuff[0x0],bSigABR1,sizeof(bSigABR1)) == 0 || 
					memcmp(&m_pbyBuff[0x0],bSigATG,sizeof(bSigATG)) == 0 || memcmp(&m_pbyBuff[0x0],bSigATH,sizeof(bSigATH)) == 0 ||
					memcmp(&m_pbyBuff[0x0],bSigBTI,sizeof(bSigBTI)) == 0 || memcmp(&m_pbyBuff[0x0],bSigBUA,sizeof(bSigBUA)) == 0 ||
					memcmp(&m_pbyBuff[0x0],bSigABT,sizeof(bSigABT)) == 0 || memcmp(&m_pbyBuff[0x0],bSigICS,sizeof(bSigICS)) == 0)
				{
					if(_tcslen(szVirusName) > 0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSinowalORC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Sinowal Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSinowalORC()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	bool bIsDll = false;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		bIsDll = true;

	if(((m_wNoOfSections == 0x4 && bIsDll == false) || (m_wNoOfSections == 0x5 && bIsDll == true)) && m_wAEPSec == 0x0 && (m_dwAEPUnmapped & 0xF000)== 0x2000 && m_dwAEPMapped == m_dwAEPUnmapped
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xB000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int SINOWAL_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[SINOWAL_BUFF_SIZE];
		if(!m_pbyBuff)
			return iRetStatus;
		BYTE byPreChk[] = {0x2B, 0xC0, 0x83, 0xC0, 0xFF, 0x50, 0x83, 0xE8, 0x01, 0x50, 0x48, 0x50, 0x6A, 0x00};
 		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], 0x1000, sizeof(byPreChk), sizeof(byPreChk)))
			return iRetStatus;
		if(memcmp(&m_pbyBuff[0], byPreChk, sizeof(byPreChk))!= 0x0)
			return iRetStatus;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], m_pSectionHeader[0x1].PointerToRawData + 0xA0, SINOWAL_BUFF_SIZE, SINOWAL_BUFF_SIZE))
			return iRetStatus;
		
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szSinowalOrc = (_T("6E616C706867696E*526563687473616E77616C7420506C616E696572726175706520526563687473616E77616C74*526563687473616E77616C74006469622D302D676962"));
		objdbscan.LoadSigDBEx(szSinowalOrc, _T("Backdoor.Sinowal.ORC"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SINOWAL_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormBenjaminA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Benjamin.A Family
					  Uses Kazaa P2P network to spread itself.
					  Then copies itself in C:\Windows\system as "EXPLORER.SCR" & also ensures its autorun entry.	
					  Creates directory %WinDir%\Temp\Sys32 & fills it with copies of itself with names contained in body of worm.
					  Also attempts to open foll. website "benjamin.xww.de"
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormBenjaminA()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x9 || m_wNoOfSections == 0xA) && m_dwAEPMapped == m_dwAEPUnmapped &&
		m_dwAEPUnmapped == 0x32858 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x32000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BENJAMINA_BUFF_SIZE = 0x400;
		m_pbyBuff = new BYTE[BENJAMINA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const BYTE bBENJAMINA_SIG[]= {0x53,0x79,0x73,0x74,0x72,0x61,0x79,0x00,0x4B,0x61,0x7A,0x6F,0x61};// Systray.Kazoa
		DWORD dwReadOff = 0x0;
		if(m_pMaxPEFile->ReadBuffer(&dwReadOff,m_dwAEPMapped + 0x24,sizeof(DWORD),sizeof(DWORD)))
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOff - m_dwImageBase,&dwReadOff))
			{
				return iRetStatus;
			}
		}
		if(!GetBuffer(dwReadOff,sizeof(bBENJAMINA_SIG),sizeof(bBENJAMINA_SIG)))
		{
			return iRetStatus;
		}
		if(memcmp(&m_pbyBuff[0x0],bBENJAMINA_SIG,sizeof(bBENJAMINA_SIG)) == 0)
		{
			if(!GetBuffer(m_dwAEPMapped - 0xF00,BENJAMINA_BUFF_SIZE,BENJAMINA_BUFF_SIZE))
			{
				return iRetStatus;
			}
			CSemiPolyDBScn	polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			LPCTSTR	szWormBenjaminA = (_T("5C74656D705C7379733332*5C53595354454D5C4558504C4F5245522E534352*737973636F64*416363657373206572726F7220233033413A39343537343A*62656E6A616D696E2E7877772E6465"));
			                          // \temp\sys32*\SYSTEM\EXPLORER.SCR*syscod*Access error #03A:94574:*benjamin.xww.de
			polydbObj.LoadSigDBEx(szWormBenjaminA, _T("P2P.Worm.Benjamin.A"),FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], BENJAMINA_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorDonbotB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of Donbot Family
					  Related INF Sig : INF.WIN32.Autorun_0=5B4175746F52756E5D5368654C6C5C6558704C6F72455C434F6D6D614E64203D20746E6D622E7069665368656C6C5C4F70654E5C634F6D4D616E44203D746E6D622E7069*664F70656E3D20746E6D622E7069665368656C6C5C4F70656E5C64456661756C743D315348656C6C5C4155744F506C61595C636F6D6D616E44203D20746E6D622E706966
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorDonbotB()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if((m_wAEPSec == 0x0 || m_wAEPSec == m_wNoOfSections - 0x2 || m_wAEPSec == m_wNoOfSections - 0x1) 
		&& (m_wNoOfSections >= 0x3 && m_wNoOfSections <= 0x9) && 
		((m_dwAEPUnmapped & 0xF000) == 0x5000  || (m_dwAEPUnmapped & 0xF00000) == 0x700000)&& 
		((m_pSectionHeader[0x0].SizeOfRawData >= 0x4800 && m_pSectionHeader[0x0].SizeOfRawData <= 0x5A00) ||
		m_pSectionHeader[0x0].Misc.VirtualSize == 0x485E ||
		m_pSectionHeader[0].Misc.VirtualSize == m_pSectionHeader[0].SizeOfRawData))
	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int DONBOTB_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[DONBOTB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0xDB0,DONBOTB_BUFF_SIZE,DONBOTB_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR	szBackdoorDonbotB = (_T("76403B4D14720233C98B450C33D2BBE80300000FB6040103C7F7F38B5D080FB6041E2BC2*790FBAFF0000002BD0C1EA*C1E20803C288041E414683C7093B751072C0"));
		                         
		polydbObj.LoadSigDBEx(szBackdoorDonbotB, _T("Backdoor.Donbot.B"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], DONBOTB_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorAgentUEK
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.UEK Family
					  Also drops non-malicious file 'addon.dat' at foll location %AppData% & tries to connect to a remote server.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorAgentUEK()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections <= 0x6 && m_dwAEPUnmapped == 0x75E9 && (m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x67F2 ||
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == m_pSectionHeader[m_wAEPSec].SizeOfRawData ||
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x67F2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0xA000)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int AGENTUEK_BUFF_SIZE  = 0x60;
		m_pbyBuff = new BYTE[AGENTUEK_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_dwAEPMapped - 0x184,AGENTUEK_BUFF_SIZE,AGENTUEK_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szBackdoorAgentUEK = (_T("08C20FAFC885EF0FA5C1B959B89BF287CA41F7D1F2EB01D1808030104000D9403D0060000072D9*88C223CF0FC9C7C11190138AEB01490FCAEB01E9F6DA23CF4169C82948EB028080307040007B403D5F03000072D2"));
		objdbscan.LoadSigDBEx(szBackdoorAgentUEK, _T("Backdoor.Agent.uek"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTUEK_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorFinloskyB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Finlosky.B Family
					  - Create Mutex DC_MUTEX-F54S21D
    				  - The following Host Names were requested from a host database:
       						 - 192.5.5.241
       						 - sesar005.no-ip.org
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorFinloskyB()
{
	int	iRetStatus = VIRUS_NOT_FOUND;
	if((m_dwAEPUnmapped == 0x8C87C || m_dwAEPUnmapped == 0x8BE24) && (m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize % 2 == 0))
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}

		const int FINLOSKYB_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[FINLOSKYB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped, 0x5, 0x5))
		{
			if(m_pbyBuff[0] == 0x68)
			{
				m_dwAEPMapped = *(DWORD *)&m_pbyBuff[1] - m_dwImageBase;

				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_dwAEPMapped,&m_dwAEPMapped))
				{
					return iRetStatus;
				}
			}

			if(!GetBuffer(m_dwAEPMapped + 0xB04, FINLOSKYB_BUFF_SIZE, FINLOSKYB_BUFF_SIZE))
			{
				return iRetStatus;
			}
			TCHAR FINLOSKYB_SIG[] = {_T("753868A0D948008D95C8FEFFFF33C0E8041EF8FF*B5C8FEFFFF68C8D948008D85CCFEFFFFBA03000000E80985F7FF8B85CCFEFF")};
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};
			polydbObj.LoadSigDBEx(FINLOSKYB_SIG, _T("Trojen.Backdoor.Finlosky.b"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], FINLOSKYB_BUFF_SIZE, szVirusName) >= 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectChydoAXA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Chydo.AXA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectChydoAXA()
{
	int iReturn = VIRUS_NOT_FOUND;

	if (m_dwAEPMapped == 0x2865 && m_wAEPSec == 0x0 && 
	   (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) &&
	    m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CHYDO_BUFF_SIZE = 0x70;

		m_pbyBuff = new BYTE[CHYDO_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iReturn;
		}

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x75, CHYDO_BUFF_SIZE, CHYDO_BUFF_SIZE))
		{
			return iReturn;
		}
		
		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};

		TCHAR szCHYDO_Sign[] = {_T("2BC12B45E48845EB0FBE153CF0460081C21A01000088153CF046006A008D45F0506A018D*0FBE053CF04600051A010000A23CF046008B4DEC034DF0894DECEB")};// Decryption loop for dropped file

		objdbscan.LoadSigDBEx(szCHYDO_Sign, _T("Trojan.Chydo.axa"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], CHYDO_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iReturn;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderLMN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Downloader.LMN Family
					  A. Installation:	
						- Download DialogBox download exe and install itself and aslo download another 2 application. 
						- Related to Mail.Ru. 
						- Toolbar(MailRU) to IE.
					  Covered Variants:
						1. Downloader.LMN.gjxy		Detected by .gjyc
						2. Downloader.LMN.gjyb		Detected by .gjxm
						3. Downloader.LMN.gkak		Detected by .gjxm
						4. Downloader.LMN.gkdj		Detected by .gkem
						5. Downloader.LMN.gkdr		Detected by .gkem
						6. Downloader.LMN.gkdt
						7. Downloader.LMN.gkec		Detected by .gkem
						8. Downloader.LMN.glun		Detected by .gjyt
						9. Downloader.LMN.gluo		Detected by .glul
						10.Downloader.LMN.glup		Detected by .glul
						11.Downloader.LMN.gluq		Detected by .glul
						12.Downloader.LMN.gmbm		Detected by .gjxm
						13.Downloader.LMN.wp
						14.Downloader.LMN.wy		Detected by Loadmoney.f
						15.Downloader.LMN.xb		Detected by Loadmoney.f & .gen
						16.Downloader.LMN.yx		Detected by Loadmoney.f		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderLMN()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	//---------------------------------Downloader.LMN.it-----------------------------------
	if(m_wNoOfSections == 0x7 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1140 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8C00 
		&& ((m_pSectionHeader[m_wNoOfSections -1].SizeOfRawData & 0xF000)== 0x4000 || (m_pSectionHeader[m_wNoOfSections -1].SizeOfRawData & 0xF000) == 0x2000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x60;
		DWORD dwReadBuffOffset = 0x0;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_dwAEPUnmapped + 0x2DD, &dwReadBuffOffset)) 
		{
				return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szDwnldLMNit = (_T("83FE02750466BE040089C899F7FB8B1CF5*A0400089D031C399891CCF8B04F5*A040004631D08944CF04413B4DE48D59087CCC8B75E48B5DD4C1E602893424E82E71000031D2EB078A0C57880C104239F27CF5")); //LLC Mail.Ru1.0 * http://mail.ru/0 4C4C43204D61696C2E5275311430*687474703A2F2F6D61696C2E72752F30
		objdbscan.LoadSigDBEx(szDwnldLMNit, _T("not-a-virus:Downloader.LMN.it"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}//---------------------------------Downloader.lmn.mlkd--------------------------------
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0484 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x78600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x30;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x77119, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("5231D28A1508D0470030135AA134D04700*8A1508D04700001033C0A074CE47008A806CCE4700A278CE4700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.mlkd"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//---------------------------------Downloader.LMN.wi-----------------------------------
	else if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xB51A && ((m_wNoOfSections == 0x05 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17600 && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2600)
		||(m_wNoOfSections == 0x03 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x21000 && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x6400 && memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 0x4) == 0)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x200;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x1].PointerToRawData + 0x23A0;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_wNoOfSections == 0x03)
			dwReadBuffOffset = m_dwAEPMapped + 0xFE86;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szDwnldLMNit = (_T("44006F0077006E006C006F0061006400650072002E006C006F0067*2D00530054004100520054002D*2F00760065007200730069006F006E*440077006E006C006F0061006400650072002E006E00650074")); //D.o.w.n.l.o.a.d.e.r...l.o.g * -.S.T.A.R.T.- * /.v.e.r.s.i.o.n * D.w.n.l.o.a.d.e.r...n.e.t
		objdbscan.LoadSigDBEx(szDwnldLMNit, _T("not-a-virus:Downloader.LMN.iw"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}//---------------------------------Downloader.LMN.mh-----------------------------------
	else if(m_wAEPSec == 0x0 && ((m_wNoOfSections == 0x07 && m_dwAEPUnmapped == 0x1140 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2600))
		||(m_wNoOfSections == 0x08 && m_dwAEPUnmapped == 0x14B0 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3200))
		||(m_wNoOfSections == 0x06 && (0x186C == m_dwAEPUnmapped || 0x1870 == m_dwAEPUnmapped) && (0x1A600 == m_pSectionHeader[m_wAEPSec].SizeOfRawData || 0x19C00 == m_pSectionHeader[m_wAEPSec].SizeOfRawData)))
		&& ((m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData & 0xF0FF) == 0x2000 || m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x4A00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x300;
		DWORD dwReadBuffOffset = 0x1600;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_wNoOfSections == 0x08)
		{
			dwReadBuffOffset = 0x1700;
		}
		else if(m_wNoOfSections == 0x06)
		{
			dwReadBuffOffset = 0x2600;
		}
		
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadBuffOffset, &dwReadBuffOffset)) 
		{
			return iRetStatus;
		}
		
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szDwnldLMNmh1 = (_T("3204D51C404000*8844D305*3204D51D404000*8844D307*3204D51E404000*8844D304*3204D51F404000*8844D306")); //Decryption Loop instructions.
		LPCTSTR  szDwnldLMNmh2 = (_T("320CD520504000*884CD305*320CD521504000*884CD307*320CD522504000*884CD304*320CD523504000*884CD306")); //
		LPCTSTR  szDwnldLMNmh3 = (_T("8844D3FD*8A04D511504000*8844D3FF*8A04D512504000*8844D3FC*8A04D513504000*8844D3FE*8A04D514504000")); //
		LPCTSTR  szDwnldLMNmh4 = (_T("3204D520504000*8844D305*3204D521504000*8844D307*3204D522504000*8844D304*3204D523504000*8844D306"));
		LPCTSTR  szDwnldLMNmh5 = (_T("320CD51C404000*884CD305*320CD51D404000*884CD307*320CD51E404000*884CD304*320CD51F404000*884CD306"));
		LPCTSTR  szDwnldLMNmh6 = (_T("3214CD11504000*8854C8FF*3214CD12504000*8854C8FC*3214CD13504000*8854C8FE*3214CD14504000*8854C8F9"));
		LPCTSTR  szDwnldLMNmh7 = (_T("890577E04100890D4AE04100891DF8E0410089C38BE55DC3*74646D2B2B777977716A2D00647376622D2D7A2D79372D6A366F34006E732D62"));
		LPCTSTR  szDwnldLMNmh8 = (_T("73006E003500620033006D000000000061362B30726C7A0064007300620061*68003900390065002B003500690066006F0036003200610023006C"));

		objdbscan.LoadSigDBEx(szDwnldLMNmh8, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh7, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh6, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh5, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh4, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh3, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh2, _T("not-a-virus:Downloader.LMN.mh"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNmh1, _T("not-a-virus:Downloader.LMN.mh"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}//---------------------------------Downloader.LMN.anwj-----------------------------------
	else if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xF7F6 && ((m_wNoOfSections == 0x5 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1DA00)
		||(m_wNoOfSections == 0x3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x26000)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x300;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x1].PointerToRawData + 0x3A20;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_wNoOfSections == 0x3)
		{
			dwReadBuffOffset = m_dwAEPMapped + 0x1322A;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szDwnldLMNanwj = (_T("500069006E007300740061006C006C00000000005A006F006E0061*640077006E006C006F0061006400650072005F*7700650062005F00730065007400750070005F006D0075007400650078")); //P.i.n.s.t.a.l.l.....Z.o.n.a * d.w.n.l.o.a.d.e.r._ *w.e.b._.s.e.t.u.p._.m.u.t.e.x
		objdbscan.LoadSigDBEx(szDwnldLMNanwj, _T("not-a-virus:Downloader.LMN.anwj"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}//---------------------------------Downloader.LMN.a-----------------------------------
	else if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && ((m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13E00 && m_dwAEPUnmapped == 0x7409) 
		|| (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14800 &&  m_dwAEPUnmapped == 0x7A21)
		|| (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14600 &&  m_dwAEPUnmapped == 0x773E)
		|| (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4400 &&  m_dwAEPUnmapped == 0x19B4)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x280;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x3].PointerToRawData + 0x2D0;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(m_dwAEPUnmapped == 0x7A21 || m_dwAEPUnmapped == 0x773E)
		{
			dwReadBuffOffset = m_pSectionHeader[0x3].PointerToRawData + 0xD50;
		}

		if(m_dwAEPUnmapped == 0x19B4)
		{
			dwReadBuffOffset = m_pSectionHeader[0x1].PointerToRawData + 0x300;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szDwnldLMNa0 = (_T("6C6F61646D6F6E65792E7275*2F6765745F646F776E6C6F61645F786D6C3F6964")); //loadmoney.ru * /get_download_xml?id
		LPCTSTR  szDwnldLMNa1 = (_T("696E7465726E65746D61696C72752E63646E6D61696C2E7275*496E7465726E65742E657865*766F66666B612E636F6D")); //internetmailru.cdnmail.ru * Internet.exe * voffka.com
		if(m_dwAEPUnmapped == 0x19B4)
			objdbscan.LoadSigDBEx(szDwnldLMNa1, _T("not-a-virus:Downloader.LMN.a"), FALSE);
		else
			objdbscan.LoadSigDBEx(szDwnldLMNa0, _T("not-a-virus:Downloader.LMN.a"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}//---------------------------------Downloader.LMN.qh-----------------------------------
	else if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x0 && ((m_dwAEPUnmapped & 0xFF00) == 0x1700 || (m_dwAEPUnmapped & 0xFF00) == 0x1800 || (m_dwAEPUnmapped & 0xFF00) == 0x1600) &&
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF000) == 0x2000 || (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E00 && (m_dwAEPUnmapped & 0xFF00) == 0x1700)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x200;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x0].PointerToRawData + 0x150;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const BYTE byCheck1[] = {0x35, 0xF4, 0x01, 0x00, 0x00, 0xA3};
		for(int i = 0; i < (0x100 - sizeof(byCheck1)); i++)
		{
			if(memcmp(&m_pMaxPEFile->m_byAEPBuff[i], byCheck1, sizeof(byCheck1)) == 0x0)
			{
				if(!GetBuffer(dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
				{
					return iRetStatus;
				}
				for(i = 0x0; i < DOWNLDLMN_BUFF_SIZE; i++)
				{
					if(m_pbyBuff[i] == 0x8B && m_pbyBuff[i + 1] == 0x15 && m_pbyBuff[i + 6] == 0xA1 && m_pbyBuff[i + 0x11] == 0x01 && m_pbyBuff[i + 0x12] == 0xC2)
					{
						if(m_pbyBuff[i + 0x22] == 0x31 && m_pbyBuff[i + 0x23] == 0xC8 && m_pbyBuff[i + 0x24] == 0x88 && m_pbyBuff[i + 0x25] == 0x02 && m_pbyBuff[i + 0x33] == 0x75 && m_pbyBuff[i + 0x34] == 0xCB)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Downloader.LMN.qh"));
							return VIRUS_FILE_DELETE;
						}
					}
				}
			}
		}
	}//---------------------------------Downloader.LMN.moih-----------------------------------
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0424 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x78400)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x170;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x0].PointerToRawData + 0x76B66;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNmoih = (_T("8A0D08E04700300B59A134E047008A1508E04700001033C0A0CCCF47008A80C4CF4700A2D0CF4700*893D87A04700C7059FA04700E302010081C3C800000083F8FF7E12C705D3A047002B6C0100890D87A04700EB14C70527A04700*4D290100C70584A04700EF720100890D87A047005850FF3534E047005331DB595BEB022B318A0DD0CF4700300B803DCCCF4700")); //Downloader.lmn.moih
			objdbscan.LoadSigDBEx(szDwnldLMNmoih, _T("not a virus:Downloader.LMN.moih"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//---------------------------------Downloader.LMN.aee-----------------------------------
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0428&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x78200)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x60;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x0].PointerToRawData + 0x76D5E;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNAee = (_T("8A0D08E04700300B59A134E047008A1508E04700001033C0A018D147008A8010D14700*A21CD1470089C6893D86A04700891DEDA047005850FF3534E04700*5331DB595BEB022B318A0D1CD14700300B803D18D147000076")); //Downloader.lmn.Aee
			objdbscan.LoadSigDBEx(szDwnldLMNAee, _T("not a virus:Downloader.LMN.aee"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}//---------------------------------Downloader.LMN.orkj-----------------------------------
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0490 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x74000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x6E;
		DWORD dwReadBuffOffset = m_pSectionHeader[0x0].PointerToRawData + 0x72942;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNOrkj = (_T("8A150880470088D281FA21120C0074023013425AA1348047008A1508804700001033C0A074784700*8A806C784700A278784700890DED504700895C24E88B4C240C894424EE5B53FF3534804700*425331DB595BEB0341011931C9020D787847005089D8300858803D7478470000")); //Downloader.lmn.orkj
			objdbscan.LoadSigDBEx(szDwnldLMNOrkj, _T("not a virus:Downloader.LMN.orkj"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}////////////////////////////////////////////////Santosh code for Downloader.Lmn family//////////////////////////////
	else if(m_wNoOfSections == 0x6 && (m_dwAEPMapped ==0x0424 ||m_dwAEPMapped ==0x04A4) &&(m_pSectionHeader[0].SizeOfRawData == 0x78600 ||m_pSectionHeader[0].SizeOfRawData == 0x77C00))
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x65;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x76B08, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("5231D28A1508D0470030135AA134D047008A1508D04700001033C0A0*4133318A0D04C04700300B803D00C0")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mwtp"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x04AC &&m_pSectionHeader[0].SizeOfRawData == 0x79800)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x781EE, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("5231D28A1504F0470030135AA130F047008A1504F04700001033C0*4133318A0D1CE24700300B803D18E247")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mvxg"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x049C &&m_pSectionHeader[0].SizeOfRawData == 0x76E00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x8B;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x76019, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("5231D28A1508C0470030135AA134C047008A1508C047000010*4133318A0DE8AF4700300B803DE4AF")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mres"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0484 &&m_pSectionHeader[0].SizeOfRawData == 0x78800)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x65;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x773CB, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("5231D28A1508D0470030135AA134D047008A1508D04700001033C0A0*4133318A0DD4CD4700300B803DD0CD47")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mplm"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0424 &&m_pSectionHeader[0].SizeOfRawData == 0x78E00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x85;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x779A4, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08E04700300B59A134E047008A1508E04700001033*2B318A0DACD04700300B803DA8D04700")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mjxq"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0424 &&m_pSectionHeader[0].SizeOfRawData == 0x78C00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x90;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x778DF, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08D04700300B59A134D047008A1508D04700001033C0*2B318A0D28CE4700300B803D24CE4700")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mjip"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0424 &&m_pSectionHeader[0].SizeOfRawData == 0x79000)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x65;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x77A63, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08D04700300B59A134D047008A1508D04700001033C0*2B318A0DB4CE4700300B803DB0CE4700")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.mirt"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections != 0x6 && m_dwAEPMapped !=0x0418 &&m_pSectionHeader[0].SizeOfRawData != 0x1A800)
	{		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x75;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x15B3B, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("8A050450420029DA28C23006A1F85042008A1504504200001033C0*31C0300520104200A06C27420000C3593001890D2E104200803D68274200")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.gjxm"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0A5C &&m_pSectionHeader[0].SizeOfRawData == 0x69400)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0xA0;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x67232, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("3013425AA134E046008A1508E04600001033C0*5A300858803DA8D64600")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.age"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0960 &&m_pSectionHeader[0].SizeOfRawData == 0x69400)
	{	
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x90;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x67305, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("3013425AA134E046008A1508E046000010*5A300858803DE0D4460000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.agb"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0AA8 &&m_pSectionHeader[0].SizeOfRawData == 0x6BE00)
	{

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x45;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x6A76E, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("3013425AA1340047008A1508004700001033C0*A04CF646008A8044F64600A250F646008D1530D04600*C7421051000000893D56D04600890567D046005B53FF3534004700")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.afq"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0973 &&m_pSectionHeader[0].SizeOfRawData == 0x65E00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x64B79, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("3013425AA134A046008A1508A046000010*33C0A0609446008A8058944600A264944600*890531704600803DDC70460000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.afm"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0424 &&m_pSectionHeader[0].SizeOfRawData == 0x79A00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x5D;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x78314, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08E04700300B59A134E047008A1508E04700001033C0A038DF4700*8A8030DF4700A23CDF47008D3DD1B04700C7471CAF0000008D05F3B04700*89580466C705D2B047003BBE89350AB147005850FF3534E047005331DB595BEB02")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.aek"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0428 &&m_pSectionHeader[0].SizeOfRawData == 0x78400)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x76F5F, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08E04700300B59A134E047008A1508E04700*001033C0A0DCCF47008A80D4CF4700A2E0CF470085DB7519")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.aec"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x042C &&m_pSectionHeader[0].SizeOfRawData == 0x78400)
	{

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x77294, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("518A0D08D04700300B59A134D04700*8A1508D04700001033C0A00CCE47008A8004CE4700A210CE470089058FA0470081EFA2000000*8935DDA047005850FF3534D047005331DB595BEB02")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.adx"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped ==0x0400 &&m_pSectionHeader[0].SizeOfRawData == 0x40A00)
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int LMN_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

		if(GetBuffer(0x3F71D, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
		{
			TCHAR LMN_CZ_Sig[] = {_T("4B8A050850440000C33006A12C5044008A150850440000*1033C0A0504344008A8048434400A254434400891590204400")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(LMN_CZ_Sig, _T("Downloader.Lmn.acw"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMN_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0424 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x78600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

			const int DOWNLDLMN_BUFF_SIZE  = 0x25;
			
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};

			if(GetBuffer(0x77228, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				LPCTSTR  szDwnldLMNOrkj = (_T("518A0D08E04700300B59A134E047008A1508E04700001033C0*A0FCD047008A80F4D04700"));
				objdbscan.LoadSigDBEx(szDwnldLMNOrkj, _T("Downloader.lmn.ndrn"), FALSE);

				if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
					}
				}
			}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0C28 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x68A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

			const int DOWNLDLMN_BUFF_SIZE  = 0x25;
			
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};

			if(GetBuffer(0x66B07, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				LPCTSTR  szDwnldLMNOrkj = (_T("3013425AA134D046008A1508D04600001033C0*A0B8C646008A80B0C64600A2BCC6460089CA"));
				objdbscan.LoadSigDBEx(szDwnldLMNOrkj, _T("Downloader.lmn.rlgp"), FALSE);

				if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
					}
				}
			}
	}
	else if(m_wNoOfSections == 0x6 && m_dwAEPMapped==0x0478 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x75C00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

			const int DOWNLDLMN_BUFF_SIZE  = 0x20;
			
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};

			if(GetBuffer(0x74575, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				LPCTSTR  szDwnldLMNOrkj = (_T("3013425AA134A047008A1508A04700001033C0*A0D89A47008A80D09A4700"));
				objdbscan.LoadSigDBEx(szDwnldLMNOrkj, _T("Downloader.lmn.obki"), FALSE);

				if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
					}
				}
			}
	}
	else if(m_wNoOfSections == 0x8 && m_dwAEPMapped==0x0DA8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x64C00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

			const int DOWNLDLMN_BUFF_SIZE  = 0x20;
			
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};

			if(GetBuffer(0x63F14, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				LPCTSTR  szDwnldLMNOrkj = (_T("74023013425AA1349046008A1508904600001033C0*A0888446008A8080844600A28C844600"));
				objdbscan.LoadSigDBEx(szDwnldLMNOrkj, _T("Downloader.lmn.qncf"), FALSE);

				if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
					}
				}
			}
	}
	else if(m_dwAEPMapped==0x09B8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x69A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x22;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x68112, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("8A1508E0460088D281FA001C0E0074023013*425AA134E046008A1508E046000010"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.pvwq"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x09D4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x67600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x20;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x65ADF, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNQjxs = (_T("3013425AA134C046008A1508C04600001033C0*A0F4B546008A80ECB54600"));
			objdbscan.LoadSigDBEx(szDwnldLMNQjxs, _T("Downloader.lmn.qjxs"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x04A0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x75A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x40;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x748A6, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("8A1508A0470088D281FA21120C0074023013425AA134A04700*8A1508A04700001033C0A0949847008A808C984700A298984700893DE7704700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.ocso"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x048C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x77E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x30;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x76F31, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("5231D28A1508D0470030135AA134D04700*8A1508D04700001033C0A074BF47008A806CBF4700A278BF4700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.mmdl"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x049C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x75E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x35;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x74C1E, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("8A1508A0470088D281FA21120C0074023013425AA134A04700*8A1508A04700001033C0A0689847008A8060984700A26C984700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.ocfx"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x04B4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x75C00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x40;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x745BF, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("8A1508A0470088D281FA21120C0074023013425AA134A04700*8A1508A04700001033C0A0209947008A8018994700A224994700FF05E6704700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.oeda"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_dwAEPMapped==0x04C0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x76A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int DOWNLDLMN_BUFF_SIZE  = 0x35;

		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};

		if(GetBuffer(0x75357, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			LPCTSTR  szDwnldLMNPvwq = (_T("8A1508B0470088D281FA21120C0074023013425A*A134B047008A1508B04700001033C0A0E4A847008A80DCA84700A2E8A84700"));
			objdbscan.LoadSigDBEx(szDwnldLMNPvwq, _T("Downloader.lmn.ofbl"), FALSE);

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}


	

	////////////////////////////////////////////////Santosh code ended//////////////////////////////


	//-------------------------Downloader.LMN.a, Gen, Lv--------------------
	DWORD dwSRD = m_pSectionHeader[m_wAEPSec].SizeOfRawData;
	if(m_wAEPSec == 0x0 && (m_dwAEPUnmapped == 0x1140 || m_dwAEPUnmapped == 0x1160) && m_wNoOfSections == 0x7 &&
		((dwSRD & 0xF0FF) == 0x1000 || (dwSRD & 0xF0FF) == 0x2000 || (dwSRD & 0xF0FF) == 0x3000 || (dwSRD & 0xF0FF) == 0x4000 || (dwSRD & 0xF000) == 0x5000 || (dwSRD & 0xF000) == 0x6000 || (dwSRD & 0xF000) == 0x8000 || (dwSRD & 0xF000) == 0x9000
		|| (dwSRD & 0xF0FF) == 0xA000 || (dwSRD & 0xF0FF) == 0xB000 || (dwSRD & 0xF0FF) == 0xC000 || (dwSRD & 0xF0FF) == 0xD000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int DOWNLDLMN_BUFF_SIZE  = 0x200;
		DWORD dwReadBuffOffset = 0x1020;
		m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadBuffOffset, &dwReadBuffOffset)) 
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		DWORD	dwLength = 0, dwOffset = (m_dwAEPUnmapped - 0x1020), dwHits = 0, dwCall2 = 0x0, dwLastCall;
		int iInstCnt = 0x0, iTempInstCnt = 0x0;
		t_disasm da = {0};
		while(dwOffset < DOWNLDLMN_BUFF_SIZE)
		{
			iInstCnt++;
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);   
			if(dwLength > DOWNLDLMN_BUFF_SIZE - dwOffset)
				break;

			if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x0 && m_pbyBuff[dwOffset + dwLength] == 0x90)
			{
				dwOffset = 0x0;
				dwHits++;
				continue;
			}
			else if(dwLength == 0x01  && strstr(da.result,"PUSH EBP") && dwHits == 0x1)
			{
				dwHits++;
			}

			else if(dwLength == 0x02  && strstr(da.result,"CALL EAX") && dwHits == 0x2)
			{
				dwHits++;
			}

			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x3 && m_pbyBuff[dwOffset + dwLength] == 0xE8)
			{
				iTempInstCnt = iInstCnt;
				dwCall2 = *(DWORD*)&m_pbyBuff[dwOffset + 0x1] + dwLength + dwOffset + 0x1020;
				dwHits++;
			}
			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x4 && (iInstCnt - iTempInstCnt == 0x1) && m_pbyBuff[dwOffset - dwLength] == 0xE8)
			{
				
				if((*(DWORD*)&m_pbyBuff[dwOffset + 0x1] + dwLength + dwOffset + 0x1020) - dwCall2 == 0x570)
					dwHits++;
				else 
					break;
			}
			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x5 && m_pbyBuff[dwOffset + dwLength] == 0x83)
				dwHits++;
			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x6 && m_pbyBuff[dwOffset - 0x3] == 0x83)
			{
				dwCall2 = *(DWORD*)&m_pbyBuff[dwOffset + 0x1] + dwLength + dwOffset + 0x1020;
				dwHits++;
			}
			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x7 && m_pbyBuff[dwOffset + dwLength] == 0x89 && m_pbyBuff[dwOffset + dwLength + 0x2] == 0xE8)
			{
				dwLastCall = *(DWORD*)&m_pbyBuff[dwOffset + 0x1] + dwLength + dwOffset + 0x1020;
				if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwLastCall, &dwReadBuffOffset)) 
				{
					return iRetStatus;
				}

				if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, 0x40, 0x40))
				{
					return iRetStatus;
				}

				dwOffset = 0x0;
				dwHits++;
				continue;
			}
			else if(dwLength == 0x05  && strstr(da.result,"CALL ") && dwHits == 0x8 && m_pbyBuff[dwOffset + dwLength] == 0xE8)
			{
				if(dwCall2 == (*(DWORD*)&m_pbyBuff[dwOffset + 0x1] + dwLength + dwOffset + dwLastCall))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Downloader.LMN.a"));
					return VIRUS_FILE_DELETE;
				}
				else 
					break;
			}
			dwOffset += dwLength;
		}
	}
	//-------------------------Downloader.LMN.wb, .wc, .ug------------------------
	bool bDelphi = false, bTemp = false;
	if(m_wNoOfSections == 0x6 && (memcmp(m_pSectionHeader[m_wAEPSec].Name, "CODE", 4) == 0 || memcmp(m_pSectionHeader[m_wAEPSec].Name, "C0DE", 4) == 0 || memcmp(m_pSectionHeader[m_wAEPSec].Name, "C9DE", 4) == 0 ||  (memcmp(m_pSectionHeader[m_wAEPSec].Name, ".text", 5) == 0 ||  memcmp(m_pSectionHeader[0x1].Name, "DATA", 4) == 0)) && m_wAEPSec == 0x0)
	{
		bDelphi = true;
		//-------------------------Downloader.LMN.wb, .wc-------------------------
		if(((m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17A00 && m_dwAEPUnmapped == 0x18770)
			||(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18400 && m_dwAEPUnmapped == 0x190F4)))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff =NULL;
			}
			const int DOWNLDLMN_BUFF_SIZE  = 0x200;
			DWORD dwReadBuffOffset = m_pSectionHeader[0].PointerToRawData + 0x500;
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			if(m_dwAEPUnmapped == 0x190F4) // wb
				dwReadBuffOffset += 0x100;

			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};
			LPCTSTR  szDwnldLMNwb = (_T("66C7055CA041008C5B2905D7A04100*8A0D04C0410029DA3008A1C0C141008A1504C04100001033C0A070B84100*C6058BA04100F6890D99A04100")); //Loop
			LPCTSTR  szDwnldLMNwc = (_T("66C7055A9041008E278D05BD9041002938*8A0D04B0410029DA3008A110B241008A1504B04100001033C0A0ACA74100*66C705C29041002DCF89056E904100")); //Loop
			if(m_dwAEPUnmapped == 0x190F4)
			{
				objdbscan.LoadSigDBEx(szDwnldLMNwb, _T("not-a-virus:Downloader.LMN.wb"), FALSE);
			}
			else
			{
				objdbscan.LoadSigDBEx(szDwnldLMNwc, _T("not-a-virus:Downloader.LMN.wc"), FALSE);
			}

			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}//-------------------Downloader.LMN.ug & joky (Ransom.Foreign.joky)--------------------------------
		else if(((m_dwAEPUnmapped == 0x18F1C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1D000)
			||(m_dwAEPUnmapped == 0x100C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19E00)))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff =NULL;
			}
			const int DOWNLDLMN_BUFF_SIZE  = 0x80;
			DWORD dwReadBuffOffset = m_pSectionHeader[0].PointerToRawData + 0x330;
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			if(m_dwAEPUnmapped == 0x100C)	// Ransom.Foreign.joky
				dwReadBuffOffset += 0x120;

			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};
			LPCTSTR  szDwnldLMNug	= (_T("6B005F0023006600630000006F0067007800370032005F0034006B007200640066006E*7700340079006300770078006C0000003400630067006C006E002D007200340064"));		// File names Scr and Dest while copying
			LPCTSTR  szDwnldLMNjoky = (_T("770061006B00780035006700760064006200780023*2B007200690071003200000077006E007A00780077002D0079002D*64007400740039006F006D006D0071007700390077002D")); // File names Scr and Dest while copying
			if(m_dwAEPUnmapped == 0x100C)
				objdbscan.LoadSigDBEx(szDwnldLMNjoky, _T("not-a-virus:Downloader.LMN.joky"), FALSE); // Ransom.Foreign.joky
			else
				objdbscan.LoadSigDBEx(szDwnldLMNug, _T("not-a-virus:Downloader.LMN.ug"), FALSE);
			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}//-------------------Downloader.LMN.gjxm, .gjyc, .gjyt, .gjzo, .gkem
		else if(((m_dwAEPUnmapped == 0x1018 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1A800 || 0x1C200 ==m_pSectionHeader[m_wAEPSec].SizeOfRawData
			|| m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1A200 || 0x2AA00 == m_pSectionHeader[m_wAEPSec].SizeOfRawData || 0x19C00 == m_pSectionHeader[m_wAEPSec].SizeOfRawData) 
			&& (m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2A00 || m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2C00 || 0x4A00 == m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData || 0x25C00 == m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData || 0x3000 == m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData || 0x4000 == m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData))
			|| (m_dwAEPUnmapped == 0x1034 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22000 && m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x25C00)
			|| (m_dwAEPUnmapped == 0x185C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x24000 && m_pSectionHeader[m_wNoOfSections - 1].VirtualAddress == 0x34000)))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff =NULL;
			}
			const int DOWNLDLMN_BUFF_SIZE  = 0x800;
			DWORD dwReadBuffOffset = m_pSectionHeader[0].PointerToRawData + 0xF00;
			m_pbyBuff = new BYTE[DOWNLDLMN_BUFF_SIZE];
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, DOWNLDLMN_BUFF_SIZE, DOWNLDLMN_BUFF_SIZE))
			{
				return iRetStatus;
			}

			CSemiPolyDBScn objdbscan;
			TCHAR szVirusName[MAX_PATH] = {0};
			LPCTSTR  szDwnldLMNgjxm	= (_T("6F2B357663716435666C650063006600740020006E006C*2D00660039007800750079003700650030*38727A6532613423742B00007A0023006F"));		// File names Scr and Dest while copying
			LPCTSTR  szDwnldLMNgjyc = (_T("38386E34657862653463683000000000670062006F007300230062007A006D*65006E00370039006F00700061007700330000006D7A79636F6879")); // File names Scr and Dest while copying
			LPCTSTR  szDwnldLMNgjyt = (_T("646E33796233656877000000663563392D00000062356861*383534717A6D5F70335F0000642035386B352D3677655F5F6C6766206C"));
			LPCTSTR  szDwnldLMNgkem = (_T("390038003500720071006A00690037007500690076*680066003300790079007900340062006A0066006C0061005F006400720061002B006700350032"));
			LPCTSTR  szDwnldLMNgkbs = (_T("61697168666469656A6E672D6577337430656B30*327A6D69306F76236D726C646472776C783663*2D366A7A7369233069306E6D2B747A5F"));
			LPCTSTR  szDwnldLMNglul = (_T("66C70517104200819AC7059410420065600100013D1B104200*66C7053910420008D23A*8935AA10420087155A104200891DFC104200"));
			LPCTSTR  szDwnldLMNmh	= (_T("C70506014200025201008905D4004200C6050A0142003E890D610042008905F6*B82C2A40008945FC8B45FC50E8EBF9FFFF"));
			LPCTSTR  szDwnldLMNgkdt = (_T("390074007800230032006D007A0000002B0061*66003700230076002B0071006A0076007A006D007100200063"));
			LPCTSTR  szDwnldLMNwp	= (_T("5F6C7877777800006800700061007500610079*69006F0062006B002300000000003276393561637634776D7871"));
			
			objdbscan.LoadSigDBEx(szDwnldLMNwp, _T("not-a-virus:Downloader.LMN.wp"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNgkdt, _T("not-a-virus:Downloader.LMN.gkdt"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNgjxm, _T("not-a-virus:Downloader.LMN.gjxm"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNgjyc, _T("not-a-virus:Downloader.LMN.gjyc"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNgjyt, _T("not-a-virus:Downloader.LMN.gjyt"), TRUE); //virus:Downloader.LMN.gjzo, .glum
			objdbscan.LoadSigDBEx(szDwnldLMNgkem, _T("not-a-virus:Downloader.LMN.gkem"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNgkbs, _T("not-a-virus:Downloader.LMN.gkbs"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNglul, _T("not-a-virus:Downloader.LMN.glul"), TRUE);
			objdbscan.LoadSigDBEx(szDwnldLMNmh,	_T("not-a-virus:Downloader.LMN.mh"), FALSE);
			
			if(objdbscan.ScanBuffer(&m_pbyBuff[0], DOWNLDLMN_BUFF_SIZE, szVirusName)>= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
		else if(m_wAEPSec==0x0 && m_wNoOfSections == 0x06 && (m_dwAEPUnmapped & 0xFF0F)== 0x100C && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF0FFF)==0x70400)
				{
		
					if(m_pbyBuff)
					{
						delete []m_pbyBuff;
						m_pbyBuff =NULL;
					}

					DWORD	dwReadOff =m_pSectionHeader[m_wAEPSec].PointerToRawData+0x73D30;
					const int LMN_BUFF_SIZE=0xC10;

					m_pbyBuff = new BYTE[LMN_BUFF_SIZE];

					if(!GetBuffer(dwReadOff, LMN_BUFF_SIZE, LMN_BUFF_SIZE))
					{
						return iRetStatus;
					}

					CSemiPolyDBScn Objdbscan;
					TCHAR szVirusName[MAX_PATH]={0};
					
					if(m_dwAEPUnmapped==0x108C)
					{
						LPCTSTR szDwnldrLmnshi =(_T("8A1508A0470088D281FA21120C0074023013425AA134A047008A1508A047000010*33C0A0E89A47008A80E09A4700A2EC9A470089052870470081E3D500000029CF893511704700*5B53FF3534A04700425331DB595BEB034133318A0DEC9A4700300B803DE89A4700007631"));
					Objdbscan.LoadSigDBEx(szDwnldrLmnshi,_T("not a virus:Downloader.lmn.nshi"),false);
					}

					if(m_dwAEPUnmapped==0x107C)
					{
						
						LPCTSTR szDwnldrLmnojbe =(_T("8A1508B0470088D281FA21120C0074023013425AA134B047008A1508B047000010*33C0A028AA47008A8020AA4700A22CAA4700011D*2A80470083FEFF75108D3DCB804700"));
						Objdbscan.LoadSigDBEx(szDwnldrLmnojbe,_T("not a virus:Downloader.lmn.ojbe"),false);

					}

					
					if(Objdbscan.ScanBuffer(&m_pbyBuff[0],LMN_BUFF_SIZE,szVirusName)>=0)
					{
						if(_tcslen(szVirusName)>0)
						{
							_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
							return VIRUS_FILE_DELETE;
						}
					}
			}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPalevoCqmm
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Palevo Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPalevoCqmm()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	//------------------------------------P2P-Worm.Palevo.cqmm------------------------------------------
	if((m_dwAEPUnmapped == 0x19A92 || m_dwAEPUnmapped == 0x19A93) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x21800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].Misc.VirtualSize))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
	
		const int PALEVO_BUFF_SIZE	= 0x300;

		m_pbyBuff = new BYTE[PALEVO_BUFF_SIZE];		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		DWORD dwReadOffset = 0x29760;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOffset, &dwReadOffset))
		{
			return iRetStatus;
		}
		if(!GetBuffer(dwReadOffset, PALEVO_BUFF_SIZE, PALEVO_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		TCHAR			szPalevoCqmm[] = {_T("4E616D65733D5B7B34324235464141452D36353336*25732573000000004343434343430000414141414141")};	//Names=[{42B5FAAE-6536 * %s%s....CCCCCC..AAAAAA

		polydbObj.LoadSigDBEx(szPalevoCqmm, _T("Worm.Palevo.cqmm"), FALSE); 
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PALEVO_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectInstallBrain
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of InstallBrain Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInstallBrain()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(!(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size >= 0x1500 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size <= 0x2100))
	{
		return iRetStatus;
	}
	if(((m_wNoOfSections == 0x05 || m_wNoOfSections == 0x04)) ||
		(m_wNoOfSections == 0x03 &&
		m_pSectionHeader[0].SizeOfRawData == 0x00))
		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x300];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress + 0xDD0, 0x300, 0))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	polydbObj;
		TCHAR	szVirusName[MAX_PATH] = {0};
	
		TCHAR	InstallBrain_Sig1[] = {_T("426561766572746F6E31*506572666F726D6572736F6674204C4C43")};
		TCHAR	InstallBrain_Sig2[] = {_T("426561766572746F6E31*59656C6C6F77536F667420496E63")};
		TCHAR	InstallBrain_Sig3[] = {_T("426561766572746F6E31*4D6564696154656368536F667420496E63")};
		
		polydbObj.LoadSigDBEx(InstallBrain_Sig1, _T("Not-a-virus:Adware.InstallBrain"), TRUE);
		polydbObj.LoadSigDBEx(InstallBrain_Sig2, _T("Not-a-virus:Adware.InstallBrain"), TRUE);
		polydbObj.LoadSigDBEx(InstallBrain_Sig3, _T("Not-a-virus:Adware.InstallBrain"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x300, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdloadU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Adload Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdloadU()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if	(m_wAEPSec == 0x0 && m_wNoOfSections == 0x7 && (m_dwAEPUnmapped & 0xFF00) == 0x1400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E00 && 
		(memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".tsustub", 8) == 0) && (memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".tsuarch", 8) == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		int		iAdloadBuffSize = 0x1000;
		m_pbyBuff = new BYTE[iAdloadBuffSize];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//Compairing last and second last section tiz3 70005
		if(m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0],m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData + 0x10, 0x8, 0x8))
		{
			if(m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x8],m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + 0x10, 0x8, 0x8))
			{
				if(memcmp(&m_pbyBuff[0], &m_pbyBuff[0x8], 0x8) != 0)
				{
					return iRetStatus;
				}
			}
			else
			{
				return iRetStatus;
			}
		}
		else 
		{
			return iRetStatus;
		}

		DWORD	dwType = 0x010, dwNameID = 0x01 , dwLangID = 0x0, dwRVA = 0x0 , dwSize = 0x0;
		if(FindRes(LPCTSTR(&dwType), LPCTSTR(&dwNameID), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwRVA))
			{
				return iRetStatus;
			}

			if(dwSize < iAdloadBuffSize)
			{
				iAdloadBuffSize = dwSize;
			}
		}		
		if(!GetBuffer(dwRVA, iAdloadBuffSize, iAdloadBuffSize))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};
		TCHAR				szAdloadU[] = {_T("5400530055004C006F0061006400650072*5400530055004C006F0061006400650072002E006500780065*41007200670075006D0065006E0074007300000000002F0078")}; //T.S.U.L.o.a.d.e.r * T.S.U.L.o.a.d.e.r...e.x.e * A.r.g.u.m.e.n.t.s...../.x

		polydbObj.LoadSigDBEx(szAdloadU, _T("not-a-virus:Downloader.Adload.u"), FALSE); 
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], iAdloadBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectObfuscatedFEQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Obfuscated.FEQ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectObfuscatedFEQ()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0x08 && m_wNoOfSections == 0xA && m_dwAEPUnmapped == 0x277E0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xAE00 && memcmp(m_pSectionHeader[0x03].Name, "tmd", 3) == 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	OBFUSCATED_BUFF_SIZE = 0x150;
		DWORD		dwReadOffset = 0x146C0;

		m_pbyBuff = new BYTE[OBFUSCATED_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOffset, &dwReadOffset))
		{
			return iRetStatus;
		}

		if(!GetBuffer(dwReadOffset, OBFUSCATED_BUFF_SIZE, OBFUSCATED_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		TCHAR			szObfuscatedFEQ[] = {_T("7777772E424C3137362E636F6D0000000030000000312E3030*336B646C6C2E706462")}; //www.BL176.com * 3kdll.pdb

		polydbObj.LoadSigDBEx(szObfuscatedFEQ, _T("Trojan.Obfuscated-FEQ"), FALSE); 
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], OBFUSCATED_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDragonMess
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Dragon Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDragonMess()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if (m_wNoOfSections == 0x3 && ((m_wAEPSec == 0x2 && m_dwAEPUnmapped == 0xD457 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00) || (m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x4EB0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6800)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int	DRAGONMESS_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[DRAGONMESS_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		DWORD dwBuffOffset = 0x2700;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, DRAGONMESS_BUFF_SIZE, DRAGONMESS_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn		objdbscan;
		TCHAR				szVirusName[MAX_PATH] = {0};

		LPCTSTR  szDragonMess = (_T("B7ECA87D66E4A87EB3AA7DFD1085275E*1DFB78E13BE83BF2A0D583CC1A64331E*BFB79E06B88BD3217BD034DB3D1C1D78*BE01A866EDC33468943D77A18E7D393D")); //Data from .data section
		objdbscan.LoadSigDBEx(szDragonMess, _T("Trojan.DragonMess.g"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DRAGONMESS_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWinper
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Winper Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWinper()
{
	int		iRetStatus = VIRUS_NOT_FOUND;
	bool	bIsDLL = false;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		bIsDLL = true;
	}
	DWORD	dwPRD = m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData;
	DWORD	dwSRD = m_pSectionHeader[m_wAEPSec].SizeOfRawData;

	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1000 && (
		(m_wNoOfSections == 0x03 && dwSRD == 0x14000 &&  (dwPRD == 0x1C200 || dwPRD == 0x1D000)&& bIsDLL == false) ||
		(m_wNoOfSections == 0x08 && dwSRD == 0xAC00 && dwPRD == 0x10E00 && bIsDLL == false)	||
		(m_wNoOfSections == 0x07 && dwSRD == 0xB400 && bIsDLL == true)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	WINKER_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[WINKER_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwReadBuffOff = 0xC2B0;
		if(m_wNoOfSections == 0x08)
		{
			dwReadBuffOff = m_pSectionHeader[0x1].PointerToRawData + 0x2A0;
		}
		else if(m_wNoOfSections == 0x07)
		{
			dwReadBuffOff = m_pSectionHeader[0x1].PointerToRawData + 0x230;
		}
		else 
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadBuffOff, &dwReadBuffOff))
			{
				return iRetStatus;
			}
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOff, WINKER_BUFF_SIZE, WINKER_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szWinperA = (_T("5300650072007600520065006C004C006300730073*7B00330031003000440045003200390043002D0030004100440033002D003400*630072007900700074006F002E0064006C006C*6C006300730073002E006500780065")); //MutexName * CLSID * c.r.y.p.t.o...d.l.l * l.c.s.s...e.x.e

		objdbscan.LoadSigDBEx(szWinperA, _T("Worm.Wenper.a"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], WINKER_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectInjectZZX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Inject.ZZX Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInjectZZX()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if((m_dwAEPUnmapped == 0x60AC && ((m_wAEPSec == 0x01 && (m_wNoOfSections == 0x08 || m_wNoOfSections == 0x09) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200) 
		|| (m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC000)))
		|| ((m_dwAEPUnmapped >= 0xF000 || m_dwAEPUnmapped <= 0x12000) && m_wAEPSec == (m_wNoOfSections -1) && m_wNoOfSections == 0x09 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200)
		|| (m_dwAEPUnmapped == 0x5C3C && m_wAEPSec == 0x0 && m_wNoOfSections == 0x09 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4E00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	INJECTZZX_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[INJECTZZX_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset = 0x29D3;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, INJECTZZX_BUFF_SIZE, INJECTZZX_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szInjectZZX = (_T("803DEE860001007405F6020F751D0FB73AC1EF038BCE03C903C93BF8760B*8888A8850001403BF877F58BC74683C22083FE3775CC5F5EC38BC053*83C0303D300B00007305B8300B000005D0040000C1E80D83F807")); //Loop * fix offsets

		objdbscan.LoadSigDBEx(szInjectZZX, _T("Trojan.Inject.zzx"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], INJECTZZX_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWebtoolbarMyWebSearch
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of MyWebSearch Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWebtoolbarMyWebSearch()
{
	int		iRetStatus = VIRUS_NOT_FOUND;
	bool	IsDll = false;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		IsDll = true;
	}

	if (m_wAEPSec == 0x0 && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && 
	   ((((m_dwAEPUnmapped & 0xFF00) == 0x1500 || (m_dwAEPUnmapped & 0xFF00) == 0x1800 || (m_dwAEPUnmapped & 0xFF00) == 0x1700) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000 ) || 
	    ((m_dwAEPUnmapped & 0xF000) == 0x2000 && m_dwAEPUnmapped == m_dwAEPMapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000 && m_pSectionHeader[m_wNoOfSections - 0x1].PointerToRawData == 0x7000)) && 
		IsDll == false)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int	WEBTOOLBAR_BUFF_SIZE  = 0x600;
		DWORD		dwReadBuffOffset = m_pSectionHeader[0x02].PointerToRawData;

		m_pbyBuff = new BYTE[WEBTOOLBAR_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000)
		{
			dwReadBuffOffset = m_pSectionHeader[0x02].PointerToRawData + 0xE00;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, WEBTOOLBAR_BUFF_SIZE, 0x200))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szDwnldLMNit = (_T("687474703A2F2F696D676661726D2E636F6D2F696D616765732F6E6F63616368652F74722F6175312E676966*726573756C743D2578")); // http://imgfarm.com/images/nocache/tr/au1.gif * result=%x
		LPCTSTR			szDwnldLMNit1 = (_T("46756E205765622050726F6475637473204561737920496E7374616C6C6572*4D7946726565*5C496E7374616C6C72"));

		objdbscan.LoadSigDBEx(szDwnldLMNit1, _T("not-a-virus:WebToolbar.MyWebSearch.gg"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNit, _T("not-a-virus:WebToolbar.MyWebSearch.gen"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], WEBTOOLBAR_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if (IsDll == true && m_wAEPSec == 0x0 && m_wNoOfSections == 0x07 && (m_dwAEPUnmapped & 0xF0000) == 0x10000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF0FFF) == 0x30000 && 
		     memcmp(m_pSectionHeader[0x03].Name, "t8Shared", 8)== 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	WEBTOOLBAR_BUFF_SIZE  = 0x300;
		DWORD		dwReadBuffOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].VirtualAddress;
		
		if(dwReadBuffOffset == 0x0)
		{
			return iRetStatus;
		}

		m_pbyBuff = new BYTE[WEBTOOLBAR_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadBuffOffset, WEBTOOLBAR_BUFF_SIZE, 0x200))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szDwnldLMNit = (_T("4E6574776F726B31*4D696E64737061726B20496E746572616374697665204E6574776F726B30")); // Network1 * Mindspark Interactive Network0

		objdbscan.LoadSigDBEx(szDwnldLMNit, _T("not-a-virus:WebToolbar.MyWebSearch.gen"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], WEBTOOLBAR_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Fareit.Qsy Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJorikFareitQsy()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if (m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x10C0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11E00 && 
		m_pSectionHeader[m_wNoOfSections -1].SizeOfRawData == 0xA00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	JORIKQSY_BUFF_SIZE = 0x2B0;
		m_pbyBuff = new BYTE[JORIKQSY_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset = m_dwAEPMapped;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x05, 0x05))
		{
			return iRetStatus;
		}
		
		if(m_pbyBuff[0] == 0x68)
		{
			dwBuffOffset = *(DWORD *)&m_pbyBuff[0x1] - m_pMaxPEFile->m_stPEHeader.ImageBase;
		}
		else
		{
			return iRetStatus;
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, JORIKQSY_BUFF_SIZE, JORIKQSY_BUFF_SIZE))
		{
			return iRetStatus;
		}

		if(*(DWORD *)&m_pbyBuff[0x0] !=  0x21354256)			// VB5! Chk
		{
			return iRetStatus;
		}

		CSemiPolyDBScn		objdbscan;
		TCHAR				szVirusName[MAX_PATH] = {0};
		LPCTSTR				szVBaso = (_T("58254000*E90000006823400058244000CC104000*434841525457495A2E4F4358*F40100001899400000000000802C4100902C4100101C")); //RT Main Structure * pikachu * V.I.R.U.S

		objdbscan.LoadSigDBEx(szVBaso, _T("Trojan.Jorik.Fareit.qsy"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], JORIKQSY_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectJorikWanbagEM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of JorikWanbagEM Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJorikWanbagEM()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wNoOfSections == 0x3 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x3088 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2C000 
		&& m_pSectionHeader[m_wNoOfSections -1].SizeOfRawData == 0x9200)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		
		const int	JORIKWANBAG_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[JORIKWANBAG_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwBuffOffset = m_dwAEPUnmapped + 0x7828;

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, JORIKWANBAG_BUFF_SIZE, JORIKWANBAG_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn		objdbscan;
		TCHAR				szVirusName[MAX_PATH] = {0};
		LPCTSTR				szVBaso = (_T("687474703A2F2F7879746574732E636F6D3A323334352F742E6173703F6F733D77616E676261*43003A005C00740065006D0070005C00430050002E006500780065")); //http://xytets.com:2345/t.asp?os=wangba * C.:.\.t.e.m.p.\.C.P...e.x.e

		objdbscan.LoadSigDBEx(szVBaso, _T("Trojan.Jorik.Wanbag.em"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], JORIKWANBAG_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVBAso
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of VB.Aso Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBAso()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if ((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1FE4 && 
	   (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x42000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x44000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4E000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	VBASO_BUFF_SIZE = 0x3A0;
		m_pbyBuff = new BYTE[VBASO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset = m_dwAEPMapped;
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, 0x05, 0x05))
		{
			return iRetStatus;
		}
		if(m_pbyBuff[0] == 0x68)
		{
			dwBuffOffset = *(DWORD *)&m_pbyBuff[0x1] - m_pMaxPEFile->m_stPEHeader.ImageBase;
		}
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, VBASO_BUFF_SIZE, VBASO_BUFF_SIZE))
		{
			return iRetStatus;
		}

		if(*(DWORD *)&m_pbyBuff[0x0] !=  0x21354256)			// VB5! Chk
		{
			return iRetStatus;
		}

		CSemiPolyDBScn		objdbscan;
		TCHAR				szVirusName[MAX_PATH] = {0};

		LPCTSTR  szVBaso = (_T("E9000000A4BB400044BC4000F01F4000*70696B61636875*F401000014CB40000000000050E84000D01C4400*560049005200550053")); //RT Main Structure * pikachu * V.I.R.U.S
		objdbscan.LoadSigDBEx(szVBaso, _T("Worm.VB.aso"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], VBASO_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectQukartGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Qukart Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectQukartGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if ((m_wAEPSec == 0x04 && (m_wNoOfSections == 0x05 || m_wNoOfSections == 0x06) && (m_dwAEPUnmapped == 0x2E000 || (m_dwAEPUnmapped & 0xF0FFF) == 0x30000) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData ==0x1000))	|| 
	   (m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1219 && (m_wNoOfSections == 0x01 || (m_wNoOfSections == 0x05))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	QUKART_BUFF_SIZE = 0x200;
		DWORD		dwReadOffset = m_pSectionHeader[0x2].PointerToRawData;

		m_pbyBuff = new BYTE[QUKART_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_wNoOfSections != 0x1)		
		{
			if(!GetBuffer(dwReadOffset, QUKART_BUFF_SIZE, QUKART_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		else							// for Having only one section
		{	
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0], 0x2A090, 0x100, 0x100))
			{
				return iRetStatus;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x100], 0x2B090, 0x100, 0x100))
			{
				return iRetStatus;
			}
		}

		if(m_wAEPSec == 0x04)			// for Encrypted 
		{
			DWORD	dwKey = *(DWORD *)&m_pbyBuff[0x10];
			for(int i = 0x0; i < QUKART_BUFF_SIZE; i+= 0x04)
			{
				 *(DWORD *)&m_pbyBuff[i] ^= dwKey;
			}
		}

		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};

		TCHAR	szQukartGen01[] = {_T("517565656E4B6172746F6E5F*687474703A2F2F7461742D6E65667462616E6B2E7275")}; //QueenKarton_ * http://tat-neftbank.ru
		TCHAR	szQukartGen02[] = {_T("4B696E674B6172746F6E5F*687474703A2F2F636F6C6F722D62616E6B2E7275*687474703A2F2F74726F6A616E2E7275")}; // KingKarton_ * http://crutop.ru *http://trojan.ru
		TCHAR	szQukartGen03[] = {_T("4B4B5F*687474703A2F2F637275746F702E6E75*687474703A2F2F6861636B6572732E6C76")}; // KK_ * http://crutop.nu * http://hackers.lv
		
		polydbObj.LoadSigDBEx(szQukartGen03, _T("Proxy.Qukart.gen"), TRUE); 
		polydbObj.LoadSigDBEx(szQukartGen02, _T("Proxy.Qukart.gen"), TRUE); 
		polydbObj.LoadSigDBEx(szQukartGen01, _T("Proxy.Qukart.gen"), FALSE); 
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], QUKART_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: Prashant
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of HotKeyHook Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectHotKeyHook()
{
	int		iRetStatus = VIRUS_NOT_FOUND;
	bool	bIsDLL = false;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		bIsDLL = true;
	}

	if	((m_wNoOfSections >= 0x03 && m_wNoOfSections <= 0x06 && (m_dwAEPUnmapped % 0x2 == 0x0 || (m_dwAEPUnmapped % 0x10 == 0x3 && m_wNoOfSections == 0x04)) && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize % 0x2) == 0x0 && bIsDLL == false) || 
		(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && (m_dwAEPUnmapped == 0x1230 || m_dwAEPUnmapped == 0x122F) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C00 && bIsDLL == true))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	HOTKEYHOOK_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[HOTKEYHOOK_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		int		iSecNo = 0x0;
		DWORD	dwReadBuffOff = 0x0;
		if(bIsDLL == false)
		{
			while(iSecNo <= m_wNoOfSections)								// to Search .data section number
			{
				if(memcmp(m_pSectionHeader[iSecNo].Name, ".data", 5) == 0)
				{
					break;
				}
				iSecNo++;
			}
			dwReadBuffOff = 0x200;
		}else
		{
			iSecNo		  = 0x2;
			dwReadBuffOff = 0xFFFFFEB0;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0x0], m_pSectionHeader[iSecNo].PointerToRawData + dwReadBuffOff, HOTKEYHOOK_BUFF_SIZE, HOTKEYHOOK_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szHotKeysHook = (_T("4572726F72*4840744B6579734840406B2E444C4C")); //for EXE : Error *  H@tKeysH@@k.DLL

		if(bIsDLL == true)
		{
			SecureZeroMemory(&szHotKeysHook, sizeof(szHotKeysHook));
			szHotKeysHook = (_T("4840744B6579734840406B2E646174*486F744B657973486F6F6B0050")); //for DLL : H@tKeysH@@k.dat *  HotKeysHook.P
		}
		objdbscan.LoadSigDBEx(szHotKeysHook, _T("not-a-virus: Trojan.HotKeyHook"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], HOTKEYHOOK_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPowpGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Powp Family
						- Copy it self to C:\Documents and Settings\admin\<randome>.exe files.
						- C:\Documents and Settings\admin\axmn .exe	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPowpGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && 
		((m_dwAEPUnmapped == 0x3800 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3400)
		  || (m_dwAEPUnmapped == 0x3910 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3600)
		  || (m_dwAEPUnmapped == 0x3CE0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3A00)
		  || (m_dwAEPUnmapped == 0x3A80 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3600)) 
		&& m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x200)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	POWPGEN_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[POWPGEN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwReadOffset = 0x3513;
		if(m_dwAEPUnmapped == 0x3910)
		{
			dwReadOffset = 0x36F5;
		}
		if(m_dwAEPUnmapped == 0x3CE0)
		{
			dwReadOffset = 0x39D6;
		}
		if(m_dwAEPUnmapped == 0x3A80)
		{
			dwReadOffset = 0x37AE;
		}

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOffset, &dwReadOffset))
		{
			return iRetStatus;
		}

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwReadOffset, POWPGEN_BUFF_SIZE, POWPGEN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};

		LPCTSTR  szPowpGen = (_T("A1A46740004368BB00000050C705086040000453000081E3FF000000FF1518504000*688C6E000068D45D000050*8A0C338B44241803C8B879787878*81E1FF0000008A14318A0C2F32CA880C2F8B0D24604000F7E9")); 
		
		if(m_dwAEPUnmapped == 0x3910)
		{
			SecureZeroMemory(&szPowpGen, sizeof(szPowpGen));
			szPowpGen = (_T("4381E3FF000000FFD58A04338B5424188B0D9C64400003C225FF00000051*881433880431FFD58A04338B54241003C225FF000000*8A0C308B44241C8A140732D18814078B442420473BF87C9A"));
		}
		else if(m_dwAEPUnmapped == 0x3CE0)
		{
			SecureZeroMemory(&szPowpGen, sizeof(szPowpGen));
			szPowpGen = (_T("68FB3D000068D841000068357B000068B5720000*B80564344CF7EAC1FA068BC2C1E81F03D0*81E2FF0000008A04328A142F32D08B44241C88142F47")); 
		}
		else if(m_dwAEPUnmapped == 0x3A80)
		{
			SecureZeroMemory(&szPowpGen, sizeof(szPowpGen));
			szPowpGen = (_T("68A80D0000682408000089542420*81E1FF0000005050894C2430*8A0C328A140732D1881407*8BC2C1E81F03D08B44241C")); 
		}
		
		objdbscan.LoadSigDBEx(szPowpGen, _T("Trojan.Win32.Powp.gen"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], POWPGEN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
		
	}
	return iRetStatus;
}



/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  Drops file 
						C:\WINDOWS\system32\xvhost.sb
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPePatchedLX()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x0 && m_wAEPSec == 0 && m_wNoOfSections == 0x2 && 
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3F16)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PEPATCHEDLX_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[PEPATCHEDLX_BUFF_SIZE];
                if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const BYTE bPEPATCHEDLXSig[] = {0x36, 0x36, 0x34, 0x46, 0x69, 0x72, 0x73, 0x78, 0x78, 0x64, 0x66, 0x64, 0x74, 0x4E, 0x61, 0x6D, 0x65};
					      // Name of mutex: 664FirsxxdfdtName
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x320, sizeof(bPEPATCHEDLXSig),sizeof(bPEPATCHEDLXSig)))
		{
			return iRetStatus;
		}
		
		if(memcmp(m_pbyBuff, bPEPATCHEDLXSig, sizeof(bPEPATCHEDLXSig)) == 0)
		{
			if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x690, PEPATCHEDLX_BUFF_SIZE, PEPATCHEDLX_BUFF_SIZE))
			{
				CSemiPolyDBScn objdbscan;
				TCHAR szVirusName[MAX_PATH] = {0};
				TCHAR szPEPATCHEDLXSig[] = {_T("74656D7020737472*4D53444E205375726642656172*73797374656D33325C7876686F73742E7362")};
				                           // temp str*MSDN SurfBear*system32\xvhost.sb
				objdbscan.LoadSigDBEx(szPEPATCHEDLXSig, _T("Packed.W32.PePatch.lx"), FALSE);
				if(objdbscan.ScanBuffer(&m_pbyBuff[0], PEPATCHEDLX_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentSn
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.sn Family
					  downloads malicious setup.exe from website malicious website http://trkairinstaller.com
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentSn()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05 && m_wAEPSec == 0x0 && m_dwAEPMapped == 0x015AD94 && 
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x019373F)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int AGENTSN_BUFF_SIZE = 0x90;
		m_pbyBuff = new BYTE[AGENTSN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x2A770, AGENTSN_BUFF_SIZE, AGENTSN_BUFF_SIZE))
		{
			TCHAR AGENTSN_SIG[] = {_T("68007400740070003A002F002F00740072006B002E0061006900720069006E007300740061006C006C00650072*63006F006D002F006700650074002F006500760065006E0074002F003F006E0061006D0065")};
										//h.t.t.p.:././.t.r.k...a.i.r.i.n.s.t.a.l.l.e.r*c.o.m./.g.e.t./.e.v.e.n.t./.?.n.a.m.e
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(AGENTSN_SIG, _T("not-a-virus:WebToolbar.Win32.Agent.sn"), FALSE);
			if(polydbObj.ScanBuffer(m_pbyBuff, AGENTSN_BUFF_SIZE, szVirusName) >= 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME, szVirusName);
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanFakeAVASBH
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of FakeAV Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanFakeAVASBH()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if (m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && (m_dwAEPUnmapped & 0xF000) == 0x1000 &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00) &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress == 0x3A00 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size == 0x200)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	FAKEAVASBH_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[FAKEAVASBH_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwReadOff = 0x2535, dwXorKey = 0x32985E43, dwAddKey = 0x5AE34687;

		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwReadOff,&dwReadOff))
		{
			return iRetStatus;
		}
		if(!GetBuffer(dwReadOff,FAKEAVASBH_BUFF_SIZE,FAKEAVASBH_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		for(int i = 0x0; i < FAKEAVASBH_BUFF_SIZE; i += 0x4)
		{
			*(DWORD*)&m_pbyBuff[i] ^= dwXorKey;
			*(DWORD*)&m_pbyBuff[i] += dwAddKey;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szTrojanFakeAVasbh = (_T("803A11E9656C33322E646C6C*CB2A6185"));

		polydbObj.LoadSigDBEx(szTrojanFakeAVasbh, _T("Trojan.FakeAV.asbh"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], FAKEAVASBH_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPSWLdPinchDLT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prajakta + Virus Analysis Team
	Description		: Detection routine for different varients of LdPinch Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPSWLdPinchDLT()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if  (m_wAEPSec == 0x0 && 
		(m_dwAEPUnmapped & 0xF000) == 0x9000 && m_dwImageBase == 0x13140000 &&
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xF0000) == 0x40000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	PSWLDPINCHDLT_BUFF_SIZE = 0x330;
		m_pbyBuff = new BYTE[PSWLDPINCHDLT_BUFF_SIZE];
		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(!GetBuffer(m_dwAEPMapped,0x15,0x15))
		{
			return iRetStatus;
		}
		if (m_pbyBuff[0x0] == 0x68 && m_pbyBuff[0x5] == 0x60 && m_pbyBuff[0x6] == 0xB8 && m_pbyBuff[0xB] == 0x81 &&
			m_pbyBuff[0xC] == 0x30 && m_pbyBuff[0x11] == 0x83 && m_pbyBuff[0x12] == 0xC0 && m_pbyBuff[0x13] == 0x4 && 
			m_pbyBuff[0x14] == 0x3D)
		{
			DWORD	dwDecOff = *(DWORD*)&m_pbyBuff[0x7] - m_dwImageBase;
			DWORD	dwXORKey = *(DWORD*)&m_pbyBuff[0xD];

			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDecOff,&dwDecOff))
			{
				return iRetStatus;
			}
			if(!GetBuffer(dwDecOff,PSWLDPINCHDLT_BUFF_SIZE,PSWLDPINCHDLT_BUFF_SIZE))
			{
				return iRetStatus;
			}
			for(int i = 0x0; i < PSWLDPINCHDLT_BUFF_SIZE; i+=4)
			{
				*(DWORD*)&m_pbyBuff[i] ^= dwXORKey;
			}
			
			CSemiPolyDBScn		polydbObj;
			TCHAR				szVirusName[MAX_PATH] = {0};
			TCHAR				szPSWLdPinchDLT[] = {_T("67717957756766547442*5468652042617421*4D6972616E646120494351")};
			                             //gqyWugfTtB(Mutex name)*The Bat!*Miranda ICQ

			polydbObj.LoadSigDBEx(szPSWLdPinchDLT,_T("Trojan.PSW.LdPinch.dlt"),FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], PSWLDPINCHDLT_BUFF_SIZE, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectIndirectA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Indirect Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIndirectA()
{
	if	((m_wNoOfSections == 0x7 || m_wNoOfSections == 0x5) && m_wAEPSec == 0x0 && 
		((m_dwAEPMapped & 0xF000) == 0x3000 || (m_dwAEPMapped & 0xF000) == 0x2000) && 
		(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size > 0x0) &&
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF000) == 0x8000 || (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF000) == 0x5000))
	{
		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		m_pbyBuff = new BYTE[m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size];

		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}

		if(GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress + 0xE50, 0x200,0x200))
		{
			CSemiPolyDBScn		polydbObj;
			TCHAR				szVirusName[MAX_PATH] = {0};
			TCHAR				szIndirectA[] = {_T("1da1050e888fc4e39c8d63f7be57619a*3082010a0282010100e57d3f7542c1b9e8d657b9090a68166643b32fe513a7*be1f62cb7939eff495ac3fc731812d8b0c58c9117317dd0233a5b185052018cacb8e")};
			
			polydbObj.LoadSigDBEx(szIndirectA,_T("not-a-virus:Adware.Indirect.A"),FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of MegaSearch Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMegaSearch()
{
	if	((m_wNoOfSections == 0x5 || m_wNoOfSections == 0x3) && m_wAEPSec == 0x0 && 
		(((m_dwAEPMapped & 0xF0000) == 0x10000) || ((m_dwAEPMapped & 0xF000) == 0xC000) || 
		((m_dwAEPMapped & 0xF000) == 0xE000)) && 
		(((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF0000) == 0x10000) || 
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xF0000) == 0x20000)))
	{
		if(m_pMaxPEFile->m_byAEPBuff[0x0] != 0xE8 && m_pMaxPEFile->m_byAEPBuff[0x5] != 0xE9)
		{
			return VIRUS_NOT_FOUND;
		}
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x1000];

		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}

		if(GetBuffer(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress + 0x80, 0x1000,0x1000))
		{
			CSemiPolyDBScn		polydbObj;
			TCHAR				szVirusName[MAX_PATH] = {0};
			TCHAR				szMegaSearch[] = {_T("1100fa2e3fcb8e83b20759399f7e1d9549ee*3082010a0282010100de304b1d8f664f3ad19b313ac1635af8d67e*0d6383b3826fa2fd96bed721f596d472d853db68355244a1883413661f695c01b3d09f")};
			TCHAR				szMegaSearch1[] = {_T("884d2047062633b742f0e5f69a18d0f8*3082010a0282010100aa6dbdeadf7d61e63da754441cd79bfb7daf6e51dd696760f5cf5ed959*fe5417d4f891c5ad013702b283eb9d4952a0ca022c7823a776e9654b3916b73ec7cf10f962b8ff6063e8097b")};
			TCHAR				szMegaSearch2[] = {_T("1100d14c8cc7422b7b416198eeb359191765*3082010a0282010100de84cb60cc58701e8bfe86af08960296c31d6547eb374a2fff59a1dd*bde64eb64de366c0b2d614614fbecc251e64d162d5ef6076bed48aab05838461772c0fa5580a646658ef8fad")};
		
			polydbObj.LoadSigDBEx(szMegaSearch,_T("not-a-virus:Adware.MegaSearch.at"),TRUE);
			polydbObj.LoadSigDBEx(szMegaSearch1,_T("not-a-virus:Adware.MegaSearch.at"),TRUE);
			polydbObj.LoadSigDBEx(szMegaSearch2,_T("not-a-virus:Adware.MegaSearch.at"),FALSE);

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x1000, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}
	return VIRUS_NOT_FOUND;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectAgentFO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.FO Family
	   				    - Drops Autorun.inf in C:\Autorun.inf
						- Drops Own copy
						- C:\SystemVolumeInformation\LucifeR.exe
						- C:\WINDOWS.EXE
						- C:\Documents and Settings\admin\Datos de programa.exe	
					  Related Sigs 
						Trojan.AutorunINF.Gen=53797374656da0566f6c756d65a0496e666f726d6174696f6e5c4c7563696665522e65786520363636*456a65637574617220636f6d6f
						Trojan.BAT.Agent.fo=6E6F6D6272653A2776656E6F6D5F6C75636966657227*73797374656D33325C647269766572735C6574635C255F2168252E636F6D22*73797374656DFF766F6C756D65FF696E666F726D6174696F6E5C6C7563696665722E657865
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentFO()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0 && ((m_dwAEPUnmapped == 0xCF48 && ((m_wNoOfSections == 0x8 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xC798) ||
		(m_wNoOfSections == 0x3 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x14000))) || 
		(m_wNoOfSections == 0x3 && (m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress != 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].Size != 0x0) &&(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize & 0xF0F) == 0x404 && 
		(m_dwAEPUnmapped & 0xFF0F) == 0x240E )))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int	AGENTFO_BUFF_SIZE = 0x100;
		DWORD		dwOffset = 0x0;
		LPCTSTR		AGENTFO_SIG1;

		m_pbyBuff = new BYTE[AGENTFO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if(m_dwAEPUnmapped != 0xCF48)
		{
			// Checks for C# file
			DWORD dwMetaDataRVA = 0x0,dwMetaDataSize = 0x0,dwCLIOff = 0x0;
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress,&dwCLIOff))
			{
				return iRetStatus;
			}
			m_pMaxPEFile->ReadBuffer(&dwMetaDataRVA,(dwCLIOff + 0x8),sizeof(DWORD),sizeof(DWORD));
			m_pMaxPEFile->ReadBuffer(&dwMetaDataSize,(dwCLIOff + 0xC),sizeof(DWORD),sizeof(DWORD));

			if(dwMetaDataRVA != 0x20A4)
				return iRetStatus;	

			AGENTFO_SIG1 = (_T("05006C0000001C010000237E00008801000014010000*02000001471402000900000000FA0133001600000100000006*0050200000000096003F000A0001009C2000000000861844000E000100110044001200190044000E002100"));
			dwOffset = 0xC0;
		}
		else
		{
			dwOffset = 0xAF7A;
			AGENTFO_SIG1 = (_T("BE84F84000BF82F84000BD7CF840008BCB66D36500EB*662B1E8BCB668B0766D3E066094500833D70F84000007415FF0D70F84000E878FFFFFF25FF000000668907EB0566C707000066C70608000F"));	
		}

		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + dwOffset, AGENTFO_BUFF_SIZE, AGENTFO_BUFF_SIZE))
		{
			CSemiPolyDBScn polydbObj;
			TCHAR szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(AGENTFO_SIG1, _T("Trojan.Agent.fo"), false);
			if(polydbObj.ScanBuffer(m_pbyBuff, AGENTFO_BUFF_SIZE, szVirusName) >= 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME, szVirusName);
			}
		}

	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentAYUW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.AYUW Family
					  Covered Variants: not-a-virus:
						1. Adware.DomaIQ.een
						2. Adware.DomaIQ.eit
						3. Adware.DomaIQ.ekr
						4. Adware.DomaIQ.adw	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentAYUW()
{
	if	((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return VIRUS_NOT_FOUND;
	}

	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0 &&
		((m_dwAEPMapped == 0xC571 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1BFE7)||
		( m_dwAEPMapped == 0xC90B && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1C447)||
		(((m_dwAEPUnmapped & 0xFF0F) == 0xD102) || ((m_dwAEPUnmapped & 0xFF0F) == 0xD101) && (m_pSectionHeader[0].SizeOfRawData == 0x1DE00 || m_pSectionHeader[0].SizeOfRawData == 0x1C000))||
		((m_dwAEPUnmapped == 0xD685 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E400)||(m_dwAEPUnmapped == 0xD50B && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C600))||
		((((m_dwAEPUnmapped & 0xF00F) == 0xC002 || (m_dwAEPUnmapped & 0xF00F) == 0xC008)) && (m_pSectionHeader[0].SizeOfRawData == 0x1BA00 || m_pSectionHeader[0].SizeOfRawData == 0x1BC00))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];
		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}
		
		DWORD dwStartOff = 0x0;
		if((m_dwAEPMapped & 0xFF00) == 0xB800)
		{
			dwStartOff = m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x3330;
		}
		else
			dwStartOff = m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x400;

		if(GetBuffer(dwStartOff, 0x100, 0x100))
		{
			CSemiPolyDBScn		polydbObj;
			TCHAR	szVirusName[MAX_PATH] = {0};
			TCHAR	szAgentAYUW[] = {_T("5C706172656E742E747874003131312E74787400696E7374616C6C65722E6578652E636F6E666967*696E7374616C6C65722E657865000000444D")}, //\parent.txt.111.txt.installer.exe*installer.exe...DM									
					szDomaIQACT[] = {_T("6578652E636F6E666967*706172656E742E747874005C3131312E747874")},		//exe.config*\parent.txt.\111.txt
					szDomaIQeol[] = {_T("5C3131312E747874000000005C706172656E742E747874*2E6578652E636F6E666967*2E65786500434F626A656374")},// \111.txt....\parent.txt*.exe.config*.exe.CObject
					szDomaIQenz[] = {_T("5C706172656E742E747874*5C3131312E747874*6578652E636F6E666967")}; //\parent.txt * \111.txt * exe.config
			
			polydbObj.LoadSigDBEx(szDomaIQenz, _T("not-a-virus:Adware.DomaIQ.enz"), true);
			polydbObj.LoadSigDBEx(szDomaIQeol, _T("not-a-virus:Adware.DomaIQ.eol"), true);
			polydbObj.LoadSigDBEx(szAgentAYUW, _T("not-a-virus:Downloader.Agent.ayuw"), true);	//Downloader.Agent.ayuw & Adware.DomaIQ.dzd
			polydbObj.LoadSigDBEx(szDomaIQACT, _T("not-a-virus:Adware.DomaIQ.act"), false);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x100, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectIRCBotAerz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of IRCBot Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIRCBotAerz()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if	(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && m_dwAEPMapped == 0x1D1D3 && 
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2BEE8 && memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name,".fei0",0x5)== 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}

		const int	IRCBOT_BUFF_SIZE = 0x200;
		DWORD		dwOffset = 0x0;
	
		m_pbyBuff = new BYTE[IRCBOT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		TCHAR IRCBOT_SIG1[] = {_T("687474702533412F2F61712E71712E636F6D2F636E322F696E646578*62552A69546C414F2A47537277792A43714F756D424C592A7A372A2D51307A*5075626C69634B65793D224135423535393530*3831383034433039323943303737373641363731453530354437343645304232")};
										//http%3A//aq.qq.com/cn2/index*bU*iTlAO*GSrwy*CqOumBLY*z7*-Q0z*PublicKey="A5B55950
		if(GetBuffer(m_pSectionHeader[m_wAEPSec + 0x1].PointerToRawData + 0x20B0, IRCBOT_BUFF_SIZE, IRCBOT_BUFF_SIZE))
		{
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(IRCBOT_SIG1, _T("Backdoor.IRCBot.aerz"),FALSE);
			if(polydbObj.ScanBuffer(m_pbyBuff, IRCBOT_BUFF_SIZE, szVirusName) >= 0)
			{
				iRetStatus = VIRUS_FILE_DELETE;
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME, szVirusName);
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectInjectorHXBU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Injector.hxbu Family
					  Covers Samples of Downloader.Agent.ajuq & Dropper.Injector.hbpw
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInjectorHXBU()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if	((m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && m_dwAEPMapped == 0x6AA55 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x81E4A && m_pMaxPEFile->m_stPEHeader.CheckSum == 0xBD278) ||
		(m_wNoOfSections >= 0x4 && m_wNoOfSections <= 0x6 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1D146 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x37000))
	{
		if(m_pMaxPEFile->m_byAEPBuff[0x0] == 0xE8 && m_pMaxPEFile->m_byAEPBuff[0x5] == 0xE9)
		{
			DWORD dwOffset = ((*(DWORD *)&m_pMaxPEFile->m_byAEPBuff[0x1]) + m_dwAEPUnmapped +0x5);

			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwOffset,&dwOffset))
			{
				return iRetStatus;
			}
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			m_pbyBuff = new BYTE[0x30];

			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			BYTE INJECTOR_SIGN[] = {0xBF,0x4E,0xE6,0x40,0xBB};

			if(!GetBuffer(dwOffset,0x30,0x30))
			{
				return iRetStatus;
			}
			int i = 0,iChk = 0;
			while( i < (0x30 - sizeof(INJECTOR_SIGN)))
			{
				if(memcmp(INJECTOR_SIGN,&m_pbyBuff[i],sizeof(INJECTOR_SIGN)) == 0)
				{
					iChk = 0x1;
					dwOffset = ((*(DWORD *)&m_pMaxPEFile->m_byAEPBuff[0x6]) + m_dwAEPUnmapped +0xA);
					
					if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwOffset,&dwOffset))
					{
						return iRetStatus;
					}
					if(!GetBuffer(dwOffset,0x30,0x30))
					{
						return iRetStatus;
					}

					const BYTE	INJECTOR_SIGN1[] = {0xBF,0x94,0x0,0x0,0x0};
					i = 0;
					while(i < (0x30 - sizeof(INJECTOR_SIGN)))
					{
						if(memcmp(INJECTOR_SIGN1,&m_pbyBuff[i],sizeof(INJECTOR_SIGN1)) == 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Injector.hxbu"));
							return VIRUS_FILE_DELETE;
						}
						i++;
					}
				}
				if(iChk == 0x1)
				{
					break;
				}
				i++;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Danglo Family
						- Application setup files
						- connect to malicious website & downloads files
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDangloKT()
{
	int iReturn = VIRUS_NOT_FOUND;

	if	(m_wAEPSec == 0 && m_dwAEPMapped == 0x400 && m_wNoOfSections == 0x5 && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF) == 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int dwBuffSize = 0x200;
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
		{
			return iReturn;
		}
		
		TCHAR szDangloKT_Sign[] = {_T("687474703A2F2F7777772E636865617468617070656E732E636F6D2F756E617574686F72697A65642F30682E7A6970*312E6D703300332E6D7033")};
										//(http://www.cheathappens.com/unauthorized/0h.zip * 1.mp3.3.mp3)
		
		if(GetBuffer(m_pSectionHeader[m_wAEPSec + 0x3].PointerToRawData + 0x200,dwBuffSize,dwBuffSize))
		{
			CSemiPolyDBScn	objdbscan;
			TCHAR			szVirusName[MAX_PATH] = {0};

			objdbscan.LoadSigDBEx(szDangloKT_Sign,_T("Trojan.Danglo.KT"),FALSE);
			if(objdbscan.ScanBuffer(m_pbyBuff,dwBuffSize,szVirusName) >= 0)
			{
				if(_tcslen(szVirusName)>0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iReturn;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDomaIQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of DomaIQ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDomaIQ()
{
	if(m_pMaxPEFile->m_bIsVBFile)
	{
		return VIRUS_NOT_FOUND;
	}

	if(IMAGE_FILE_DLL == (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL))
	{
		return VIRUS_NOT_FOUND;
	}

	if	(0x5 == m_wNoOfSections && 0 == m_wAEPSec && (0xD685 == m_dwAEPUnmapped || 0xD6A5 == m_dwAEPUnmapped) && 
		0x1E400 == m_pSectionHeader[m_wAEPSec].SizeOfRawData)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x200];
		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}

		if(!GetBuffer(0x400, 0x200, 0x200))
		{
			return VIRUS_NOT_FOUND;
		}

		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};
		TCHAR				szDomaIQaad0[] = {_T("A1B07A4200*68808E4200*68808E4200FF1500024200508D4DE0E84F0500006A00*68240442008D4DE0518D9570FFFFFF52")}; // ocsclient
		TCHAR				szDomaIQaad1[] = {_T("A1B07A4200*68808E4200*68808E4200FF1500024200508D4DDCE8680500006A00*68240442008D4DDC518D956CFFFFFF52")}; // ocsclient
		
		polydbObj.LoadSigDBEx(szDomaIQaad1, _T("not-a-Virus:Adware.DomaIQ.AAD"), TRUE);
		polydbObj.LoadSigDBEx(szDomaIQaad0, _T("not-a-Virus:Adware.DomaIQ.AAD"), FALSE);

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x500, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DecteAgentAl
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.al Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DecteAgentAl()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if	((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL || m_pMaxPEFile->m_bIsVBFile == true)
	{
		return iRetStatus;
	}

	if	(m_wAEPSec == 0 && m_wNoOfSections == 0x03&& ((m_dwAEPUnmapped == 0x3C7F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000)
		||((m_dwAEPUnmapped & 0xF00F) == 0x400F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000)))
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int AGENTAL_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[AGENTAL_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9A0;
		if(!GetBuffer(dwReadOff, AGENTAL_BUFF_SIZE, AGENTAL_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szAgentAl0 = (_T("81F1D4C3B2A18BD18AD9C1EA1C80E30F80E20FC0E30402D38BD9C1EB1432D38B*32D35BC1E90432D13C5C885424080F84B20000003C*81EC380200005355"));
		LPCTSTR			szAgentAl1 = (_T("8B5424045381F2D4C3B2A18BCA8ADAC1E91C80E30F80E10FC0E304*32CA884C24047506B1A188*81EC380200005355"));
		
		polydbObj.LoadSigDBEx(szAgentAl0, _T("Downloader.Agent.al"), TRUE);
		polydbObj.LoadSigDBEx(szAgentAl1, _T("Downloader.Agent.al"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0x0], AGENTAL_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloadSponsor
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Prashant + Virus Analysis Team
	Description		: Detection routine for different varients of Sponsor Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloadSponsor()
{
	if(IMAGE_FILE_DLL == (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL))
	{
		return VIRUS_NOT_FOUND;
	}

	if(m_pMaxPEFile->m_bIsVBFile)
	{
		if(0x3 == m_wNoOfSections && ((0x1620 == m_dwAEPUnmapped && 0x18000 == m_pSectionHeader[m_wAEPSec].SizeOfRawData) || ((0x1560 == m_dwAEPUnmapped || 0x1490 == m_dwAEPUnmapped)&& 0xA000 == m_pSectionHeader[m_wAEPSec].SizeOfRawData) || (0x15B0 == m_dwAEPUnmapped && 0xD000 == m_pSectionHeader[m_wAEPSec].SizeOfRawData)))
		{
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			m_pbyBuff = new BYTE[0x200];
			if(!m_pbyBuff)
			{
				return VIRUS_NOT_FOUND;
			}

			if(!GetBuffer(m_pMaxPEFile->m_dwVBSigOff, 0x200, 0x200))
			{
				return VIRUS_NOT_FOUND;
			}

			CSemiPolyDBScn		polydbObj;
			TCHAR				szVirusName[MAX_PATH] = {0};
			TCHAR				szSponser0[] = {_T("E900000048F5400048F540002C16400078*6F6373636C69656E74")}; // ocsclient
			TCHAR				szSponser1[] = {_T("E9000000E8484000E8484000BC15400078*6F6373636C69656E74")}; // ocsclient
			TCHAR				szSponser2[] = {_T("E900000098484000984840006C15400078*6F6373636C69656E74")}; // ocsclient
			TCHAR				szSponser3[] = {_T("E9000000F4474000F44740009C14400078*6F6373636C69656E74")}; // ocsclient
			
			polydbObj.LoadSigDBEx(szSponser3, _T("not-a-virus:Trojan.DownloadSponsor"), TRUE);
			polydbObj.LoadSigDBEx(szSponser2, _T("not-a-virus:Trojan.DownloadSponsor"), TRUE);
			polydbObj.LoadSigDBEx(szSponser1, _T("not-a-virus:Trojan.DownloadSponsor"), TRUE);
			polydbObj.LoadSigDBEx(szSponser0, _T("not-a-virus:Trojan.DownloadSponsor"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x500, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(0 == m_wAEPSec && 0x4 == m_wNoOfSections && 0x4000E == (m_dwAEPUnmapped & 0xF000F) && 0x1000 == m_pSectionHeader[m_wNoOfSections - 0x1].SizeOfRawData)
	{
		if(0 == m_pMaxPEFile->m_stPEHeader.DataDirectory[0xE].VirtualAddress)
		{
			return VIRUS_NOT_FOUND;
		}
		
		DWORD	dwTypeID = 0x10, dwNameID = 0x0001 , dwLangID = 0x0, dwRVA = 0x0 , dwSize = 0x0;
		if(FindRes(LPCTSTR(&dwTypeID), LPCTSTR(&dwNameID), LPCTSTR(&dwLangID), dwRVA, dwSize))
		{
			if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwRVA, &dwRVA))
			{
				return VIRUS_NOT_FOUND;
			}
			if(0 == dwSize)
			{
				return VIRUS_NOT_FOUND;
			}
		}

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwSize];
		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}

		if(!GetBuffer(dwRVA, dwSize, dwSize))
		{
			return VIRUS_NOT_FOUND;
		}

		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};
		TCHAR				szSponser0[] = {_T("500072006500730065007400750070*A9002000500072006F006A0065006300740020004F00430053*4F00430053002E006500780065")}; // P.r.e.s.e.t.u.p *  .. .P.r.o.j.e.c.t. .O.C.S * O.C.S...e.x.e
		
		polydbObj.LoadSigDBEx(szSponser0, _T("not-a-virus:Trojan.DownloadSponsor"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWhiteCertificate
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or 10001 (for Digital Signaure Found)
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function is designed to search for company in from digital certificate tables.
					  Companies Digital Certificates of reputed companies
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWhiteCertificateEx() // Sign from Certificate only
{
	DWORD	dwReadBuffOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress;

	if(0x0 == dwReadBuffOffset)
	{
		return VIRUS_NOT_FOUND;
	}

	DWORD BUFF_SIZE  = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size;

	if(0x0 == BUFF_SIZE) 
	{
		return VIRUS_NOT_FOUND;
	}

	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData; 
	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].VirtualAddress != dwOverlayStart)
	{
		dwReadBuffOffset = m_pMaxPEFile->m_dwFileSize - BUFF_SIZE;
	}

	if(BUFF_SIZE > 0x3C00)	// size should be less than 15kb
	{
		BUFF_SIZE = 0x3C00;	// 1st 15kb from start of Certificate
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff =NULL;
	}

	m_pbyBuff = new BYTE[BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return VIRUS_NOT_FOUND;
	}
	
	if(!GetBuffer(dwReadBuffOffset, BUFF_SIZE, (BUFF_SIZE/3)))
	{
			return VIRUS_NOT_FOUND;
	}

	CSemiPolyDBScn		objdbscan;
	TCHAR				szVirusName[MAX_PATH] = {0};

	LPCTSTR  szMicrosoftCorp	= (_T("4D6963726F736F667420436F72706F726174696F6E*4D6963726F736F667420436F72706F726174696F6E"));					// Certificate Serial key and LLC Pentagon
	LPCTSTR  szSymantecCorp	= (_T("53796D616E74656320436F72706F726174696F6E*53796D616E74656320436F72706F726174696F6E"));					// Certificate Serial key and LLC Pentagon
	LPCTSTR  szOracle =  (_T("4F7261636C6520416D65726963612C20496E632E*4F7261636C6520416D65726963612C20496E632E"));
	LPCTSTR  szgoogleinc = (_T("476F6F676C6520496E63*476F6F676C6520496E63"));
	//LPCTSTR  szSysinternals = (_T("53007900730069006E007400650072006E0061006C007300*53007900730069006E007400650072006E0061006C007300"));
	LPCTSTR  szMIcrosoftWin = (_T("4D6963726F736F66742057696E646F7773*4D6963726F736F66742057696E646F7773"));

	objdbscan.LoadSigDBEx(szMicrosoftCorp,_T("Microsoft.Corp"), TRUE);
	objdbscan.LoadSigDBEx(szSymantecCorp,_T("White.Cert.Symantec"), TRUE);
	objdbscan.LoadSigDBEx(szOracle,_T("White.Cert.Oracle"), TRUE);
	objdbscan.LoadSigDBEx(szgoogleinc,_T("White.Cert.Google"), TRUE);
	//objdbscan.LoadSigDBEx(szSysinternals,_T("White.Cert.SysInternal"), TRUE);
	objdbscan.LoadSigDBEx(szMIcrosoftWin ,_T("White.Cert"), FALSE);

	if(objdbscan.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			return 10001;
		}
	}

	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWhiteCertificate
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or 10001 (for Digital Signaure Found)
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function is designed to search for company in from digital certificate tables.
					  Companies Digital Certificates of reputed companies
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWhiteCertificate() // Sign from Certificate only
{
	TCHAR szFileName[MAX_PATH] = {0};
	_tcscpy(szFileName,m_pMaxPEFile->m_szFilePath);
	HCERTSTORE hStore = NULL;
	HCRYPTMSG hMsg = NULL; 
	PCCERT_CONTEXT pCertContext = NULL;
	PCMSG_SIGNER_INFO pSignerInfo = NULL;
	BOOL fResult;   
	DWORD dwEncoding, dwContentType, dwFormatType;

	DWORD dwSignerInfo = 0x00;
	CERT_INFO CertInfo; 
	LPTSTR szName = NULL;
	DWORD dwData;

	if (pSignerInfo != NULL) LocalFree(pSignerInfo);
	if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
	if (hStore != NULL) CertCloseStore(hStore, 0);
	if (hMsg != NULL) CryptMsgClose(hMsg);

	fResult = CryptQueryObject(CERT_QUERY_OBJECT_FILE,
		szFileName,
		CERT_QUERY_CONTENT_FLAG_PKCS7_SIGNED_EMBED,
		CERT_QUERY_FORMAT_FLAG_BINARY,
		0,
		&dwEncoding,
		&dwContentType,
		&dwFormatType,
		&hStore,
		&hMsg,
		NULL);
	if (!fResult)
	{
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}

	fResult = CryptMsgGetParam(hMsg, 
		CMSG_SIGNER_INFO_PARAM, 
		0, 
		NULL, 
		&dwSignerInfo);
	if (!fResult)
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}

	pSignerInfo = (PCMSG_SIGNER_INFO)LocalAlloc(LPTR, dwSignerInfo);
	if (!pSignerInfo)
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}
	fResult = CryptMsgGetParam(hMsg, 
		CMSG_SIGNER_INFO_PARAM, 
		0, 
		(PVOID)pSignerInfo, 
		&dwSignerInfo);
	if (!fResult)
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}

	CertInfo.Issuer = pSignerInfo->Issuer;
	CertInfo.SerialNumber = pSignerInfo->SerialNumber;

	pCertContext = CertFindCertificateInStore(hStore,
		ENCODING,
		0,
		CERT_FIND_SUBJECT_CERT,
		(PVOID)&CertInfo,
		NULL);
	if (!pCertContext)
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}
	dwData = pCertContext->pCertInfo->SerialNumber.cbData;

	if (!(dwData = CertGetNameString(pCertContext, 
		CERT_NAME_SIMPLE_DISPLAY_TYPE,
		CERT_NAME_ISSUER_FLAG,
		NULL,
		NULL,
		0)))
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}
	szName = (LPTSTR)LocalAlloc(LPTR, dwData * sizeof(TCHAR));
	if (!szName)
	{
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}
	if (!(CertGetNameString(pCertContext, 
		CERT_NAME_SIMPLE_DISPLAY_TYPE,
		0,
		NULL,
		szName,
		dwData)))
	{
		if (szName != NULL) LocalFree(szName);
		if (pSignerInfo != NULL) LocalFree(pSignerInfo);
		if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
		if (hStore != NULL) CertCloseStore(hStore, 0);
		if (hMsg != NULL) CryptMsgClose(hMsg);
		return 0;
	}

	_tcslwr(szName);
	if (pSignerInfo != NULL) LocalFree(pSignerInfo);
	if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
	if (hStore != NULL) CertCloseStore(hStore, 0);
	if (hMsg != NULL) CryptMsgClose(hMsg);

	if (_tcscmp(L"microsoft corporation",szName) == 0 || 
		_tcscmp(L"google llc",szName) == 0 ||
		_tcscmp(L"Aura india private ltd.",szName) == 0 ||
		_tcscmp(L"adobe inc.",szName) == 0 ||
		_tcscmp(L"symantec corporation",szName) == 0 ||
		_tcscmp(L"microsoft windows",szName) == 0 ||
		_tcscmp(L"oracle america, inc.",szName) == 0 ||
		_tcscmp(L"proton technologies ag",szName) == 0)
	{
		return 10001;
	}

	/*
	TCHAR szDummy[MAX_PATH] = {0};

	_tcscpy(szDummy,szName);
	_tcslwr(szDummy);
	if (pSignerInfo != NULL) LocalFree(pSignerInfo);
	if (pCertContext != NULL) CertFreeCertificateContext(pCertContext);
	if (hStore != NULL) CertCloseStore(hStore, 0);
	if (hMsg != NULL) CryptMsgClose(hMsg);

	if (_tcscmp(L"microsoft corporation",szDummy) == 0 || 
		_tcscmp(L"google llc",szDummy) == 0 ||
		_tcscmp(L"Aura india private ltd.",szDummy) == 0 ||
		_tcscmp(L"adobe inc.",szDummy) == 0 ||
		_tcscmp(L"symantec corporation",szDummy) == 0 ||
		_tcscmp(L"microsoft windows",szDummy) == 0 ||
		_tcscmp(L"oracle america, inc.",szDummy) == 0)
	{
		return 10001;
	}
	*/
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCertificate
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: This function is designed to search for company in from digital certificate tables.
					  Companies Digital Certificates are exclusively revoked by its issuer
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCertificate() // Sign from Certificate only
{
	DWORD	dwReadBuffOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress;

	if(0x0 == dwReadBuffOffset)
	{
		return VIRUS_NOT_FOUND;
	}

	DWORD BUFF_SIZE  = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size;

	if(0x0 == BUFF_SIZE) 
	{
		return VIRUS_NOT_FOUND;
	}

	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData; 
	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].VirtualAddress != dwOverlayStart)
	{
		dwReadBuffOffset = m_pMaxPEFile->m_dwFileSize - BUFF_SIZE;
	}

	if(BUFF_SIZE > 0x3C00)	// size should be less than 15kb
	{
		BUFF_SIZE = 0x3C00;	// 1st 15kb from start of Certificate
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff =NULL;
	}

	m_pbyBuff = new BYTE[BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return VIRUS_NOT_FOUND;
	}
	
	if(!GetBuffer(dwReadBuffOffset, BUFF_SIZE, (BUFF_SIZE/3)))
	{
			return VIRUS_NOT_FOUND;
	}

	CSemiPolyDBScn		objdbscan;
	TCHAR				szVirusName[MAX_PATH] = {0};
	//------------------------------------With Primary Checks---------------------------------------
	if(m_wNoOfSections == 0x05 && m_pSectionHeader[2].SizeOfRawData == 0x1600 && m_pSectionHeader[4].SizeOfRawData >= 0x2800 
		&& m_pSectionHeader[4].SizeOfRawData <= 0x2E00 && BUFF_SIZE == 0x1570)
	{
		LPCTSTR	szShared = {_T("3880360034007300680061007200650064002E0063006F006D*44006F0077006E006C006F00610064002000480065006C007000650072")};
		objdbscan.LoadSigDBEx(szShared, _T("not-a-virus:Adware.4Shared"), TRUE); // Trojan.4Shared
	}
	//----------------Adware.ClickRun-----------------------------
	if((m_wNoOfSections == 0x08) && m_wAEPSec == 0 && memcmp(m_pSectionHeader[2].Name, "BSS", 3) == 0)
	{
		LPCTSTR  szClickRun = {_T("436C69636B2072756E20736F66747761726530*61646D696E40636C69636B72756E736F6674776172652E636F6D30")};
		objdbscan.LoadSigDBEx(szClickRun, _T("not-a-virus:ClickRun"), TRUE);	//
	}
	//----------------Adware.InstallBrain--------------------------
	if(BUFF_SIZE >= 0x1500 && BUFF_SIZE <= 0x2100)
	{
		if(((m_wNoOfSections == 0x05 || m_wNoOfSections == 0x04)) || (m_wNoOfSections == 0x03 && m_pSectionHeader[0].SizeOfRawData == 0x00))	
		{
			LPCTSTR	szInstallBrain0 = {_T("426561766572746F6E31*506572666F726D6572736F6674204C4C43")};
			LPCTSTR	szInstallBrain1 = {_T("426561766572746F6E31*59656C6C6F77536F667420496E63")};
			LPCTSTR	szInstallBrain2 = {_T("426561766572746F6E31*4D6564696154656368536F667420496E63")};
			objdbscan.LoadSigDBEx(szInstallBrain0, _T("not-a-virus:Adware.InstallBrain"), TRUE);
			objdbscan.LoadSigDBEx(szInstallBrain1, _T("not-a-virus:Adware.InstallBrain"), TRUE);
			objdbscan.LoadSigDBEx(szInstallBrain2, _T("not-a-virus:Adware.InstallBrain"), TRUE);
		}
	}
	//----------------Trojan.Safe Decision, Inc---------------------
	if(((((m_wNoOfSections == 0xD && m_wAEPSec == 0xB && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData == 0x1B000) ||
		  (m_wNoOfSections == 0x7 && m_wAEPSec == 0x5 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData == 0x1D000))&& (m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].Misc.VirtualSize < 0x100))
		|| ((m_wNoOfSections == 0xA || m_wNoOfSections == 0x5) && m_wAEPSec == 0x0 && (m_dwAEPUnmapped & 0xF000) == 0x3000))
		&& (BUFF_SIZE == 0xCA0 || BUFF_SIZE == 0x818))
	{
		DWORD dwAddOffset = 0x65D;
		if(BUFF_SIZE == 0x818)
			dwAddOffset = 0x1F1;
		
		BYTE bySafeDecSign[] = {0x53, 0x61,0x66, 0x65, 0x20, 0x44, 0x65, 0x63, 0x69, 0x73, 0x69, 0x6F, 0x6E, 0x2C, 0x20, 0x49, 0x6E, 0x63};
		if(memcmp(&m_pbyBuff[dwAddOffset], bySafeDecSign, sizeof(bySafeDecSign)) == 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,_T("not-a-virus:Trojan.Safe Decision, Inc"));
			return VIRUS_FILE_DELETE;
		}
	}
	//------------------Optimum.Installer-------------------------------
	if((BUFF_SIZE == 0x1F28 || BUFF_SIZE == 0xEB0 || BUFF_SIZE == 0x740 || BUFF_SIZE == 0x1460 || BUFF_SIZE == 0x1898 || BUFF_SIZE == 0x1328) && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05))
	{
		
		BYTE byOptimum[]   = {0x4F, 0x70, 0x74, 0x69, 0x6D, 0x75, 0x6D, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x65, 0x72},
			 byiBryteJcs[] = {0x50, 0x72, 0x65, 0x6D, 0x69, 0x75, 0x6D, 0x20, 0x49, 0x6E, 0x73, 0x74, 0x61, 0x6C, 0x6C, 0x65, 0x72},
			 byiBryteJda[] = {0x54, 0x49, 0x4E, 0x59, 0x20, 0x49, 0x4E, 0x53, 0x54, 0x41, 0x4C, 0x4C, 0x45, 0x52},
			 byiBryteGen[] = {0x55, 0x04, 0x0A, 0x14, 0x06, 0x69, 0x42, 0x72, 0x79, 0x74, 0x65, 0x31};
		for(int i = 0; i < m_dwNoOfBytes - sizeof(byOptimum); i++)
		{
			if(memcmp(&m_pbyBuff[i], byOptimum, sizeof(byOptimum)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Optimum.Installer"));
				return VIRUS_FILE_DELETE;
			}
			else if(memcmp(&m_pbyBuff[i], byiBryteJcs, sizeof(byiBryteJcs)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Adware.iBryte.jcs"));
				return VIRUS_FILE_DELETE;
			}
			else if(memcmp(&m_pbyBuff[i], byiBryteJda, sizeof(byiBryteJda)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Adware.iBryte.jda"));
				return VIRUS_FILE_DELETE;
			}
			else if(memcmp(&m_pbyBuff[i], byiBryteGen, sizeof(byiBryteGen)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Adware.iBryte.gen"));
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	//-----Adware.Agent.allm------27/jun/2014 Ramandeep Singh---Detection:97.59%---------------

	if	(m_wAEPSec == 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size > 0 &&
		( (m_wNoOfSections == 0x7 && m_dwAEPUnmapped ==0x39AC && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7200 &&
		 m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x70BC )||(m_wNoOfSections == 0x5 && m_dwAEPUnmapped ==0x323C && 
		 m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5C00 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x5A5A)))
		
	{  
		LPCTSTR szAgentAllm1 = {_T("54686177746520436F6465205369676E696E67204341*53495445204F4E2053504F54204C7464")};
		LPCTSTR szAgentAllm2 = {_T("7777772E64696769636572742E636F6D*54656C2041766976*536F6D6F746F204C696D69746564")};
		objdbscan.LoadSigDBEx(szAgentAllm1,	_T("Adware.Agent.allm"),TRUE);	
		objdbscan.LoadSigDBEx(szAgentAllm2,	_T("Adware.Agent.allm"),TRUE);
	}
	//------------------Solimba.gen------------------------------------ Added by Sandeep on 2nd June,2014
	if((m_dwAEPUnmapped == 0x4327 || m_dwAEPUnmapped == 0x323C || m_dwAEPUnmapped == 0x333F) && (m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].Size > 0) &&
		(m_wNoOfSections == 0x07 || m_wNoOfSections == 0x05) && 
		(m_pSectionHeader[0].SizeOfRawData == 0x8A00 || m_pSectionHeader[0].SizeOfRawData == 0x5C00) &&
		(m_pSectionHeader[1].SizeOfRawData == 0x200 || m_pSectionHeader[1].SizeOfRawData == 0x1200 || m_pSectionHeader[1].SizeOfRawData == 0x1400) &&
		(m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x4600 || m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x6E00 || m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData == 0x2800))
	{
		LPCTSTR szSig	 = {_T("426164616C6F6E6131223020*536F6C696D62612041706C69636163696F6E657320532E4C")};
		objdbscan.LoadSigDBEx(szSig, _T("not-a-virus:Adware.Solimba.gen"), TRUE);
	}

	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x9C40 && m_wNoOfSections == 0x08 && 
		m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9400)
	{
		LPCTSTR	szInstallCoreJ = {_T("4F6E7465636E6961204D65646961204E6574776F726B73*4F6E7465636E6961204D65646961204E6574776F726B73")};//Ontecnia Media Networks
		objdbscan.LoadSigDBEx(szInstallCoreJ, _T("not-a-virus:Adware.InstallCore.j"), TRUE);// Adware.InstallCore.j
	}

	if(m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 && 
		(m_dwAEPUnmapped == 0x30FA || m_dwAEPUnmapped == 0x9C40) && (m_wNoOfSections == 0x05 || m_wNoOfSections == 0x08) && 
		(m_pSectionHeader[0].SizeOfRawData == 0x5E00 || m_pSectionHeader[0].SizeOfRawData == 0x9400) )
	{
		LPCTSTR	szAgentGK0 = {_T("56697474616C6961204C696D69746564*56697474616C6961204C696D69746564")};//vittalia limited
		LPCTSTR	szAgentGK1 = {_T("313030426C6F677320534C*313030426C6F677320534C")};//100Blogs SL
		objdbscan.LoadSigDBEx(szAgentGK0, _T("not-a-virus:Downloader.Agent.gk"), TRUE);
		objdbscan.LoadSigDBEx(szAgentGK1, _T("not-a-virus:Downloader.Agent.gk"), TRUE);
	}
	
	if(m_wAEPSec == 0x0 && (m_dwAEPUnmapped > 0x17000 || m_dwAEPUnmapped <87000) && 
		(m_wNoOfSections == 0x05 || m_wNoOfSections == 0x06) && m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020)
	{
		LPCTSTR	szTrackCash0 = {_T("537175617265204E6574776F726B2054656368*537175617265204E6574776F726B2054656368")};//Square Network Tech
		LPCTSTR	szTrackCash1 = {_T("687474703A2F2F747261636B2E6D6F6263*6C69636B2E6E65742F646F776E6C6F61642F")};//http://track.mobclick.net/download
		LPCTSTR	szTrackCash2 = {_T("687474703A2F2F7777772E747261636B6669*6C65646F776E6C6F61642E636F6D2F66696C65")};//http://www.trackfiledownload.com/file
		LPCTSTR	szTrackCash3 = {_T("4E616E6E696E6720776569777520546563686E6F6C6F6779*4E616E6E696E6720776569777520546563686E6F6C6F6779")};//Nanning weiwu Technology
		
		objdbscan.LoadSigDBEx(szTrackCash0, _T("Trojan.Trackcash"), TRUE);
		objdbscan.LoadSigDBEx(szTrackCash1, _T("Trojan.Trackcash"), TRUE);
		objdbscan.LoadSigDBEx(szTrackCash2, _T("Trojan.Trackcash"), TRUE);
		objdbscan.LoadSigDBEx(szTrackCash3, _T("Trojan.Trackcash"), TRUE);//Trojan.Trackcash
		
	}

	//----------------Downloader.Lmn.afx  && Downloader.Lmn.afi-----------------------------


	if(m_wAEPSec==0x0 && (m_wNoOfSections == 0x06 || m_wNoOfSections == 0x03 || m_wNoOfSections == 0x05 ||m_wNoOfSections == 0x04) && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size==0x1178) 
	{
		LPCTSTR	 szDwnldLMNafi	= {_T("4F00620073006F006C006500740065*03E0092EFF98DE7CC5F1F99075953A18")};
		LPCTSTR	 szDwnldLMNafx	= {_T("4F00620073006F006C006500740065*00CC0F261D7E85068D83E0A6524610F1D8")};

		objdbscan.LoadSigDBEx(szDwnldLMNafi,	_T("not a virus:Downloader.LMN.afi"), TRUE);
		objdbscan.LoadSigDBEx(szDwnldLMNafx,	_T("not a virus:Downloader.LMN.afx"), TRUE);
	}

	//--------------------not-a-virus:Adware.Midia.f----------------------------------------------
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x7A9D8 && m_wNoOfSections == 0x08  && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x79C00 && m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0xAD000)
	{
		LPCTSTR	szAdwareMidiaF0 = {_T("425220534F465457415245204C4C43*4252534F465457415245*6272736F6674776172656C6C6340676D61696C2E636F6D")};//BR Software LLC
		LPCTSTR	szAdwareMidiaF1 = {_T("425220534F465457415245204C4C43*425220534F465457415245*6272736F6674776172656C6C6340676D61696C2E636F6D")};//BR Software LLC
			
		objdbscan.LoadSigDBEx(szAdwareMidiaF0, _T("not-a-virus:Adware.Midia.f"), TRUE);//Adware.Midia.f
		objdbscan.LoadSigDBEx(szAdwareMidiaF1, _T("not-a-virus:Adware.Midia.f"), TRUE);
	}

	//---------------------Downloader.Morstar.bad-------------------------------------------------
	if(m_wNoOfSections==0x05 && ( m_dwAEPUnmapped >= 0xCA00 && m_dwAEPUnmapped <= 0xDFFF)&& m_wAEPSec == 0x0 &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1C000||m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1BC00 ||m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1C600 ||m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1B400 ||m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1C200))
	{
		LPCTSTR	 szmorstarbad	= {_T("42617263656C6F6E61*426164616C6F6E61*504F50454C45522053595354454D")};
		objdbscan.LoadSigDBEx(szmorstarbad,	_T("not-a-virus:Downloader.Win32.Morstar.bad "), TRUE);
	}
	//---------------------Downloader.Morstar.dhp------------------------------------------------------
	if(m_wNoOfSections==0x05 && ( m_dwAEPUnmapped ==0xC6AC)&& m_wAEPSec == 0x0 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1AE00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1BC00)
	{
		LPCTSTR	 szmorstardhp	= {_T("11214A840538566C60A8459CC4FF24F6A711*426164616C6F6E61*56657461666F726D20446576656C6F706D656E7473")};
	    objdbscan.LoadSigDBEx(szmorstardhp,	_T(" 	not-a-virus:Downloader.Win32.Morstar.dhp "), TRUE);
	}
	
	//-----not-a-virus:Downloader.Agent.beao ------ Yogesh Sakat------------------

	if( m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size > 0 && m_dwAEPUnmapped == 0x30FA
		  && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x5C4C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5E00 )
	{
		LPCTSTR szAgentBeao = {_T("5765446F776E6C6F61642C204C746431*5765446F776E6C6F61642C204C746430*0320C5B8F7CE6E92D3665598826A4480")};  //WeDownload, Ltd1  *  WeDownload, Ltd0  *    Serial No
		objdbscan.LoadSigDBEx(szAgentBeao,_T("not-a-virus:Downloader.Agent.beao"),TRUE);
	}	

	//------------------------------------Adware.MultiPlug.ehwa-----------------------------------

	if(m_wAEPSec == 0 && m_wNoOfSections>=0x4 && m_wNoOfSections<=0x7 )
	{
		LPCTSTR	szMultiPlugEhwa = {_T("15d51642691b3ee20985639a8fe865dd*416C657865792E6B7572696C656E6B6F40686F746D61696C2E636F6D")};//[Alexey.kurilenko@hotmail.com]
		objdbscan.LoadSigDBEx(szMultiPlugEhwa, _T("not-a-virus:Adware.MultiPlug.ehwa"), TRUE);
	}
	
	//-----------------------------not-a-virus:Downloader.Widoman.a---------------

	if(0x0==m_wAEPSec && (0x5==m_wNoOfSections || 0x6==m_wNoOfSections ) 
		&& (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL)!=IMAGE_FILE_DLL)
	{
		LPCTSTR	szWidomanA = {_T("62C4C7A64C8A37907F0A31EF11A79AC6*57696E6E657220536F6C7574696F6E73204C4C43")};
		objdbscan.LoadSigDBEx(szWidomanA, _T("not-a-virus:Downloader.Widoman.a"),TRUE);
	}
	//----------------------------not-a-virus:Adware.Linkun.j--------------------------
	if(m_wAEPSec == 0x0 && m_wNoOfSections ==0x05 && m_dwAEPUnmapped == 0x30CB && 
	m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5A00)
	{
		LPCTSTR	szAdwareLinkunJ0 = {_T("5265646F6E646F204265616368*4C696E6B756C6172204C4C4331*4C696E6B756C6172204C4C4330")};//Linkular LLC
		
		objdbscan.LoadSigDBEx(szAdwareLinkunJ0, _T("not-a-virus:Adware.Linkun.j"), TRUE);
		
	}

	//----------------------------not-a-virus:AdWare.MSIL.iBryte.o--------------------------
	if	(m_wAEPSec == 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[14].Size > 0 && m_wNoOfSections == 0x3 && 
		(m_dwAEPUnmapped >=0x30A00 && m_dwAEPUnmapped <=0x32000)&& m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x2EC00)
	{  
		LPCTSTR szAgentAllm1 = {_T("11214970685444EA564782B9D78C5544B747*4E6572642054616273204C4C4331*2CA6B3*537461726669656C6420546563686E6F6C6F676965732C20496E63")};
		objdbscan.LoadSigDBEx(szAgentAllm1,	_T("not-a-virus:AdWare.MSIL.iBryte.o"),TRUE);	
	}

	//----------------------------not-a-virus:WebToolbar.Win32.Cossder.ah----------------------
	if	(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xD374 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize==0x15C18)
	{  
		LPCTSTR szWebToolbarCossder = {_T("41727475722053656D616E696E31*61727475726E657740646576656C6F70677572752E696E666F*38bedba31b62d500b998286a80e230eb")};
		objdbscan.LoadSigDBEx(szWebToolbarCossder,	_T("not-a-virus:WebToolbar.Win32.Cossder.ah "),TRUE);	
	}
	
	//----------------------------not-a-virus:Downloader.Win32.DriverUpd.wxv----------------------
	if	(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPUnmapped ==0x8B4E  && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize==0x83EF )
	{  
		LPCTSTR szDriverupd = {_T("696E666F4076616C69636572742E636F6D*079EA58C1A6ED1*537461726669656C6420546563686E6F6C6F676965732C20496E63*504C5547494E2055504441544520532E4C")};
		objdbscan.LoadSigDBEx(szDriverupd,	_T("not-a-virus:Downloader.Win32.DriverUpd.wxv"),TRUE);
	}
	
	//----------------------Adware.OutBrowse.byy,not-a-virus:AdWare.OutBrowse.byy-------------------
	if(0x30FA==m_dwAEPMapped && 0x5==m_wNoOfSections)
	{

		LPCTSTR	szOutBrowseByy = {_T("1121C2B62F950620B06898B61A2141C617E2*54696B692054616B61")};//[Serial No]*Tiki Takal
		objdbscan.LoadSigDBEx(szOutBrowseByy, _T("not-a-virus:AdWare.OutBrowse.byy"),TRUE);
	}
	//----------------------not-a-virus:Downloader.driverupd.ipb-------------------------------------

	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1388)
	{	
		LPCTSTR szDriverhlh={_T("53616E7461204372757A206465*506C7567696E20534C31*457A2C44F936DD8EEF974AFC80E53578")};
		objdbscan.LoadSigDBEx(szDriverhlh, _T("not-a-virus:Downloader.driverupd.ipb"),TRUE);
	}	

	//-----------------------not-a-virus:Downloader.driverupd.hlh-----------------------------------------------
	if(m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size == 0x1390)
	{
		LPCTSTR szDriverhlh={_T("53616E7461204372757A206465*506C7567696E20534C31*457A2C44F936DD8EEF974AFC80E53578")};
		objdbscan.LoadSigDBEx(szDriverhlh, _T("not-a-virus:Downloader.driverupd.hlh"),TRUE);
	}

	//-----------------------not-a-virus:Adware.Midia.ahdh-----------------------------------------------
	//Alisha
	if(m_wAEPSec == 0x00 && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && (m_dwAEPMapped == 0x263C || m_dwAEPMapped == 0x8B902) && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xAB000))
	{
		LPCTSTR szMidiaahdh={_T("DE2CA50D54127B901BF2CFE3*D0DEF5")};
		objdbscan.LoadSigDBEx(szMidiaahdh, _T("not-a-virus:Adware.Midia.ahdh"),TRUE);
	}

	//-----------------------not-a-virus:Downloader.byDownloaderGuid.pwj-----------------------------------------------
	//Alisha
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x5 && (m_dwAEPMapped & 0xF000F) == 0x1000C && (m_dwAEPUnmapped & 0xF000F) == 0x1000C)
	{
		BYTE byDownloaderGuid[]   = {0x00, 0xBC, 0xED, 0xCE, 0x12, 0x9E, 0x9A, 0xA2, 0x36, 0xBB, 0xF4, 0xBC, 0x05, 0x9A, 0x58, 0xBA, 0x55};
		LPCTSTR szDownloaderGuid={_T("00BCEDCE129E9AA236BBF4BC05*58BA55")};
		objdbscan.LoadSigDBEx(szDownloaderGuid, _T("not-a-virus:Downloader.byDownloaderGuid.pwj"),TRUE);
	}
	//-----------------------not-a-virus:Adware.Fiseria.ie---------------------------------------------------------------
	//Sneha Kurade
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && (m_dwAEPMapped >= 0xCBED || m_dwAEPMapped <= 0xD43C) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >=0x1C400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData <=0x1C800)&& BUFF_SIZE == 0x1AC0)
	{
		LPCTSTR	szFiseria = {_T("4265636869726F20532E4C2E*0de376129471b42ce6bca90326047a34")};
		objdbscan.LoadSigDBEx(szFiseria, _T("not-a-virus:Adware.Fiseria.ie"), TRUE); // Trojan.Fiseria.ie
	}
	//---------------------------Downloader.FrieCook.a--------------------------------------------
	//Alisha
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x9040 && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x9400))
	{
		LPCTSTR szSig	 = {_T("112188FF79FB726173E4354F5D668F721A4F*4672656520446F776E6C6F61642028467269656420436F6F6B6965204C7464")};
		objdbscan.LoadSigDBEx(szSig, _T("not-a-virus:Downloader.FrieCook.a"), TRUE);
	}

	//-----------------------------Trojan.Agent.ifat----------------------------------------------
	//Alisha
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && ((m_dwAEPMapped & 0xFF000) >= 0x1D000) && ((m_dwAEPMapped & 0xFF000) <= 0x1F000))
	{
		LPCTSTR szSig	 = {_T("715A33AE9117D0C2B07CE5B9C396152A*526F64696F6E2056657265736576311730")};//serial no*Rodion Veresev1.0
		objdbscan.LoadSigDBEx(szSig, _T("Trojan.Agent.ifat"), TRUE);
	}

	//-----------------------------Downloader.CentrumLoader.a-------------------------------------
	if(m_wAEPSec == 0x1 && m_wNoOfSections ==0x09 && m_dwAEPMapped == 0x86A98 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0A00)
	{
		LPCTSTR	szCentrumLoaderA = {_T("43656E7472756D20486F6C64696E677320732E722E6F2E*5b19803c2f9a19f74dfdf69c694930e5")};//
		objdbscan.LoadSigDBEx(szCentrumLoaderA, _T("Downloader.CentrumLoader.a"), TRUE);
	}
	//-----------------------------Adware.MSIL.Eorezo.cj-------------------------------------
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x13A52 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13A00) 
	{
		LPCTSTR szMSILEorezocj	 = {_T("636C6F7564347063*61646D696E7340636C6F75643470632E636F6D")};// Name , Email Id
		objdbscan.LoadSigDBEx(szMSILEorezocj, _T("Adware.MSIL.Eorezo.cj"), TRUE);
	}
	//-----------------------------Dropper.Agent.bjqqjd-------------------------------------
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x18983 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x28E00) 
	{
		LPCTSTR szAgentBjqqjd	 = {_T("3d79358f1cb0629c9595f33e197e886f*494E53414645")};// Name and seriel no.
		objdbscan.LoadSigDBEx(szAgentBjqqjd, _T("Dropper.Agent.bjqqjd"), TRUE);
	}

	//-----------------------------not-a-virus:AdWare.ICLoader.AHFK-------------------------------------
	// Swapnil Sanghai
	if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && (m_pSectionHeader[0].SizeOfRawData ==0x349000 || m_pSectionHeader[0].SizeOfRawData ==0x34A000) && m_pSectionHeader[1].SizeOfRawData ==0x1000)
	{
		LPCTSTR	 szAdwICL	= {_T("00BAC99C02090065AB875A9184F270889F*47454854534F4654")};
		objdbscan.LoadSigDBEx(szAdwICL,	_T("not-a-virus:AdWare.ICLoader.AHFK"), TRUE);
	}

	//-----------------------------not-a-virus:WebToolbar.Codiby.EMF-------------------------------------
	// Swapnil Sanghai
	if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x14CFF0 && m_pSectionHeader[0].SizeOfRawData ==0x14E800)
	{
		LPCTSTR	 szWebtlbrCodibyEMF	= {_T("447261676F6E2053657276696365*0F8AB2E17CD7C38F0A414500678E65")};
		objdbscan.LoadSigDBEx(szWebtlbrCodibyEMF, _T("not-a-virus:WebToolbar.Codiby.EMF"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.Agent.JWTW-------------------------------------
	// Sneha Kurade
	if(m_wAEPSec == 0x0 && m_wNoOfSections ==0x05 && (m_dwAEPMapped >= 0x315D && m_dwAEPMapped <= 0x31CD) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x11400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x11600)&& (m_pMaxPEFile->m_stPEHeader.CheckSum >= 0x23C52 && m_pMaxPEFile->m_stPEHeader.CheckSum <= 0x34117))
    {
		LPCTSTR		szAdwareAgentJWTW = {_T("42756E646C6F7265204C696D69746564*232ce5297f2941a352148152a936fb93")};
		objdbscan.LoadSigDBEx(szAdwareAgentJWTW, _T("not-a-virus:Adware.Agent.JWTW"), TRUE);
	}
	
	//-----------------------------not-a-virus:Adware.ICLoader.JAF-------------------------------------
	// Alisha
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == m_dwAEPUnmapped && (m_dwAEPMapped & 0xFFF00F) == 0x124000 && (m_pMaxPEFile->m_stSectionHeader[0x1].SizeOfRawData == 0x1000))
	{
		LPCTSTR szICLoaderjaf	 = {_T("00F1D39FAAD39A52EAE619AFD0D19A9B82*4C4C432C2053454F2D52554D")};//SERIAL NO*LLC, SEO-RUM
		objdbscan.LoadSigDBEx(szICLoaderjaf, _T("not-a-virus:Adware.ICLoader.JAF"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.InstallMonster.JSAR-------------------------------------
	// Sneha
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x4 && m_dwAEPMapped  == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4F6000)
	{
		LPCTSTR szSig	 = {_T("27E6852B245B556D3FFC3D9738C73EF8*50524F4649544F2C204C4C43")};//serial no*name
		objdbscan.LoadSigDBEx(szSig, _T("not-a-virus:Adware.InstallMonster.JSAR"), TRUE);
	}

	//-----------------------------not-a-virus:WebToolbar.Codiby.GEN-------------------------------------
	// Swapnil
	if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x14CFF0 || m_dwAEPMapped == 0x145A58 && m_pSectionHeader[0].SizeOfRawData == 0x14E800 || m_pSectionHeader[0].SizeOfRawData == 0x147000)
	{
		LPCTSTR	 szWebtlbrCodibyemf	= {_T("447261676F6E2053657276696365*0F8AB2E17CD7C38F0A414500678E65")};  //Dragon Service*Serial No
		objdbscan.LoadSigDBEx(szWebtlbrCodibyemf, _T("not-a-virus:WebToolbar.Codiby.GEN"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.ICLoader.IWJ-------------------------------------
	// Swapnil
	if(m_wNoOfSections ==0x04 || m_wNoOfSections ==0x05 && m_dwAEPMapped & 0xFFFF00 &&  m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x34D000 && 
	   m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 && m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData) == 0x1F18)
	{
		LPCTSTR	szAdwareICLoaderiwj = {_T("009D8CEF4E1393C58A0466CF6BBCC83B04*22495420484F4C44494E4722204C4C43*616B756C6F762E64656E4069742D686F6C64696E672E636F6D2E7561")};
		objdbscan.LoadSigDBEx(szAdwareICLoaderiwj, _T("not-a-virus:Adware.ICLoader.IWJ"), TRUE);
	}

	//-----------------------------not-a-virus:Downloader.Adload.LKKN-------------------------------------
	// Swapnil
	if (m_wNoOfSections == 4 && m_dwAEPMapped & 0xF000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xE000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000)
	{
		LPCTSTR	 sziAdwDownAdloadLKKN	= {_T("79DB1629A125B1CDAA6C39B8A0B7360E*4F4F4F20225374696B7322")};  
		objdbscan.LoadSigDBEx(sziAdwDownAdloadLKKN, _T("not-a-virus:Downloader.Adload.LKKN"), TRUE);
	}

	//-----------------------------not-a-virus:Downloader.Win32.DownloaderGuide.K-------------------------------------
	// Swapnil
	if(m_wNoOfSections == 0x5 && m_dwAEPMapped & 0xF0000 &&  m_pSectionHeader[0].SizeOfRawData & 0xF0000)
	{
		LPCTSTR	 szDownGuideK	= {_T("249E4122D3206380E8C5DB9AFC085C73*436F7675732050726F20476D6248")};
		objdbscan.LoadSigDBEx(szDownGuideK,	_T("not-a-virus:Downloader.Win32.DownloaderGuide.K"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.Agent.HJRU-------------------------------------
	// Swapnil
	if(m_wNoOfSections == 0x16 || m_wNoOfSections == 0x1C && m_dwAEPMapped == 0xF0000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x600 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x800)
	{
		LPCTSTR	 szAdwAgentHJRU	= {_T("076E053D14B7F3599E1558AAAC5613C1*536563757265496E7374616C6C2C204C4C43")};
		objdbscan.LoadSigDBEx(szAdwAgentHJRU, _T("not-a-virus:Adware.Agent.HJRU"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.AdLoad.ZPJV-------------------------------------
	// Swapnil
	if (m_wNoOfSections == 4 || m_wNoOfSections == 5 &&  m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData) == 0x13F8)
	{
		LPCTSTR	 szAdwAdlZPJV	= {_T("00A1A8731C79367FBF17020F28B60C1C79*22536D6172742D556E696F6E222C4C4C43")};
		objdbscan.LoadSigDBEx(szAdwAdlZPJV,	_T("not-a-virus:Adware.AdLoad.ZPJV"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.InstallMonster.MIHY-------------------------------------
	// Swapnil
	if(m_wNoOfSections==0x08 && m_dwAEPMapped == 0x9E98 &&  m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA200 && m_pMaxPEFile->m_dwFileSize == 0xEEA28)
	{
		LPCTSTR	 szAdwInstallMonMIHY	= {_T("00B3238F64F3F894B9*416D617A696E6720536F6674776172652050726F6475637473")};
		objdbscan.LoadSigDBEx(szAdwInstallMonMIHY,	_T("not-a-virus:Adware.InstallMonster.MIHY "), TRUE);
	}

	//-----------------------------not-a-virus:Downloader.DownloAdmin.bhoz-------------------------------------
	// Aniket
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && (m_dwAEPMapped==0x41D6 || m_dwAEPMapped==0x4216) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xE200))
	{
		LPCTSTR szDownloAdminbhoz	 = {_T("5E43099D2166479B*4B5049204D656469612047726F7570")};// SERIAL NO*Company Name , KPI Media Group
		objdbscan.LoadSigDBEx(szDownloAdminbhoz, _T("not-a-virus:Downloader.DownloAdmin.BHOZ"), TRUE);
	}

	//-----------------------------not-a-virus:Adware.MultiPlug.bei-------------------------------------
	// Sneha Kurade
	if(m_wNoOfSections==0x04 && m_dwAEPMapped == 0xFC5B &&  m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19A00)
	{
		LPCTSTR	 szAdwMultiPlugBEI	= {_T("4F70656E20536F7572636520446576656C6F7065722C20*536572676569204976616E6F766963682044726F7A646F76*64726F7A646F76353440686F746D61696C2E636F6D*4E05AFB21C1318DB8A2C0669760C9050")};
		objdbscan.LoadSigDBEx(szAdwMultiPlugBEI,	_T("not-a-virus:Adware.MultiPlug.BEI"), TRUE);
	}

	//-----------------------not-a-virus:Adware.Wajam.Gen------------------------------
	// Swapnil
	if(m_wNoOfSections==0x07 && m_dwAEPMapped == 0x990CC && m_wAEPSec == 0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData==0xE4000 && 
	   (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL && 
	    m_pMaxPEFile->m_dwFileSize == 0x141FC8 &&
	    m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x1197F4 && 
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress == 0x13E000 && 
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size == 0x3FC8)
	{
		LPCTSTR	 szAdwWajam	= {_T("70696C6C6163746563686E6F6C6F67792E636F6D*1832FA91942F8EA95A39380C")};
		objdbscan.LoadSigDBEx(szAdwWajam,	_T("not-a-virus:Adware.Wajam.Gen"), TRUE);
	}

	//-----------------------not-a-virus:HEUR:AdWare.Win32.InnoBundle.gen------------------------------
	// Swapnil
	if(m_wAEPSec == 0x01 && m_wNoOfSections == 0x08 && m_dwAEPMapped == 0xFFDC && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x19000 &&
		m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData == 0x3C600)
	{
		LPCTSTR  szDownInnoBun = {_T("49534106AF6F3AD3BC7A8702A8EF0396*D09ED09ED09E20C2ABD090D0BFD0BFD181D0B5D182C2BB")};
		objdbscan.LoadSigDBEx(szDownInnoBun ,	_T("not-a-virus:HEUR:AdWare.Win32.InnoBundle.gen"), TRUE);
	}

	//-----------------------HEUR:Hoax.Win32.Reptile.gen------------------------------
	// Swapnil
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && m_dwAEPMapped == 0xB5C0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBA00)
	{
		LPCTSTR  szHoxReptile = {_T("723180E2A807DDA0F77264108931DA53*5861637469")};
		LPCTSTR  szWebToolbarReptileGEN = {_T("687474703A2F2F746F6F6C6261722E*696E626F782E636F6D2F")};

		objdbscan.LoadSigDBEx(szHoxReptile ,	_T("HEUR:Hoax.Win32.Reptile.gen"), TRUE);
		objdbscan.LoadSigDBEx(szWebToolbarReptileGEN  ,	_T("not-a-virus:HEUR:WebToolbar.Win32.Reptile.gen"), TRUE);
	}
	//--------------------------------------------------------------------------

	//-----------------------NetTool.Win64.NetFilter.O------------------------------
	// Sagar
	if(m_wNoOfSections==0x09 && m_dwAEPMapped == 0x5c64 &&  m_wAEPSec == 0x6 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA00)
	{
        LPCTSTR  szNetToolNetFiltero = {_T("1121B348573C1CA1DF257D517183A16A9C79*42696C696D62693110300E0603550403130742696C696D6269308201")}; //Bilimbi

       objdbscan.LoadSigDBEx(szNetToolNetFiltero ,	_T("not-a-virus:NetTool.Win64.NetFilter.O"), TRUE);
	}

	//-----------------------Adware.razy.33261-----------------------------
	// Mukesh
	if(m_wNoOfSections ==0x07 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		LPCTSTR  szHoxReptile = {_T("45536967687420496E7369676874*19484BD7D8DD4B8619C11740D5AE0229")};
		objdbscan.LoadSigDBEx(szHoxReptile ,	_T("Adware.razy.33261"), TRUE);

	}

	//-----------------------Trojan.Bsymem.drl-----------------------------
	// Sagar
	if(m_wAEPSec == 0x1 && m_wNoOfSections == 0x8  && m_pSectionHeader[m_wAEPSec].PointerToRawData==0xf800 && m_dwAEPUnmapped == 0x117dc && m_dwAEPMapped==0xffdc )
	{
		LPCTSTR	 szBsymemdrl	= {_T("0C07597974637665713110300E060355*04030C075A636772716C77310B30*0C07597974637665713110300E060355*04030C075A636772716C77310B30")};
		objdbscan.LoadSigDBEx(szBsymemdrl,	_T("Trojan.Bsymem.drl"), TRUE);
	}

	//-----------------------Trojan.Zamg.U-----------------------------
	// Aniket
	if((m_wNoOfSections == 0x04) && m_wAEPSec == 0 && m_dwAEPMapped == m_dwAEPUnmapped)
	{
		LPCTSTR  szZamgU = {_T("53696E6768204167696C6520436F6E74656E742044657369676E204C696D69746564*696E666F4073696E67682D636F6E74656E742E636F2E756B")};
		objdbscan.LoadSigDBEx(szZamgU, _T("Trojan.Zamg.U"), TRUE);	//
	}

	//-----------------------not-a-virus:AdWare.Win32.DealPly.ehppe------------------------------
	// Aniket
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && m_dwAEPMapped == 0x99F8 && m_dwAEPUnmapped == 0xA5F8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E00)
	{
		LPCTSTR  szDealPlyehppe = {_T("416C706861204372697465726961204C7464*416C706861204372697465726961204C7464")};
		objdbscan.LoadSigDBEx(szDealPlyehppe ,	_T("not-a-virus:AdWare.Win32.DealPly.ehppe"), TRUE);
	}

	//---------------------------------Trojan.SelfDel.groc------------------------------//
	// Aniket
	if(m_wAEPSec == 0x00 || m_wAEPSec == 0x01 && m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05 || m_wNoOfSections == 0x03 && m_dwAEPMapped == m_dwAEPUnmapped )
	{
		LPCTSTR  szSelfDelGroc = {_T("4D414E44412053454355524954592050524F464553*53494F4E414C532C204C5444")};
		objdbscan.LoadSigDBEx(szSelfDelGroc ,	_T("Trojan.SelfDel.GROC"), TRUE);
	}

	//---------------------------------Trojan.Win32.Bsymem.EFO------------------------------//
	// Swapnil
	if(m_wNoOfSections == 0x08 && m_dwAEPMapped == 0xFFDC && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x19000 && m_pMaxPEFile->m_dwFileSize == 0x1498C8)
	{
		LPCTSTR	szTrojanBsymemEFO	= {_T("51766E736464310E300C06035504030C054171656A6C*51766E736464310E300C06035504030C054171656A6C")};	
		objdbscan.LoadSigDBEx(szTrojanBsymemEFO   ,_T("Trojan.Win32.Bsymem.EFO"), TRUE);
	}

	//---------------------------------not.a.virus.AdWare.MegaSearch.gen------------------------------//
	// Swapnil
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0xFCAB && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19A00)
	{
		LPCTSTR	szAdwMegaSearchGEN	=	{_T("6534084D6A4B724011508EF1B5AD13D6*416E6472657920476C6F62696E*636174406361746D656C2E696E666F")};            
		objdbscan.LoadSigDBEx(szAdwMegaSearchGEN,_T("not.a.virus.AdWare.MegaSearch.gen"), TRUE);
	}

	//---------------------------------not.a.virus.Downloader.Generic------------------------------//
	// Swapnil
	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0xEBE7 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x23000)
	{
		LPCTSTR	szDownGen1 = {_T("008BDD4E3193295EE9*4152524F4E5445434820534F465457415245204C494D49544544")};
		LPCTSTR	szDownGen2 = {_T("30B7CA48C45C664CC111E89C3EB87FEC*48415354494E475320494E5445524E4154494F4E414C20422E562E")};

		objdbscan.LoadSigDBEx(szDownGen1, _T("not.a.virus.Downloader.Generic"), TRUE);
		objdbscan.LoadSigDBEx(szDownGen2, _T("not.a.virus.Downloader.Generic"), TRUE);
	}

	//------------------------------------Without Primary Checks------------------------------------
	LPCTSTR  szDwnldLMNgen0	= (_T("326EC322624296E34D6183514D11E84E*4C4C432050656E7461676F6E"));					// Certificate Serial key and LLC Pentagon
	LPCTSTR  szDwnldLMNgen1	= (_T("77019A082385E4B73F569569C9F87BB8*696E666F40616E64636F6D70616E792E7275"));		// Certificate Serial key 
	LPCTSTR  szDwnldLMNgen2	= (_T("6502A25EFF2BF211ECBA032383C2C6BA*696E666F4069742D6C696E656D736B2E7275"));		// Certificate Serial key 
	LPCTSTR  szDwnldLMNxe	= (_T("0776444138B82422DF336D2BF7FD2968*4E616B68696D6F7661*4B72756E64"));				// Certificate Serial key 
	LPCTSTR  szDwnldLMNf1	= (_T("6502A25EFF2BF211ECBA032383C2C6BA*4954204C696E6531"));							//Certificate Serial key for LoadMoney.f
	LPCTSTR  szDwnldLMNf2	= (_T("204E717AF42FC1AC4E22F179E6AF42F3*5649535431"));
	LPCTSTR  szDwnldMR0		= (_T("506F7274616C50726F6772616D6173*6F7274616C50726F6772616D6173"));
	LPCTSTR  szDwnldMR1		= (_T("534554555050524F434553*534554555050524F434553"));
	LPCTSTR  szDwnldMR2		= {_T("536F6C696D62612041706C69636163696F6E6573*536F6C696D6261")};
	LPCTSTR  szDwnldLMNye	= (_T("4142534F4C5955542054524549442C204F4F4F*00C51E1AEF06FDC803CF08B62FC59F7557"));	// Certificate Serial key  and Name
	//LPCTSTR  szOutBrowseB	= (_T("56a6fe571611b68c9224798ad62913ca*52616D61742047616E31123010060355040A14094F757442726F777365313E*3082010a0282010100a7ac02429b9befb0c2e452"));
	LPCTSTR  szDwnldLMNgen3	= (_T("494E464F524D415453494F4E4E59452054454B484E4F4C4F474949*4D9D81FB1247142AE81FF73D60F97FD3"));
//	LPCTSTR  szConduit0		= (_T("3a82654719d8f75b59134f7b66465210*436F6E64756974204C7464"));						// Serial no * Conduit Ltd
//	LPCTSTR  szConduit1		= (_T("45F87694FE8D1984719796AEC8031DF4*506572696F6E204E6574776F726B204C7464"));		// Serial no * Perion Network Ltd
//	LPCTSTR  szConduit2		= (_T("110f603e63c86349a5f243ea06966f33*436F6F6C4D6972616765204C74642E"));				// Serial no * CoolMirage Ltd.
//	LPCTSTR  szConduit3		= (_T("3736DA15AF647632CCE61CD41B6577DD*436F6E64756974204C74642E"));					// Serial no * Conduit Ltd
	LPCTSTR  szLinkular		= {_T("27c70f809279a3*4C696E6B756C6172204C4C4331153013060355*3082010A0282010100E3FC2C6C8BA1A361AE8E8C13BB463F7CD66E76A3AD693BB836D6F4")}; // Certificate Serial key  
	LPCTSTR  szSomoto		= (_T("536F6D6F746F2049737261656C31*536F6D6F746F2049737261656C30"));
	LPCTSTR	 szSigSolimba	= {_T("426164616C6F6E61*737570706F727440736F6C696D6261")};
	LPCTSTR  szOutBrowseB    = (_T("52616D61742047616E*4F555442524F575345"));		//Ramat Gan*OutBrowse
	LPCTSTR  szOutBrowseG    = (_T("52616D61742047616E*4F757442726F777365"));		//Ramat Gan*OUTBROWSE
	LPCTSTR	 szFiseria		 = (_T("4649525345524941*4649525345524941"));			//FIRSERIA*FIRSERIA
	LPCTSTR  szOutBrowseBBL    = (_T("52616D61742047616E*4F555462726F777365"));     //Ramat Gan*OUTbrowse
	LPCTSTR	 szBRSoftware	= {_T("4F70656E20536F7572636520446576656C6F706572*6272736F6674776172656C6C6340676D61696C2E636F6D")};
	LPCTSTR  szDwnldLMNaca  = (_T("2E9D66F88B13880A37872C17A2E17029*4C4C43204954204D616E6167656D656E74"));
	LPCTSTR szPlayTurtle = {_T("506C617920547572746C65*506C617920547572746C65")};
	LPCTSTR szTrojanJ0		={_T("098417F7EA6406EC7B320590E17A65B7*4D696E64737061726B20496E746572616374697665204E6574776F726B")};
	LPCTSTR szTrojanJ1		={_T("41730eb0e6d92a476e16628a0dbefb36*4D696E64737061726B20496E746572616374697665204E6574776F726B")};
	LPCTSTR szInstallVibeAb	={_T("00f29201ebc1ead2b751f2854ad68c6244*496E7374616C6C5669626573")};
	LPCTSTR	 szWebtoolbaravw	= {_T("49737261656C*4E657373205A696F6E61*436C69656E74436F6E6E656374204C5444")};
	LPCTSTR  szAgentAqda	= (_T("78D22334FC3A8C23C5226A26540F86C6*4A6F7474697820696E7465726E6174696F6E616C206D6564696120472E204D")); //Certificate Serial key * Jottix international media G. M
	LPCTSTR  szKranetG	= (_T("0CD194221ED016F035BD7BACA4027DC3*53616E20446965676F3126302406035504090C1D313036323020547265656E61205374726565742053756974652032333031*4D65676162726F7773653113301106035504030C0A4D65676162726F77736530*6365727473406D65676162726F7773652E62697A")); // YOGESH
	LPCTSTR  szGoobzo0	= (_T("49737261656C*476F6F627A6F204C5444*476F6F627A6F204C5444"));
	LPCTSTR	 szSigIbryteJhp	= {_T("4F00620073006F006C006500740065*26B6A2E42157A5020CF75500730F2CF3")};
	LPCTSTR szAiraddInstaller = {_T("566963746F72696131153013060355040A140C41697220536F66747761726531*41697220536F66747761726530*3AC786E09219DF82DA830E461D4FC39F")};
	LPCTSTR	szisoftpulseybk = (_T("01438AF7C5B708CB0E497C84D028BF72*477569612044652049736F7261*506C7567696E20557064617465*01438AF7C5B708CB0E497C84D028BF72*43006C00690063006B00200022005900450053002200200074006F00200062006500670069006E002000730065007400750070"));
	LPCTSTR	sziBrytejhl = (_T("4D6973736F7572693114301206035504070C0B4B616E7361732043697479*4D616469736F6E2041766520464C20313031143012060355040A0C0B4C69*4C69717569646275696C64"));
	LPCTSTR szMorstarEwe = {_T("7D4509F01375B349F2DE66BF15A48CD7*42617263656C6F6E613111300F06035504071308426164616C6F6E6131*504F50454C45522053595354454D")};
	LPCTSTR	szMorstarBaad = (_T("7D4509F01375B349F2DE66BF15A48CD7*42617263656C6F6E61*504F50454C45522053595354454D"));
	LPCTSTR szMorstarFbg = {_T("0EF8CB39AB15607AB4EF554EB245AFB1*42617263656C6F6E61*45696C696F20446576656C6F706D656E74732C20732E6C")};
	LPCTSTR	szYotoonXYO = {_T("5265636F72642050616765*5265636F72642050616765*420d8c325bcf64fba46bf2f2e2aac265")};//Record Page and seriel number
	LPCTSTR szReqPS3 = {_T("18DA5D77283E42E4EA6279778229FFBA*53742E204D69636861656C*47726561742041707073")};
    LPCTSTR szReqPS2 = {_T("7D61D56D95A57700E33F4323BC658FD9*53616E20446965676F*5061737320616E6420506C6179")};
    LPCTSTR szReqPS1 ={_T("5C76BD56433708C69DEAA66A9837A517*53616E20446965676F*43617420446F67")};
	LPCTSTR szMorstarFce = {_T("118CB8518EA58F13E8564921BC606003*424144414C4F4E4131*504947415445522053595354454D")};
	LPCTSTR szMorstarFcg = {_T("09CCB9F75710AD5CAD663DEF1AFEF7BF*504947415445522053595354454D*737570706F7274407069676174657273797374656D2E636F6D")};
	LPCTSTR szReqPS4 = {_T("61DE6EF5A0C35D1FC5D9A64C4791281C*53616E20446965676F*46696C74657220526573756C747331")};
	LPCTSTR szAdwareMultiPlugNbjr = {_T("6F6C65682E616C656B7379756B40686F746D61696C2E636F6D*3082010A0282010100A4DB97A24C62DA*4E5EA82EA4FC659A225BA88D2DD96A0A*3F42151CCAD6E8C610946EE44021DAF5")};//[oleh.aleksyuk@hotmail.com]
	LPCTSTR	szSoftpulseXVM = {_T("506C7567696E2055706461746520532E4C2E*506C7567696E2055706461746520532E4C2E*0E923B9CF60DA59FC3A43A87A8071FC2")};//Company name and seriel number
	LPCTSTR szAdwareIhdo={_T("53616E20446965676F*457870726573732046696E64*77B12701E8BEED7CAC979CAD84929826")};
	LPCTSTR szDownFch={_T("0ECFF438C8FEBF356E04D86A981B1A50*6401528D61284BEE9666B64CBA9B368A*4341524F53454E54452050524F4A4543542C20532E4C")};
	LPCTSTR	szDwnldLMNade = {_T("073734171C2AD1B60C674267620A6C93*5468617774652C20496E63")};
	LPCTSTR	szDwnldLMNafw = {_T("00ba9220e1bef0519921922b933c27dfdd*53766572646C6F76736B")};
	LPCTSTR	szDwnldLMNgep = {_T("00D60847E39B584310D58407A5090B843C*536D6172742053656375726520536F667477617265")};
	LPCTSTR	szMorstarApz = {_T("44757262616E76696C6C65310F*11211594C14279DEF101FBACE6D408D1C14E")};
	LPCTSTR	szSigSoftPlusG	= {_T("229111B20CCF13394E8E6CA9EAB4121F*53616E7461204372757A")};
	LPCTSTR	szSigSoftPlusYfj	= {_T("23D0DE494A0B1445D561131B4AEDA90C*53616E7461204372757A")};
	LPCTSTR	szSigLMNAdg		= {_T("552610CA660BDA5B05753B55699DF110*4D6F636B6F76736B617961206F626C617374")};
	LPCTSTR	szSigLMNAhf		= {_T("5B6A93520D54B6626ADB1AF5B6FDE0A0*4D756B6F6D6F6C6E79")};
	LPCTSTR	szSigLMNAhu	= {_T("00DC8081929C6F2B3484DAE70B64635CE7*466C6F74736B617961")};
	LPCTSTR	szSigLMNAhu_1	= {_T("5B6A93520D54B6626ADB1AF5B6FDE0A0*4D756B6F6D6F6C6E79")};
	LPCTSTR	szSigLMNAin		= {_T("00C5748D950B5855C8F1291300CAA21E91*647A686F6E696B69647A65")};
	LPCTSTR	szSigLMNAiu		= {_T("008E183416DE03F976E8A4D748A29E0CDE*4B4F4E454E4B4F5641")};
	LPCTSTR	szSigLMNAiz		= {_T("008E183416DE03F976E8A4D748A29E0CDE*534D4F4C454E534B")};
	LPCTSTR	szSigLMNAiz_1	= {_T("2595E9AF2C4D1EDB8526A00C99357F23*4B616C696E696E67726164")};
	LPCTSTR	szSigLMNAio		= {_T("00F2BA93FBA5FC7F8DA70439F110A8AB8C*5374726F6D796E6B6131")};
	LPCTSTR	szSigDriverupdHlh	= {_T("457A2C44F936DD8EEF974AFC80E53578*4372757A2064652054656E6572696665")};
	LPCTSTR szAdWICLoader = (_T("436F6E736F727469756D2047726F7570206C7464*436F6E736F727469756D2047726F7570206C7464")); //Consortium Group ltd * Consortium Group ltd
    LPCTSTR szAdWICLoader1 = (_T("436F6E736F727469756D206C7464*436F6E736F727469756D206C7464")); //Consortium ltd * Consortium ltd
	LPCTSTR	szSigSmartInstaller	= {_T("61B50595685F5A33D7709C52CAC559DA*546F6D696C696E6F")};
	LPCTSTR	szSigYottonAdbt	= {_T("19F5D4497933566E59B41EAD8B41CB60*447261676F6E")};
	LPCTSTR	szSigDriverupdIbp	= {_T("457A2C44F936DD8EEF974AFC80E53578*53616E7461204372757A2064652054656E6572696665")};
	LPCTSTR	szSigSoftPlusxsx	= {_T("47353B4EEC0D902A135E20BEE1A66817*616E7461204372757A2064652054656E6572696665")};
	LPCTSTR	szSigSoftPlusP	= {_T("01438AF7C5B708CB0E497C84D028BF72*54656E6572696665")};
	LPCTSTR	szSigSoftPlusYbr	= {_T("0E923B9CF60DA59FC3A43A87A8071FC2*477569612064652049736F7261")};
	LPCTSTR szSigMorstarBht	= {_T("112137190C5DFED5E171B34698C4D7367405*4265636869726F")};
	LPCTSTR	szSigSoftPlusFcr	= {_T("13D5C30806C3A51F3AB837BBFF8D5EC5*494D4245524E4553")};
	LPCTSTR	szSigMorstarFcs	= {_T("11219194A2E7EDD02B7DFBEA99132A3C4275*42415243454C4F4E41")};
	LPCTSTR szSigMorstarLa	= {_T("11218832573D4BDD488A310AF2AC15B41F25*45696C696F")};
	LPCTSTR	szSigMorstarFca	= {_T("40AA34E55B1BC6EE54598A0C83C81304*496E76657374656E61")};
	LPCTSTR	szSigOutBrowseBxe	= {_T("112120D679EF1EE7D9572B904048A1A11800*426F6E20446F6E204A6F76")};
	LPCTSTR	szSigLMNAmx	= {_T("0A592524DE85C7D382CCF65F09E16728*4B616C696E696E67726164")};
	LPCTSTR szSigPlocustLcxy	= {_T("5FA92DD6EF72F9E2B23E099D11B8EF44*416E64726F6E6F76736B6F65")};
	LPCTSTR	szAdwareFileTourJCG	= {_T("504F4C494B4F5049522C204F4F4F31*504F4C494B4F5049522C204F4F4F30")}; //Tushar => POLIKOPIR, OOO*POLIKOPIR, OOO0 ==> Digital Certificate was exclusively revoked by its issuer
	LPCTSTR	szDownloaderGuidePWJ	= {_T("467265656D69756D20476D6248311630*467265656D69756D20476D624830")}; //Tushar => The Company "Freemium GmbH" is creating Bundled Installers with Advertisements
	LPCTSTR	szDownloaderGuideJ	= {_T("467265652D6D69756D20476D62483117*467265652D6D69756D20476D624830")}; //Tushar => The Company "Freemium GmbH" is creating Bundled Installers with Advertisements
	LPCTSTR	szDownloaderGuideGen	= {_T("434F4D50555445522042494C44204469676974616C20476D624831*434F4D50555445522042494C44204469676974616C20476D624830")}; //Tushar => The Company "Freemium GmbH" is creating Bundled Installers with Advertisements
	LPCTSTR	szDownloaderGuideGen2	= {_T("476D6248311A30*20476D624830")}; //Tushar => The Company "Freemium GmbH" is creating Bundled Installers with Advertisements
	LPCTSTR	szCrossRider	= {_T("4167696F7320446F6D6574696F73*4469676974204E6574776F726B202845787472656D65205768697465204C696D6974656429")}; //Tushar => The Company Digit Network (Extreme White Limited), creates unwanted softwares packages (Tool bars)
	LPCTSTR	szWebToolCroRibei	= {_T("00A1BB8569950C0B2080A11A0E2F618B33*4B696D6168726920536F66747761726520696E632E")};
	LPCTSTR	szWebToolCroRibtj	= {_T("00ECF35E880AD0F3BC6F82DFB1F2E84CC0*526F626F6B696420546563686E6F6C6F67696573")};
	LPCTSTR	szStrictor	=		{_T("009F3C178BBD6EE1737FCA8EFE1B29A2F3*544F5252454E54")};
	LPCTSTR szMultiplugOaqk = {_T("416E647265792E486D656C6E696B6F7640686F746D61696C2E636F6D*727B500ADD12D49F610A094EBFE02E4B")};//Andrey.Hmelnikov@hotmail.com* serial no
	LPCTSTR szAgentIF	 = {_T("022c6886f5c72feed25746f4ac3ba8ce*494E5354414C4C2054484953")};//serial no*Install this
	LPCTSTR szAgentOcna	 = {_T("434F4D50555445522042494C44204469676974616C20476D6248*3FA913BCFD78C2AA7C07414BB8442483")};//serial no*COMPUTER BILD Digital GmbH
	LPCTSTR szWebToolbarAE	 = {_T("42616E646F6F204D65646961*20496E63*42616E646F6F204D65646961*20496E63")};  //Bandoo Media Inc
	LPCTSTR	szSigWebAltaD	= {_T("00D2DF90913DCC669380B5AD75791544A2*6B7574736B617961206F62")};
	LPCTSTR	szMultiplugOfeb   = {_T("4da70bc5d170c81a264d2fefc580b716*45676F72204B6C6F63686B6F*7374726F6E672E6B6C6F63686B6F406C6973742E7275")};
	LPCTSTR	szAgentIfat   = {_T("715a33ae9117d0c2b07ce5b9c396152a*526F64696F6E2056657265736576")};
	LPCTSTR	szDwnldLMNahx = {_T("49542D534552564953*49cff2290babf351009a74693e4c904e")};
	LPCTSTR	szSomatoR	= {_T("536F6D6F746F204C7464*02fed381427052f6e66365a4627fb0ed")};
	LPCTSTR	szAdwareFileTourHAJ	= {_T("4D414C4954454B31*4D414C4954454B30")}; //Tushar => MALITEK1*MALITEK0 ==> Digital Certificate was exclusively revoked by its issuer
	LPCTSTR	szImaliC = {_T("494D414C4920E28093204E2E492E204D45444941204C544431*494D414C4920E28093204E2E492E204D45444941204C544431")}; //Tushar => IMALI ... N.I. MEDIA LTD1*IMALI ... N.I. MEDIA LTD1
	LPCTSTR	szOutBrowseBZY = {_T("54696B692054616B6131*54696B692054616B6130")};//Tushar ==> Tiki Taka1*Tiki Taka0
	LPCTSTR	szInffinityYAS = {_T("496E6666696E69747920496E7465726E657431*496E6666696E69747920496E7465726E657430")};//Tushar ==> Inffinity Internet1*Inffinity Internet0
	LPCTSTR	szAgentHCZR = {_T("4F4F4F202259757476204D656469612231*4F4F4F202259757476204D656469612230")};//Tushar ==> OOO "Yutv Media"1*OOO "Yutv Media"0 //Explicitly Revoked by Issuer
	LPCTSTR	szOutBrowseBZA = {_T("5361466520536F66747761526520734C4C31*5361466520536F66747761526520734C4C30")};//Tushar ==> SaFe SoftwaRe sLL1*SaFe SoftwaRe sLL0
	LPCTSTR	szMyWebSearchTR = {_T("4D696E64737061726B20496E746572616374697665204E6574776F726B31*4D696E64737061726B20496E746572616374697665204E6574776F726B30")};//Tushar ==> Mindspark Interactive Network1*Mindspark Interactive Network0
	LPCTSTR	szAdwSoftPlusCGBV	= {_T("5D0A1845D85007CD040B350F48C5F721*41707020736563757265204C4C43")}; // Swapnil Sanghai
	LPCTSTR	szWbtlbrAgentBAE	= {_T("4B6C69702050616C*59A8A4CF2048A90F9AE8754A98A645E4")}; // Swapnil Sanghai
	LPCTSTR szDownloaderGuideI = {_T("00b62903fe5ead70014a936cd880180a7a*4F636F6E6F20476D6248")}; //Sneha Kurade
	LPCTSTR szAgentBDG = {_T("53757266456E68616E6365*53757266456E68616E6365")}; //Sneha Kurade
	LPCTSTR szAgentBCY	= {_T("40C4725F1712C4789A4BDCEA560D5BE2*7375726620736C696465*7375726620736C696465")}; //Sneha Kurade
	LPCTSTR	szWebToolbarAgentAHJ = {_T("437261776C65722047726F75702C204C4C43*437261776C65722047726F75702C204C4C43")}; //Sneha Kurade ==> Crawler Group, LLC
	LPCTSTR	szAgentBAH = {_T("54EAA4FDDD0AEB1183ED278A995C36F7*4164616E616B*4164616E616B")}; //Sneha Kurade
	LPCTSTR	szAgentBAF = {_T("526164205261746572*526164205261746572")}; //Sneha Kurade
	LPCTSTR	szWebToolbarAgentAIQ = {_T("437261776C65722C204C4C43*437261776C65722C204C4C43")}; //Sneha Kurade ==> Crawler, LLC
	LPCTSTR szEorezo = {_T("5475746F3450432E636F6D31*11214E18677190942D49073E30C52D17C351")};//Alisha ==> Tuto4PC.com1*serial no
	LPCTSTR szFakeInstaller = {_T("4179EA1BEC59D4CA7E66862832555480*457667656E204B756769746B6F")};//Alisha ==> Evgen Kugitko*serial no
	LPCTSTR	szStartSurfC = {_T("53656375726520446F776E6C6F6164732058333631*53656375726520446F776E6C6F6164732058333630")};//Tushar ==> Secure Downloads X361*Secure Downloads X360
	LPCTSTR szLinkSwift = {_T("6C696E6B7377696674*6C696E6B7377696674")};//linkswift*linkswift
	LPCTSTR szDownloadHelperDCX = {_T("3CCA67117AE7C5BE2F99ECBA3ECC9F69*56756C79747379612044616C6E7974736B612C20427564796E6F6B*0D4C4C432022415A20534F465422")};//LLC "AZ SOFT"
	LPCTSTR szDownloadHelperDHH = {_T("00BB3CCAF99CC223A1AD34177B638A3BC8*495420415544495420414E4420434F4D504C49414E4345205345525649434553204C4C43")};//IT AUDIT AND COMPLIANCE SERVICES LLC
	LPCTSTR szDealplyAPFOU = {_T("2A9FE0366B280B65E2788E33BDF8123E*57656263656C6C656E6365204C7464")};//Webcellence Ltd
	LPCTSTR szRubar = {_T("5275626172204C4C43*61646D696E4072756261726C6C632E636F6D")};//Rubar llc
	LPCTSTR szDriverPack = {_T("4B757A79616B6F7620417274757220567961636865736C61766F76696368204950*4B757A79616B6F7620417274757220567961636865736C61766F76696368204950")};//
	LPCTSTR szLMNAKT = {_T("224B4F4D502D474152414E54222C4F4F4F*224B4F4D502D474152414E54222C4F4F4F")};//"KOMP-GARANT",OOO
	LPCTSTR	szAgentJRAM	= {_T("4334444C204D65646961*70D154A322A603A8766AC35933E06140")};
	LPCTSTR	szDownloaderLMNApe = {_T("1DA99F3707BD77E0DCD9A582E11C8FF3*494E5452412C204F4F4F")};//INTRA, OOO
	LPCTSTR	szDownloaderLMNUhmx	= {_T("4C4C4320426C616272756D*6C6C632E626C616272756D4079616E6465782E7275*3E20B53982BE3C224BD1515C4776025C")};//LLC Blabrum
	LPCTSTR	szAgentACOK	= {_T("00A7C14EE4C077938029F3A7B5E3DE5FD1*5A45542D5220534F4654")};
	LPCTSTR	szAgentBUT	= {_T("5A8A8EB89241677A4F3C653900D6D12E*5072696D61727920526573756C74")};//Primary Result
	LPCTSTR	szCrossRiderKTI	= {_T("416972706C616E65204E6574776F726B7320*28427269676874436972636C6520496E766573746D656E7473204C696D6974656429*00ADA185AFC7F23D3C115D613E31289B")};
	LPCTSTR	szCrossRiderKYC	= {_T("416344632050726F6A65637420*28427269676874436972636C6520*496E766573746D656E7473204C696D6974656429*00BB5CB272841409598560E8776848BBF4")};
	LPCTSTR	szSearchSuiteX	= {_T("694D65736820496E632E*33F899CFA53E7CFBF698D456F5A0A87C")};//iMesh Inc.
	LPCTSTR	 szWbtlbrAgentBSI	= {_T("3A4111572DC58360F25560523A458483*4F6C6761204D696B6861796C6F7661*4F6C6761204D696B6861796C6F7661*4F6C6761204D696B6861796C6F7661")};
	LPCTSTR szIbryte	 =  {_T("00FA71459C161D5D538F7612ACFBFBB680*5361666520446F776E")};//serial key
	LPCTSTR	 szWebtlbrCodibyemf	= {_T("447261676F6E2053657276696365*0F8AB2E17CD7C38F0A414500678E65")};
	LPCTSTR	 sziBryteJJO	= {_T("5EE011413A702F6705B25B34B674F3AB*4A6F6C746C6F676963")};
	LPCTSTR	 szLMNala	= {_T("00EA94EC5CBA3B7367DD60F5F2C486FF6A*496E65742070726F64756B74*61646D696E40696E657470726F647563742E7275")};
	LPCTSTR	 szLMNale	= {_T("008F8AF4451E61CD493E2A4911EDF99404*46616C636F6E20546563686E6F6C6F6779*737570706F72744066616C636F6E7465632E7275")};
	LPCTSTR	 szDownLMNanc	= {_T("35E2FE54B6461DCD9DFB0447461EC15D*534D415254554D*61646D696E406F6F6F2D736D617274756D2E7275")};
	LPCTSTR	 szDownLMNukbi	= {_T("5CE7DCCDCBB4CC16DC53B581A7710692*426573742050726F67*6265737470726F676D736B4079616E6465782E7275")};
	LPCTSTR	 szDownLMNalo	= {_T("00DE50502864AD81B9AC5B5C93201532A3*41544D412D4B4F4D*61646D696E4061746D612D6B6F6D2E7275")};
	LPCTSTR	szAdwareICLoaderiwj = {_T("61646D696E40646566656E73656D6972726F722E636F6D*446566656E7365204D6972726F72204C5444*100001")};
	LPCTSTR	 szMorstarCUN	= {_T("0C903250E5B6BC8883153FAB99138CD5*44616E6F72656C20496E74656772616C")};
	LPCTSTR  szAdwareAmonetizeFHOF  = {_T("52000F617E61399D2E17DF7532309A1D*52000F617E61399D2E17DF7532309A1D")};
	LPCTSTR	 szWDownloaderKASINST	= {_T("11210187E0E8B2519429AE25ED45F682D75E*536976656E746C792053524C")};
	LPCTSTR	 szAdwareAmonetizeCHJN	= {_T("00D0571C6D5A0C08F86BDF425E244EC0E8*464B20534F4654*61646D696E40666B2D736F66742E727530")};
	LPCTSTR	szAdwareAgentMSILOCNAAAE = {_T("62657272796265736561726368*62657272796265736561726368")};
	LPCTSTR	szAdwareAgentMSILOCNAAA = {_T("571A68EFDF8D88E7D7D34481579430EA*571A68EFDF8D88E7D7D34481579430EA")};
	LPCTSTR	szAdwareAgentMSILOCNAAAF = {_T("1B1E1EFD302AF6482FC6671507D8E2A7*1B1E1EFD302AF6482FC6671507D8E2A7")};
	LPCTSTR	szAdwareAgentMSILOCNAAAH = {_T("6474EA2025CF9E5C7B9460E79D3B409E*6474EA2025CF9E5C7B9460E79D3B409E")};
	LPCTSTR	szAdwareAgentMSILOCNAAAO = {_T("18C541759E913EC1CBDA43C13830E0B3*18C541759E913EC1CBDA43C13830E0B3")};
	LPCTSTR	szAdwareAgentMSILOCNAAAU = {_T("3308B48A98D635F50AF4E52B1D5E6168*3308B48A98D635F50AF4E52B1D5E6168")};
	LPCTSTR	szAdwareAgentMSILOCNAAAX = {_T("2D86173680295E7F1148C866779C1987*2D86173680295E7F1148C866779C1987")};
	LPCTSTR	szAdwareAgentMSILOCNAAAY = {_T("0C16ABA3C547AD068A6AA5F218316288*0C16ABA3C547AD068A6AA5F218316288")};
	LPCTSTR	szAdwareAgentMSILOCNAAB = {_T("525d9fa332967c7e9fdf3294c6b5f41d*525d9fa332967c7e9fdf3294c6b5f41d")};
	LPCTSTR	 szAdwareAgentMSILOCNAASB = {_T("3FA913BCFD78C2AA7C07414BB8442483*3FA913BCFD78C2AA7C07414BB8442483")};	
	LPCTSTR	szAdwareAgentIcloaderAEYV = {_T("44A039A91DECC9857001CF41663B9489*4E61727A616E*4E61727A616E*61646D696E406F6F6F2D6E61727A616E2E7275*44A039A91DECC9857001CF41663B9489")};
	LPCTSTR	szAdwareAgentIcloaderIWA = {_T("00d9470e43faf61e39b012a9e5ea7a73ad*544F562022534D41525420414A544922*544F562022534D41525420414A544922*00d9470e43faf61e39b012a9e5ea7a73ad")};
	LPCTSTR	szAdwareAgentIcloaderIWE = {_T("5e76a8edd0515f9102860b7ab8268e93*4C4C4320224E4159414C204159544922*4C4C4320224E4159414C204159544922*5e76a8edd0515f9102860b7ab8268e93")};
	LPCTSTR	szAdwareAgentIcloaderIWK = {_T("009d8cef4e1393c58a0466cf6bbcc83b04*22495420484F4C44494E4722204C4C43*22495420484F4C44494E4722204C4C43*009d8cef4e1393c58a0466cf6bbcc83b04")};
	LPCTSTR	szAdwareAgentIcloaderIWL = {_T("00cc840f7a47106b1e7d0614f50a02684f*444953204D2C20544F56*444953204D2C20544F56*00cc840f7a47106b1e7d0614f50a02684f")};
	LPCTSTR	szAdwareAgentIcloaderIWO = {_T("00a0d8fa0619137039584d094f9c17c8d5*464953484E4554*464953484E4554*00a0d8fa0619137039584d094f9c17c8d5")};
	LPCTSTR	szAdwareAgentIcloaderIXC = {_T("010ca9df7294a6705ba91c975e6afb7a*496E666F526573757273*496E666F526573757273*010ca9df7294a6705ba91c975e6afb7a")};
	LPCTSTR	szAdwareAgentIcloaderIXH = {_T("00fd78645344e7608ccb43d1675d02eba9*4C414E203337*4C414E203337*00fd78645344e7608ccb43d1675d02eba9")};
	LPCTSTR	szAdwareAgentIcloaderIXM = {_T("4cf2e3881756332ebc390b3170190c13*53454F2D52554D*53454F2D52554D*4cf2e3881756332ebc390b3170190c13")};
	LPCTSTR	szAdwareAgentIcloaderIXO = {_T("00cac8e904b0761bbf4e69cb48ad9cbd22*49504F4B415254*49504F4B415254*00cac8e904b0761bbf4e69cb48ad9cbd22")};
	LPCTSTR	 szAdwAgentJRAJ	= {_T("02863B699C5DB2DAEE6433C2053AE339*E2809C57656220776179E2809D204F4F4F*61646D696E407765622D7665792E7275")};
	LPCTSTR	 szWebToolbarCodiby	= {_T("0F8AB2E17CD7C38F0A414500678E65*447261676F6E2053657276696365")};
	LPCTSTR	 szAdLoadTYRR	= {_T("00EB9527E8BCA9329AC92BBC78C8659E06*4F4F4F20224954547320537461727422*69746373746172744079616E6465782E7275")};
	LPCTSTR	 szAdwAgentJEZR	= {_T("069EEE3A188BD66948EDFA466F9B4B55*5349474E4920534F46542053524C")};
	LPCTSTR	 szAdLoadFakeDownAC	= {_T("009CA0BE54A9516364680AD45D6408C6A2*53424953*61646D696E406F6F6F2D736269732E7275")};
	LPCTSTR	 szAdLoadYKFW	= {_T("28080D334EE7DFC423AABC5BD4A33ED9*22506F72742D50726F6D22204C7464")};
	LPCTSTR	 szAdLoadYPFT	= {_T("00E1355431BB7C984FDDE0853E1766743C*22476C6F62616C20527573202D20205472656964222C204C74642E")};
	LPCTSTR	 szAdLoadEORGSUJ	= {_T("11217A044D9875AB5200314888C39C5486EF*5475746F3450432E636F6D")};
	LPCTSTR	 szAdwICLoaderDNIG	= {_T("00FCED9ABB323C8D3440E101E41ED4CFCF*4C4C432C205A45524F4E4953")};
	LPCTSTR	 szAdwICLoaderDWDI	= {_T("5C46F2ED8E28C16CAE718C235AB580A1*4B5241532D4B4F4D2C204C4C43")};
	LPCTSTR	 szAdwICLoaderEEQD	= {_T("00E5AD984CA90CBC1ECDC06013E6861398*59554E494B5345525649532C204C4C43")};
	LPCTSTR	 szAdwICLoaderEPJF	= {_T("04DF017060C48BF5B5A6D26A68F9904C*4F4F4F2C20524F534B4F4E4E454B54")};
	LPCTSTR	 szAdwICLoaderEPJG	= {_T("0BAC4FCF6A44CFE7DACE1BC08CA46288*4C4C432C204B4F4D504147454E54")};
	LPCTSTR	 szAdwICLoaderFFHH	= {_T("448B0E8F326BFBA123D81C5E57D27133*4F4F4F2C204F5242494B412D504C595553")};
	LPCTSTR	 szAdwICLoaderIRB	= {_T("697E502B75A4B3F00630645EC15CE65C*22417564697420466F726D22204142432043656E746572204C4C43")};
	LPCTSTR	 szAdwICLoaderIRE	= {_T("00C2B359ED60C761A895364833F2D9AF20*50726F656B7420542C20544F56")};
	LPCTSTR	 szAdwICLoaderIVK	= {_T("009FE9F3AEC4E24AE55335C3BE2088E4E2*416E76696B6F20414954492C20544F56*6B6F76616C6368756B40616E76696B6F2D69742E636F6D2E7561")};
	LPCTSTR	 szAdwICLoaderJAW	= {_T("00CE0DB63D780B1F6FF0032798FD440BA0*4F4F4F2C2053454C494E4B")};
	LPCTSTR	 szAdwICLoaderJBH	= {_T("504C432C20464F524D4F5A412D4954*00F83BEEB5E6FF03E334295B49F391ED72")};
	LPCTSTR	 szAdwDealKeeper	= {_T("62726F777365626974*62726F777365626974")};
	LPCTSTR	 szAdwInstallMonGEN	= {_T("648AC4D9679F34D4EF1B0CF8*417374726F204E6574776F726B2028416C706861204372697465726961204C74642E29")};
	LPCTSTR	 szAdwMSILOcnaACW	= {_T("53616C6520506C616E6574*53616C6520506C616E6574")};
	LPCTSTR	 szAdwMSILOcnaACY	= {_T("5375706572204772656174*5375706572204772656174")};
	LPCTSTR	 szAdwMSILOcnaADC	= {_T("417374726F2046696E64*417374726F2046696E64")};
	LPCTSTR	 szAdwMSILOcnaADH	= {_T("4469672044656570*4469672044656570")};
	LPCTSTR	 szAdwMSILOcnaADP	= {_T("576562204C6179657273*576562204C6179657273")};
	LPCTSTR	 szAdwMSILOcnaADV	= {_T("456E74657220566F79616765*456E74657220566F79616765")};
	LPCTSTR	 szAdwMSILOcnaAEX	= {_T("426F6C64204C657474657273*426F6C64204C657474657273")};
	LPCTSTR	 szAdwMSILOcnaAEZ	= {_T("477265617420487562*477265617420487562")};
	LPCTSTR	 szAdwMSILOcnaACZ	= {_T("5072696D61727920436F6C6F72*5072696D61727920436F6C6F72")};
	LPCTSTR	 szAdwOcnaBEJ = {_T("00C548FE73466D586F20FBE82D234747C7*41534B20494E5445475241544F52*61736B696E7465677261746F724079616E6465782E7275")};
	LPCTSTR	szAdwOcnaBKK = {_T("4661737420446F776E6C6F61646572204D65646961*06DE6B1C05303BB5")};
	LPCTSTR szOCNAbf = {_T("13396D8733DD5F35D3FC41477C1EB99D*4D6F6B69726179")};//serial no * Mokiray
	LPCTSTR szOCNAanc = {_T("40C372FD48099605BEB4115F56052C9C*48656C70696E672048616E646C65")};//serial no * Helping Handle
	LPCTSTR szOCNAalf = {_T("666F63757362617365*666F63757362617365")};// focusbase * focusbase
	LPCTSTR szOCNAakk = {_T("6F70746974726F79*6F70746974726F79")};// optitroy * optitroy
	LPCTSTR szOCNAaio = {_T("57697365456E68616E6365*57697365456E68616E6365")};// WiseEnhance * WiseEnhance
	LPCTSTR szOCNAaid = {_T("48617342726F777365*48617342726F777365")};// HasBrowse * HasBrowse
	LPCTSTR szOCNAags = {_T("616C6C67656E697573*616C6C67656E697573")};// allgenius * allgenius
	LPCTSTR szOCNAagk = {_T("41707020427564*41707020427564")};// App Bud * App Bud
	LPCTSTR szOCNAbnn = {_T("49504F4B4152542C204C4C43*49504F4B4152542C204C4C43")};// IPOKART LLC*IPOKART, LLC
	LPCTSTR szHiddenInstall = {_T("496E7465722041692D54692C204F4F4F*2A2DCB6250C2FA8A228D0A7DF37523E7*2A2DCB6250C2FA8A228D0A7DF37523E7")};//Inter Ai-Ti, OOO
	LPCTSTR szICLoaderIXV = {_T("56374C37E64A6A8769B36C165638CCFB*5445484E4F415248495631")};//serial no. * TEHNOARHIV1
	LPCTSTR szICLoaderIXY = {_T("4C4C43204954204F50455241544F522055534E*4C4C43204954204F50455241544F522055534E")};//LLC IT OPERATOR USN
	LPCTSTR szICLoaderIYK = {_T("0BDAB05F6627EEC5CB2257445EE94E4F*4B4F4D5049554D")};//serial no*KOMPIUM
	LPCTSTR szICLoaderIZD = {_T("0084737D8F13E48789BA455283D5D36BA7*544F5620536D6172742054656B686E696B73")};//serial no*TOV Smart Tekhniks
	LPCTSTR szICLoaderJAD = {_T("233EA948E9A4607E8CC051F72AA1622B*42454249484F5354")};//serial no*BEBIHOST
	LPCTSTR szICLoaderIZZ = {_T("00F6A752029F1A0CF16D3BBA3C6BC41B20*42494E4F4D2C204C4C43")};//serial no * BINOM, LLC
	LPCTSTR szICLoaderIZX = {_T("306F259E9045C92CE0DC198FB136AA51*4D41524B4B4F4D2C204F4F4F")};//serial no * MARKKOM, OOO
	LPCTSTR szICLoaderIZK = {_T("305C1C120FB2970B81524EF717DD2231*0A5654464F4E2C204F4F4F")};//serial no * .VTFON, OOO
	LPCTSTR	szAdLoadSFPY = {_T("536D617274204D656469612053697374656D7A*20556B7261696E612C20544F56*33F248BD2288442704A0530E5C15C919")};//Smart Media Sistemz Ukraina, TOV
	LPCTSTR szSigAgentIZIY = {_T("426C75656973*58AC2B1B2E1E80F003ECEE0F41F4124A")};//name*serial no
	LPCTSTR szSigAgentJLEQ = {_T("416C6F6C204C74642E*5211125FFCB0259A79ADCBDF84A645EB")};
	LPCTSTR szSigAgentJRAJ = {_T("E2809C57656220776179E2809D204F4F4F*02863B699C5DB2DAEE6433C2053AE339")};
	LPCTSTR szSigAgentKAKT = {_T("544D524720496E632E*7E36C4BE2CEB69DF7BCEDB3B868E9EF9")};
	LPCTSTR szSigAgentRUP = {_T("5361666520496E7374616C6C657220436F6D70616E79*5361666520496E7374616C6C657220436F6D70616E79")};
	LPCTSTR	 szAdwareEJRS	= {_T("4F4F4F2022534F4C204179546922*403319CB9221F2FB5A893E1BE830CD8A")}; //OOO "SOL AyTi"
	LPCTSTR szSigICLoaderAFUD = {_T("46494B53424147*00A236A64C5C2B7859195FFC076EDC1BD8")};//FIKSBAG
	LPCTSTR szSigICLoaderAGIJ = {_T("564F524B455A*00A255A94CDBA6364F4A6FD73E00D315BD")};//VORKEZ
	LPCTSTR szSigICLoaderAGLJ = {_T("49504F4B415254*00CAC8E904B0761BBF4E69CB48AD9CBD22")};//IPOKART
	LPCTSTR szSigICLoaderAKNU = {_T("52544B2D5445524D494E414C*008FE8A0659D9D5D697A9EBEE89E4559F7")};//RTK-TERMINAL
	LPCTSTR szSigICLoaderAVUR = {_T("544F5620536D617274204C494E452054726576656C*00B6D5882139BD443A7BDAD264B94C7C1B")};//TOV Smart LINE Trevel
	LPCTSTR szSigICLoaderCEHK = {_T("574D4420496E7465726E657420454952454C49202D204D45*303BBC65B32F89158A34E079")};//WMD Internet EIRELI - ME
	LPCTSTR szSigICLoaderCNGR = {_T("46756C66696C6C696E672041707073*12B07D718C4DEFC51662B3022083C11F")};//Fulfilling Apps
	LPCTSTR szSigICLoaderCUPN = {_T("42494E4F4D2C204F4F4F*0082399AE5579A293ED615FBFB7592C0AC")};//BINOM, OOO
	LPCTSTR szSigICLoaderCUPQ = {_T("492D4D41524B412C204F4F4F*0744957EE0F5C0DDC5AD955573AFC18B")};//I-MARKA, OOO
	LPCTSTR szSigICLoaderCAWN = {_T("4556524F50414B*00B0856DBEB566E6307EA52F2BE5BF8BDC")};//EVROPAK
	LPCTSTR	 szOcnaABE	= {_T("506F6C6973686564205061747465726E73*45FA3B2C3FFC48342963B2F8A159CEA6")};
	LPCTSTR	 szOcnaABJ	= {_T("42726F7773654D61726B*1401B58097E1C00CABB2C6F4A73C0CAF")};
	LPCTSTR	 szOcnaABL	= {_T("5669727475616C205472616E736974*3B60F6720FBFBD69B97363C66E494F3E")};
	LPCTSTR	 szOcnaABS	= {_T("466F6C6C6F772052756C6573*360C16AC576B09F5DFA927EA0089856F")};
	LPCTSTR	 szOcnaAC	= {_T("41697220476C6F6265*0C68EFA725DB8110CE807489DAC03553")};
	LPCTSTR	 szOcnaACB	= {_T("48756C61546F6F*085C145DCAAAEB713C3C6B3E2BFDBFE3")};
	LPCTSTR	 szOcnaACC	= {_T("6E6575726F77697365*44381E530504967961F48BDFACFAA048")};
	LPCTSTR	 szOcnaACS	= {_T("53717561726520436F726E6572*52626BC0EA278192E7FA51F91BA8DF92")};
	LPCTSTR	 szOcnaACU	= {_T("426C697373536561726368*5F0DC08BBF13B41AE39AD901F44E209D")};
	LPCTSTR szNetFilterY = {_T("746563686E6F6C6F67696576616E6F6973652E636F6D*746563686E6F6C6F67696576616E6F6973652E636F6D")};//technologievanoise.com
	LPCTSTR szNetFilterGEN = {_T("76616E6F697365746563686E6F6C6F67792E636F6D*76616E6F697365746563686E6F6C6F67792E636F6D")}; //vanoisetechnology.com
	LPCTSTR szAdwareDealPlyAPFOT = {_T("57C45B80F67AA50F8F84171C*446F776E6C6F6164696F7573*446F776E6C6F6164696F7573*57C45B80F67AA50F8F84171C")};
	LPCTSTR szAdwareDealPlyARKIT = {_T("00C2A29D09A80F11BA9422A46F246029C0*54656B686E6F20536D6172742C20544F56*54656B686E6F20536D6172742C20544F56*00C2A29D09A80F11BA9422A46F246029C0")};
	LPCTSTR  szWebToolbarCossderAH = {_T("38BEDBA31B62D500B998286A80E230EB*41727475722053656D616E696E*41727475722053656D616E696E*38BEDBA31B62D500B998286A80E230EB")};
	LPCTSTR  szDownloaderSnojanpjc = {_T("6172636164656769616E74*57BC95B0241F043C637386F57295B150*57BC95B0241F043C637386F57295B150*6172636164656769616E74")};
	LPCTSTR	szAdwareAmonetizeFHST	= {_T("103E7DD3BD69DED4035451FB*5374726F794C6F67697374696B61204F4F4F*5374726F794C6F67697374696B61204F4F4F*103E7DD3BD69DED4035451FB")};
	LPCTSTR  szWebToolbarCossderXHDO = {_T("145B82E22CCF1D1A2268198D76B51075*4F70656E20536F7572636520446576656C6F7065722C20506176656C204B5241534E4F56*145B82E22CCF1D1A2268198D76B51075")};
	LPCTSTR  szWebToolbarCossderXHDN = {_T("00EA64F94CDE70375038736C9F1C0960DF*4F73746170204C61706F6E6F76*4F73746170204C61706F6E6F76*00EA64F94CDE70375038736C9F1C0960DF")};
	LPCTSTR  szWebToolbarCossderXHDN_1 = {_T("4F70656E20536F7572636520446576656C6F7065722C20426F72697320566C6164696D69726F7669636820424F424F56534B59*626F6240626F72722E696E666F30")};
	LPCTSTR  szDealPlyAPFOW = {_T("41647665727469736F20476D6248*41647665727469736F20476D6248")};
	LPCTSTR	 szAntiFWGEN	= {_T("4E696B69746120507269686F646B6F*70726F6E6940667265656F707469632E696E666F*4707DC43E33AFFC384801DA82BA2F1AA")};
	LPCTSTR  szDownloaderKanistGen = {_T("069EEE3A188BD66948EDFA466F9B4B55*5349474E4920534F46542053524C*5349474E4920534F46542053524C*069EEE3A188BD66948EDFA466F9B4B55")};//SIGNI SOFT SRL
	LPCTSTR  szDownloaderKanistGen1 = {_T("63C72E9CF30DB668557B6C0E*536976656E7379732053524C*536976656E7379732053524C*63C72E9CF30DB668557B6C0E")};//Sivensys SRL
	LPCTSTR	 szAdWareWin32SoftPulsextb = {_T("1858913428C49A270BE00711E97381C6*506C7567696E2055706461746520534C")};
	LPCTSTR	 szDownloaderLMNajz = {_T("22494B4F2D50524F46222C204F4F4F*00BC2915F4441B9D8AC34D01058C89EAE7")};
	LPCTSTR szDownloAdminBUPZ = {_T("62A69E72E38AFE48*537570657220436C69636B20496E746572616374697665")};
	LPCTSTR szDealPlyARKJC = {_T("48414C4F4D4F542049545A48414B204C5444*681F08E4FCD9FE6F794BCAE1")};
	LPCTSTR  szAdwareDealplyALBTC = {_T("4F4F4F204B6F642037*4F4F4F204B6F642037*696E666F40636F6465736576656E2D6D6F73636F772E636F6D*00FC58F5CEE524E5814BD6217974F2E5CA")};
	LPCTSTR  szAdwareAgentKAZG = {_T("0C085368616E676861693111300F06035504070C0853*68616E6768616931393037060355040A0C30E4B88AE6*E4B89AEFBC88E69C89E99990E59088E4BC99EFBC89310E300C060355040B0C054954E983A831393037")};
	LPCTSTR  szAdwareSmartInstallerONW = {_T("00834AB1967F563A47BCF77B42858EC8FF*424159542D5345525649532C204C4C43*424159542D5345525649532C204C4C43*00834AB1967F563A47BCF77B42858EC8FF")};
	LPCTSTR  szAdwareSmartInstallerOWA = {_T("00BD7F6EDAF93FA86F0B00221F619CD8A3*4F4F4F2C20424159542D5345525649533119301706035504030C104F4F4F2C20424159542D534552564953*00BD7F6EDAF93FA86F0B00221F619CD8A3")};
	LPCTSTR  szAdwareSmartInstallerT   = {_T("3F9CE894CD79F679B2A88E52D69504EF*50534B204C4F4745554D204C4C43311730150603550403140E50534B204C4F4745554D204C4C43*3F9CE894CD79F679B2A88E52D69504EF")};
	LPCTSTR  szAdwareSmartInstallerJVV = {_T("008CFF530DA2838AC72B7D7ECE8DC363E9*4C4C432022415954492D4F4E4C41594E22310B3009060355040B0C024954311A301806035504030C114C4C432022415954492D4F4E4C41594E22*008CFF530DA2838AC72B7D7ECE8DC363E9")};
	LPCTSTR  szAdwareSmartInstallerLFE = {_T("16779BED7FB1D7190B832B0B1A427A66*5445504C4F204F4E4C414A4E3115301306035504030C0C5445504C4F204F4E4C414A4E*16779BED7FB1D7190B832B0B1A427A66")};
	LPCTSTR  szAdwareSmartInstallerMKK = {_T("00E92F9D3990E4BFD084C6744474215646*544F56202256697A61726420534F465422310B3009060355040B0C024954311A301806035504030C11544F56202256697A61726420534F465422*00E92F9D3990E4BFD084C6744474215646")};
	LPCTSTR  szAdwareSmartInstallerOME = {_T("5141064DF1B107BBE35AE9F293FF3572*4C4C432C204C414E2033373114301206035504030C0B4C4C432C204C414E203337*5141064DF1B107BBE35AE9F293FF3572")};
	LPCTSTR  szMultiPlugBWOF = {_T("5374616E69736C617620204B6162696E*5374616E69736C61762E4B6162696E40686F746D61696C2E636F6D*3469022839E88D596EA6FE14C990AF76")};
	LPCTSTR  szDealPlyAPFPA = {_T("446F62726570726F6772616D792073702E207A206F2E6F2E*11211AD9FFFF7B7307EA7EF56E85C6344F73")};//Dobreprogramy sp. z o.o.
	LPCTSTR  szAdwareMailRU = {_T("244FC2F89B8E5F5FB98CDC377996C175*4C4C43204D61696C2E527531143012060355040B0C0B4C4C43204D61696C2E5275*4C4C43204D61696C2E5275*244FC2F89B8E5F5FB98CDC377996C175")};
	LPCTSTR  szAdwareMewishid = {_T("39D3FCDE4532A63BD298039D0555D0C2*4368696368656B204B6F6E737472616B73686E2C20544F56*6C7564612E726F736C79756B406368696368656B2D6B6F6E737472616B73686E2E636F6D2E7561")};/*Company name*luda.roslyuk@chichek-konstrakshn.com.ua*serial number */
	LPCTSTR  szAdWareAcon = {_T("496E6E6F7661746976652053797374656D73204C4C43*450EACFE8D673E82864CE46BC1A92FCA")};//Innovative Systems LLC
	LPCTSTR  szAdWareOpenCandy = {_T("53657661732D53204C4C43*53657661732D53204C4C43")};//Sevas-S LLC
	LPCTSTR  szAdWareOpenCandyLD = {_T("4F4F4F2022496E64757374727922*00D139BDA20096871840DCE08E6A80B6F0*687474703A5C2F5C2F646C2E646F776E6C6974652E6E65745C2F*696E6465782E7068705C2F646F776E6C6F61645C2F7265706F7274")};
	LPCTSTR  szDownloaserLMNAOM = {_T("4B414D454C4F5420464F52543115301306035504030C0C4B414D454C4F5420464F5254*6B616D656C6F74666F72744079616E6465782E7275*00FCCC76049C82589BBE9DC26E90FAD23B")};//KAMELOT FORT*kamelotfort@yandex.ru
	LPCTSTR  szDownloaserLMNHEUR = {_T("00CBFFA08965CCA4E663201C7972457BDB*2253696C766572202D20536F6674222C204C7464311D301B06035504030C142253696C766572202D20536F6674222C204C7464*00CBFFA08965CCA4E663201C7972457BDB")};//"Silver - Soft", Ltd
	LPCTSTR  szDownloaserLMNHEUR1 = {_T("00CBFFA08965CCA4E663201C7972457BDB*2253696C766572202D20536F6674222C204C7464311D301B06035504030C142253696C766572202D20536F6674222C204C7464*00CBFFA08965CCA4E663201C7972457BDB")};//"Silver - Soft", Ltd
	LPCTSTR  szDownloaserLMNGen = {_T("6DB4D6451840481B470CABBD55471AA0*4752414E44204D45444941204C4C433118301606035504030C0F4752414E44204D45444941204C4C43*6DB4D6451840481B470CABBD55471AA0")};//"Silver - Soft", Ltd
	LPCTSTR  szTrojanInstallCoreFe = {_T("4B4F52414D2047414D4553204C494D49544544*53b6bd34f6b702dec3c291d72e678eef")};
	LPCTSTR  szTrojanInstallCoreFe1 = {_T("4E6F205A65627261204E6574776F726B204C7464612E*49d9bc150ece10c921669720128b3cf3")};
	LPCTSTR  szTrojanInstallCoreFe2 = {_T("4E4F205A45425241204E4554574F524B*11219cdfc62030cb7bb9ace54f1acecfa0bb")};
	LPCTSTR  szTrojanInstallCoreFe3 = {_T("57656C6C204B6E6F776E204D65646961204C7464*73cc925bc7b1eafc96d9c9f2eaa55030")};
	LPCTSTR  szTrojanInstallCoreFe4 = {_T("444620496E7374616C6C2028467269656420436F6F6F6B6965204C74642E29*11219717c2164e1716bf35a15bf545063842")};
	LPCTSTR  szTrojanInstallCoreFe5 = {_T("4F4F4F20546568536E6162*1b3ae09c419260e223ea4701f7a75ece")};
	LPCTSTR  szTrojanInstallCoreFe6 = {_T("52696E67696572204178656C20537072696E67657220506F6C736B612073702E207A206F2E6F2E*00f58c43870a319f9a7934dfe1c1760eb1")};
	LPCTSTR  szTrojanInstallCoreFe7 = {_T("5570646174655374617220476D6248*71a04d21e9f4bb6e19c3cb7d720e6245")};
    LPCTSTR  szDwnldLMNGen1 = (_T("00FA8518523686FBA4AAC991E7D8232F47*4C4C4320412D49543111300F06035504030C084C4C4320412D4954*00FA8518523686FBA4AAC991E7D8232F47"));
	LPCTSTR  szDwnldLMNGen2 = (_T("5D13D7ECCEBD88AAB14F6A2C4A06158D*506C697461204C4C433112301006035504030C09506C697461204C4C43*5D13D7ECCEBD88AAB14F6A2C4A06158D"));
	LPCTSTR  szDwnldLMNGen3 = (_T("00EF2A3EF42C4224E0B9C35ACC1217B079*4F4F4F20536F66742D4D656469613117301506035504030C0E4F4F4F20536F66742D4D65646961*00EF2A3EF42C4224E0B9C35ACC1217B079"));
	LPCTSTR  szTrojanEkstakIcsl = {_T("28C0370CF2DC2E605B5F71E429E386CF*5350494E41522C4C4C43")}; //SPINAR,LLC
	LPCTSTR  szAdwareSoftPulseHEUR = {_T("504C5547494E2055504441544520534C*504C5547494E2055504441544520534C")};//PLUGIN UPDATE SL
   	LPCTSTR  szAdwareSoftPulseHEUR1 = {_T("4469676974616C20506C7567696E20534C*4469676974616C20506C7567696E20534C")}; //Digital Plugin SL
	LPCTSTR  szAdwareSoftPulseHEUR2 = {_T("4449474954414C20504C5547494E20532E4C2E55*4449474954414C20504C5547494E20532E4C2E55")}; //DIGITAL PLUGIN S.L.U
	LPCTSTR  szAdwareSoftPulseHEUR3 = {_T("53616D62616D65646961204C4C43*53616D62616D65646961204C4C43")}; //Sambamedia LLC
    LPCTSTR  szAdwareSoftPulseHEUR4 = {_T("4449474954414C20504C5547494E20534C55*4449474954414C20504C5547494E20534C55")}; //DIGITAL PLUGIN SLU
	LPCTSTR  szAdwareSoftPulseHEUR5 = {_T("536D6172742053656375726520536F66747761726520532E6C2E*536D6172742053656375726520536F66747761726520532E6C2E")}; //Smart Secure Software S.l.
    LPCTSTR  szAdwareSoftPulseHEUR6 = {_T("506C7567696E2055706461746520534C*506C7567696E2055706461746520534C")}; //Plugin Update SL
   	LPCTSTR  szAdwareSoftPulseHEUR7 = {_T("566F6C76616E205072656D69756D*566F6C76616E205072656D69756D")}; //Volvan Premium
	LPCTSTR  szAdwareSoftPulseHEUR8 = {_T("5365747570204D616E61676572204C4C43*5365747570204D616E61676572204C4C43")}; //Volvan Premium
    LPCTSTR  szAdwareSoftPulseHEUR9 = {_T("59756D6F6E2053797374656D20532E4C2E*59756D6F6E2053797374656D20532E4C2E")}; //Yumon System S.L.
	LPCTSTR  szAdwareSoftPulseHEURA = {_T("566964656F20506C7567696E20736F66747761726520534C*566964656F20506C7567696E20736F66747761726520534C")}; //Video Plugin software SL
	LPCTSTR  szGraftor = {_T("47616D65204D6F6464696E67*353FBC711BE59C95A27F1D9D4D3255B4")}; //Game Modding
	LPCTSTR  szAdwareICLoadergen = {_T("544f562022536d617274204b6172747920556b7261696e7922*3f4e11816c5e8df0468f17808bb1bc05")};
	LPCTSTR  szAdwareICLoadergen1 = {_T("4c5444204c4f47*00ec7fc54982f27e7e604efb6bf5cee7a7")};
	LPCTSTR  szAdwareICLoadergen2 = {_T("4d4d52204c4c43*0082647cf352a77aae3aa5c152c6bea6c3")};
	LPCTSTR  szAdwareICLoadergen3 = {_T("4c5444204c4f442d4156544f*0cd8a7aa3873daad3b6b125ce232eeb9")};
	LPCTSTR  szAdwareICLoadergen4 = {_T("52554c4f4e204c5444*008a681eb196587c0211cb9b79792929a8")};
	LPCTSTR  szAdwareICLoadergen5= {_T("4f4f4f204c494c4953*00f2fae9ef4faf84f19f8aabae3f52331a")};
	LPCTSTR  szAdwareICLoadergen6= {_T("544f562022536d617274204c616974696e672053697374656d7322*37c6feb6363872577ab307942f302a70")};
	LPCTSTR  szAdwareICLoadergen7= {_T("544f5620536d6172742054656b686e6f6c6f647a6869*7355e83e71563158254f33bf400ea7")};
	LPCTSTR  szAdwareICLoadergen8= {_T("47414d4d41*00907dab109c51c1774d72ba24c7cfc270")};
	LPCTSTR  szAdwareICLoadergen9= {_T("4d45524544*065161c07948c387a2d75a6e7192acab")};
	LPCTSTR  szDwnldInstallM_B= (_T("04F067CB9EFD3EEBEDABCC3882579B37*42494241444F20494E564553544D454E5453*42494241444F20494E564553544D454E5453*04F067CB9EFD3EEBEDABCC3882579B37"));
	LPCTSTR  szTrojanStartPage = {_T("1AA04889F37502186E693BBF*436C6F756420496E7374616C6C6572")};
	LPCTSTR  szAdwareELEXgen= {_T("456C657820646F2042726173696C20506172746963697061C3A7C3B56573204C746461*456C657820646F2042726173696C20506172746963697061C3A7C3B56573204C746461")};
	LPCTSTR  szHiddenInstallOO = (_T("060A2B060104018237020104*00A20A4AB70A4619DB79EDB57AE383ABA7*53495354454D2D505249445A48454B542C204F4F4F*61646D696E4073797374656D732D707269647A68656B742E7275"));
	LPCTSTR  szDownloadSponsor = {_T("43484950204469676974616C20476D6248*43484950204469676974616C20476D6248")}; //CHIP Digital GmbH
	LPCTSTR	szDownloaderGuideGen3	= {_T("3036F2C249EE56B0F365B1CDAD61C8BF*667265656D69756D20476D624831*667265656D69756D20476D624830")};
	LPCTSTR	 szDownloaderAgentJTVN	= {_T("496E666F20536F667477617265*00e220024bdc56cc086c3d719de03a3aed")};
	LPCTSTR	szRootKitAgentAVO1	= {_T("57444B54657374436572742041646D696E2C313331343830343935323832393431393431*57444B54657374436572742041646D696E2C313331343830343935323832393431393431")};
	LPCTSTR	szAdwareTornTVGen	= {_T("110F603E63C86349A5F243EA06966F33*436F6F6C4D6972616765204C74642E311830160603550403140F436F6F6C4D6972616765204C74642E*110F603E63C86349A5F243EA06966F33")};
	LPCTSTR	szTrojanNymeria650	= {_T("FECA3429AD6393974B5597434BA41ACB*7165464B7854586F494147706359724A42355144466D3263745972393763456B5478305833575169637A33554A574171746C6269575A5A4B524B6F4B")};
	LPCTSTR	szRootKitAgentAVO	= {_T("57444B54657374436572742041646D696E2C313331363636323636303736383331343334*57444B54657374436572742041646D696E2C313331363636323636303736383331343334")};
	LPCTSTR	szAdwaredealPlyGen12	= {_T("0D254C97C30E96DAAE21FCE9*5375706572622044656C69766572792028416C706861204372697465726961204C74642E29312E302C060355040313255375706572622044656C69766572792028416C706861204372697465726961204C74642E29*0D254C97C30E96DAAE21FCE9")};
	LPCTSTR	 szAdWareWebSearchGen = {_T("29F54A856D44BCE8F565EB4AB207FA14*537072696E6754656368204C7464")};	
	LPCTSTR	szAdwareOutBrowseGen = {_T("6D33FCA7C911A4DE54C53CAE497140FE*47497665204177617920736F667477617265311B301906035504030C1247497665204177617920736F667477617265")};	
	LPCTSTR	 szRiskToolSProtectorVT = {_T("547CFDC5D70FD7C944A9BA11E88CCB1C*5043205574696C697469657320536F667477617265204C696D69746564")};
	//LPCTSTR	 szTrojanAgentBOI = {_T("4D61696C2E5275204C4C4331*4D61696C2E5275204C4C4330")};
	LPCTSTR  szHoaxSpeedUpMyPcarj = {_T("00a3d4f14dec863bc770ade38738ddc79d*537570657220504320546F6F6C73204C696D69746564")}; //Super Optimizer
	LPCTSTR  szAdwaredeMultiPlugOFGS = {_T("009AE37A5537F1B682C02A835BCC61E4C9*44616E69656C20486172657576656E693119301706035504030C1044616E69656C20486172657576656E69*61646D696E406275696C646465736B746F706761646765742E636F6D*009AE37A5537F1B682C02A835BCC61E4C9")};
	LPCTSTR  szShared12345 = {_T("41707020536563757265204C4C43*41707020536563757265204C4C43")};
	LPCTSTR	 szDownloaderOfferInstallGen = {_T("62CE46520678C49F2A0BCBC862666F64*50524F544F54414950532C204F4F4F")};
	LPCTSTR	 szTrojanBsymemDYD = {_T("556E7371310F300D06035504030C06487561717064*556E7371310F300D06035504030C06487561717064")};
	LPCTSTR	 szTrojanBsymemDZD = {_T("5A68626470310E300C06035504030C055062627462*5A68626470310E300C06035504030C055062627462")};
	LPCTSTR	szAdwareDealplyGen	= {_T("586574617070204C696D69746564*62CF29AD43B55F0BEEDDFE47DAEE52D4")};
	LPCTSTR	szAdwareDealplyGen1	= {_T("506572736F6E616C436C65616E6572*685F7E727ED51E9A38F37A50DC276FF3")};
	LPCTSTR	szTrojanBsymemdyd1	= {_T("487561717064*01*487561717064")};
	LPCTSTR	szSnojanFr = {_T("7DB295891E333B2320BE4965AC27FC2C*53755A686F75204D6F726E696E672053756E20496E666F726D6174696F6E20546563686E6F6C6F6779204C4C43")};	
	LPCTSTR szHoaxAgent = {_T("537570657220504320546F6F6C73204C696D69746564*00A3D4F14DEC863BC770ADE38738DDC79D")};
	LPCTSTR	 szDownloaderOfferInstallGen1 = {_T("00a7a6d0d08d81d355f480a734653a5157*4C4C4320496D70756C7365*696E666F406D616F6D62692E73746F7265")};
	LPCTSTR  szMegaSearchAT = {_T("50657465722053756C696B*51664A6CB00BE789CB474E7F25A72C4D")};
	LPCTSTR	szNAVDealPlyGEN1	= {_T("7BE20DA80D4D2D5DC477076191A6D03A*4E657874496E7465726163746976654D65646961*736572766963652E6573644030316E65742E6672")};
	LPCTSTR	szNAVDealPlyGEN2	= {_T("7FDBEFB70B5ED0AF3613A69663CFDF2D*446F762067696C204D616E6167656D656E74204C74642E")};
	LPCTSTR	szNAVDealPlyGEN4	= {_T("112111817CD313A533F2A76178D4452F81A6*506C6174666F726D50726F6D7074202028416C706861204372697465726961204C74642E29")};
	LPCTSTR	szNAVDealPlyGEN7	= {_T("00F19272B6D26A10F95246B7222B439A95*4F494C20536D617274205365727669732C20544F56*79757269692E7669726B6F406F696C2D736D6172742D7365727669732E636F6D2E7561")};
	LPCTSTR	szNAVDealPlyGEN8	= {_T("1121AC672D5AB416D17B426FE33CECEB6E62*506C6174666F726D466C61736820284E6577204D6564696120486F6C64696E6773204C74642E29")};
	LPCTSTR	szNAVDealPlyGEN9	= {_T("112193355882F591C6D4A41A79561784A499*48414C4F4D4F542049545A48414B204C5444")};
	LPCTSTR	szNAVDealPlyGEN10	= {_T("1121DC084C957768775E59D575FF65D567A0*4D6178506C6174666F726D20284E6577204D6564696120486F6C64696E6773204C746429")};
	LPCTSTR	szNAVDealPlyGEN11	= {_T("4CEA459D2BA055E1BBA597D71DD7823C*53616B79736F66742073726C")};
	LPCTSTR	szNAVDealPlyGEN12	= {_T("11211D765201C9D05F729E4C67DC7BBF8A9C*5365747570466C61736820284E6577204D6564696120486F6C64696E6773204C74642E29")};
	LPCTSTR szDrvRootkitAgentGEN = {_T("081C1803CF7A146AE1AC5503F5627FE8*E99FB5E7BEBDE581A5E5BAB7E7AEA1E79086E592A8E8AFA2EFBC88E4B88AE6B5B7EFBC89E69C89E99990E585ACE58FB8")};
	LPCTSTR	szNAVDealPlyGEN13	= {_T("1121206405ACDAB5906908B3939BD86EF916*5570646174655374617220476D6248")};

	objdbscan.LoadSigDBEx(szHoaxAgent,_T("Hoax.Agent.gen"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanBsymemdyd1,_T("Trojan.Bsymem.DYD1"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareDealplyGen,	_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareDealplyGen1,	_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanBsymemDZD ,_T("Trojan.Win32.Bsymem.dzd"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanBsymemDYD ,_T("Trojan.Win32.Bsymem.dyd"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderOfferInstallGen  , _T("not.a.virus.Downloader.OfferInstall.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szShared12345, _T("Trojan.InstallCore.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szAdwaredeMultiPlugOFGS , _T("not-a-virus:AdWare.Win32.MultiPlug.OFGS"), TRUE);
	objdbscan.LoadSigDBEx(szHoaxSpeedUpMyPcarj,_T("Hoax.Win32.SpeedUpMyPC.ARJ"), TRUE);
	objdbscan.LoadSigDBEx(szMorstarFbg ,	_T("not-a-virus:Downloader.Morstar.fbg "), TRUE);
	objdbscan.LoadSigDBEx(szPlayTurtle,_T("not-a-virus:Trojan.PlayTurtle"),TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNaca,	_T("not-a-virus:Downloader.LMN.aca"), TRUE);
	objdbscan.LoadSigDBEx(szBRSoftware,		_T("not-a-virus:Adware.BRSoftware"), TRUE);
	objdbscan.LoadSigDBEx(szOutBrowseBBL,		_T("not-a-virus:Adware.OutBrowse.bbl"), TRUE);
	objdbscan.LoadSigDBEx(szFiseria,		_T("not-a-virus:Adware.Fiseria"), TRUE);
	objdbscan.LoadSigDBEx(szOutBrowseG,		_T("not-a-virus:Downloader.OutBrowse.g"), TRUE);
	objdbscan.LoadSigDBEx(szOutBrowseB,		_T("not-a-virus:Downloader.OutBrowse.b"), TRUE);
	objdbscan.LoadSigDBEx(szSomoto,			_T("not-a-virus:Adware.Somoto.a"), TRUE);
	//objdbscan.LoadSigDBEx(szOutBrowseB,		_T("not-a-virus:Downloader.OutBrowse.b"), TRUE); //Downloader.OutBrowse.o
	objdbscan.LoadSigDBEx(szDwnldLMNye,		_T("not-a-virus:Downloader.LMN.ye"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldMR2,		_T("not-a-virus:Trojan.DownLoadMR"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldMR1,		_T("not-a-virus:Trojan.DownLoadMR"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldMR0,		_T("not-a-virus:Trojan.DownLoadMR"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNf2,		_T("not-a-virus:Trojan.LoadMoney.f"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNf1,		_T("not-a-virus:Trojan.LoadMoney.f"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNxe,		_T("not-a-virus:Downloader.LMN.xe"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNgen2,	_T("not-a-virus:Downloader.LMN.gen"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNgen1,	_T("not-a-virus:Downloader.LMN.gen"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNgen0,	_T("not-a-virus:Downloader.LMN.gen"), TRUE); 
	objdbscan.LoadSigDBEx(szDwnldLMNgen3,	_T("not-a-virus:Downloader.LMN.gen"), TRUE);
//	objdbscan.LoadSigDBEx(szConduit3,		_T("not-a-virus:Trojan.Conduit"), TRUE);
//	objdbscan.LoadSigDBEx(szConduit2,		_T("not-a-virus:Trojan.Conduit"), TRUE);
//	objdbscan.LoadSigDBEx(szConduit1,		_T("not-a-virus:Trojan.Conduit"), TRUE);
//	objdbscan.LoadSigDBEx(szConduit0,		_T("not-a-virus:Trojan.Conduit"), TRUE);
	objdbscan.LoadSigDBEx(szSigSolimba,		_T("not-a-virus:Adware.Solimba.variant"), TRUE);
	objdbscan.LoadSigDBEx(szLinkular,		_T("not-a-virus:Trojan.Linkular"), TRUE); 
	objdbscan.LoadSigDBEx(szTrojanJ0,		_T("not-a-virus:WebToolbar.Win32.MyWebSearch.sy"),TRUE);
	objdbscan.LoadSigDBEx(szTrojanJ1,		_T("not-a-virus:WebToolbar.Win32.MyWebSearch.sy"),TRUE);
	objdbscan.LoadSigDBEx(szInstallVibeAb,	_T("not-a-virus:Downloader.Win32.InstallVibe.ab"),TRUE);
	objdbscan.LoadSigDBEx(szWebtoolbaravw,			_T("not-a-virus:WebToolbar.Win32.Agent.avw"), TRUE);
	objdbscan.LoadSigDBEx(szAgentAqda,		_T("not-a-virus:Downloader.Agent.aqda"), TRUE);
	objdbscan.LoadSigDBEx(szKranetG,		_T("not-a-virus:AdWare.Win32.Kranet.g"), TRUE);
	objdbscan.LoadSigDBEx(szGoobzo0,		_T("Trojan.Goobzo"), TRUE);
	objdbscan.LoadSigDBEx(szSigIbryteJhp,	_T("not a virus:Adware.ibryte.jhp"), TRUE);
	objdbscan.LoadSigDBEx(szAiraddInstaller,	_T("not-a-virus:AdWare.Win32.AirAdInstaller.gpxn"),TRUE);
	objdbscan.LoadSigDBEx(szisoftpulseybk ,		_T("not-a-virus:AdWare.Win32.SoftPulse.ybk "), TRUE);
	objdbscan.LoadSigDBEx(sziBrytejhl,	_T("not-a-virus:AdWare.Win32.iBryte.jhl"), TRUE);
	objdbscan.LoadSigDBEx(szMorstarEwe ,	_T("not-a-virus:Downloader.Win32.Morstar.ewi "), TRUE);
	objdbscan.LoadSigDBEx(szMorstarBaad,	_T("not-a-virus:Downloader.Morstar.bad"), TRUE);
	objdbscan.LoadSigDBEx(szYotoonXYO,		_T("not-a-virus:Adware.Yotoon.xyo"), TRUE);
	objdbscan.LoadSigDBEx(szReqPS3,			_T("not-a-virus:AdWare.Agent.hgwu"), TRUE);
	objdbscan.LoadSigDBEx(szReqPS1,			_T("Adware.BrowseFox.k"), TRUE);
	objdbscan.LoadSigDBEx(szReqPS2,			_T("Adware.BrowseFox"), TRUE);
	objdbscan.LoadSigDBEx(szMorstarFce,		_T("not-a-virus:Downloader.Morstar.fce"), TRUE);
	objdbscan.LoadSigDBEx(szMorstarFcg,		_T("not-a-virus:Downloader.Morstar.fcg"), TRUE);
	objdbscan.LoadSigDBEx(szReqPS4,			_T("Adware.BrowseFox"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareMultiPlugNbjr,_T("not-a-virus:Adware.MultiPlug.nbjr"), TRUE);
	objdbscan.LoadSigDBEx(szSoftpulseXVM, _T("not-a-virus:Adware.SoftPulse.xvm"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareIhdo ,	_T("not-a-virus:AdWare.Win32.Agent.ihdo"), TRUE);
	objdbscan.LoadSigDBEx(szDownFch ,	_T("not-a-virus:Downloader.Morstar.fch"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNade,	_T("Downloader.lmn.ade"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNafw,	_T("Downloader.lmn.afw"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNgep,	_T("Downloader.lmn.gep"), TRUE);
	objdbscan.LoadSigDBEx(szMorstarApz,	_T("Downloader.morstar.apz"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusG,	_T("Adware.softplus.g"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusYfj,	_T("Adware.softplus.yfj"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAdg		,_T("Downloader.LMN.adg"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAhf		,_T("Downloader.LMN.ahf"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAhu		,_T("Downloader.LMN.ahu"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAhu_1		,_T("Downloader.LMN.ahu"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAin		,_T("Downloader.LMN.ain"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAiu		,_T("Downloader.LMN.aiu"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAiz		,_T("Downloader.LMN.aiz"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAiz_1		,_T("Downloader.LMN.aiz"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAio		,_T("Downloader.LMN.aio"), TRUE);
	objdbscan.LoadSigDBEx(szSigDriverupdHlh ,_T("downloader.driverupd.hlh"), TRUE);
	objdbscan.LoadSigDBEx(szAdWICLoader1,	_T("not-a-virus:Adware.ICLoader.heur1"), TRUE);
	objdbscan.LoadSigDBEx(szAdWICLoader,	_T("not-a-virus:Adware.ICLoader.heur"), TRUE);
	objdbscan.LoadSigDBEx(szSigSmartInstaller,_T("Adware.SmartInstaller.a"), TRUE);
	objdbscan.LoadSigDBEx(szSigYottonAdbt,_T("Adware.Yotoon.adbt"), TRUE);
	objdbscan.LoadSigDBEx(szSigDriverupdIbp,	_T("Downloader.DriverUpd.ipb"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusxsx,	_T("Adware.softplus.xsx"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusP,	_T("Adware.softplus.p"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusYbr,	_T("Adware.softplus.ybr"), TRUE);
	objdbscan.LoadSigDBEx(szSigMorstarBht,	_T("Downloader.Morstar.bht"), TRUE);
	objdbscan.LoadSigDBEx(szSigSoftPlusFcr,	_T("Downloader.Morstar.fcr"), TRUE);
	objdbscan.LoadSigDBEx(szSigMorstarFcs,	_T("Downloader.Morstar.fcs"), TRUE);
	objdbscan.LoadSigDBEx(szSigMorstarLa,	_T("Downloader.Morstar.la"), TRUE);
	objdbscan.LoadSigDBEx(szSigMorstarFca,	_T("Downloader.Morstar.fca"), TRUE);
	objdbscan.LoadSigDBEx(szSigOutBrowseBxe,_T("Adware.outbrowse.bxe"), TRUE);
	objdbscan.LoadSigDBEx(szSigLMNAmx,_T("Downloader.lmn.amx"), TRUE);
	objdbscan.LoadSigDBEx(szSigPlocustLcxy,_T("Downloader.plocust.lcxy"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareFileTourJCG,	_T("Adware.FileTour.JCG"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderGuidePWJ,	_T("not-a-virus:Downloader.DownloaderGuide.PWJ"), TRUE); 
	objdbscan.LoadSigDBEx(szDownloaderGuideJ,	_T("not-a-virus:Downloader.DownloaderGuide.J"), TRUE); 
	//objdbscan.LoadSigDBEx(szDownloaderGuideGen,	_T("not-a-virus:Downloader.DownloaderGuide.GEN"), TRUE); 
	//objdbscan.LoadSigDBEx(szDownloaderGuideGen2,	_T("not-a-virus:Downloader.DownloaderGuide.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szCrossRider,	_T("not-a-virus:WebToolbar.CrossRider.AMQA"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolCroRibei, _T("not-a-virus:WebToolbar.Win32.CroRi.bei"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolCroRibtj,	_T("not-a-virus:WebToolbar.CroRi.btj"), TRUE);
	objdbscan.LoadSigDBEx(szStrictor,			_T("Trojan.strictor"), TRUE);
	objdbscan.LoadSigDBEx(szAgentOcna, _T("Downloader.Agent.Ocna"), TRUE);
	objdbscan.LoadSigDBEx(szMultiplugOaqk, _T("not-a-virus:Adware.MultiPlug.oaqk"), TRUE);
	objdbscan.LoadSigDBEx(szAgentIF, _T("not-a-virus:Downloader.Agent.IF"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarAE, _T("not-a-virus:WebToolbar.SearchSuite.ae"), TRUE);
	objdbscan.LoadSigDBEx(szSigWebAltaD,_T("Adware.Webalta.d"), TRUE);
	objdbscan.LoadSigDBEx(szMultiplugOfeb,  _T("Adware.MultiPlug.ofeb"), TRUE);
	objdbscan.LoadSigDBEx(szAgentIfat,      _T("Trojan.Agent.ifat"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNahx,    _T("not-a-virus:Downloader.LMN.ahx"), TRUE);
	objdbscan.LoadSigDBEx(szSomatoR, _T("Downloader.Somato.r"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareFileTourHAJ,	_T("Adware.FileTour.HAJ"), TRUE);
	objdbscan.LoadSigDBEx(szInffinityYAS, _T("not-a-virus:AdWare.Inffinity.YAS"), TRUE);
	objdbscan.LoadSigDBEx(szOutBrowseBZY,	_T("not-a-virus:Adware.OutBrowse.BYY"), TRUE);
	objdbscan.LoadSigDBEx(szOutBrowseBZA,	_T("not-a-virus:Adware.OutBrowse.BZA"), TRUE);
	objdbscan.LoadSigDBEx(szAgentHCZR, _T("not-a-virus:Downloader.Agent.HCZR"), TRUE);
	objdbscan.LoadSigDBEx(szMyWebSearchTR, _T("not-a-virus:WebToolbar.MyWebSearch.TR"), TRUE);
	objdbscan.LoadSigDBEx(szAdwSoftPlusCGBV, _T("not-a-virus:AdWare.Win32.SoftPulse.CGBV"), TRUE);
	objdbscan.LoadSigDBEx(szWbtlbrAgentBAE, _T("not-a-virus:WebToolbar.Agent.BAE"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderGuideI, _T("not-a-virus:Downloader.DownloaderGuide.I"), TRUE);
	objdbscan.LoadSigDBEx(szAgentBDG ,_T("not-a-virus:WebToolbar.Agent.BDG"), TRUE);
	objdbscan.LoadSigDBEx(szAgentBCY ,_T("not-a-virus:WebToolbar.Agent.BCY"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarAgentAHJ, _T("not-a-virus:WebToolbar.Agent.AHJ"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarAgentAIQ, _T("not-a-virus:WebToolbar.Agent.AIQ"), TRUE);
	objdbscan.LoadSigDBEx(szAgentBAF ,_T("not-a-virus:WebToolbar.Agent.BAF"), TRUE);
	objdbscan.LoadSigDBEx(szAgentBAH ,_T("not-a-virus:WebToolbar.Agent.BAH"), TRUE);
	objdbscan.LoadSigDBEx(szEorezo,	_T("not-a-virus:Adware.Eorezo.ABYB"),TRUE);
	objdbscan.LoadSigDBEx(szFakeInstaller,	_T("not-A-Virus:Adware.FakeInstaller.CHI"),TRUE);
	objdbscan.LoadSigDBEx(szStartSurfC, _T("not-a-virus:Adware.StartSurf.C"), TRUE);
	objdbscan.LoadSigDBEx(szLinkSwift ,_T("not-a-virus:Adware.LinkSwift.A"), TRUE);
	objdbscan.LoadSigDBEx(szDownloadHelperDHH ,_T("not-a-virus:Downloader.DownloadHelper.DHH"), TRUE); 
	objdbscan.LoadSigDBEx(szDownloadHelperDCX ,_T("not-a-virus:Downloader.DownloadHelper.DCX"), TRUE); 
	objdbscan.LoadSigDBEx(szDealplyAPFOU ,_T("not-a-virus:Adware.DealPly.APFOU"), TRUE); 
	objdbscan.LoadSigDBEx(szRubar ,	_T("not-a-virus:WebToolbar.Rubar.HT"), TRUE);
	objdbscan.LoadSigDBEx(szDriverPack ,_T("Trojan.bundler.driverpack.1"), TRUE);
	objdbscan.LoadSigDBEx(szLMNAKT ,_T("Downloader.LMN.AKT"), TRUE);
	objdbscan.LoadSigDBEx(szAgentJRAM,_T("not-a-virus:Adware.Agent.JRAM"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderLMNApe,_T("not-a-virus:Downloader.LMN.APE"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderLMNUhmx,_T("not-a-virus:Downloader.LMN.UHMX"), TRUE);
	objdbscan.LoadSigDBEx(szAgentACOK,_T("not-a-virus:WebToolbar.Agent.ACOK"), TRUE);
	objdbscan.LoadSigDBEx(szAgentBUT,_T("not-a-virus:WebToolbar.Agent.BUT"), TRUE);
	objdbscan.LoadSigDBEx(szCrossRiderKTI,_T("not-a-virus:WebToolbar.CrossRider.KTI"), TRUE);
	objdbscan.LoadSigDBEx(szCrossRiderKYC,_T("not-a-virus:WebToolbar.CrossRider.KYC"), TRUE);
	objdbscan.LoadSigDBEx(szSearchSuiteX,_T("not-a-virus:WebToolbar.SearchSuite.X"), TRUE);
	objdbscan.LoadSigDBEx(szWbtlbrAgentBSI, _T("not-a-virus:WebToolbar.Agent.BSI"), TRUE);
	objdbscan.LoadSigDBEx(szIbryte, _T("not-a-virus:Adware.ibryte.JHR"), TRUE);
	objdbscan.LoadSigDBEx(szWebtlbrCodibyemf, _T("not-a-virus:WebToolbar.Codiby.GEN"), TRUE);
	objdbscan.LoadSigDBEx(sziBryteJJO, _T("not-a-virus:Adware.iBryte.JJO"), TRUE);
	objdbscan.LoadSigDBEx(szLMNala, _T("not-a-virus:Downloader.Win32.LMN.ALA"), TRUE);
	objdbscan.LoadSigDBEx(szLMNale, _T("not-a-virus:Downloader.Win32.LMN.ALE"), TRUE);
	objdbscan.LoadSigDBEx(szDownLMNanc, _T("not-a-virus:Downloader.LMN.ANC"), TRUE);
	objdbscan.LoadSigDBEx(szDownLMNukbi, _T("not-a-virus:Downloader.LMN.UKBI"), TRUE);
	objdbscan.LoadSigDBEx(szDownLMNalo, _T("not-a-virus:Downloader.LMN.ALO"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoaderiwj, _T("Trojan.razy.63227"), TRUE);
	objdbscan.LoadSigDBEx(szImaliC,	_T("not-a-virus:Adware.Imali.C"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAmonetizeFHOF,_T("Adware.Amonetize.FHOF"), TRUE);
	objdbscan.LoadSigDBEx(szWDownloaderKASINST, _T("Downloader.Kasinst.B"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAmonetizeCHJN, _T("Adware.Amonetize.CHJN"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAASB, _T("Adware.MSIL.Ocna.ASB"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAB, _T("Adware.MSIL.Ocna.AB"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAY, _T("Adware.MSIL.Ocna.AAY"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAX, _T("Adware.MSIL.Ocna.AAX"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAU, _T("Adware.MSIL.Ocna.AAU"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAO, _T("Adware.MSIL.Ocna.AAO"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAH, _T("Adware.MSIL.Ocna.AAH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAA, _T("Adware.MSIL.Ocna.AA"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAE, _T("Adware.MSIL.Ocna.AAE"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentMSILOCNAAAF, _T("Adware.MSIL.Ocna.AAF"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderAEYV, _T("Adware.ICLoader.AEYV"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIWA, _T("Adware.ICLoader.IWA"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIWE, _T("Adware.ICLoader.IWE"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIWK, _T("Adware.ICLoader.IWK"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIWL, _T("Adware.ICLoader.IWL"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIWO, _T("Adware.ICLoader.IWO"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIXC, _T("Adware.ICLoader.IXC"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIXH, _T("Adware.ICLoader.IXH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIXM, _T("Adware.ICLoader.IXM"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentIcloaderIXO, _T("Adware.ICLoader.IXO"), TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarCodiby, _T("WebToolbar.Codiby.EIH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwAgentJRAJ, _T("not-a-virus:AdWare.Win32.Agent.JRAJ"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadTYRR,	_T("not-a-virus:Adware.AdLoad.TYRRT"), TRUE);
	objdbscan.LoadSigDBEx(szAdwAgentJEZR, _T("not-a-virus:AdWare.Win32.Agent.JEZR"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadFakeDownAC,	_T("not-a-virus:Adware.FakeDownloader.AC"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadYKFW,	_T("not-a-virus:Adware.AdLoad.YKFW"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadYPFT,	_T("not-a-virus:Adware.AdLoad.YPFT"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadEORGSUJ,	_T("not-a-virus:Adware.Eorezo.GSUJ"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderDNIG,	_T("not-a-virus:Adware.ICLoader.DNIG"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderDWDI,	_T("not-a-virus:Adware.ICLoader.DWDI"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderEEQD,	_T("not-a-virus:Adware.ICLoader.EEQD"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderEPJF,	_T("not-a-virus:Adware.ICLoader.EPJF"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderEPJG,	_T("not-a-virus:Adware.ICLoader.EPJG"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderFFHH,	_T("not-a-virus:Adware.ICLoader.FFHH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderIRB,	_T("not-a-virus:Adware.ICLoader.IRB"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderIRE,	_T("not-a-virus:Adware.ICLoader.IRE"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderIVK,	_T("not-a-virus:Adware.ICLoader.IVK"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderJAW,	_T("not-a-virus:Adware.ICLoader.JAW"), TRUE);
	objdbscan.LoadSigDBEx(szAdwICLoaderJBH,	_T("not-a-virus:Adware.ICLoader.JBH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwDealKeeper,	_T("not-a-virus:Adware.DealKeeper.A"), TRUE);
	objdbscan.LoadSigDBEx(szAdwInstallMonGEN ,	_T("not-a-virus:Adware.InstallMonster.GEN "), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaACW,	_T("not-a-virus:Adware.MSIL.Ocna.ACW"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaACY,	_T("not-a-virus:Adware.MSIL.Ocna.ACY"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaADC,	_T("not-a-virus:Adware.MSIL.Ocna.ADC"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaADH,	_T("not-a-virus:Adware.MSIL.Ocna.ADH"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaADP,	_T("not-a-virus:Adware.MSIL.Ocna.ADP"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaADV,	_T("not-a-virus:Adware.MSIL.Ocna.ADV"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaAEX,	_T("not-a-virus:Adware.MSIL.Ocna.AEX"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaAEZ,	_T("not-a-virus:Adware.MSIL.Ocna.AEZ"), TRUE);
	objdbscan.LoadSigDBEx(szAdwMSILOcnaACZ,	_T("not-a-virus:Adware.MSIL.Ocna.ACZ"), TRUE);
	objdbscan.LoadSigDBEx(szAdwOcnaBEJ, _T("Adware.Ocna.BEJ"), TRUE);
	objdbscan.LoadSigDBEx(szAdwOcnaBKK, _T("Adware.Ocna.BKK"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAbnn ,	_T("not-a-virus:Adware.Ocna.BNN"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAagk ,	_T("not-a-virus:Adware.MSIL.Ocna.AGK"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAags ,	_T("not-a-virus:Adware.MSIL.Ocna.AGS"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAaid ,	_T("not-a-virus:Adware.MSIL.Ocna.AID"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAaio ,	_T("not-a-virus:Adware.MSIL.Ocna.AIO"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAakk ,	_T("not-a-virus:Adware.MSIL.Ocna.AKK"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAalf ,	_T("not-a-virus:Adware.MSIL.Ocna.ALF"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAanc ,	_T("not-a-virus:Adware.MSIL.Ocna.ANC"), TRUE);
	objdbscan.LoadSigDBEx(szOCNAbf ,	_T("not-a-virus:Adware.MSIL.Ocna.BF"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIZK ,	_T("not-a-virus:Adware.ICLoader.IZK"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIZX ,	_T("not-a-virus:Adware.ICLoader.IZX"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIZZ ,	_T("not-a-virus:Adware.ICLoader.IZZ"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderJAD ,	_T("not-a-virus:Adware.ICLoader.JAD"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIZD ,	_T("not-a-virus:Adware.ICLoader.IZD"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIYK ,	_T("not-a-virus:Adware.ICLoader.IYK"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIXY ,	_T("not-a-virus:Adware.ICLoader.IXY"), TRUE);
	objdbscan.LoadSigDBEx(szICLoaderIXV ,	_T("not-a-virus:Adware.ICLoader.IXV"), TRUE);
	objdbscan.LoadSigDBEx(szHiddenInstall ,	_T("not-a-virus:Adware.HiddenInstall.DA"), TRUE);
	objdbscan.LoadSigDBEx(szAdLoadSFPY,_T("not-a-virus:Adware.AdLoad.sfpy"), TRUE);
	objdbscan.LoadSigDBEx(szSigAgentIZIY, _T("not-a-virus:Adware.Agent.iziy"), TRUE);
	objdbscan.LoadSigDBEx(szSigAgentJLEQ, _T("not-a-virus:Adware.Agent.jleq"), TRUE);
	objdbscan.LoadSigDBEx(szSigAgentJRAJ, _T("not-a-virus:Adware.Agent.jraj"), TRUE);
	objdbscan.LoadSigDBEx(szSigAgentKAKT, _T("not-a-virus:Adware.Agent.kakt"), TRUE);
	objdbscan.LoadSigDBEx(szSigAgentRUP, _T("not-a-virus:Adware.agent.rup"), TRUE);	
	objdbscan.LoadSigDBEx(szAdwareEJRS, _T("Adware.Amonetize.ejrs"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderAFUD, _T("not-a-virus:Adware.ICLoader.afud"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderAGIJ, _T("not-a-virus:Adware.ICLoader.agij"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderAGLJ, _T("not-a-virus:Adware.ICLoader.aglj"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderAKNU, _T("not-a-virus:Adware.ICLoader.aknu"), TRUE);	
	objdbscan.LoadSigDBEx(szSigICLoaderAVUR, _T("not-a-virus:Adware.ICLoader.avur"), TRUE);	
	objdbscan.LoadSigDBEx(szSigICLoaderCEHK, _T("not-a-virus:Adware.ICLoader.cehk"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderCNGR, _T("not-a-virus:Adware.ICLoader.cngr"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderCUPN, _T("not-a-virus:Adware.ICLoader.cupn"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderCUPQ, _T("not-a-virus:Adware.ICLoader.cupq"), TRUE);
	objdbscan.LoadSigDBEx(szSigICLoaderCAWN, _T("not-a-virus:Adware.ICLoader.cawn"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaABE,	_T("Adware.MSIL.Ocna.abe"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaABJ,	_T("Adware.MSIL.Ocna.abj"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaABL,	_T("Adware.MSIL.Ocna.abl"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaABS,	_T("Adware.MSIL.Ocna.abs"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaAC,	_T("Adware.MSIL.Ocna.ac"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaACB,	_T("Adware.MSIL.Ocna.acb"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaACC,	_T("Adware.MSIL.Ocna.acc"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaACS,	_T("Adware.MSIL.Ocna.acs"), TRUE);
	objdbscan.LoadSigDBEx(szOcnaACU,	_T("Adware.MSIL.Ocna.acu"), TRUE);
	objdbscan.LoadSigDBEx(szNetFilterY, _T("AdWare.Win32.NetFilter.y"), TRUE);
	objdbscan.LoadSigDBEx(szNetFilterGEN, _T("AdWare.Win32.NetFilter.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAmonetizeFHST, _T("Adware.Amonetize.FHST"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareDealPlyAPFOT,_T("Adware.DealPly.APFOT"),TRUE);
	objdbscan.LoadSigDBEx(szAdwareDealPlyARKIT,_T("Adware.DealPly.ARKIT"),TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarCossderAH,_T("WebToolbar.Cossder.AH"),TRUE);
	objdbscan.LoadSigDBEx(szDownloaderSnojanpjc,_T("Downloader.Snojan.PJC"),TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarCossderXHDO,_T("WebToolbar.Cossder.XHDO"),TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarCossderXHDN,_T("WebToolbar.Cossder.XHDN"),TRUE);
	objdbscan.LoadSigDBEx(szWebToolbarCossderXHDN_1,_T("WebToolbar.Cossder.XHDN"),TRUE);
	objdbscan.LoadSigDBEx(szDealPlyAPFOW,	_T("not-a-virus:Adware.DealPly.apfow"), TRUE);//Advertiso GmbH
	objdbscan.LoadSigDBEx(szAntiFWGEN,	_T("Trojan.AntiFW.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderKanistGen1 ,	_T("Downloader.Kanist.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderKanistGen ,	_T("Downloader.Kanist.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdWareWin32SoftPulsextb,_T("not-a-virusAdWare.Win32.SoftPulse.xtb"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderLMNajz,_T("not-a-virus:Downloader.Win32.LMN.ajz"), TRUE);
	objdbscan.LoadSigDBEx(szDownloAdminBUPZ ,_T("not-a-virus:Downloader.DownloAdmin.BUPZ"), TRUE);
	objdbscan.LoadSigDBEx(szDealPlyARKJC ,_T("not-a-virus:Adware.DealPly.ARKJC"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareDealplyALBTC ,_T("not-a-virus:AdWare.Win32.DealPly.albtc "), TRUE);
	objdbscan.LoadSigDBEx(szAdwareAgentKAZG ,_T("not-a-virus:AdWare.Win32.Agent.kazg"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerOME ,_T("not-a-virus:AdWare.Win32.SmartInstaller.OME"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerMKK ,_T("not-a-virus:AdWare.Win32.SmartInstaller.MKK"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerLFE ,_T("not-a-virus:AdWare.Win32.SmartInstaller.LFE"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerJVV ,_T("not-a-virus:AdWare.Win32.SmartInstaller.JVV"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerT   ,_T("not-a-virus:AdWare.Win32.SmartInstaller.T"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerOWA ,_T("not-a-virus:AdWare.Win32.SmartInstaller.OWA"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSmartInstallerONW ,_T("not-a-virus:AdWare.Win32.SmartInstaller.ONW"), TRUE);
	objdbscan.LoadSigDBEx(szMultiPlugBWOF ,	_T("not-a-virus:Adware.MultiPlug.bwof"), TRUE);
	objdbscan.LoadSigDBEx(szDealPlyAPFPA ,	_T("not-a-virus:Adware.DealPly.apfpa"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareMailRU ,_T("not-a-virus:Adware.Win32.Mail.RU"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareMewishid ,_T("not-a-virus:HEUR:AdWare.Win32.Mewishid.gen "), TRUE);
	objdbscan.LoadSigDBEx(szAdWareOpenCandyLD ,	_T("not-a-virus:AdWare.Win32.OpenCandy.ld"), TRUE);
	objdbscan.LoadSigDBEx(szAdWareOpenCandy ,	_T("not-a-virus:HEUR:AdWare.Win32.OpenCandy.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdWareAcon ,	   _T("not-a-virus:AdWare.Win32.Acon.bnu"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaserLMNGen ,	_T("not-a-virus:Downloader.LMN.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaserLMNHEUR1 ,	_T("not-a-virus:Downloader.LMN.Heur"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaserLMNHEUR ,	_T("not-a-virus:Downloader.LMN.Heur"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaserLMNAOM ,	_T("not-a-virus:Downloader.LMN.aom"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe1 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe2 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe3 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe4 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe5 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe6 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanInstallCoreFe7 ,_T("Trojan.installcore.fe"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNGen3, _T("not-a-virus:Downloader.LMN.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNGen2, _T("not-a-virus:Downloader.LMN.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldLMNGen1, _T("not-a-virus:Downloader.LMN.Gen"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanEkstakIcsl ,	_T("Trojan.Win32.Ekstak.ICSL"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR1 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR2 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR3 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR4 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR5 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR6 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR7 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR8 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEUR9 ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareSoftPulseHEURA ,	_T("not-a-virus:Adware.SoftPulse.heur"), TRUE);	
	objdbscan.LoadSigDBEx(szGraftor ,	_T("Trojan.graftor.375356"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen1 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen2 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen3 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen4 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen5 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen6 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen7 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen8 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareICLoadergen9 ,_T("Adware.ICLoader.gen"), TRUE);
	objdbscan.LoadSigDBEx(szDwnldInstallM_B, _T("Downloader.InstallM.B"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanStartPage ,	_T("HEUR:Trojan.Win32.StartPage"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareELEXgen ,_T("Adware.ELEX.gen"), TRUE);
	objdbscan.LoadSigDBEx(szHiddenInstallOO ,	_T("not-a-virus:Downloader.Win32.HiddenInstall.OO"), TRUE);
	objdbscan.LoadSigDBEx(szDownloadSponsor ,	_T("Downloader.MSIL.DownloadSponsor.gen"), TRUE);
	//objdbscan.LoadSigDBEx(szDownloaderGuideGen3,_T("not-a-virus:Downloader.DownloaderGuide.GEN"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderAgentJTVN,	_T("not-a-virus:Downloader.Win32.Agent.jtvn"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareTornTVGen ,	_T("Adware.NSIS.TornTV.gen"), TRUE);
	objdbscan.LoadSigDBEx(szRootKitAgentAVO ,	_T("Rootkit.Win64.Agent.avo"), TRUE);
	objdbscan.LoadSigDBEx(szRootKitAgentAVO1 ,	_T("Rootkit.Win64.Agent.avo"), TRUE);
	objdbscan.LoadSigDBEx(szTrojanNymeria650 ,	_T("AIT:Trojan.Nymeria.650"), TRUE);
	objdbscan.LoadSigDBEx(szAdwaredealPlyGen12 ,	_T("not-a-virus:HEUR:AdWare.Win32.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdWareWebSearchGen , _T("not-a-virus:HEUR:AdWare.Win32.WebSearch.gen"), TRUE);
	objdbscan.LoadSigDBEx(szAdwareOutBrowseGen , _T("not-a-virus:HEUR:AdWare.Win32.OutBrowse.gen"), TRUE);
	objdbscan.LoadSigDBEx(szRiskToolSProtectorVT , _T("not-a-virus:RiskTool.Win32.SProtector.VT"), TRUE);
	//objdbscan.LoadSigDBEx(szTrojanAgentBOI , _T("Trojan.Agent.boi"), TRUE);
	objdbscan.LoadSigDBEx(szSnojanFr ,	_T("not-a-virus:Downloader.Win32.Snojan.FRXX"), TRUE);
	//objdbscan.LoadSigDBEx(szMorstarCUN, _T("Trojan.Downloader.Morstar.CUN"), FALSE);// Add Above this Line
	objdbscan.LoadSigDBEx(szMorstarCUN, _T("Trojan.Downloader.Morstar.CUN"), TRUE);
	objdbscan.LoadSigDBEx(szMegaSearchAT , 	_T("not.a.virus:AdWare.MegaSearch.at"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN1,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN2,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN4,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN7,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN8,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN9,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN10,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN11,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN12,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szNAVDealPlyGEN13,_T("not.a.virus.AdWare.DealPly.gen"), TRUE);
	objdbscan.LoadSigDBEx(szDrvRootkitAgentGEN ,_T("HEUR:Rootkit.Win32.Agent.gen"), TRUE);
	objdbscan.LoadSigDBEx(szDownloaderOfferInstallGen1  , _T("not.a.virus.Downloader.OfferInstall.gen"), FALSE);// Add Above this Line
	
	if(objdbscan.ScanBuffer(&m_pbyBuff[0], m_dwNoOfBytes, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff =NULL;
			}
			return VIRUS_FILE_DELETE;
		}
	}
	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDdoxCJN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Ddox.cjn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDdoxCJN()
{
	if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x0 && m_dwAEPMapped == 0x3E2A && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3C0E)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[0x100];

		if(!m_pbyBuff)
		{
			return VIRUS_NOT_FOUND;
		}
		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x600,0x100,0x100))
		{
			CSemiPolyDBScn		polydbObj;
			TCHAR				szVirusName[MAX_PATH] = {0};
			TCHAR				szDdoxCJNSig[] = {_T("33DB8B4D14C70514614000A06740003BF1C7058068400006000000720233F680259D6840000039*8B4DFC03C88B450C33D2BBE80300000FB604060345F8FF35C4694000894DF4F7F3A1A46940000FB619*B8FF0000002BC3C1E808C1E00803D88B45148B4D108D44300F3BC1764E3B")};
			
			polydbObj.LoadSigDBEx(szDdoxCJNSig,_T("Trojan.Ddox.cjn"),FALSE);

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], 0x100, szVirusName) >= 0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return VIRUS_NOT_FOUND;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAbuseMx
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Abuse.MX Family
					  Try to connect with malicious website & inject its own file in with the help of explorer.exe as follows
						http://qmmmm.com.cn/Count/Count.asp?ExeFile=%ProgramFiles%\Common Files\SysAnti.exe?InjectFile=%ProgramFiles%\Internet Explorer\IEXPLORE.EXE
					  Drops dll at C:\WINDOWS\Fonts\grmem.dll
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAbuseMx()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if(IMAGE_FILE_DLL == (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL))
		return iRetStatus;

	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x2) && m_wAEPSec == 0x0 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x18000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData<= 0x1A000) && !m_pMaxPEFile->m_bIsVBFile && 
		(((m_dwAEPMapped == 0xA848 || m_dwAEPMapped == 0x9C34 || m_dwAEPMapped == 0xA08C) && (memcmp(m_pSectionHeader[0].Name,"",4) == 0) && (memcmp(m_pSectionHeader[1].Name,"",4) == 0) && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size == 0x0) || (m_dwAEPMapped == 0xA50C)) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}	

		DWORD	dwBuffSize = 0xB50;
		m_pbyBuff = new BYTE[dwBuffSize];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, dwBuffSize);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x3B50, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		BYTE bAbuseSign0[] = {0x8B, 0x55, 0xFC, 0x8A, 0x54, 0x1A, 0xFF, 0x80, 0xF2, 0x49, 0x88, 0x54, 0x18, 0xFF, 0x43, 0x4E, 0x75, 0xE6};  // Decryption loop

		for(int i = 0; i < (dwBuffSize - sizeof(bAbuseSign0)); i++)
		{
			if(memcmp(m_pbyBuff,bAbuseSign0, dwBuffSize))
			{
				CSemiPolyDBScn		polydbObj;
				TCHAR				szVirusName[MAX_PATH] = {0};
				BYTE *bDecryptBuff = new BYTE[0xB0];
				DWORD dwDecryptOffset = 0x0;
				TCHAR szAbuseSign[] = {_T("45786546696C653D2550726F6772616D46696C6573255C436F6D6D6F6E2046696C65735C537973*496E6A65637446696C653D2550726F6772616D46696C6573255C496E7465726E6574204578706C6F7265725C494558504C4F52452E455845")};
							   // ExeFile=%ProgramFiles%\Common Files\Sys*InjectFile=%ProgramFiles%\Internet Explorer\IEXPLORE.EXE
				if(m_dwAEPMapped == 0xA848)
					dwDecryptOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x17000;			// Worm.Abuse.MX
				else if(m_dwAEPMapped == 0xA50C)
					dwDecryptOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x180B0;			// Worm.Abuse.AX
				else
					dwDecryptOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x16000;			// Worm.abuse.MK

				if(!m_pMaxPEFile->ReadBuffer(bDecryptBuff,dwDecryptOffset,0xB0,0xB0))
				{
					return iRetStatus;
				}
				for(i = 0; i < 0xB0; i++)
				{
					bDecryptBuff[i] ^= 0x49;
				}
				polydbObj.LoadSigDBEx(szAbuseSign,_T("Worm.Abuse.gen"),FALSE);
				if(polydbObj.ScanBuffer(bDecryptBuff,0xB0,szVirusName) >= 0)
				{
					if(_tcslen(szVirusName) > 0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKeyLogger
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of KeyLogger Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKeyLogger()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0xD0F4)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}	

		DWORD dwBufSize = 0x100;
		m_pbyBuff = new BYTE[dwBufSize];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		memset(m_pbyBuff, 0x00, dwBufSize);

		if(!GetBuffer(m_dwAEPMapped + 0x650, dwBufSize, dwBufSize))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbObj;
		TCHAR szSig[] = {_T("720065007300740061007200740000006F00700065006E*53004F004600540057004100520045005C0058007400720065006D0065005200410054")};	
		polydbObj.LoadSigDBEx(szSig, _T("Spy.KeyLogger.qzp"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(m_pbyBuff, dwBufSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLolipop
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Lolipop Family
					  Adware.Lolipop.yyw
				      Adware.Lolipop.rnp
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLolipop()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wNoOfSections == 0x05 &&
		m_pMaxPEFile->m_stPEHeader.CheckSum > 0x78400000 &&
		(m_dwAEPUnmapped % 0x10) != 0x00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		DWORD	dwBuffSize	= 0x400;
		DWORD	dwFnlBufsz	= 0x00;
		m_pbyBuff = new BYTE[dwBuffSize];
		if(!GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x200, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}
		for(int i = 0x00; i < dwBuffSize; i++)
		{
			if(m_pbyBuff[i] == 0x00)
			{
				continue;
			}
			else
			{
				m_pbyBuff[dwFnlBufsz++] = m_pbyBuff[i];
				//dwFnlBufsz++;
			}
		}
		CSemiPolyDBScn objdbScan;
		TCHAR szVirusName[MAX_PATH] = {0};
		TCHAR szVirusSig[] = {_T("776B736D73636F72776B73*52656D6F746550726F636573732E50726F6772616D*5075626C69634D6574686F64")};
		objdbScan.LoadSigDBEx(szVirusSig, _T("not-a-virus:Adware.Lolipop.gen"), FALSE);

		if(objdbScan.ScanBuffer(&m_pbyBuff[0x00], dwFnlBufsz, szVirusName) >= 0x00)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVanBot
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sandeep Vasoya + Virus Analysis Team
	Description		: Detection routine for different varients of VanBot Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVanBot()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(!(m_wNoOfSections == 0xA && m_wAEPSec == 0 && m_dwAEPMapped < 0xA00 &&
		(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL))
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete[] m_pbyBuff;
		m_pbyBuff = NULL;
	}	

	DWORD dwBufSize = 0x250;

	m_pbyBuff = new BYTE[dwBufSize];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	memset(m_pbyBuff, 0x00, dwBufSize);

	if(!GetBuffer(m_pSectionHeader[1].PointerToRawData + m_pSectionHeader[1].SizeOfRawData - dwBufSize, dwBufSize, dwBufSize))
	{
		return iRetStatus;
	}

	CSemiPolyDBScn polydbObj;
	TCHAR szSig[] = {_T("4655434B*45584653")};	
	polydbObj.LoadSigDBEx(szSig, _T("BackDoor.VanBot"), FALSE);
	TCHAR szVirusName[MAX_PATH] = {0};
	if(polydbObj.ScanBuffer(m_pbyBuff, dwBufSize, szVirusName) >= 0)
	{
		if(_tcslen(szVirusName) > 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
			return VIRUS_FILE_DELETE;
		}
	}	
	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWebprefixApj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Webprefix Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWebprefixApj()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if( m_wAEPSec == 0x1 && m_dwAEPUnmapped ==0x13679 && m_wNoOfSections == 0x03 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15200 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x15DBC && memcmp(m_pSectionHeader[0].Name, ".rdata", 6) == 0 && m_pSectionHeader[0].SizeOfRawData == 0x4C00)
	  
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	WEBPREFIX_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[WEBPREFIX_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset = 0xBA00;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, WEBPREFIX_BUFF_SIZE, WEBPREFIX_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szWebprefixEg0 = (_T("C1E30433FB03FE8B750C8BD8C1EB0B83E3038B1C9E03D833FB2BD78BFAC1*C1E30433FB2BC18BD883E3038B349E03F003FA33FE8B75FC2BF7FF4DF88975FC75B5*83450808807D100059597406FF45F0FF4DF84E75DF5EC9C3")); 
		
		objdbscan.LoadSigDBEx(szWebprefixEg0, _T("Trojan.Webprefix.apj"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], WEBPREFIX_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectStagetEg
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Staget Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectStagetEg()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if( m_wAEPSec == 0x0 && ((m_dwAEPUnmapped ==0x163C && m_wNoOfSections == 0x02) || (m_dwAEPUnmapped ==0x188C && (m_wNoOfSections == 0x02 ||m_wNoOfSections == 0x03))||(m_dwAEPUnmapped ==0x1998 && (m_wNoOfSections == 0x02 ||m_wNoOfSections == 0x03))))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	STAGET_BUFF_SIZE = 0x3300;
		m_pbyBuff = new BYTE[STAGET_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset = 0x17D0;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, STAGET_BUFF_SIZE, STAGET_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szStagetEg0 = (_T("5642352136267662366368732E646C6C*74616B65736F6674*6400610073006F00660074002E0065006E0063006F006400650000*74006500730074002E0072006500670000")); //vb*takesoft*encode*reg.test for takesoft.exe
		LPCTSTR			szStagetEg1 = (_T("5642352136267662366368732E646C6C*005A006800750044006F006E006700460061006E006700790075002E00650078006500*7300680065006E006A0069006E0067007900750061006E006900650035003200300000"));//vb*zhan*shenz foe encode file

		objdbscan.LoadSigDBEx(szStagetEg0, _T("Trojan.Staget.eg"), TRUE);
		objdbscan.LoadSigDBEx(szStagetEg1, _T("Trojan.Staget.eg"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], STAGET_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBanker
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Lohmys Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBanker()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_pMaxPEFile->m_stPEHeader.DataDirectory[4].Size ==0x1958 && m_wNoOfSections == 0x08 &&
		m_wAEPSec == 0x0 && (m_dwAEPUnmapped==0x9EDCC || m_dwAEPUnmapped ==0x9EE38 || m_dwAEPUnmapped==0x9EDCC || m_dwAEPUnmapped==0x9C374)
		&& ( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E000|| m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9B400 ))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	SMALLO_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		DWORD ReadOffset = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress - 0x1000;
	//	DWORD ReadOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size ;
        
		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		
		if(m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0],ReadOffset ,SMALLO_BUFF_SIZE,SMALLO_BUFF_SIZE ))
		{
			

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szSmallo = (_T("5465787406*687474703A2F2F6A61646F776E6C6F61642E636F6D2E6272")); //ht_p://jadownload[dot]com[dot]br/
		LPCTSTR			szSmall1 = (_T("5465787406*687474703A2F2F3138362E3230322E3136352E3535")); //ht_p://186[dot]202[dot]165[dot]55/
        
        objdbscan.LoadSigDBEx(szSmallo, _T("Banker.Lohmys.a"), TRUE);
		objdbscan.LoadSigDBEx(szSmall1, _T("Banker.Lohmys.a"), FALSE);
		
		 if(objdbscan.ScanBuffer(&m_pbyBuff[0], SMALLO_BUFF_SIZE, szVirusName)>= 0)
		  {
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		  }
	   }
	}


	else if(m_wNoOfSections == 0x0A && m_wAEPSec == 0x0 && (m_dwAEPUnmapped==0xA35CC || m_dwAEPUnmapped==0xA355C ||
		    m_dwAEPUnmapped==0xA35F0 ||m_dwAEPUnmapped==0xA3644 ||m_dwAEPUnmapped==0xA3AE8 || m_dwAEPUnmapped==0xA3B04)&& 
			m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA3000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000
		   )
	  
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	SMALLO_BUFF_SIZE = 0x5000;
		m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		DWORD	dwBuffOffset = m_dwAEPUnmapped - 0x5000;
				
		//m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, SMALLO_BUFF_SIZE, SMALLO_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szSmallo = (_T("687474703A2F2F676F6F2E676C2F*687474703A2F2F7777772E736B697070656469612E6E6574*687474703A2F2F7777772E636F6E74617072696D652E636F6D2F"));
		                               //ht_p://goo[dot]gl/          //ht_p://www[dot]skippedia[dot]net               //ht_p://www[dot]contaprime[dot]com/
      
		objdbscan.LoadSigDBEx(szSmallo, _T("Banker.Lohmys.a"), FALSE);
		
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SMALLO_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectSmallo
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of small.oo Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmallo()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if((m_wAEPSec == 0x0 && m_dwAEPUnmapped ==0x32D6 && (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04)&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x41000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400)|| 
	   (m_wAEPSec == 0x0 && (m_dwAEPUnmapped ==0x3512 || m_dwAEPUnmapped ==0x3534 || m_dwAEPUnmapped ==0x32D6 )&& (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x05)&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2600 ||
	    m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4600) && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400)||((m_wAEPSec == 0x3|| m_wAEPSec == 0x04 || m_wAEPSec == 0x06) && m_dwAEPUnmapped >=0x42000 && (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04 || m_wNoOfSections == 0x08|| m_wNoOfSections == 0x05)))
	  
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	SMALLO_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset = 0x5000;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
		
		//m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, SMALLO_BUFF_SIZE, SMALLO_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szSmallo = (_T("3139322E3136382E312E32*25735C74656D705F25642E6578650000444F574E4C4F41443A00000053544F5041545441434B*6E756C0000202F63202064656C20000000434F4D53504543"));
		

		objdbscan.LoadSigDBEx(szSmallo, _T("Backdoor.small.oo"), FALSE);
		
		

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SMALLO_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectZenoSearch
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of ZenoSearch Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectZenoSearch()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if( m_wAEPSec == 0 && m_wNoOfSections == 0x04 && ( (m_dwAEPUnmapped == 0x64CF  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000)
		||(m_dwAEPUnmapped == 0x66FF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7000) ) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int ZENO_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[ZENO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x3500;
		if(!GetBuffer(dwReadOff, ZENO_BUFF_SIZE, ZENO_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szZenoSearcho = (_T("8A4C07FF8BC699BD03000000F7FD02D18D4C240CFECA5256*8A4C07FF8D47FF99BD03000000F7FD2ACAFEC1884C24108D4C240C8B5424105256"));
		polydbobj.LoadSigDBEx(szZenoSearcho, _T("Adware.ZenoSearch.o"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], ZENO_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectOficla
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Oficla Family
					  Some of IP addresses it tries to connect are :
						 74.125.236.103:80 - 1e100.net (one of the Google servers)
						 74.125.236.133:80
						 109.74.195.149:443 - linode.com	  
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectOficla()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if( m_wAEPSec == 0 && m_dwAEPUnmapped == 0x1D51 && (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x4)
		&& m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 
	    &&(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x12000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1C34)
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int OFICLA_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[OFICLA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOff = 0x1A00;
		if(!GetBuffer(dwReadOff, OFICLA_BUFF_SIZE, OFICLA_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szOficla = (_T("8BFA8B7100438BD9F7D74B81F6F900000003DAF7DF897200*03F8474B03F0414B428BD803DA8BF94E48"));
		polydbobj.LoadSigDBEx(szOficla, _T("Trojan.Oficla.heq"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], OFICLA_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSocks
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Priyanka Lokhande + Virus Analysis Team
	Description		: Detection routine for different varients of Socks Family
					  Covers Worm.Socks.ja and Worm.Socks.bo
					  Covers Worm.Socks.ja,Worm.Socks.bo,Worm.Socks.a,Worm.Socks.au and Worm.Socks.t.		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSocks() 
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( ( m_wAEPSec == 0 || m_wAEPSec == 1) && (m_wNoOfSections == 0x02 || m_wNoOfSections == 0x03) && (m_dwAEPUnmapped == 0xA9BC || m_dwAEPUnmapped == 0x2D758 || m_dwAEPUnmapped == 0x106091 || m_dwAEPUnmapped == 0x3FD4C || m_dwAEPUnmapped == 0xA3CC || m_dwAEPUnmapped == 0x22CDC || m_dwAEPUnmapped == 0xA6FC || m_dwAEPUnmapped == 0xA71C || m_dwAEPUnmapped == 0xA71C) && 
		(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3020 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x4E9E || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1402 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x6660 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x29D0 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xA000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x54F8 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2D14 ||  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2CF0 ||  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xA000 ) 
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000) && 
		(m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int SOCKS_BUFF_SIZE = 0x120;
		m_pbyBuff = new BYTE[SOCKS_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOff;
		if(m_dwAEPUnmapped == 0xA9BC)
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x900;
		}
		else if(m_dwAEPUnmapped == 0x2D758 || m_dwAEPUnmapped == 0x3FD4C) // Worm.Socks.a
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x2200;
		}
		else if(m_dwAEPUnmapped == 0xA3CC) // Worm.Socks.au
		{
			if( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 )
			{
				dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x7640;
			}
			else
			{
				dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x640;
			}
		}
		else if( m_dwAEPUnmapped == 0x22CDC )// Worm.Socks.t
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x2000;
		}
		else if( m_dwAEPUnmapped == 0xA6FC )
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x8C0;
		}

		else if( m_dwAEPUnmapped == 0xA71C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 )
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x7700;
		}
		else if( m_dwAEPUnmapped == 0xA71C )
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x700;
		}
		else
		{
			dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x250; // dropped dll by "Worm.Socks.peq"
		}
		if(!GetBuffer(dwReadOff, SOCKS_BUFF_SIZE, SOCKS_BUFF_SIZE)) 
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};

		LPCTSTR szSocks1 = (_T("8B55080355FC0FBE0233450C8B4D08034DFC8801*EBD28B45088BE55D"));
		LPCTSTR szSocks2 = (_T("8B55080355FC0FBE0283F0028B4D08034DFC8801*EBD28B45088BE55D"));
		LPCTSTR szSocks3 = (_T("8B45FC83C0018945FC8B4D0851E8E7390000*83C4043945FC73168B55080355FC0FBE0283F0028B4D08034DFC8801EBD0")); // Worm.Socks.a
		LPCTSTR szSocks4 = (_T("EB098B45FC83C0018945FC8B4D0851*3945FC7D168B55080355FC0FBE0233450C8B4D08034DFC8801EBD28B4508")); // Worm.Socks.au
		LPCTSTR szSocks5 = (_T("EB098B45FC83C0018945FC8B4D0851*3945FC7D168B55080355FC0FBE0283F0028B4D08034DFC8801EBD2")); // Worm.Socks.t 
		LPCTSTR szSocks6 = (_T("8B45080345FC0FBE0083F0028B4D08034DFC8801*EBD58B4508")); // Win32.Worm.Socks.O (GData)(DLL)

		polydbobj.LoadSigDBEx(szSocks1, _T("Worm.Socks"), TRUE);	
		polydbobj.LoadSigDBEx(szSocks2, _T("Worm.Socks"), TRUE);
		polydbobj.LoadSigDBEx(szSocks3, _T("Worm.Socks"), TRUE);
		polydbobj.LoadSigDBEx(szSocks4, _T("Worm.Socks"), TRUE);
		polydbobj.LoadSigDBEx(szSocks5, _T("Worm.Socks"), TRUE);
		polydbobj.LoadSigDBEx(szSocks6, _T("Win32.Worm.Socks.O"), FALSE);

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], SOCKS_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					     1 : It injects code into Internet Explorer and modifies its setting i.e. it changes searchscopes
						 and Start Page of Internet Explorer. 
						 It puts the following  url as start page "file://localhost/C:/www.google.com.htm"
						 This URL is used in searchsopes http://www.google.com/cse?cx=partner-pub-9588033570232632:rhmyra-cwbb&q={searchTerms}"
						 Tries to connect to a remote server and establishes connection and gives Backdoor access to the infected System. 

						 2 : Adds an enrty to run the trojan at every system startup.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanBuzus()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if( m_wAEPSec == 0 && m_dwAEPUnmapped == 0x3970 &&
		(m_pSectionHeader[m_wAEPSec].PointerToRawData >= 0x200 && m_pSectionHeader[m_wAEPSec].PointerToRawData <= 0x1000)
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x3700 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <=0x9000)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int TROJANBUZUS_BUFF_SIZE = 0xC00;
		m_pbyBuff = new BYTE[TROJANBUZUS_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwReadOff = m_pSectionHeader[0].PointerToRawData;
		if(!GetBuffer(dwReadOff, TROJANBUZUS_BUFF_SIZE, TROJANBUZUS_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szTrojanBuzus = (_T("8B550C8B45FC8A8000604000380417*8B45FC83C02FB95E00000099F7F989D08A800060400088041F"));
		polydbobj.LoadSigDBEx(szTrojanBuzus, _T("Trojan.Buzus.gwud"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], TROJANBUZUS_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentBcw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.BCW Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentBcw()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if( m_wAEPSec == 0 && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x6) && (m_dwAEPUnmapped == 0x32C6 ||m_dwAEPUnmapped == 0x3292) 
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000) 
		&& ((m_pSectionHeader[m_wAEPSec].PointerToRawData >= 0x200) && (m_pSectionHeader[m_wAEPSec].PointerToRawData <= 0x1000)))
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int AGENTBCW_BUFF_SIZE = 0xF00;
		m_pbyBuff = new BYTE[AGENTBCW_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//DWORD dwReadOff = m_pSectionHeader[0].PointerToRawData + 0xC00;
		if(!GetBuffer(0xC00, AGENTBCW_BUFF_SIZE, AGENTBCW_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szAgentBcw = (_T("8B46088B0485D05040008B4E0C83248100FF4608837E0813*0FB6138B4D0C83651000FF4DFCD3E20955084383450C0839450C"));
		polydbobj.LoadSigDBEx(szAgentBcw, _T("Trojan.Agent.bcw"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], AGENTBCW_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBlueHeaven
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of BlueHeaven Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBlueHeaven()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0 && (m_wNoOfSections == 5 || m_wNoOfSections == 6) &&(m_pSectionHeader[1].SizeOfRawData >= 0x800 && m_pSectionHeader[1].SizeOfRawData <= 0x1800) && (memcmp(m_pSectionHeader[m_wAEPSec + 1].Name, ".rdata", 6) == 0)) 
	{
		DWORD dwBuffSize = 0x1000;

		if(m_pSectionHeader[1].SizeOfRawData < 0x1000)
			dwBuffSize = m_pSectionHeader[1].SizeOfRawData;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwBuffSize];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, dwBuffSize);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec + 1].PointerToRawData, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}
		BYTE bBlueHeavenSign[] = {0x42, 0x6C, 0x75, 0x65, 0x48, 0x65, 0x61, 0x76, 0x65, 0x6E};
		for(int i = 0; i< (dwBuffSize - sizeof(bBlueHeavenSign)); i++)
		if(memcmp(&m_pbyBuff[i],bBlueHeavenSign,sizeof(bBlueHeavenSign)) == 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.BlueHeaven"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentdele
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.DELE Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentdele()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if(0x4 == m_wNoOfSections && 0xDCE == m_dwAEPMapped && 0 == m_wAEPSec && 0xE00 == m_pSectionHeader[m_wAEPSec].SizeOfRawData)
	{
		DWORD dwBuffSize = 0x14;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
			return iRetStatus;

		memset(m_pbyBuff, 0x00, dwBuffSize);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x806, dwBuffSize, dwBuffSize))
			return iRetStatus;
	
		BYTE *bDecrypKeyBuff = new BYTE[dwBuffSize];
		
		if(!m_pMaxPEFile->ReadBuffer(bDecrypKeyBuff,m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9A2, dwBuffSize, dwBuffSize))
			return iRetStatus;

		for(int icnt = 0; icnt < dwBuffSize; icnt++)
			bDecrypKeyBuff[icnt] ^= m_pbyBuff[icnt];

		BYTE bAgentdeleSign[] = {0x6C, 0x73, 0x61, 0x73, 0x65};  // dropped file name lsase.exe
		for(int i = 0; i < dwBuffSize; i++)
		if(memcmp(&bDecrypKeyBuff[i],bAgentdeleSign,sizeof(bAgentdeleSign)) == 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Agent.dele"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickerAgent
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Clicker.Agent Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerAgent()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x8 && m_dwAEPMapped == 0xEF2FC && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xEF000)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}	
		m_pbyBuff = new BYTE[0x25];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, 0x25);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x16760, 0x25, 0x25))
		{
			return iRetStatus;
		}

		TCHAR szClickerAgent[] = {_T("636F6F6469672F666174*436F6F646967216C6F7421646F756F66")};
		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(szClickerAgent,_T("Clicker.Agent.cbgm"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],0x25,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderCeed
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Downloader.Ceed Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderCeed()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1098 && m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 &&
		m_wNoOfSections == 0x0006 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x78A00 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CEED_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[CEED_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, CEED_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[1].PointerToRawData + m_pSectionHeader[1].SizeOfRawData - CEED_BUFF_SIZE, CEED_BUFF_SIZE, CEED_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szReconycBvep = (_T("747567757520736C*7475677575"));//tuguu sl
		objdbscan.LoadSigDBEx(szReconycBvep,_T("not-a-virus:Downloader.Agent.ceed"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],CEED_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectReconycBvep
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Reconyc.bvep Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectReconycBvep()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xECB5 && m_wNoOfSections == 0x0005 && 
		m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1B400 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int RECONY_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[RECONY_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, RECONY_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + m_pSectionHeader[2].SizeOfRawData - RECONY_BUFF_SIZE, RECONY_BUFF_SIZE, RECONY_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szReconycBvep = (_T("6C70766F69647261792E6D65696D6F66616E672E636F6D*6C70766F69647261792E68756F39392E636F6D*35382E3234312E3133332E323531*3131372E33342E36362E3838"));
		//lpvoidray.meimofang.com,lpvoidray.huo99.com,58.241.133.251,117.34.66.88
		objdbscan.LoadSigDBEx(szReconycBvep,_T("Trojan.Reconyc.bvep"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],RECONY_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectHacktoolAgentape
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.ape Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectHacktoolAgentape()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x1400 && ((m_wNoOfSections == 0x4 &&  (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x1440 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x11F0)
	   )|| (m_wNoOfSections == 0x2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x80400) ||(m_wNoOfSections==0x3  
	    && ( m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x57000 ||m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x56000 )
	   && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x56000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize==0x57000))))
	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int	SMALLO_BUFF_SIZE = 0x1200;
		m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset =0x6800;
		//m_pbyBuff = new BYTE[SMALLO_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset, SMALLO_BUFF_SIZE, SMALLO_BUFF_SIZE))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szagentape = (_T("31322E6261740000202D696478202564202D69702025732D2573202D706F7274203830202D696E736572*2F7363726970743E2200004A6176610000000074703A2F2F*25735C6361636C732E6578650000000025735C333630*5061636B65742E646C6C00000025735C647269766572735C6E70662E737973"));
		
		objdbscan.LoadSigDBEx(szagentape, _T("HackTool.Agent.ape"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SMALLO_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBuzusFvjf
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Buzus.FVJF Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBuzusFvjf()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if( m_wAEPSec == 0x0 && m_dwAEPUnmapped ==0x4C6D && m_wNoOfSections == 0x04 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9600 && m_pSectionHeader[1].Misc.VirtualSize == 0x0C00 &&
		m_pSectionHeader[2].Misc.VirtualSize == 0x23E00 && m_pSectionHeader[2].PointerToRawData == 0xA600 
		&& m_pSectionHeader[3].PointerToRawData == 0x2E400 && m_pSectionHeader[3].Misc.VirtualSize == 0x1300)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int	BUZUS_BUFF_SIZE = 0x150;
		m_pbyBuff = new BYTE[BUZUS_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset = 0x4300;
		
		if(!GetBuffer(dwBuffOffset, BUZUS_BUFF_SIZE, BUZUS_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR		 szVirusName[MAX_PATH] = {0};
		LPCTSTR		 szBuzusFvjs = (_T("58560FB708EB019081F9FF150000740B8B55D483C2018955D4EBDE*720024768945DCC7854CFFFFFF339EB6A59C81854CFFFFFFCD61495A9DEB13*C745C811C6BAA89C8145C8EF3945579DC745CC090BF736")); 
		
		objdbscan.LoadSigDBEx(szBuzusFvjs, _T("Trojan.Buzus.fvjf"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], BUZUS_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectInjectorHxth
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Injector.HXTH Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInjectorHxth()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped ==0x1FF16 &&( m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05) && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x39400 && m_pSectionHeader[1].Misc.VirtualSize == 0x10000 && m_pSectionHeader[1].PointerToRawData == 0x39800
		&& m_pSectionHeader[2].PointerToRawData == 0x49800 && m_pSectionHeader[2].Misc.VirtualSize == 0x5000 && (memcmp(m_pSectionHeader[3].Name, ".gms", 4) == 0) )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	INJHXTH_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[INJHXTH_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
        memset(m_pbyBuff, 0x00, INJHXTH_BUFF_SIZE);
		DWORD	dwBuffOffset = 0x3be00;
		
		
		if(!GetBuffer(dwBuffOffset, INJHXTH_BUFF_SIZE, INJHXTH_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR		 szVirusName[MAX_PATH] = {0};
		LPCTSTR		 szInjHxth = (_T("64006F0077006E002E0033003600300073006100660065002E0063006F006D002F0070002F003300360030*7000680070003F0074006E003D00320039003000360035003000310038005F003100310035002E006500780065*2F002F00640031002E006B0075006100690038002E0063006F006D002F00730065007400750070")); 
		                                     // h.t.t.p.:././.d.o.w.n...3.6.0.s.a.f.e...c.o.m.                                        //h.t.t.p.:././.d.l...c.l.i.e.n.t...b.a.i.d.u...c.o.m./                                   //h.t.t.p.:././.d.1...k.u.a.i.8...c.o.m./
		objdbscan.LoadSigDBEx(szInjHxth, _T("Dropper.Injector.hxth"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], INJHXTH_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloaderMorstarAs
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Morstar.As Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderMorstarAs()
{
	int iRetStatus = VIRUS_NOT_FOUND;

   if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
      {
         return iRetStatus;
      }

   if( m_wAEPSec == 0x0 && ( m_dwAEPUnmapped ==0xdfdc ||m_dwAEPUnmapped ==0xdfec ||m_dwAEPUnmapped ==0xdefc || m_dwAEPUnmapped ==0xde1C|| m_dwAEPUnmapped ==0xdebc) 
	   && m_wNoOfSections == 0x05 &&( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1c800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1c600)&&
	   (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1c614 ||m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1c534 ||m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1c444 
	   ||m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1c4e4)&& (m_pSectionHeader[1].SizeOfRawData == 0x9A00 || m_pSectionHeader[1].SizeOfRawData == 0x9C00 || m_pSectionHeader[1].SizeOfRawData == 0x9e00) &&  
	    m_pSectionHeader[4].SizeOfRawData== 0x1A00 && m_pSectionHeader[4].Characteristics==0x42000040 )                

          {
              if(m_pbyBuff)
                 {
                   delete []m_pbyBuff;
                    m_pbyBuff =NULL;
                 }

			  LPTSTR str1;

			  if( m_dwAEPUnmapped ==0xdfdc ||m_dwAEPUnmapped ==0xdfec)
			        str1 =_T("not-a-virus:Downloader.Morstar.as");
			  else if(m_dwAEPUnmapped ==0xdefc)
					str1 =_T("not-a-virus:Downloader.Morstar.la");
			  else if( m_dwAEPUnmapped ==0xde1C|| m_dwAEPUnmapped ==0xdebc)
					str1=_T("not-a-virus:Downloader.Morstar.akm");
                
               const int   MORSTARAS_BUFF_SIZE = 0x350;
               m_pbyBuff = new BYTE[MORSTARAS_BUFF_SIZE];
               if(!m_pbyBuff)
                  {
                      return iRetStatus;
                  }
                memset(m_pbyBuff, 0x00, MORSTARAS_BUFF_SIZE);
                DWORD dwBuffOffset = 0x25150;
                                
                                
              if(!GetBuffer(dwBuffOffset, MORSTARAS_BUFF_SIZE, MORSTARAS_BUFF_SIZE))
                  {
                      return iRetStatus;
                  }

              CSemiPolyDBScn     objdbscan;
              TCHAR             szVirusName[MAX_PATH] = {0};
              LPCTSTR           szMorstarAs =(_T("007A00690070*6C00610075006E0063006800650072002E006300700070*00610073006500720065006A006500")); 
                                                                                                                        
              objdbscan.LoadSigDBEx(szMorstarAs,str1, FALSE); 
              if(objdbscan.ScanBuffer(&m_pbyBuff[0], MORSTARAS_BUFF_SIZE, szVirusName)>= 0)
                  {
                      if(_tcslen(szVirusName)>0)
                          {
                              _tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
                              return VIRUS_FILE_DELETE;
                          }
                   }
       }
             return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperhkve
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Dropper.HKVE Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperhkve()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x5 && m_dwAEPMapped != 0x1E21 && m_wAEPSec != 0 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0x5C00)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int DROPPERHKVE_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[DROPPERHKVE_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0].PointerToRawData+0x1550,DROPPERHKVE_BUFF_SIZE,DROPPERHKVE_BUFF_SIZE))
	{
		TCHAR DHkve_Sig[] = {_T("0FB7440E0266891183C1028BD06685C075EE*6689100FB74C060283C0028BD16685C975EE")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(DHkve_Sig, _T("Dropper.agent.hkve"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],DROPPERHKVE_BUFF_SIZE, szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMultiplagB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Multiplag.B Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMultiplagB()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPMapped!=0xFDEB && m_wAEPSec !=0x0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData !=0x19C00)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int MULTIPLAGB_BUFF_SIZE = 0x200;
	m_pbyBuff = new BYTE[MULTIPLAGB_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0].PointerToRawData+15386,MULTIPLAGB_BUFF_SIZE,MULTIPLAGB_BUFF_SIZE))
	{
		TCHAR MultiplagB_Sig[] = {_T("310105B0006BB135C0C0C0C08D49044A75EE*8D510C8B0285C0740403C789028B411485C0740503C78941148B411C85C0740503C789411C8B412485C0740503C78941248B0A85C975C9")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(MultiplagB_Sig, _T("not-a-virus:Adware.multiplag.b"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],MULTIPLAGB_BUFF_SIZE, szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgenthedm
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.HEDM Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgenthedm()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPMapped == 0x1A011 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2F200)
	{
		BYTE AGENTHEDM_BUF[0x3B] = {0};	
		BYTE AGENTHEDM_Sig[] = {0x8B,0x45,0x10,0x89,0x45,0xF4,0x8B,0x45,0x10,0x48,0x89,0x45,0x10,0x83,0x7D,0xF4,0x00,0x76,0x28,0x8B,0x45,0xFC,0x8B,0x00,0x33,0x45,0x14,0x8B,0x4D,0xFC,0x89,0x01,0x8B,0x45,0xFC,0x83,0xC0,0x04,0x89,0x45,0xFC,0x8B,0x45,0x14,0x05,0xCD,0xDC,0x5C,0x5A,0x35,0x24,0xF1,0xBE,0xAD,0x89,0x45,0x14,0xEB,0xC5};
		if(m_pMaxPEFile->ReadBuffer(&AGENTHEDM_BUF[0x00],m_pSectionHeader[0].PointerToRawData+0x2BD45, 0x3B, 0x3B))
		{
			if(memcmp(&AGENTHEDM_BUF[0x00], AGENTHEDM_Sig, sizeof(AGENTHEDM_Sig)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.agent.hedm"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectJuchedPgy
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Juched.PGY Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJuchedPgy()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_dwAEPUnmapped == 0x7570 && m_pSectionHeader[0].SizeOfRawData == 0x26000 && m_wAEPSec == 0)
	{	
		const int JUCHEDPGY_BUFF_SIZE = 0x74;		
		BYTE JUCHEDPGY_Sig[] = {0x8B,0x4D,0x98,0x83,0xC1,0x01,0x89,0x4D,0x98,0x8B,0x55,0x98,0x3B,0x55,0x9C,0x7D,0x63,0xC7,0x45,0x94,0x00,0x00,0x00,0x00,0xEB,0x09,0x8B,0x45,0x94,0x83,0xC0,0x01,0x89,0x45,0x94,0x83,0x7D,0x94,0x5E,0x7D,0x33,0x8B,0x4D,0x0C,0x03,0x4D,0x98,0x0F,0xBE,0x11,0x8B,0x45,0x94,0x0F,0xBE,0x4C,0x05,0xA0,0x3B,0xD1,0x75,0x1C,0x8B,0x45,0x94,0x83,0xC0,0x2F,0x99,0xB9,0x5E,0x00,0x00,0x00,0xF7,0xF9,0x8B,0x45,0x08,0x03,0x45,0x98,0x8A,0x4C,0x15,0xA0,0x88,0x08,0xEB,0x02,0xEB,0xBE,0x83,0x7D,0x94,0x5E,0x75,0x10,0x8B,0x55,0x08,0x03,0x55,0x98,0x8B,0x45,0x0C,0x03,0x45,0x98,0x8A,0x08,0x88,0x0A,0xEB,0x8C};
		if(GetBuffer(m_pSectionHeader[0].PointerToRawData+0x5D8,JUCHEDPGY_BUFF_SIZE,JUCHEDPGY_BUFF_SIZE))
		{
			if(memcmp(&m_pbyBuff[0x00], JUCHEDPGY_Sig, sizeof(JUCHEDPGY_Sig)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.juched.pgy"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectYotoonBFM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Yotoon.bfm Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectYotoonBFM()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x8A72 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11200 &&
		m_wNoOfSections == 0x0005)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int YOTOONBFM_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[YOTOONBFM_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, YOTOONBFM_BUFF_SIZE);

		//if(!GetBuffer(((m_pMaxPEFile[m_wAEPSec].m_dwFileSize - m_pSectionHeader[m_wAEPSec].SizeOfRawData)/4) + m_pSectionHeader[m_wAEPSec].PointerToRawData, BANCOSU_BUFF_SIZE, BANCOSU_BUFF_SIZE))
		if(!GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x53B0, YOTOONBFM_BUFF_SIZE, YOTOONBFM_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szYotoonBFM = (_T("443A5C5574696C69746965735C*5C4D61696E7461696E65725C4D61696E7461696E6572436C69656E745C5265*6C656173655C4D61696E7461696E6572436C69656E742E706462"));
						//D:\Utilities\		\Maintainer\MaintainerClient\Release\MaintainerClient.pdb
		
		objdbscan.LoadSigDBEx(szYotoonBFM,_T("not-a-virus:Adware.Yotoon.bfm"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],YOTOONBFM_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectChydoCCQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Chydo.CCQ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectChydoCCQ()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && (m_dwAEPUnmapped == 0x2095 || m_dwAEPUnmapped == 0x2075 || m_dwAEPUnmapped == 0x20A5) &&(m_wNoOfSections == 0x0004 || m_wNoOfSections == 0x0005) && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4C2E))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CHYDOCCQ_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[CHYDOCCQ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, CHYDOCCQ_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x0010, CHYDOCCQ_BUFF_SIZE, CHYDOCCQ_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szChydoccq = (_T("8945FC6A0068800000006A046A006A0268*408B4D1051FF15086040008945F8C745FC"));//
		
		objdbscan.LoadSigDBEx(szChydoccq,_T("Trojan.Chydo.ccq"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],CHYDOCCQ_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAirAdInstallerGacx
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of AirAdInstaller.Gacx Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAirAdInstallerGacx()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && (m_dwAEPUnmapped > 0x180000 || m_dwAEPUnmapped < 0x190000) && m_pSectionHeader[m_wAEPSec].Characteristics == 0x60000020 &&
		m_wNoOfSections == 0x0005 && (m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x28D000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x283000 || 
		m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x28B000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x28A000 ||
		m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x284000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x28C000 ))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AIRGACX_BUFF_SIZE = 0x3000;
		m_pbyBuff = new BYTE[AIRGACX_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, AIRGACX_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[3].PointerToRawData + 0x21F0, AIRGACX_BUFF_SIZE, AIRGACX_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szAirAdInstallerGacx1 = (_T("41006900720049006E007300740061006C006C00650072*730065007400750070002E006500780065"));//AirInstaller,setup.exe
		LPCTSTR szAirAdInstallerGacx2 = (_T("49006E007300740061006C006C00650072*730065007400750070002E006500780065"));//Installer,setup.exe
		objdbscan.LoadSigDBEx(szAirAdInstallerGacx1,_T("Not A virus:Adware.AirAdInstaller.gacx"),TRUE);
		objdbscan.LoadSigDBEx(szAirAdInstallerGacx2,_T("Not A virus:Adware.AirAdInstaller.gacx"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],AIRGACX_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectGenomeAdbwg
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gajanan Vaikunthe + Virus Analysis Team
	Description		: Detection routine for different varients of Genome.Adbwg Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGenomeAdbwg()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL)==IMAGE_FILE_DLL &&
		m_dwAEPUnmapped == 0x525c0 && m_wAEPSec == 8 && 
		(memcmp(m_pSectionHeader[3].Name,"bmw",4)==0)&& 
		(memcmp(m_pSectionHeader[5].Name,".bmw0",5)==0) && 
		(memcmp(m_pSectionHeader[6].Name,".bmw1",5)==0) && 
		(memcmp(m_pSectionHeader[8].Name,".bmw2",5)==0)
		)
	{	
		const int GENOME_BUFF_SIZE = 0x44;		
		BYTE GENOME_Sig[] = {0x5C, 0x42, 0x4C, 0x35, 0x2E, 0x30, 0x35, 0x5C, 0x73, 0x79, 0x64, 0x6C, 0x6C, 0x5C, 0x52, 0x65, 0x6C, 0x65, 0x61, 0x73, 0x65, 0x5C, 0x42, 0x4C, 0x53, 0x6B, 0x79, 0x44, 0x6C, 0x6C, 0x2E, 0x70, 0x64, 0x62};
		if(GetBuffer(m_pSectionHeader[1].PointerToRawData+0x2c59,GENOME_BUFF_SIZE,GENOME_BUFF_SIZE))
		{
			if(memcmp(&m_pbyBuff[0x00], GENOME_Sig, sizeof(GENOME_Sig)) == 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Genome.adbwg"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMultiPlugL
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gajanan Vaikunthe + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of MultiPlug.L Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMultiPlugL()
{
	int			iRetStatus = VIRUS_NOT_FOUND;
	int const	MULTIPLUGL_BUFF_SIZE = 0x190;

	if((m_dwAEPUnmapped == 0x1089b|| m_dwAEPUnmapped ==0x10a9b) && 
		m_wAEPSec == 0 && m_pSectionHeader[1].SizeOfRawData==0x9e00 &&
		m_wNoOfSections==0x4)
	{	
		TCHAR MultiPlugL_Sig[] = {_T("43003A005C000000476C6F62616C5C*476C6F62616C5C*4C6F63616C5C*64657175653C543E20746F6F206C6F6E670000006D61702F7365743C543E20746F6F206C6F6E67")};
		if(GetBuffer(m_pSectionHeader[1].PointerToRawData+0x6a50,MULTIPLUGL_BUFF_SIZE,MULTIPLUGL_BUFF_SIZE))
		{
			CSemiPolyDBScn	polyDBscan;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polyDBscan.LoadSigDBEx(MultiPlugL_Sig,_T("not-a-virus:AdWare.MultiPlug.l"),FALSE);
			if(polyDBscan.ScanBuffer(&m_pbyBuff[0],MULTIPLUGL_BUFF_SIZE,szVirusName))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:AdWare.MultiPlug.l"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x173A2 && m_pSectionHeader[1].SizeOfRawData == 0x13E00)
	{
		TCHAR MultiPlugL_Sig[] = {_T("3D8797CA777F263D40486C627F2F3DDD3AE3AE7F403D05A45D9A*C745E0E1B690CCEBA83DD79DECC37F163DDE3AE3AE759A8B45EC8945F8C745E005A45D9A*3D69A25E0E7F4D3D5F9FEF077F5D3D352AEFF9")};
		if(GetBuffer(m_pSectionHeader[0].PointerToRawData+0x500,MULTIPLUGL_BUFF_SIZE,MULTIPLUGL_BUFF_SIZE))
		{
			CSemiPolyDBScn	polyDBscan;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polyDBscan.LoadSigDBEx(MultiPlugL_Sig,_T("not-a-virus:AdWare.MultiPlug.nblw"),FALSE);

			if(polyDBscan.ScanBuffer(&m_pbyBuff[0],MULTIPLUGL_BUFF_SIZE,szVirusName)>=0)
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if((m_wNoOfSections >=0x5 && m_wNoOfSections <= 0x8) && (((m_dwAEPMapped & 0xF000) >= 0x5000 && ((m_dwAEPMapped & 0xF000) <= 0x8000)&& 
		((m_pSectionHeader[0].SizeOfRawData & 0xF000) >= 0xB000 && (m_pSectionHeader[0].SizeOfRawData & 0xF000) <= 0xE000)) || 
		((  ((m_dwAEPMapped & 0xF0000) <= 0x40000 )&& ((m_dwAEPMapped & 0xF0000) >= 10000))|| ((m_dwAEPMapped >= 0xA30) && (m_dwAEPMapped <= 0x2430)) ) && 
		((   ((m_pSectionHeader[0].SizeOfRawData & 0xF0000) <= 0x40000) && ((m_pSectionHeader[0].SizeOfRawData & 0xF0000) >= 0x10000)) ||
		(    (m_pSectionHeader[0].SizeOfRawData >= 0x4400) && (m_pSectionHeader[0].SizeOfRawData <= 0x7A00) ))))	        
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x1000;
		int		iTotalCount = 0;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMultiPlugChk[] = {0x55,0x89,0xE5};//,0x57,0x56};

			for(int i =0;i<0x100; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMultiPlugChk,sizeof(byMultiPlugChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				t_disasm	da;
				int			iInstruction =0;
				for(DWORD dwOffset = 0x0; dwOffset < (BUFF_SIZE - MAX_INSTRUCTION_LEN);dwOffset +=dwLength)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);

					if((dwLength == 0x3 || dwLength == 7)&& (strstr(da.result,"MOV EAX,[EBP") || strstr(da.result,"MOV EAX,[ESP")) && iInstruction == 0)
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"SUB EAX") && iInstruction == 1)
					{
						iInstruction++;
						continue;
					}
					else if(iInstruction == 0x1)
					{
						iInstruction = 0;
						continue;
					}
					else if(((dwLength == 0x3 && strstr(da.result,"MOV [EBP"))|| dwLength == 0x7 && strstr(da.result,"MOV [ESP")) && iInstruction == 2)
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x5 && strstr(da.result,"JMP") && iInstruction == 3)
					{
						iInstruction++;
					}
					if(iInstruction == 0x4)
					{
						iTotalCount++;
					}

					if(iTotalCount>0xC)
						break;

				}	
				if(iTotalCount>0xC)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.MultiPlug.OFDZ")); //Adware.MultiPlug.ofea ofem offm ofed
					return VIRUS_FILE_DELETE; 
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentahruw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.AHRUW Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentahruw()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if(0x5 == m_wNoOfSections && 0x640 == m_dwAEPMapped && 0x0 == m_wAEPSec && (memcmp(m_pSectionHeader[2].Name, ".rdata", 6)) == 0 &&
		0x2600 == m_pSectionHeader[0x2].SizeOfRawData && 0x3CC00== m_pSectionHeader[0x2].PointerToRawData)
	{
		DWORD dwBuffSize = 0x100;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
			return iRetStatus;

		memset(m_pbyBuff, 0x00, dwBuffSize);

		if(!GetBuffer( m_pSectionHeader[0x2].PointerToRawData, dwBuffSize, dwBuffSize))
			return iRetStatus;

		TCHAR szAgentahruw[] = {_T("657865005C005C4D6972612E68*53616161616C616D6D")};  //exe.\.\Mira.h*Saaaalamm
		CSemiPolyDBScn		polydbObj;
		TCHAR				szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(szAgentahruw,_T("Trojan.Agent.ahruw"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],dwBuffSize,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}


	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBadurjukw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Badur.JUKW Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBadurjukw()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
		
	if( m_wAEPSec == 0 && (m_dwAEPUnmapped == 0x448B || m_dwAEPUnmapped == 0x449B) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4200)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int BADUR_BUFF_SIZE = 0x500;
		DWORD dwReadOff;


		dwReadOff=m_pSectionHeader[1].PointerToRawData+0x22E0;




		m_pbyBuff = new BYTE[BADUR_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
	
		if(!GetBuffer(dwReadOff, BADUR_BUFF_SIZE, BADUR_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szBadur = (_T("68007400740070003A002F002F0069006D0070002E0066007500730069006F006E00*69006E007300740061006C006C002E0063006F006D002F00*69006D007000720065007300730069006F006E002E0064006F002F00"));
								 //  h.t.t.p.:././.i.m.p...f.u.s.i.o.n                                i.n.s.t.a.l.l...c.o.m./.                           i.m.p.r.e.s.s.i.o.n...d.o./.
		
		polydbobj.LoadSigDBEx(szBadur, _T("Trojan.badur.jukw"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0], BADUR_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperSmall
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Dropper.Small Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperSmall()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(0x1 == m_wNoOfSections && 0xC00 == m_dwAEPMapped &&  0xB95B0FEB == *(DWORD *)&m_pMaxPEFile->m_byAEPBuff[0] && 0x50==*(DWORD *)&m_pMaxPEFile->m_byAEPBuff[0x4] &&
		0x0B34804B == *(DWORD *)&m_pMaxPEFile->m_byAEPBuff[0x8])
	{
		DWORD dwBuffSize = 0x18;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
			return iRetStatus;

		memset(m_pbyBuff, 0x00, dwBuffSize);

		if(!GetBuffer(m_dwAEPMapped + 0x1B, dwBuffSize, dwBuffSize))
			return iRetStatus;

		for(int iVar = 0; iVar<dwBuffSize; iVar++)
		{
			m_pbyBuff[iVar] ^= m_pMaxPEFile->m_byAEPBuff[0xC];
		}
		BYTE bDropperSmallSign[] = {0xBB,0x28,0x10,0x00,0x00,0x03,0xD8,0xB9,0x00,0x08,0x00,0x00,0x4B,0xBA,0xA0,0x17,0x00,0x00,0x03,0xD0,0x52,0x80,0x34,0x0B};

		if(memcmp(&m_pbyBuff[0],bDropperSmallSign,dwBuffSize) == 0)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Small.axz"));
			return VIRUS_FILE_DELETE;
		}
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMultiPlugNbld
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of mutliplug.nbld Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMultiPlugNbld()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x17982  && m_wNoOfSections == 0x05 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x1FA80 
		&&  m_pSectionHeader[m_wAEPSec + 2].Misc.VirtualSize== 0x15F84 &&  m_pSectionHeader[m_wAEPSec + 4].Misc.VirtualSize== 0x1A24 )
	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	MULTINBLD_BUFF_SIZE = 0xA00;
		m_pbyBuff = new BYTE[MULTINBLD_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset =m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + 0x150;
		 if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}
	
		
		//m_pbyBuff = new BYTE[MULTINBLD_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset, MULTINBLD_BUFF_SIZE, MULTINBLD_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("45004C00490042000700530043005200450045004E0030*54696E794A534F626A656374*372E30302E3035353520617420536174205365702032302032333A31333A31362032303134"));
		

		objdbscan.LoadSigDBEx(szdelfgk, _T("not-a-virus:Adware.mutliplug.nbld"), FALSE);
		
		

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], MULTINBLD_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLollipopMv
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Lollipop.mv Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLollipopMv()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x3056  && m_wNoOfSections == 0x05 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x9381 
		&&  m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x670C &&  m_pSectionHeader[m_wAEPSec + 3].Misc.VirtualSize== 0x46210 )
	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	LOLLIPOPMV_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[LOLLIPOPMV_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset =0xED40;
				
		//m_pbyBuff = new BYTE[LOLLIPOPMV_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset, LOLLIPOPMV_BUFF_SIZE, LOLLIPOPMV_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("7E7F0043004F004E004F00550054002400000041*52534453E82EF91A37007B4BB8D3399F959C1E3E01*633A5C73746F75742E706462*0C584100FC0541"));
		

		objdbscan.LoadSigDBEx(szdelfgk, _T("not-a-virus:AdWare.Win32.Lollipop.mv"), FALSE);
		
		

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], LOLLIPOPMV_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDelfgk
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Delf.gk Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDelfgk()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0xB5B4  && m_wNoOfSections == 0x0A &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0xB000 
		&&  m_pSectionHeader[m_wAEPSec + 2].SizeOfRawData== 0x12000 &&  m_pSectionHeader[m_wAEPSec + 7].Misc.VirtualSize== 0x2000 )
	
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	DELFGK_BUFF_SIZE = 0x1050;
		m_pbyBuff = new BYTE[DELFGK_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset =m_dwAEPUnmapped - 0xAB0;
	
		
		//m_pbyBuff = new BYTE[DELFGK_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset, DELFGK_BUFF_SIZE, DELFGK_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("476565676C792E6578650000FF*61742031202F64656C657465202F796573*69616D73797374656D000000697469736D757465786F6E65"));
		

		objdbscan.LoadSigDBEx(szdelfgk, _T("Trojan.Delf.gk"), FALSE);
		
		

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DELFGK_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWenper
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Wenper Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWenper()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(((m_wAEPSec==0x0 && m_dwAEPUnmapped==0x10FC  && m_wNoOfSections == 0x08 || m_wNoOfSections == 0x03)||
		(m_wAEPSec==0x1 && m_dwAEPUnmapped==0x1DEA0  && m_wNoOfSections == 0x03)) 
		&&  m_pMaxPEFile->m_stPEHeader.DataDirectory[0x09].Size !=0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	WENP_BUFF_SIZE = 0x1200;
		m_pbyBuff = new BYTE[WENP_BUFF_SIZE];
		DWORD	dwBuffOffset =0xBB00;

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
				
		//m_pbyBuff = new BYTE[WENP_BUFF_SIZE];
		memset(m_pbyBuff, 0x00, WENP_BUFF_SIZE);
		if(!GetBuffer(dwBuffOffset, WENP_BUFF_SIZE, WENP_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR		szVirusName[MAX_PATH] = {0};
		LPCTSTR		szwenp= (_T("43003A005C0075006E006D003000760065002E00740078007400*5300650074005C00530065007200760069006300650073005C004C00630073007300*5300650072007600520065006C004C006300730073"));
                                 //C.:.\.u.n.m.0.v.e...t.x.t. * C.o.n.t.r.o.l.S.e.t.\.S.e.r.v.i.c.e.s.\.L.c.s.s * S.e.r.v.R.e.l.L.c.s.s
		objdbscan.LoadSigDBEx(szwenp, _T("Worm.Wenper.b"), FALSE);
		
		

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], WENP_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSmartInstallerA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of SmartInstaller.A Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmartInstallerA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x9 && m_dwAEPUnmapped == 0x12A0 && ( m_pSectionHeader[8].SizeOfRawData == 0xA2E00 || m_pSectionHeader[8].SizeOfRawData == 0xD2200 || m_pSectionHeader[8].SizeOfRawData == 0xD8C00 ) )
		
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int SMARTINSTALLER_BUFF_SIZE = 0xB0;

		m_pbyBuff = new BYTE[SMARTINSTALLER_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[2].PointerToRawData + 0x40;

		if(!GetBuffer(dwReadOff, SMARTINSTALLER_BUFF_SIZE, SMARTINSTALLER_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szAgent_SmartInstaller = (_T("540044004900520025005800*530049002E006500780065*530049002E006500780065002E0063006F006E00660069006700*4E006500770074006F006E0073006F00660074002E004A0073006F006E002E0064006C006C"));
		
		polydbobj.LoadSigDBEx(szAgent_SmartInstaller, _T("not-a-virus:AdWare.SmartInstaller.a"), FALSE);	
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], SMARTINSTALLER_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickerKuk
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Clicker.Kuk Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerKuk()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x3 && m_dwAEPUnmapped == 0x16F8 && ( m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x787C || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x788C)
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 && m_pSectionHeader[1].Misc.VirtualSize == 0xAA0 && m_pSectionHeader[1].SizeOfRawData == 0x1000  )
		
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int CLICKERKUK_BUFF_SIZE = 0xC60;

		m_pbyBuff = new BYTE[CLICKERKUK_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = 0x1DA0;

		if(!GetBuffer(dwReadOff, CLICKERKUK_BUFF_SIZE, CLICKERKUK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szAgent_ClickerKuk1 = (_T("081D4000AC1C400004174000*603C4000C0804000*6A006900650073002E00620061006B002E007600620073*57005300630072006900700074002E004500780065"));
		LPCTSTR szAgent_ClickerKuk2 = (_T("081D4000AC1C400004174000*703C4000D0804000*6A006900650073002E00620061006B002E007600620073*57005300630072006900700074002E004500780065"));
		
		polydbobj.LoadSigDBEx(szAgent_ClickerKuk1, _T("Trojan-Clicker.Kuk.ba"), TRUE);	
		polydbobj.LoadSigDBEx(szAgent_ClickerKuk2, _T("Trojan-Clicker.Kuk.ba"), FALSE);	
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], CLICKERKUK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLolbot
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of LolBot.bsuq Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLolbot()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwReadOff;
	BYTE byLolbotSign[1024];
	
	if( m_wAEPSec == 0 && ( m_dwAEPUnmapped == 0x42B0 || m_dwAEPUnmapped == 0x43A0 ) && ( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4A00
		|| m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18000 ) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int LOLBOT_BUFF_SIZE = 0x1D;

		m_pbyBuff = new BYTE[LOLBOT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		if( m_dwAEPUnmapped == 0x42B0 )
		{
			if( m_wNoOfSections == 0x3 )
			{
				dwReadOff = 0x4083;
			}
			else
			{
				dwReadOff = 0x3483;
			}
			BYTE Sig[] = {0x83,0xC4,0x0C,0x89,0xC3,0x89,0xF9,0x89,0xF0,0x31,0xD2,0xF7,0xF1,0x89,0xD0,0x8A,0x80,0xB8,0x64,0x40,0x00,0x88,0x03,0x8D,0x43,0x01,0x5F,0x5E,0x5B};
			memcpy(byLolbotSign,Sig,29);
		}
		else if( m_dwAEPUnmapped == 0x43A0 )
		{
			dwReadOff = 0x3573;
			BYTE Sig[] = {0x83,0xC4,0x0C,0x89,0xC3,0x89,0xF9,0x89,0xF0,0x31,0xD2,0xF7,0xF1,0x89,0xD0,0x8A,0x80,0x18,0x65,0x40,0x00,0x88,0x03,0x8D,0x43,0x01,0x5F,0x5E,0x5B};
			memcpy(byLolbotSign,Sig,29);
		}

		if(GetBuffer(dwReadOff, LOLBOT_BUFF_SIZE, LOLBOT_BUFF_SIZE ))
		{
			if( memcmp(m_pbyBuff, byLolbotSign, LOLBOT_BUFF_SIZE )==0) 
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.LolBot.gen"));
				return VIRUS_FILE_DELETE;
			}
		}	
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDorifel
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Dorifel Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDorifel()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x9 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10800 
		&& (memcmp(m_pSectionHeader[m_wNoOfSections - 4].Name, ".yc0", 3) == 0) && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".yc1", 3) == 0) )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int DORIFEL_BUFF_SIZE = 0x10;

		m_pbyBuff = new BYTE[DORIFEL_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_dwAEPMapped - 0x1AC;
		if(GetBuffer(dwReadOff, DORIFEL_BUFF_SIZE, DORIFEL_BUFF_SIZE ))
		{
			BYTE byDorifelSign[] = {0x6E,0x74,0x73,0x68,0x72,0x75,0x69,0x73,0x32,0x2E,0x64,0x6C,0x6C}; // ntshruis2.dll
			if( memcmp(m_pbyBuff, byDorifelSign, sizeof(byDorifelSign)) == 0 ) 
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dorifel.aiez.DLL"));
				return VIRUS_FILE_DELETE;
			}
		}	
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentJKOA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.JKOA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentJKOA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( ( m_wAEPSec == 0 || m_wAEPSec == 1 ) && m_wNoOfSections == 0x7 && m_pSectionHeader[1].SizeOfRawData == 0x400 )
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int JKOA_BUFF_SIZE = 0x100;

		m_pbyBuff = new BYTE[JKOA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[1].PointerToRawData;

		if(!GetBuffer(dwReadOff, JKOA_BUFF_SIZE, JKOA_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szAgent_JKOA = (_T("8D5801BF74160020895D088A4F018A0753880F57884701*85C0756A83C73881FF0C2200207CE0"));
		
		polydbobj.LoadSigDBEx(szAgent_JKOA, _T("Trojan-Dropper.Agent.jkoa"), FALSE);	
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], JKOA_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
		
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTenta
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Tenta Family
					  *>this file creates a "win32swp.sys" file in the C drive.
					  *>and write some contents of "C:\WINDOWS\winhlp32.exe" file
					  *>also it creates "tentacle.txt" file in the  C drive.
					  *>and writes "I'm the Tentacle Virus" in that file.  	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTenta()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

	
		
				const int TENTA_BUFF_SIZE = 0x100;
				m_pbyBuff = new BYTE[TENTA_BUFF_SIZE];

				DWORD dwSignStart1,dwStart2,dwStart3,dwVirusStart;
				dwSignStart1 = m_dwAEPUnmapped+0xB;
				dwStart2=dwSignStart1-0x15C;
				dwStart3=dwStart2+5;

				m_pMaxPEFile->Rva2FileOffset(dwStart3, &dwVirusStart);

				if(GetBuffer(dwVirusStart,TENTA_BUFF_SIZE, TENTA_BUFF_SIZE))
				{
					TCHAR TENTA_Sig[] = {_T("77696E33327377702E737973*74656E7461636C652E747874*49276D207468652054656E7461636C6520566972757321")};
											//win32swp.sys             tentacle.txt              I'm the Tentacle Virus!
					CSemiPolyDBScn polydbObj;
					polydbObj.LoadSigDBEx(TENTA_Sig, _T("virus.w32.tenta.2045"), FALSE);

					TCHAR szVirusName[MAX_PATH] = {0};

					if(polydbObj.ScanBuffer(&m_pbyBuff[0],TENTA_BUFF_SIZE , szVirusName)>=0)	
					{

						if(_tcslen(szVirusName) > 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
	
							return VIRUS_FILE_DELETE;
					
						}
					}
				
				}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorZegostAIKW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Zegost.aikw Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorZegostAIKW()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x66744 && m_wNoOfSections == 0x0005 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x67000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int ZEGOSTAIKW_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[ZEGOSTAIKW_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, ZEGOSTAIKW_BUFF_SIZE);

		
		
		if(!GetBuffer(m_pSectionHeader[3].PointerToRawData + 0xDD0, ZEGOSTAIKW_BUFF_SIZE, ZEGOSTAIKW_BUFF_SIZE))
		{
			return iRetStatus;
		}
		


		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szZegostAIKW = (_T("6161303533332E33*3332322E6F7267"));//website
		
		objdbscan.LoadSigDBEx(szZegostAIKW,_T("Backdoor.Zegost.aikw"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],ZEGOSTAIKW_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPlocustJCMB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Plocust.JCMB Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlocustJCMB()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x1088 && m_wNoOfSections == 0x0006 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x75C00 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int PLOCUSTJCMB_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[PLOCUSTJCMB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, PLOCUSTJCMB_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].SizeOfRawData - 0x3030, PLOCUSTJCMB_BUFF_SIZE, PLOCUSTJCMB_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szChydoccq = (_T("77006E007800790039006A0072006500790037*73365F696F6A636D6972"));//
		
		objdbscan.LoadSigDBEx(szChydoccq,_T("Not A Virus:Downloader.Plocust.jcmb"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],PLOCUSTJCMB_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDomaIQBtzf
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of DomaIQ.Btzf Family
					  1) It is an Adware, it prompts to install a  videoplay software.  	
					  2) After installation drops installer files (nullsoft) detected as Adware and Genric Trojans.
					  3) The sample has a dll stored in its resource section. Signature is made for dll i.e. is extracted.	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDomaIQBtzf()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && ( m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4 ) &&  m_dwAEPUnmapped == 0x447BE && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x427C4 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x42800 )
		
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int DOMAIQ_BUFF_SIZE = 0x120;

		m_pbyBuff = new BYTE[DOMAIQ_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = 0x3A950;

		if(!GetBuffer(dwReadOff, DOMAIQ_BUFF_SIZE, DOMAIQ_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szDomaIQ_Btzf = (_T("42756773416A656E6F73004765745072697661746550726F66696C65537472696E67006C70417070*636865636B587000636865636B42525442756700496578706C6F7265724D696E5665*446F776E6C6F616446696C6500636865636B5961686F6F42756700636865636B5753627567*69646F6666657200416D6F6E6574697A6500636865636B57536275673200736574"));
		polydbobj.LoadSigDBEx(szDomaIQ_Btzf, _T("not-a-virus:AdWare.DomaIQ.btzf"), FALSE);	
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], DOMAIQ_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}	

/*-------------------------------------------------------------------------------------
	Function		: DetectLMNMldc
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of LMN.mldc Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLMNMldc()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x109c  && m_wNoOfSections == 0x06 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x7830c
		&&  m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x30c8 &&  m_pSectionHeader[0x3].PointerToRawData == 0x7BA00 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	LMNMldc_BUFF_SIZE = 0x150;
		m_pbyBuff = new BYTE[LMNMldc_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset =0x77000;

		//m_pbyBuff = new BYTE[LMNMldc_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset, LMNMldc_BUFF_SIZE,LMNMldc_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5231D28A1508E0470030135AA134E047008A1508E04700001033C0*4133318A0D10D04700300B803D0CD0470000762F89058AA04700870DCFA047008905AAA0470033C0*891DB2A04700C70506A147008D5A0100FF0535A047004089CA33C0A00CD0"));
		objdbscan.LoadSigDBEx(szdelfgk, _T("not-a-virus:Downloader.Win32.LMN.mldc"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], LMNMldc_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Fareit.APFZ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFareitApfz()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x29C0  && m_wNoOfSections == 0x04 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x2396
		&&  m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x0BFC &&  m_pSectionHeader[0x2].Misc.VirtualSize== 0x047C)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	FAREITAPFZ_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[FAREITAPFZ_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset =0x2900;

		//m_pbyBuff = new BYTE[FAREITAPFZ_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,FAREITAPFZ_BUFF_SIZE,FAREITAPFZ_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("43003A005C00530061006E00640043006100730074006C0065005C0074006F006F006C0073*5C0065006D00610069006C002E007000640066000000000043003A005C0048006F0074*61353935343532312E796F6C6F782E6E65740000500000002F676174652E706870"));
		objdbscan.LoadSigDBEx(szdelfgk, _T("Trojan-PSW.Win32.Fareit.apfz"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], FAREITAPFZ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKranetC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Kranet.C Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectKranetC()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL && m_wAEPSec==0x0 && m_dwAEPUnmapped==0x1A2DA  && m_wNoOfSections == 0x05 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x2B725
		&&  m_pSectionHeader[m_wAEPSec + 1].PointerToRawData==0x2BC00 &&  m_pSectionHeader[0x4].PointerToRawData==0x5C200) || ((m_dwAEPUnmapped>=0x82af2 && m_dwAEPUnmapped<=0x82B22 ) && (m_wAEPSec==0x0 && m_wNoOfSections == 0x03 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData ==0x80c00 && m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x20d9)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		DWORD	dwBuffOffset =0x0;
		int KRANETC_BUFF_SIZE =0x0;

		if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		{
			KRANETC_BUFF_SIZE = 0x2900;
			dwBuffOffset =0x32100;
		}
		else
		{
			KRANETC_BUFF_SIZE = 0x1200;
			dwBuffOffset =0x82200;
		}

		m_pbyBuff = new BYTE[KRANETC_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[KRANETC_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,KRANETC_BUFF_SIZE,KRANETC_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szkranetc1 = (_T("443A5C5574696C69746965735C*42726F7773657246696C7465722E48656C7065722E706462*65722E48656C7065722E646C6C005F486F6F6B50726F63403132"));
		LPCTSTR			szkranetc2 = (_T("433A5C536F757263655C596F6E746F6F4C4C435C*52656C656173655C627376632E706462*627376632E646C6C005F486F6F6B50726F63403132"));		//for exe
		LPCTSTR			szkranetc3 = (_T("00200055006E0069006E007300740061006C006C00650072002E006500780065*6E00000031002E0030002E0030002E003000000038*5765737465726E2043617065311430*44757262616E76696C6C6531"));                                 
		objdbscan.LoadSigDBEx(szkranetc1, _T("not-a-virus:AdWare.Win32.Kranet.c"), TRUE);
		objdbscan.LoadSigDBEx(szkranetc2, _T("not-a-virus:AdWare.Win32.Kranet.c"), TRUE);
		objdbscan.LoadSigDBEx(szkranetc3, _T("not-a-virus:AdWare.Win32.Kranet.c"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], KRANETC_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBagleAf
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Bagle.Af Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBagleAf()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD	dwBuffOffset =0x0;

	if((m_wAEPSec==0x0 && m_dwAEPUnmapped==0x53D0  && (m_wNoOfSections == 0x03 ||m_wNoOfSections == 0x05)
		&& ( m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x46A6 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x8000 )&& 
		( m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x0C4E || m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x7000))||
		(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x1120  && (m_wNoOfSections == 0x03 ||m_wNoOfSections == 0x02)
		&&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x600&&  m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x002A))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	BAGLEAF_BUFF_SIZE = 0x60;
		m_pbyBuff = new BYTE[BAGLEAF_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		} 
		if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)			
			dwBuffOffset =0x1FF;  //for dll
		else
			dwBuffOffset =m_dwAEPUnmapped - 0x25;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwBuffOffset, &dwBuffOffset))
		{
			return iRetStatus;
		}

		if(!GetBuffer(dwBuffOffset, BAGLEAF_BUFF_SIZE, BAGLEAF_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szbagleaf1 = (_T("558BEC8B7D08F7D0EB0B478077FF05D047FFF657FF3B7D0C75F0C9*83EC20BE001040006815A840006800704000E8CBFFFFFF5068AE5340006800104000E8BBFFFFFF81"));//for exe
		LPCTSTR			szbagleaf2 = (_T("6F70656E005C636A6563746F722E65786500000050*E8100000701000006810"));//for dll

		objdbscan.LoadSigDBEx(szbagleaf1, _T("Worm.bagle.af"), FALSE);
		objdbscan.LoadSigDBEx(szbagleaf2, _T("Worm.bagle.af"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], BAGLEAF_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBdmj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Trojan.bdmj Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBdmj()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	if(!(m_wNoOfSections == 0x03 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x0800 && m_dwAEPUnmapped == 0x1000))
	{
		return iRetStatus;
	}

	const int BDMJ_BUFF_SIZE = 0x40;
	m_pbyBuff = new BYTE[BDMJ_BUFF_SIZE];
	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	DWORD dwSignStart;
	dwSignStart = m_pSectionHeader[1].PointerToRawData+0x1C8;

	if(GetBuffer(dwSignStart,BDMJ_BUFF_SIZE, BDMJ_BUFF_SIZE))
	{
		TCHAR BDMJ_Sig[] = {_T("7600740062006F00730073002E0079*006F006C006F0078002E00*6E006500740000")};
		//vtboss.yolox.net			
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(BDMJ_Sig, _T("Trojan.bdmj"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],BDMJ_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPlocust
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Plocust Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlocust()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PLOCUST_BUFF_SIZE = 0x110;
	m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];

	if(m_wNoOfSections == 0x06 && m_dwAEPUnmapped==0x109C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76200)
	{

		DWORD dwSignStart;
		dwSignStart = m_pSectionHeader[0].PointerToRawData+0x749D0;

		if(GetBuffer(dwSignStart,PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
		{
			TCHAR PLOCUST_Sig[] = {_T("8A1508B0470088D281FA21120C0074023013425AA134B047008A1508B04700001033C0A0F4A84700*8A80ECA84700A2F8A847008B54240452E843B8F8FF893DA9804700BE570000005B53FF3534B04700*425331DB595BEB034133318A0DF8A84700300B803DF4A84700")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(PLOCUST_Sig, _T("not a virus:Downloader.plocust.isye"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],PLOCUST_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}

	if(m_wNoOfSections == 0x06 && m_dwAEPUnmapped==0x1588 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6A200)
	{

		DWORD dwSignStart;
		dwSignStart = m_pSectionHeader[0].PointerToRawData+0x68419;
		if(GetBuffer(dwSignStart,PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
		{
			TCHAR PLOCUST_Sig[] = {_T("8A150800470088D281FA001C0E0074023013425AA1340047008A1508004700001033C0A054F34600*8A804CF34600A258F34600893547C0460039054EC046007E0E871561C04600013DD4C04600EB1D890551C04600E8A9E6FFFF890D80C04600891554C04600891DB8C0460089FB5B53FF3534004700E8000000005B425389DBE8000000005B595BEB0941*E8EBFFFFFF5B011931C9E8000000005A020D58F346005089D8E8000000005A300858803D54F3460000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(PLOCUST_Sig, _T("not a virus:Downloader.plocust.lmil"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],PLOCUST_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
		}
	}



	if(m_wNoOfSections == 0x06 && m_dwAEPUnmapped==0x1978 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x75E00)
	{

		DWORD dwSignStart;
		dwSignStart = m_pSectionHeader[0].PointerToRawData+0x72B4F;
		if(GetBuffer(dwSignStart,PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
		{
			TCHAR PLOCUST_Sig[] = {_T("8A1508A0480088D281FA21120C0074023013425AA134A048008A1508A04800001033C0A0E05148008A80D8514800A2E4514800*89152120480089359A204800891D962048005B53FF3534A04800*425331DB595BEB0341011931C9020DE45148005089D8300858803DE0514800007633")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(PLOCUST_Sig, _T("not a virus:Downloader.plocust.khud"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],PLOCUST_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	if(m_wNoOfSections == 0x06 && m_dwAEPUnmapped==0x156C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x65E00)
	{
		DWORD dwSignStart;
		dwSignStart = m_pSectionHeader[0].PointerToRawData+0x64769;

		if(GetBuffer(dwSignStart,PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
		{
			TCHAR PLOCUST_Sig[] = {_T("8A1508A0460088D281FA001C0E0074023013425AA134A046008A1508A04600001033C0A0609446008A8058944600A264944600890531704600803DDC70460000*7421C705F17046005F290100893DF4704600891DD170460066C7054070460042E3EB06873DF5704600891DA67046008905237046005B53FF3534A04600*E8000000005B425389DBE8000000005B595BEB0941E8EBFFFFFF5B011931C9E8000000005A020D649446005089D8E8000000005A300858803D6094460000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(PLOCUST_Sig, _T("not a virus:Downloader.plocust.mace"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],PLOCUST_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	if(m_wNoOfSections == 0x06 && m_dwAEPUnmapped==0x109C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76000)
	{
		DWORD dwSignStart;
		dwSignStart = m_pSectionHeader[0].PointerToRawData+0x746E6;
		if(GetBuffer(dwSignStart,PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
		{
			TCHAR PLOCUST_Sig[] = {_T("8A1508A04700001033C0A0389A47008A80309A4700A23C9A470066390DB0704700*7D014B890DE770470089056D704700C70535704700CF6B01005B53FF3534A04700*425331DB595BEB0341011931C9020D3C9A47005089D8300858803D389A")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(PLOCUST_Sig, _T("not a virus:Downloader.plocust.jhej"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],PLOCUST_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1398 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6A600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x69608, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA12C0047008A1508004700001033C0*A07CEF46008A8074EF4600A280EF4600BBAE0100"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.lstb"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1744 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6BA00)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x6A3AF, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("74023013425AA1340047008A1508004700001033C0*A014F746008A800CF74600A218F7460066C705ADD04600"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.lutk"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1764 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6A400)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x25;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x68BD4, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134F046008A1508F04600001033C0A0*54ED46008A804CED4600A258ED4600"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.llfb"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x16BC && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6AC00)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x40;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x68E1F, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134F046008A1508F04600001033C0A0*40EC46008A8038EC4600A244EC4600*89FA890D2BC046008D3D43C04600816F1CD90000005B53"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.llou"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x10A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x75C00)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x74636, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134A047008A1508A04700001033C0A0*5C9E47008A80549E4700A2609E4700833D94704700"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.ipuu"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1804 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6A000)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x68900, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("8A1508F0460088D281FA001C0E0074023013425A*A134F046008A1508F04600001033C0A00CE046008A8004E04600"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.ljwj"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1068 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x25 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x7443A, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134A047008A1508A0470000*1033C0A0189A47008A80109A4700A21C9A4700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.Plocust.kahi"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1084 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x74400)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x72CD0, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("74068A150890470088D281FA21120C0074023013*425AA1349047008A1508904700001033C0"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.Plocust.kbyo"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x105C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x74800)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x72EBD, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("A1349047008A1508904700001033C0A0688A4700*8A80608A4700A26C8A4700894C24DC391DB7604700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.Plocust.kejo"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1AE4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76A00)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x35 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		 		
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x737E0, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("81FA21130F0074068A150820480088D281FA21120C00*74023013425AA134204800*8A1508204800001033C0A050E44700"));
		
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.Plocust.klqe"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1074 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x75400)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x25 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73B4B, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("8A1508A0470088D281FA21120C007402*3013425AA134A047008A1508A04700001033"));
	
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.keqg"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1094 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x74200)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x25 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}    
		 		
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x72DD4, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("8A1508D0470088D281FA21120C0074023013425AA134D0*47008A1508D04700001033C0"));
		
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kfkn"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1974 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x77600)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x20 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}      
		 		
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73F88, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("41011931C9020DF8D847005089D83008*58803DF4D8470000"));
		
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kjaa"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x19D0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76600)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x20 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x735EF, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("41011931C9020D00C44700*5089D8300858803DFCC34700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kjcu"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x19D0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x77A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x40 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}      

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x7358B, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5281FA21130F0074068A1508F04B0088D281FA21120C007402*3013425AA134F04B008A1508F04B00001033C0*A0FCC349008A80F4C34900A200C44900"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kjia"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x18F0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76A00)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x25 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}       
		 		
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73783, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA1341048008A1508104800001033C0*A070E247008A8068E24700A274E24700"));
		
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kmio"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x1620 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x77600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73CE7, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5281FA21130F0074068A150810480088D281FA21120C00*74023013425AA134*1048008A1508104800001033C0"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.ksjs"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x3248 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x7DA00)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x35 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x77370, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA1346048008A1508604800001033C0*A0583D48008A80503D4800A25C3D4800"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kxlk"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_wNoOfSections==0x6 && m_dwAEPUnmapped==0x17D0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6B000)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x69CAE, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("88D281FA001C0E0074023013425AA134F046008A1508F04600001033C0*A038EE46008A8030EE4600A23CEE4600"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.lxpn"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_dwAEPUnmapped==0x164C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x75C00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x25;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x72DAC, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134F047008A1508F04700001033C0A0*1CCE47008A8014CE4700A220CE4700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kmwi"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_dwAEPUnmapped==0x18B8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73A3B, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("8A150800480088D281FA21120C0074023013425A*A1340048008A1508004800001033C0A040DF4700"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.krsw"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_dwAEPUnmapped==0x17E0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x40 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x734F8, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5281FA21130F0074068A150810480088D281FA21120C0074023013425A*A1341048008A1508104800001033C0A00CE147008A8004E14700A210E14700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kpsi"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_dwAEPUnmapped==0x165C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x69600)
	{		
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	PLOCUST_BUFF_SIZE = 0x45 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 		
		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x67ECC, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5281FAFF000F0074068A1508E0460088D281FA001C0E0074023013425A*A134E046008A1508E04600001033C0A058DB46008A8050DB4600A25CDB4600C7055FB04600"));
		
		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.ljzd"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	
	else if(m_dwAEPUnmapped==0x18D4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x76400)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x40 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x73314, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("5281FA21130F0074068A150800480088D281FA21120C0074023013425A*A1340048008A1508004800001033C0A068DF47008A8060DF4700A26CDF4700"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.krqz"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	else if(m_dwAEPUnmapped==0x164C && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x75C00)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x25;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}


		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x72DAC, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("3013425AA134F047008A1508F04700001033C0A0*1CCE47008A8014CE4700A220CE4700"));


		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.kmwi"), FALSE);



		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	else if(m_dwAEPUnmapped==0x16CC && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x6A000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	PLOCUST_BUFF_SIZE = 0x40 ;
		m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];
		if(!GetBuffer(0x6884C, PLOCUST_BUFF_SIZE,PLOCUST_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("8A1508E0460088D281FA001C0E0074023013425A*A134E046008A1508E04600001033C0A038DE46008A8030DE4600"));

		objdbscan.LoadSigDBEx(szdelfgk, _T("Downloader.plocust.liqs"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAutoRunBANT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of AutoRun.BANT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAutoRunBANT()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if(m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x110C && (m_wNoOfSections == 0x0003 || m_wNoOfSections == 0x0004) &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AUTORUNBANT_BUFF_SIZE = 0x700;
		m_pbyBuff = new BYTE[AUTORUNBANT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, AUTORUNBANT_BUFF_SIZE);
		

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x0340 , AUTORUNBANT_BUFF_SIZE, AUTORUNBANT_BUFF_SIZE))
		{
			return iRetStatus;
		}


		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szAutoRunBant = (_T("4812400048124000181140*401C40000000000010604000206040*410043003A005C005000*4A004500430054"));//project name and start address and end address of code
		
		
		
		objdbscan.LoadSigDBEx(szAutoRunBant,_T("Worm.AutoRun.bant"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],AUTORUNBANT_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCryptPIA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Crypt.pia Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCryptPIA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if(m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x4901 && m_wNoOfSections == 0x0002 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000 && m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x6000) 		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CRYPTPIA_BUFF_SIZE = 0x2500;
		m_pbyBuff = new BYTE[CRYPTPIA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, CRYPTPIA_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].SizeOfRawData - (m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x0700) , CRYPTPIA_BUFF_SIZE, 0x500))
		{
			return iRetStatus;
		}
		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szClickerCryptPIA = (_T("566A0057E8EF090000*8A140180F2618810404E75F4*6A406800100000FF74240C6A00FF154C10BA77C368008000006A00FF74240CFF155010BA77C3"));//
			
		objdbscan.LoadSigDBEx(szClickerCryptPIA,_T("Trojan.Crypt.pia"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],CRYPTPIA_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLinkuryA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Linkury.A Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLinkuryA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && ( m_dwAEPUnmapped == 0x13A5E ||  m_dwAEPUnmapped == 0x131CE ||  m_dwAEPUnmapped == 0x13A5E) && m_wNoOfSections == 0x0003
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000 && m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x18000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int LINKURYA_BUFF_SIZE = 0x1500;
		m_pbyBuff = new BYTE[LINKURYA_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, LINKURYA_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x8FB0, LINKURYA_BUFF_SIZE, LINKURYA_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szLinkuryA = (_T("4C696E6B7572792E506572736F6E616C69*7A6174696F6E2E53657474696E67732E50*75626C697368657253657474696E67734D"));//Linkury project name

		objdbscan.LoadSigDBEx(szLinkuryA,_T("not-a-virus:Adware.Linkury.a"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],LINKURYA_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScarEXWW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Scar.EXWW Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarEXWW()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if(m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x1130 && m_wNoOfSections == 0x0003 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SCAREXWW_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[SCAREXWW_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, SCAREXWW_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x06D0 , SCAREXWW_BUFF_SIZE, 0x500))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szScarEXWW = (_T("7878442E446F776E6C6F61646572002D4C42090048*00184000A01840003C1140*00574000105740"));//project structure ,start code and end code
				
		objdbscan.LoadSigDBEx(szScarEXWW,_T("Trojan.Scar.exww"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],SCAREXWW_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMydoomM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Mydoom.M Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMydoomM()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if(m_wAEPSec == 0x00 && (m_dwAEPUnmapped == 0x3280 || m_dwAEPUnmapped == 0x2D68) && (m_wNoOfSections == 0x0003 || m_wNoOfSections == 0x0002) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000) && 
		(m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0xD000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0xA000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int MYDOOMM_BUFF_SIZE = 0x600;
		m_pbyBuff = new BYTE[MYDOOMM_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, MYDOOMM_BUFF_SIZE);
		if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x0190 , MYDOOMM_BUFF_SIZE, MYDOOMM_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szMydoomM = (_T("49454672616D65*4154485F4E6F7465*726374726C5F72656E776E643332"));//worm uses names
				
		objdbscan.LoadSigDBEx(szMydoomM,_T("Worm.Mydoom.m"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],MYDOOMM_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSelfDeltke
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of SelfDel.tke Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSelfDeltke()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec==0x0 && m_dwAEPUnmapped==0x2200 && m_wNoOfSections == 0x03 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0xC5C4
		&&  m_pSectionHeader[m_wAEPSec + 1].Misc.VirtualSize== 0x1624)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
	
		const int	SELFDELTKE_BUFF_SIZE = 0x800;
		m_pbyBuff = new BYTE[SELFDELTKE_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		DWORD	dwBuffOffset =0x21FF;
				
		//m_pbyBuff = new BYTE[SELFDELTKE_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,SELFDELTKE_BUFF_SIZE,SELFDELTKE_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szselfdeltke = (_T("681C234000E8F0FF*767B4000A4284000*B0234000E02A40000C224000*B04D400060CD4000"));
		 
		objdbscan.LoadSigDBEx(szselfdeltke, _T("Trojan.SelfDel.tke"), FALSE);
		
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SELFDELTKE_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: Ramandeep
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
				      These are installer type of adware and tries to connect to websites and try to download setup files from there.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectIbryteJhl()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if (m_wAEPSec==0x0 && (m_dwAEPUnmapped==0x1087 || m_dwAEPUnmapped==0x46B4|| m_dwAEPUnmapped==0x6371 )&& (m_wNoOfSections == 0x05||m_wNoOfSections == 0x04 )
		&& ( m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x7000 ||  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize== 0x5000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize== 0xAD2))

	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		} 

		DWORD	dwBuffOffset =0x0;
		int SELFDELTKE_BUFF_SIZE =0x0;

		if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)			
		{
			dwBuffOffset =0x2890;  //for dll
			SELFDELTKE_BUFF_SIZE = 0x150;
		}
		else
		{
			dwBuffOffset =m_pMaxPEFile->m_stPEHeader.DataDirectory[4].VirtualAddress - 0x152C;
			SELFDELTKE_BUFF_SIZE = ( m_pMaxPEFile->m_dwFileSize - dwBuffOffset) ;
		}

		m_pbyBuff = new BYTE[SELFDELTKE_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}  

		//m_pbyBuff = new BYTE[SELFDELTKE_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,SELFDELTKE_BUFF_SIZE,SELFDELTKE_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szselfdeltke1 = (_T("4D6973736F7572693114301206035504070C0B4B616E7361732043697479*4D616469736F6E2041766520464C20313031143012060355040A0C0B4C69*4C69717569646275696C64"));
		LPCTSTR			szselfdeltke2 = (_T("6D0065000000000049006E007300740061006C006C006500720020005000610063006B*6E000000000032002E0034002E0038002E003100*34363030204D616469736F6E2041766520464C*4C69717569646275696C64"));

		objdbscan.LoadSigDBEx(szselfdeltke1, _T("not-a-virus:AdWare.Win32.iBryte.jhl"), TRUE);
		objdbscan.LoadSigDBEx(szselfdeltke2, _T("not-a-virus:AdWare.Win32.iBryte.jhl"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], SELFDELTKE_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCosmuCbyn
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Cosmu.Cbyn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCosmuCbyn()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x8 &&  m_dwAEPUnmapped == 0xA704 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x9A40 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9C00 )
		
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int COSMU_BUFF_SIZE = 0x320;

		m_pbyBuff = new BYTE[COSMU_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = 0x46E0;

		if(!GetBuffer(dwReadOff, COSMU_BUFF_SIZE, COSMU_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szAgent_CosmuCbyn = (_T("000062697363616E776F726D6D61726B0000*77696E3332646300FFFFFFFF0800000077696E333264635C00000000FFFFFFFF040000002E6578650000*7061746368000000FFFFFFFF050000006364666978000000FFFFFFFF0500000063686561*5554323030340000FFFFFFFF060000005175616B6533000053"));
		
		
		polydbobj.LoadSigDBEx(szAgent_CosmuCbyn, _T("Trojan.Cosmu.cbyn"), FALSE);	
		
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], COSMU_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBublik
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Alisha + Virus Analysis Team
	Description		: Detection routine for different varients of Bublik Family
					  Trojan.Bublik.BZYJ
					  Trojan.Bublik.CBQM
					  Trojan.Bublik.CEQT
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBublik()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x4 &&  m_dwAEPUnmapped == 0x1CF0 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x0EFC && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 )

	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUBLIK_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUBLIK_BUFF_SIZE];
		memset(m_pbyBuff,0x00,BUBLIK_BUFF_SIZE);

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[0].PointerToRawData + 0xB70;

		if(!GetBuffer(dwReadOff, BUBLIK_BUFF_SIZE, BUBLIK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};

		LPCTSTR szBublikBurd = (_T("C9A8F8D969133F57EC8726CD74996E0B402D8B7390A4EEC919*BEA0E4D86A14364CE6C534DC7AF0341A4633E33DC9B1BBCF76192A46E7DD6CC061F575184D2DCC208EF0A583294E7153EDCF6DD069FC*1146338664D7B2FFD876057040E68736DE11B673144839866191A3F7C277122C50A6D927D33FFC621C"));
		polydbobj.LoadSigDBEx(szBublikBurd, _T("Trojan.Bublik.burd"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BUBLIK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	else if( m_wAEPSec == 0 && m_wNoOfSections == 0x4 &&  m_dwAEPUnmapped == 0x1215 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x0E68 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 )							//For Trojan.Bublik.bkis [Yogesh Sakat]

	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUBLIK_BUFF_SIZE = 0x310;
		m_pbyBuff = new BYTE[BUBLIK_BUFF_SIZE];
		memset(m_pbyBuff,0x00,BUBLIK_BUFF_SIZE);

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[0].PointerToRawData + 0xDC0;

		if(!GetBuffer(dwReadOff, BUBLIK_BUFF_SIZE, BUBLIK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};

		LPCTSTR szBublikBkis = (_T("518A06468A0F32C1880747594B74074975EE5B5B5F*616C6C6F77000000746F70696300416C6C0067726F756E64696E670065646974*5465787400000073746174696300627574746F6E00000051756974000000646973706C61796564"));
		polydbobj.LoadSigDBEx(szBublikBkis, _T("Trojan.Bublik.bkis"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BUBLIK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	else if( m_wAEPSec == 0 && m_wNoOfSections == 0x5 &&  m_dwAEPMapped == 0x400 && m_pSectionHeader[m_wAEPSec+1].SizeOfRawData == 0x1000)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUBLIK_BUFF_SIZE = 0x600;
		m_pbyBuff = new BYTE[BUBLIK_BUFF_SIZE];
		memset(m_pbyBuff,0x00,BUBLIK_BUFF_SIZE);

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec+1].PointerToRawData + 0x250;

		if(!GetBuffer(dwReadOff, BUBLIK_BUFF_SIZE, BUBLIK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};

		LPCTSTR szBublikBZYJ = (_T("506F6F74517579744D656F7361677D*8A1600DAF6D088D0F6D0AA83C10583C6"));
		polydbobj.LoadSigDBEx(szBublikBZYJ, _T("Trojan.Bublik.BZYJ"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BUBLIK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	else if( m_wAEPSec == 0 && m_wNoOfSections == 0x3 &&  m_dwAEPMapped == 0x455 && m_pSectionHeader[m_wAEPSec+1].SizeOfRawData == 0x1000)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUBLIK_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[BUBLIK_BUFF_SIZE];
		memset(m_pbyBuff,0x00,BUBLIK_BUFF_SIZE);

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData;

		if(!GetBuffer(dwReadOff, BUBLIK_BUFF_SIZE, BUBLIK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};

		LPCTSTR szBublikBZYJ = (_T("44240C01FF1510C754008B4C24048BC664890D000000005E83C40CC2040056*68FA0D008B4C240464890D000000005E83C40CC20400"));
		polydbobj.LoadSigDBEx(szBublikBZYJ, _T("Trojan.Bublik.CBQM"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BUBLIK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	else if(m_wAEPSec == 0 && ((m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x200) || (m_wNoOfSections == 0x2 && m_dwAEPMapped == 0x1000))
		&& m_wAEPSec == 0x0 && memcmp(m_pSectionHeader[m_wAEPSec].Name,".data",5) == 0)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BUBLIK_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[BUBLIK_BUFF_SIZE];
		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff,0x00,BUBLIK_BUFF_SIZE);

		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xE00;

		if(!GetBuffer(dwReadOff, BUBLIK_BUFF_SIZE, BUBLIK_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbobj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szBublikBZYJ = (_T("668B1200DAF6D288D0AA83E9024783C6*BA3600000083EA065883C004FFD068867F00006A00"));

		polydbobj.LoadSigDBEx(szBublikBZYJ, _T("Trojan.Bublik.CEQT"), FALSE);	
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], BUBLIK_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectZusy
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Zusy Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectZusy()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x4 &&  m_dwAEPUnmapped == 0x2865 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x53FE && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000 )
		
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
		const int ZUSY_BUFF_SIZE = 0x60;

		m_pbyBuff = new BYTE[ZUSY_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = 0x12D0;

		if(!GetBuffer(dwReadOff, ZUSY_BUFF_SIZE, ZUSY_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		
		LPCTSTR szZusy = (_T("8B55AC83C2018955AC8B45AC3B450C7353*034D0C0FAF4D0C03C133D2B91A000000F7F1*0345AC8A4C15CA88080FBE55FE0FBE45FD83E8013BD0"));
		polydbobj.LoadSigDBEx(szZusy, _T("Gen:Variant.Zusy.13800"), FALSE);	
		
		if(polydbobj.ScanBuffer(&m_pbyBuff[0], ZUSY_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectClickerSmallAK
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Small.AK Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerSmallAK()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	
	if(m_dwAEPUnmapped == 0x2000 && (m_wNoOfSections == 0x0003 || m_wNoOfSections == 0x0004) && 
		(m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x200 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x600 ) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7000 )) 		
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int CLICKERSMALL_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[CLICKERSMALL_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, CLICKERSMALL_BUFF_SIZE);

		if(m_wNoOfSections == 0x0004)
		{
			if(!GetBuffer(m_pSectionHeader[2].SizeOfRawData, CLICKERSMALL_BUFF_SIZE, 0x500))
			{
				return iRetStatus;
			}
		}
		else if (m_wNoOfSections == 0x0003)
		{
			if(!GetBuffer(m_pSectionHeader[0].SizeOfRawData - 0x2B90, CLICKERSMALL_BUFF_SIZE, 0x500))
			{
				return iRetStatus;
			}
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szClickerSmallAK = (_T("737461727420687474703A2F2F6164732E*726567696564657075622E636F6D2F6367692D62696E2F616476657274*2F6765746164733F785F64705F69643D"));//
	
		objdbscan.LoadSigDBEx(szClickerSmallAK,_T("Clicker.Small.ak"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],CLICKERSMALL_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDroppernekl
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Dropper.NEKL Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDroppernekl()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	if(!(m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x77E00 && m_dwAEPUnmapped == 0x1024))
	{
		return iRetStatus;
	}

	const int NEKL_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[NEKL_BUFF_SIZE];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}

	DWORD dwSignStart;
	dwSignStart = m_pSectionHeader[0].PointerToRawData+0x76772;

	if(GetBuffer(dwSignStart,NEKL_BUFF_SIZE, NEKL_BUFF_SIZE))
	{
		TCHAR NEKL_Sig[] = {_T("8A0D08D04700300B59A134D047008A1508D04700*001033C0A010C147008A8008C14700A214C1470084FF75*2B318A0D14C14700300B803D10C14700")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(NEKL_Sig, _T("Dropper.agent.nekl"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],NEKL_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectNvxg
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of agent.nvxg Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectNvxg()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	if(!(m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x1C000 && m_dwAEPMapped == 0xE017 && m_wNoOfSections == 0x03 ))
	{
		return iRetStatus;
	}

	const int NVXG_BUFF_SIZE = 0x50;
	m_pbyBuff = new BYTE[NVXG_BUFF_SIZE];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}


	DWORD dwSignStart;
	dwSignStart = m_pSectionHeader[0].PointerToRawData+0x3BF0;


	if(GetBuffer(dwSignStart,NVXG_BUFF_SIZE, NVXG_BUFF_SIZE))
	{
		TCHAR NVXG_Sig[] = {_T("68007400740070003A002F002F*0069006E007300740061006C006C0064007200650061006D002E0063006F006D002F*0064006F0077006E006C006F00610064002F")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(NVXG_Sig, _T("Dropper.agent.nvxg"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],NVXG_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectHedxp
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.hdxp Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectHedxp()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	if(!(m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x1200 && m_dwAEPUnmapped == 0x1EC0 && m_wNoOfSections == 0x04 ))
	{
		return iRetStatus;
	}

	const int HEDXP_BUFF_SIZE = 0x100;
	m_pbyBuff = new BYTE[HEDXP_BUFF_SIZE];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}


	DWORD dwSignStart;
	dwSignStart = m_pSectionHeader[0].PointerToRawData+0xE50;


	if(GetBuffer(dwSignStart,HEDXP_BUFF_SIZE, HEDXP_BUFF_SIZE))
	{
		TCHAR HEDXP_Sig[] = {_T("8B0632C1E855000000C35753508BD8*E82FF2FFFF85C074074975F4585B5F*880746")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(HEDXP_Sig, _T("Downloader.agent.hedxp"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],HEDXP_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBrainInst
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of BrainInst Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBrainInst()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections != 0x5 && (m_pSectionHeader[m_wAEPSec].Characteristics!=0x60000020 || m_pSectionHeader[m_wAEPSec].Characteristics!=0xE0000020))
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int BRAINNTST_BUFF_SIZE = 0x59;
	m_pbyBuff = new BYTE[BRAINNTST_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0].PointerToRawData+0x1B0, BRAINNTST_BUFF_SIZE, BRAINNTST_BUFF_SIZE))
	{
		TCHAR BRAINNTST_CZ_Sig[] = {_T("0FB7544D003D00000001730C0FB63BC1E608C1E0080BF7438BF8C1EF0B0FAFFA3BF773178BC7BF000800002BFAC1EF0503FA66897C4D0003C9EB142BC72BF78BFAC1EF052BD76689544D008D4C090181*F90001000072A9")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(BRAINNTST_CZ_Sig, _T("Not a virus:Adware.Braininst.u"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BRAINNTST_BUFF_SIZE, szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectShipupBoe
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Shipup.Boe Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectShipupBoe()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	if(!(m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x5C00 && m_dwAEPUnmapped == 0x1A00 && m_wNoOfSections == 0x04 ))
	{
		return iRetStatus;
	}

	const int BOE_BUFF_SIZE = 0xF4;
	m_pbyBuff = new BYTE[BOE_BUFF_SIZE];

	if(!m_pbyBuff)
	{
		return iRetStatus;
	}


	DWORD dwSignStart;
	dwSignStart = m_pSectionHeader[0].PointerToRawData+0x4f;


	if(GetBuffer(dwSignStart,BOE_BUFF_SIZE, BOE_BUFF_SIZE))
	{
		TCHAR BOE_Sig[] = {_T("8B45F883C0018945F88B4DF83B4D107D398B55088955F4*8B450C8945E8C745FC8EC36600C745FC8EC366008B4DE8034DF80FB6118955EC*8B45EC8945F08B4DF4034DF88A55F08811")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(BOE_Sig, _T("Trojan.shipup.boe"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],BOE_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.n Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentN()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL && m_wAEPSec==0x0 && m_dwAEPUnmapped==0x136ce  && m_wNoOfSections == 0x03 &&  m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x116d4 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[14].Size > 0 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		DWORD	dwBuffOffset =0xA000;
		int AGENTN_BUFF_SIZE =0x1000;

		m_pbyBuff = new BYTE[AGENTN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		//m_pbyBuff = new BYTE[AGENTN_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,AGENTN_BUFF_SIZE,AGENTN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szagentn = (_T("5075626C69736865724D616E6167657200737070736D004C696E6B757279*566972616C53657474696E6773*4C696E6B7572794578654469720069643132375F5075626C697368657242726F7773657253657474696E67734C697374*486F73747346696C654D6F6E69746F724C696E6B757279446F6D61696E73"));
		objdbscan.LoadSigDBEx(szagentn, _T("not-a-virus:WebToolbar.MSIL.Agent.n"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], AGENTN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLargeFiles
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of Androm.gxjj Family
					  To Detect Large files grater than 50 MB in c:/ProgramData on Windows 7 and 
					  C:/D&S/All Users on Windows XP.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLargeFiles()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(  m_pMaxPEFile->m_dwFileSize >=0x3200000)
	{
		TCHAR szFilePath[MAX_PATH] = {0};
		TCHAR szFilePath1[MAX_PATH] = {0};
		TCHAR szFilePathStatic1[MAX_PATH] = {0};
		TCHAR szFilePathStatic2[MAX_PATH] = {0};
		TCHAR szFilePathStatic3[MAX_PATH] = {0};
		//DWORD dwAttributes;
		
		//_tcscpy_s(szFilePathStatic1, MAX_PATH, L"C:\\Documents and Settings\\All Users\\");
		_stprintf(szFilePathStatic1, L"%s\\Documents and Settings\\All Users\\",m_szSysDrive);
		//_tcscpy_s(szFilePathStatic2, MAX_PATH, L"C:\\ProgramData\\");
		_stprintf(szFilePathStatic2, L"%s\\ProgramData\\",m_szSysDrive);

		_tcscpy_s(szFilePath, MAX_PATH,  m_pMaxPEFile->m_szFilePath);
		_stprintf(szFilePathStatic3, L"%s\\Users\\All Users\\",m_szSysDrive);



//		dwAttributes=FILE_ATTRIBUTE_NORMAL ;
//		SetFileAttributes(szFilePath, dwAttributes);

		LPTSTR lptPtr = _tcsrchr(szFilePath, _T('.'));

		if (lptPtr && wcsstr(lptPtr,L".exe"))
		{
			*lptPtr = 0; 
			LPTSTR lptPtrSlash = _tcsrchr(szFilePath, _T('\\'));
			_tcscpy_s(szFilePath1, MAX_PATH,  lptPtrSlash);

			*lptPtrSlash = 0;
			wcscat(szFilePath,_T("\\"));

			//if(((!(_tcsicmp(szFilePath,szFilePathStatic1)))|| (!(_tcsicmp(szFilePath,szFilePathStatic2)))) && wcsstr(szFilePath1,L"\\m") )
			if(((!(_tcsicmp(szFilePath,szFilePathStatic1)))|| (!(_tcsicmp(szFilePath,szFilePathStatic2))) || (!(_tcsicmp(szFilePath,szFilePathStatic3))))&& wcsstr(szFilePath1,L"\\m") )
			{

				DWORD	dwBuffOffset =0x0;
				int BIGFILE_BUFF_SIZE =0x70;

				//m_pbyBuff = new BYTE[BIGFILE_BUFF_SIZE];
				if(m_pbyBuff)
				{
					delete []m_pbyBuff;
					m_pbyBuff = NULL;
				}  

				m_pbyBuff = new BYTE[BIGFILE_BUFF_SIZE];
				if(!m_pbyBuff)
				{
					return iRetStatus;
				}

				if(!GetBuffer(dwBuffOffset,BIGFILE_BUFF_SIZE,BIGFILE_BUFF_SIZE))
				{
					return iRetStatus;
				}


				CSemiPolyDBScn	objdbscan;
				TCHAR			szVirusName[MAX_PATH] = {0};
				LPCTSTR			szagentn = (_T("4D5A*546869732070726F6772616D2063616E6E6F7420626520"));
				objdbscan.LoadSigDBEx(szagentn, _T("Backdoor.Win32.Androm.gxjj"), FALSE);	


				if(objdbscan.ScanBuffer(&m_pbyBuff[0], BIGFILE_BUFF_SIZE, szVirusName)>= 0)
				{
					if(_tcslen(szVirusName)>0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
			return iRetStatus;
		}
		return iRetStatus;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentUWUE
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.UWUE Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentUWUE()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0xC925 && m_wNoOfSections == 0x0005
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13000 && m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x21000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENTUWUE_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[AGENTUWUE_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, AGENTUWUE_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + 0x1590, AGENTUWUE_BUFF_SIZE, AGENTUWUE_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szLinkuryA = (_T("7100710032003000300039002E00330033*320032002E006F00720067*7100710032003000300039002E0033003300320032002E006F00720067"));//qq2009.3322.org

		objdbscan.LoadSigDBEx(szLinkuryA,_T("Trojan.Agent.uwue"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],AGENTUWUE_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDriverUPD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Ramandeep + Virus Analysis Team
	Description		: Detection routine for different varients of DriverUPD Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDriverUPD()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if (m_wAEPSec==0x0 && (m_dwAEPUnmapped==0x101A || m_dwAEPUnmapped==0xAC250 )&& (m_wNoOfSections == 0x03 ||m_wNoOfSections == 0x05  )
		&& (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x142000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x144000 || m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0xF9E48) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1DF504 || m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x1DC463 || m_pSectionHeader[m_wAEPSec].SizeOfRawData==0xFA000) )

	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		} 

		DWORD	dwBuffOffset =0x0;
		int DRIVERUPD_BUFF_SIZE =0x0;
		LPTSTR str1;

		if( m_dwAEPUnmapped ==0xAC250 )		//wkn	
		{
			dwBuffOffset =0xFC900;  
			DRIVERUPD_BUFF_SIZE = 0x700;
			str1 =_T("not-a-virus:Downloader.Win32.DriverUpd.wkn");
		}
		else
		{

			if( m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x142000 )//wxv
			{
				dwBuffOffset =0x136100;  
				DRIVERUPD_BUFF_SIZE = 0xD00;
				str1 =_T("not-a-virus:Downloader.Win32.DriverUpd.wxv");
			}
			else if(m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x144000 )//wui
			{
				dwBuffOffset =0x138100;  
				DRIVERUPD_BUFF_SIZE = 0xD00;
				str1 =_T("not-a-virus:Downloader.Win32.DriverUpd.wui");
			}
		}

		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}  

		//m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(!GetBuffer(dwBuffOffset,DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdriverupd1 = (_T("56426F784D6F7573652E7379730000004D414C5741524500564952555300000053414E44424F58005C56*73626965646C6C2E646C6C0077696E655F6765745F756E69785F66696C655F6E616D65*77005F00730000000000726F6F745C43494D5632000053454C454354202A204652*4C494B45202725564D77617265252729000000410074006C00490073"));
		LPCTSTR			szdriverupd2 = (_T("5C43494D5632000053454C454354202A2046524F4D2057696E33325F42494F53205748455245204D616E756661637475726572204C494B4520272558454E252729*56426F784D6F7573652E7379730000004D414C5741524500564952555300000053414E44424F58005C56*73626965646C6C2E646C6C0077696E655F6765745F756E69785F66696C655F6E616D65*616E64000000536F6674776172655C564F535C43616D65796F00534F4654574152455C4661726F6E696373000000535953*57697265736861726B000000497357696E646F777353657276657200497343616D65796F496E7374616C6C6564"));

		objdbscan.LoadSigDBEx(szdriverupd1,str1, TRUE);       
		objdbscan.LoadSigDBEx(szdriverupd2,str1, FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DRIVERUPD_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	
	if( (m_dwAEPUnmapped==0x530C3 || m_dwAEPUnmapped==0x531CF ) && m_wNoOfSections == 0x05 && m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x78E00 )
	{

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		const int	DRIVERHLH_BUFF_SIZE = 0x37;
		m_pbyBuff = new BYTE[DRIVERHLH_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset =m_pSectionHeader[1].PointerToRawData + 0x31B8;


		//m_pbyBuff = new BYTE[DRIVERHLH_BUFF_SIZE];

		if(!GetBuffer(dwBuffOffset, DRIVERHLH_BUFF_SIZE, DRIVERHLH_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("687474703A2F2F00*7300740061006E002E00*6D00780070003100300038002E0063006F006D"));
		objdbscan.LoadSigDBEx(szdelfgk, _T("not a virus:Downloader.driverupd.hlh"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DRIVERHLH_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	/////////////////////////////////////////for .aklm and .algb by Ramandeep //////////////////////

	if(m_wAEPSec==0x00 && ((m_dwAEPUnmapped >=0xB6610 && m_dwAEPUnmapped <=0xB6635) ||  m_dwAEPUnmapped ==0xB6BB0)&& (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x18E000 ||m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x18B000 )&& (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x03))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int	DRIVERALGB_BUFF_SIZE = 0xc00;
		m_pbyBuff = new BYTE[DRIVERALGB_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
       
		 DWORD	dwBuffOffset =0x109400;
				
		//m_pbyBuff = new BYTE[DRIVERALGB_BUFF_SIZE];
		if(!GetBuffer(dwBuffOffset,DRIVERALGB_BUFF_SIZE,DRIVERALGB_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szselfdeltke = (_T("735C56426F784D6F7573652E7379730000004D414C57415245*5C53414D504C450073626965646C6C2E646C6C0077696E655F6765745F756E69785F66696C65*4D616E756661637475726572204C494B4520272558454E252729000000000000005345*497350726F636D6F6E4F70656E000000415049204D6F6E69746F720057696E4368656174"));
		                                  
        if(m_dwAEPUnmapped ==0xB6BB0)
		{
			objdbscan.LoadSigDBEx(szselfdeltke, _T("not-a-virus:Downloader.DriverUpd.aklm"), FALSE);
		
		}
		else
		{
		objdbscan.LoadSigDBEx(szselfdeltke, _T("not-a-virus:Downloader.DriverUpd.algb"), FALSE);
		}

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DRIVERALGB_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	

	}

	//code for downloader.driverupd.ipb

	if( (m_dwAEPMapped==0x1B576 || m_dwAEPMapped==0x1B516 ) && m_wNoOfSections == 0x04 && m_pSectionHeader[m_wAEPSec].SizeOfRawData==0x34000 )
	{
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		const int	DRIVERIPB_BUFF_SIZE = 0x105;
		m_pbyBuff = new BYTE[DRIVERIPB_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwBuffOffset;

		if(m_dwAEPMapped==0x1B576)
		{
			dwBuffOffset =m_pSectionHeader[1].PointerToRawData + 0x16150;

		}

		if(m_dwAEPMapped==0x1B516)
		{
			dwBuffOffset =m_pSectionHeader[1].PointerToRawData + 0x186E8;
		}

		//m_pbyBuff = new BYTE[DRIVERIPB_BUFF_SIZE];

		if(!GetBuffer(dwBuffOffset, DRIVERIPB_BUFF_SIZE, DRIVERIPB_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szdelfgk = (_T("530045004C0045004300540020002A002000460052004F004D*570069006E00330032005F00420049004F0053*4C0049004B004500200027002500580045004E002500*4C0049004B004500200027002500560042004F005800250027*250062006F0063006800730025"));
		objdbscan.LoadSigDBEx(szdelfgk, _T("not a virus:Downloader.driverupd.ipb"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], DRIVERIPB_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomBlockerMGN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Blocker.mgn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomBlockerMGN()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && m_dwAEPUnmapped == 0x1240 && m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData == 0x6E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}
		const int BLOCKERMGN_BUFF_SIZE = 0xA0;
		m_pbyBuff = new BYTE[BLOCKERMGN_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwBuffOffset = m_pSectionHeader[m_wAEPSec + 1].PointerToRawData + 0x3F0;

		if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[0], dwBuffOffset, BLOCKERMGN_BUFF_SIZE, BLOCKERMGN_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR  szBlockerMGN = (_T("687474703A2F2F7777772E696261796D652E656232612E636F6D2F64776E2E646D70*687474703A2F2F7777772E696261796D652E656232612E636F6D2F61642E706870007777772E696261796D652E656232612E636F6D003830002F636F64652E706870")); //Malicious Websites it connects and download files..
		objdbscan.LoadSigDBEx(szBlockerMGN, _T("Trojan-Ransom.Blocker.mgn"), FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0], BLOCKERMGN_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMydoomL
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of Mydoom.l Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMydoomL()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && m_wNoOfSections == 0x2 &&  m_dwAEPUnmapped == 0x2D68 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x79EE && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7A00 )

	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int MYDOOM_BUFF_SIZE = 0xF30;

		m_pbyBuff = new BYTE[MYDOOM_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xA50;

		if(!GetBuffer(dwReadOff, MYDOOM_BUFF_SIZE, MYDOOM_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szMydoom_L = (_T("696E636F6D696E6700000000667470726F6F7400646F776E6C6F61640000000073686172*8A440DF08AD080C20280E20F88944D98FEFFFFB2F9C0E8042AD080E20F88944D99FEFFFF4183F9107CD6"));

		objdbscan.LoadSigDBEx(szMydoom_L, _T("Email-Worm.Win32.Mydoom.l"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], MYDOOM_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomBlockerGFEQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Yogesh Sakat + Virus Analysis Team
	Description		: Detection routine for different varients of RansomBlocker.GFEQ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomBlockerGFEQ()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wAEPSec == 0 && ( m_wNoOfSections == 0x6 || m_wNoOfSections == 0x8 ) &&  m_dwAEPUnmapped == 0x1240 && 
		( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1400 ) &&
		( m_pSectionHeader[2].SizeOfRawData == 0x400 || m_pSectionHeader[2].SizeOfRawData == 0x600 ) &&
		( ( m_pSectionHeader[m_wNoOfSections-1].Characteristics & 0xE0000000) == 0xE0000000 || ( m_pSectionHeader[m_wNoOfSections-3].Characteristics & 0xE0000000) == 0xE0000000 ) ) 

	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BLOCKERGFEQ_BUFF_SIZE = 0x1C0;

		m_pbyBuff = new BYTE[BLOCKERGFEQ_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwReadOff = m_pSectionHeader[2].PointerToRawData + 0x100;

		if(!GetBuffer(dwReadOff, BLOCKERGFEQ_BUFF_SIZE, BLOCKERGFEQ_BUFF_SIZE ))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	objdbscan;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szBlockerGFEQ1 = (_T("433A5C57696E5368656C6C5C57696E536576656E2E657865*50726F6772616D735C537461727475705C7461736B686F73742E657865006100433A5C57696E5368656C6C5C57696E436F6E2E646C6C*56695275532DA7C400A7A7A7C459F44FF455A753F459F453F454F445F44DA72D426942694E532DA750F44CF441F459A742F459A742F434F455A747F441F44DF445"));
		LPCTSTR			szBlockerGFEQ2 = (_T("5245472041444420484B43555C536F6674776172655C4D6963726F736F66745C57696E646F77735C43757272656E7456657273696F6E5C52756E202F762057696E5368656C6C*5245475F535A202F6420433A5C57696E5368656C6C5C57696E536576656E2E657865*2F6600433A5C57696E5368656C6C00433A5C57696E5368656C6C5C57696E536576656E2E657865"));

		objdbscan.LoadSigDBEx(szBlockerGFEQ1, _T("Trojan-Ransom.Win32.Blocker.gfeq"), TRUE);
		objdbscan.LoadSigDBEx(szBlockerGFEQ2, _T("Trojan-Ransom.Win32.Blocker.gfeq"), FALSE);

		if(objdbscan.ScanBuffer(&m_pbyBuff[0], BLOCKERGFEQ_BUFF_SIZE, szVirusName)>= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFiseriaHV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Fiseria.hv Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFiseriaHV()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && (m_dwAEPUnmapped == 0xF5BB || m_dwAEPUnmapped == 0xF56B || m_dwAEPUnmapped == 0xF5DB || m_dwAEPUnmapped == 0xF58B || m_dwAEPUnmapped == 0xE61A ) && ( m_wNoOfSections == 0x0003 || m_wNoOfSections == 0x0005 )
		&& ( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x81000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x82000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x83000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1CC00) && ( m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x87000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x89000 ||
		m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x8B000 || m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x7F000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int FISERIAHV_BUFF_SIZE = 3500;
		m_pbyBuff = new BYTE[FISERIAHV_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, FISERIAHV_BUFF_SIZE);
		if( m_pSectionHeader[2].PointerToRawData == 0x83000 )
		{
			if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + 0x4A00, FISERIAHV_BUFF_SIZE, FISERIAHV_BUFF_SIZE))
			{
				return iRetStatus;
			}

		}
		else if( m_pSectionHeader[2].PointerToRawData == 0x84000)
		{
			if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + 0x5A00, FISERIAHV_BUFF_SIZE, FISERIAHV_BUFF_SIZE))
			{
				return iRetStatus;
			}

		}
		else
		{
			if(!GetBuffer(m_pSectionHeader[2].PointerToRawData + 0x6A00, FISERIAHV_BUFF_SIZE, 0x500))
			{
				return iRetStatus;
			}
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szFiseriaHV = (_T("4669727365726961*4669727365726961*112130c3b28d7c9c29b8b07321ef3f8a1462"));//Fiseria and seriel number
		
		objdbscan.LoadSigDBEx(szFiseriaHV,_T("not-a-virus:Adware.Fiseria.hv"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],FISERIAHV_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectYotoonSZT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Deshmukh + Virus Analysis Team
	Description		: Detection routine for different varients of Yotoon.SZT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectYotoonSZT()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader .Characteristics & IMAGE_FILE_DLL ) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0x20437 && m_wNoOfSections == 0x0006
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x31000 && m_pMaxPEFile->m_stPEHeader.SizeOfImage == 0x4A000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int YOTOONSZT_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[YOTOONSZT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0x00, YOTOONSZT_BUFF_SIZE);

		if(!GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x1C0B0, YOTOONSZT_BUFF_SIZE, YOTOONSZT_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn objdbscan;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szYotoonSZT = (_T("6A01B968FA0310E8E491FEFFC3*6A01B968FA0310E88493FEFFC3*A168FA03108B500CB968FA0310FFD2F7D81BC0F7D8C3"));//function calls
		
		objdbscan.LoadSigDBEx(szYotoonSZT,_T("not-a-virus:Adware.Yotoon.szt"),FALSE);
		if(objdbscan.ScanBuffer(&m_pbyBuff[0],YOTOONSZT_BUFF_SIZE,szVirusName)>=0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName,MAX_VIRUS_NAME,szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDapatoEdqu
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gajanan Vaikunthe + Virus Analysis Team
	Description		: Detection routine for different varients of Dapato.Edqu Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDapatoEdqu()
{

	int  iRetStatus = VIRUS_NOT_FOUND;
	int const DAPATO_BUFF_SIZE = 0x80;
	if(m_wAEPSec == 0 && (m_wNoOfSections==0x5 || m_wNoOfSections==0x6) &&  m_dwAEPUnmapped==0x3C67)
	{	
		TCHAR DapatoEdqu_Sig[] = {_T("687474703A2F2F7777772E6E657374616F2E636F6D2F77702D696E636C756465732F546578742F446966662F456E67696E652F656E67696E652F*687474703A2F2F65626F6F6B63656E7465722E7676732E69722F")};
		//[http://www.nestao.com/wp-includes/Text/Diff/Engine/engine/]*[http://ebookcenter.vvs.ir/]
		if(GetBuffer(m_pSectionHeader[1].PointerToRawData + 0x4D0,DAPATO_BUFF_SIZE,DAPATO_BUFF_SIZE))
		{
			CSemiPolyDBScn polyDBscan;
			polyDBscan.LoadSigDBEx(DapatoEdqu_Sig,_T("Dropper.Dapato.edqu"),FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polyDBscan.ScanBuffer(&m_pbyBuff[0],DAPATO_BUFF_SIZE,szVirusName)>=0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dapato.edqu"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBaduramrst
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of badur.AMRST Family
					  *>malicious url.
					  "h.t.t.p.:././.t.r.a.c.k...g.e.t.p.o.r.t.a.l...n.e.t./.t.r.a.c.k.c.n.t./.K.v.g.4.8.R.p.S.K.K.F.N.k.W.8.e./.?.d.a.t.a.=.P.L.0.0.0.0.&.d.e.t.a.i.l.s.="
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBaduramrst()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	

	if(m_wNoOfSections != 0x5 && m_dwAEPMapped==0x93EA && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x10200  )
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

				const int BADURAMRST_BUFF_SIZE = 0x100;
				m_pbyBuff = new BYTE[BADURAMRST_BUFF_SIZE];

				if(GetBuffer(m_pSectionHeader[1].PointerToRawData+0x390, BADURAMRST_BUFF_SIZE, BADURAMRST_BUFF_SIZE))
				{
					TCHAR BADURAMRST_CZ_Sig[] = {_T("68007400740070003A002F002F0074007200610063006B002E00*67006500740070006F007200740061006C002E006E00650074002F0074007200610063006B0063006E007400*2F004B0076006700340038005200700053004B004B0046004E006B00570038006500*2F003F0064006100740061003D0050004C0030003000300030002600640065007400610069006C0073003D00")};

					CSemiPolyDBScn polydbObj;
					polydbObj.LoadSigDBEx(BADURAMRST_CZ_Sig, _T("Trojan.badur.amrst"), FALSE);

					TCHAR szVirusName[MAX_PATH] = {0};

					if(polydbObj.ScanBuffer(&m_pbyBuff[0], BADURAMRST_BUFF_SIZE, szVirusName)>=0)	
					{

						if(_tcslen(szVirusName) > 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
	
							return VIRUS_FILE_DELETE;
					
						}
					}
				}

		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentXknn
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Xknn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentXknn()
{
	int iRetStatus = VIRUS_NOT_FOUND;


	if(m_wNoOfSections != 0x4 && m_dwAEPMapped !=0x2330A0  &&m_pSectionHeader[0].SizeOfRawData != 0x26B000 )
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int XKNN_BUFF_SIZE = 0x3A;
	m_pbyBuff = new BYTE[XKNN_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[1].PointerToRawData+0x444, XKNN_BUFF_SIZE, XKNN_BUFF_SIZE))
	{
		TCHAR XKNN_CZ_Sig[] = {_T("6D7920666F6C6465722E657865*433A5C447269766572315C73766363686F73742E657865*433A5C44726976657231")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(XKNN_CZ_Sig, _T("Trojan.Agent.xknn"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], XKNN_BUFF_SIZE  , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentUggl
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.Uggl Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentUggl()
{
	int iRetStatus = VIRUS_NOT_FOUND;


	if(m_wNoOfSections != 0x4 && m_dwAEPMapped !=0x3BBC &&m_pSectionHeader[0].SizeOfRawData != 0x3000 )
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int UGGL_BUFF_SIZE = 0x22;
	m_pbyBuff = new BYTE[UGGL_BUFF_SIZE];

	if(GetBuffer(0x2E8C, UGGL_BUFF_SIZE, UGGL_BUFF_SIZE))
	{
		TCHAR UGGL_CZ_Sig[] = {_T("8BD881E30100008079054B83CBFE437507428AD9321A*EB068A5D014532D9885C3802403BC67CD9")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(UGGL_CZ_Sig, _T("Trojan.Agent.ugql"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], UGGL_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPlocustFzpb
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Plocust.fzpb Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlocustFzpb()
{
	int iRetStatus = VIRUS_NOT_FOUND;


	if(m_wNoOfSections != 0x6 && m_dwAEPMapped !=0x042C &&m_pSectionHeader[0].SizeOfRawData != 0x77E00)
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PLOCUST_BUFF_SIZE = 0x5B;
	m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];

	if(GetBuffer(0x76CD9, PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
	{
		TCHAR PLOCUST_CZ_Sig[] = {_T("32C08A0508C0470032D83006A134C04700*8A1508C04700001033C0A05CBE47008A8054BE4700A260BE4700*C60523904700D48B3598904700C60506914700BEC7051F90470080630100FF3534C0470056585901C883C802EB02")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(PLOCUST_CZ_Sig, _T("Downloader.Plocust.fzpb"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPlocustGlbw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Plocust.Glbw Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlocustGlbw()
{
	int iRetStatus = VIRUS_NOT_FOUND;


	if(m_wNoOfSections != 0x6 && m_dwAEPMapped !=0x042C &&m_pSectionHeader[0].SizeOfRawData != 0x78600)
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PLOCUST_BUFF_SIZE = 0x35;
	m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];

	if(GetBuffer(0x77247, PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
	{
		TCHAR PLOCUST_CZ_Sig[] = {_T("32C08A0508E0470032D83006A134E047008A1508E047000010*33C0A000D147008A80F8D04700A204D14700890DCBA04700")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(PLOCUST_CZ_Sig, _T("Downloader.Plocust.glbw"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPlocustGmby
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Plocust.Gmby Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPlocustGmby()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x6 && m_dwAEPMapped !=0x042C &&m_pSectionHeader[0].SizeOfRawData != 0x78400)
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PLOCUST_BUFF_SIZE = 0x50;
	m_pbyBuff = new BYTE[PLOCUST_BUFF_SIZE];

	if(GetBuffer(0x77088, PLOCUST_BUFF_SIZE, PLOCUST_BUFF_SIZE))
	{
		TCHAR PLOCUST_CZ_Sig[] = {_T("32C08A0508E0470032D83006A134E047008A1508E04700001033C0*A054D247008A804CD24700A258D247002915C8A0470081C39E000000890D75A04700*FF3534E0470056585901C883C802EB02")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(PLOCUST_CZ_Sig, _T("Downloader.Plocust.gmby"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], PLOCUST_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}   

/*-------------------------------------------------------------------------------------
	Function		: DetectDriverUpd
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of DriverUpd Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDriverUpd()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}
	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0xB6610 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18E000)
	{
		const int DRIVERUPD_BUFF_SIZE = 0x80;
		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(GetBuffer(0x1094BC, DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			TCHAR DRIVERUPDALGB_CZ_Sig[] = {_T("766D6D6F7573652E737973*766D686766732E737973*56426F784D6F7573652E737973*4D414C5741524500564952555300000053414E44424F58")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DRIVERUPDALGB_CZ_Sig, _T("Downloader.DriverUpd.algb"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],DRIVERUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x4 && m_dwAEPMapped ==0xB6BB0 &&m_pSectionHeader[0].SizeOfRawData == 0x18B000)
	{
		const int DUPD_BUFF_SIZE = 0x90;
		m_pbyBuff = new BYTE[DUPD_BUFF_SIZE];

		if(GetBuffer(0x109AB0, DUPD_BUFF_SIZE, DUPD_BUFF_SIZE))
		{
			TCHAR DUPD_CZ_Sig[] = {_T("53454C454354202A2046524F4D2057696E33325F42494F5320574845524520*4C494B452027255669727475616C426F78252729*4C494B45202725564D7761726525")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DUPD_CZ_Sig, _T("Downloader.DriverUpd.alkm"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x12B06 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B200)
	{
		const int DRIVERUPD_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(GetBuffer(0x39480, DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			TCHAR DRIVERUPDIWR_CZ_Sig[] = {_T("530045004C0045004300540020002A00200046*52004F004D002000570069006E00330032005F00420049004F0053*2500580045004E0025*2500560042004F00580025")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DRIVERUPDIWR_CZ_Sig, _T("Downloader.driverupd.iwr"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],DRIVERUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0xAB650 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xFA000)
	{
		const int DRIVERUPD_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(GetBuffer(0xFCE48, DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			TCHAR DRIVERUPDIALKM_CZ_Sig[] = {_T("53454C454354202A2046524F4D2057696E33325F42494F53*2558454E25*2556424F5825*25626F63687325")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DRIVERUPDIALKM_CZ_Sig, _T("Downloader.DriverUpd.wkn"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],DRIVERUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x041A &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1DF504)
	{
		const int DRIVERUPD_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(GetBuffer(0x1381FD, DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			TCHAR DRIVERUPDWUI_CZ_Sig[] = {_T("53454C454354202A2046524F4D2057696E33325F42494F53*2558454E25*2556424F5825*25626F63687325")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DRIVERUPDWUI_CZ_Sig, _T("Downloader.DriverUpd.wui"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],DRIVERUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x041A &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1DC463)
	{
		const int DRIVERUPD_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[DRIVERUPD_BUFF_SIZE];

		if(GetBuffer(0x1361E9, DRIVERUPD_BUFF_SIZE,DRIVERUPD_BUFF_SIZE))
		{
			TCHAR DRIVERUPDWXU_CZ_Sig[] = {_T("53454C454354202A2046524F4D2057696E33325F42494F53*2558454E25*2556424F582527*25626F63687325")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DRIVERUPDWXU_CZ_Sig, _T("Downloader.DriverUpd.wxu"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],DRIVERUPD_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorZepfod
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Backdoor.Zepfod Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorZepfod()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	
	if( m_wNoOfSections == 0x04 && m_dwAEPUnmapped == 0x58C2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000)
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int ZEPFOD_BUFF_SIZE = 0x80;
		m_pbyBuff = new BYTE[ZEPFOD_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
	
		if(!GetBuffer(0x4450, ZEPFOD_BUFF_SIZE, ZEPFOD_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn	polydbobj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		LPCTSTR			szZEPFOD = (_T("8B4DE483C101894DE48B55E43B550C0F83A0010000*8B45080345E48A08884DEB*0FBE55140FBE45EB2BC28845EB"));
		polydbobj.LoadSigDBEx(szZEPFOD, _T("Backdoor.Zepfod.aco"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0],ZEPFOD_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormSohanad
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of Worm.Sohanad Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormSohanad()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05) && (m_dwAEPUnmapped == 0x53E3D || m_dwAEPUnmapped == 0x16310) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x65200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x65400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x80200))//added
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int SOHANAD_BUFF_SIZE = 0x300;
		m_pbyBuff = new BYTE[SOHANAD_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwStartBuff; //added start
        
		if(m_dwAEPUnmapped == 0x16310 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x80200)
		{
		    dwStartBuff = 0x82CD8;
		}
		else
		{
		    dwStartBuff = 0x6A390;
		} // end


		if(!GetBuffer(dwStartBuff, SOHANAD_BUFF_SIZE, SOHANAD_BUFF_SIZE))
		{
			return iRetStatus;
		}

		
		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szSOHANAD = (_T("54686973206973206120636F6D70696C6564*4175746F4974207363726970*6175746F69747363726970742E636F6D"));
		polydbobj.LoadSigDBEx(szSOHANAD, _T("Worm.Sohanad.pw"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0],SOHANAD_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
		

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Scar.Oich Family
					  *>mamammmamamam@yahoo.com
					  *>lecture notes.exe
					  *>essay.exe
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarOich()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_wNoOfSections >= 0x04 && m_wNoOfSections <= 0x06) && (m_dwAEPUnmapped == 0xEC8D5 || m_dwAEPUnmapped == 0xEBCD5) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10EE00)//added
	{
		if(m_pbyBuff)
		{
			delete[] m_pbyBuff;
			m_pbyBuff = NULL;	
		}

		const int SCAR_BUFF_SIZE = 0x60;
		m_pbyBuff = new BYTE[SCAR_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer(0x1626E0, SCAR_BUFF_SIZE, SCAR_BUFF_SIZE))
		{
			return iRetStatus;
		}

		CSemiPolyDBScn polydbobj;
		TCHAR szVirusName[MAX_PATH] = {0};
		LPCTSTR szSCAR = (_T("6D616D616D6D6D616D616D616D407961686F6F2E636F6D*6C656374757265206E6F7465732E657865*65737361792E657865"));
		polydbobj.LoadSigDBEx(szSCAR, _T("Trojan.Scar.OICH"), FALSE);	

		if(polydbobj.ScanBuffer(&m_pbyBuff[0x0],SCAR_BUFF_SIZE, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPliteBhst
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Plite.BHST Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPliteBhst()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x5 || m_wNoOfSections == 0x7) && (m_dwAEPUnmapped ==0xC9E9 || m_dwAEPUnmapped ==0x159EA || m_dwAEPUnmapped ==0x16520)
		&& (m_pSectionHeader[0].SizeOfRawData == 0x3AC00 || m_pSectionHeader[0].SizeOfRawData == 0x28000 || m_pSectionHeader[0].SizeOfRawData == 0x7C000 || m_pSectionHeader[0].SizeOfRawData == 0x27C00))// Added
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	Plite_BUFF_SIZE = 0x1F4;//ADDED
		m_pbyBuff = new BYTE[Plite_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus; 
		}

		DWORD dwStartBuff  = 0x0;

		if(m_wNoOfSections == 0x3 && m_dwAEPUnmapped ==0xC9E9)  
		{
			dwStartBuff = 0x1DC44;
		}
		else if(m_wNoOfSections == 0x5 && m_dwAEPUnmapped ==0x159EA) 
		{
			dwStartBuff = 0x2BC0C;
		}
		else if(m_wNoOfSections == 0x5 && m_dwAEPUnmapped ==0x16520) // added
		{
			dwStartBuff = 0x2B790;
		}
		else 
		{
			dwStartBuff = 0x2C80C;

		}
		if(GetBuffer(dwStartBuff, Plite_BUFF_SIZE, Plite_BUFF_SIZE))
		{
			TCHAR			Plite_CZ_Sig[] = {_T("4800470044007200610077002E0064006C006C0000*3133332E3234322E3132392E313535")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(Plite_CZ_Sig, _T("Backdoor.Plite.BHST"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], Plite_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWecodAll
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of WecodAll Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWecodAll()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x7 && m_dwAEPUnmapped !=0x1210A &&m_pMaxPEFile->m_stPEHeader.CheckSum != 0x42441 && m_pSectionHeader[0].SizeOfRawData != 0x21000)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int Wecod_BUFF_SIZE = 0xC0;
	m_pbyBuff = new BYTE[Wecod_BUFF_SIZE];

	if(GetBuffer(0x26100, Wecod_BUFF_SIZE, Wecod_BUFF_SIZE))
	{
		TCHAR Wecod_CZ_Sig[] = {_T("5C004800470044007200610077002E0064006C006C0000*67006F006C00660069006E0066006F002E0069006E00690000")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(Wecod_CZ_Sig, _T("Trojan.win32.Wecod.all"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], Wecod_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Zepfod Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectZepfodYY()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


	if(m_wNoOfSections != 0x4 && m_dwAEPUnmapped !=0x5B42 && m_pSectionHeader[0].SizeOfRawData != 0x9000)
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int Backdoor_BUFF_SIZE = 0x3A;
	m_pbyBuff = new BYTE[Backdoor_BUFF_SIZE];

	if(GetBuffer(0x4667, Backdoor_BUFF_SIZE, Backdoor_BUFF_SIZE))
	{
		TCHAR Backdoor_CZ_Sig[] = {_T("8B45080345E48A08884DEB*B06FB0FFB0F5B0F5B038B070B06FB049B0C0B0*89B047B072B070B04EB0C0B086B04AB072B071B0B7B002")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(Backdoor_CZ_Sig, _T("Backdoor.Zepfod.yy"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], Backdoor_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatreDmid
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Upatre.Dmid Family
						*>this file  allocates memory by "virtual alloc function"
						*>then decryption of loop is start and stored decrypted byte at allocated memory.
						*>it creates one file in the temp folder "biwagox.exe" 
						*>this file is exact copy of a original file.				
						*>this file connect to the IP Adresses 173.243.240.79 and every time it changes 
								*>it always try to connect again again
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatreDmid()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x01A7E && m_pSectionHeader[1].Misc.VirtualSize == 0x1F6A && m_dwAEPMapped == m_dwAEPUnmapped)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int UPATRE_BUFF_SIZE = 0x55;
		m_pbyBuff = new BYTE[UPATRE_BUFF_SIZE];

		if(GetBuffer(0x1451, UPATRE_BUFF_SIZE,UPATRE_BUFF_SIZE))
		{
			TCHAR UPATRE_CZ_Sig[] = {_T("817DF0001200000F8D830000008B55B083C2018955B08B459883C007*B91F0000002B4DF08B55902BD18855D88B459883C001")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(UPATRE_CZ_Sig, _T("Downloader.Upatre.dmid"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], UPATRE_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatre
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Upatre Family
					  Downloader.upatre.frgb
					  Downloader.Upatre.dmid
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatre()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


	if(m_wNoOfSections == 0x4 && m_dwAEPUnmapped == 0x3008 && m_pSectionHeader[0].SizeOfRawData == 0x6E00 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x1C3F7)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int Downloader_BUFF_SIZE = 0x19;
		m_pbyBuff = new BYTE[Downloader_BUFF_SIZE];

		if(GetBuffer(0xB534, Downloader_BUFF_SIZE, Downloader_BUFF_SIZE))
		{
			TCHAR Downloader_CZ_Sig[] = {_T("526F777374657200*4D6174676F6261636B")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(Downloader_CZ_Sig, _T("Downloader.Upatre.frgb"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], Downloader_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	else if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x01A7E && m_pSectionHeader[1].Misc.VirtualSize == 0x1F6A && m_dwAEPMapped == m_dwAEPUnmapped)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int UPATRE_BUFF_SIZE = 0x55;
		m_pbyBuff = new BYTE[UPATRE_BUFF_SIZE];

		if(GetBuffer(0x1451, UPATRE_BUFF_SIZE,UPATRE_BUFF_SIZE))
		{
			TCHAR UPATRE_CZ_Sig[] = {_T("817DF0001200000F8D830000008B55B083C2018955B08B459883C007*B91F0000002B4DF08B55902BD18855D88B459883C001")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(UPATRE_CZ_Sig, _T("Downloader.Upatre.dmid"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], UPATRE_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSmallCpl
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Small.Cpl Family
					  *>it creates one file in the temp folder "ghsdtd.exe" 
					  *>this file is exact copy of a original file.				
					  *>this file connect to the websites gerrybroadbent.com and download developing/23 mrn.exe
								*>itsend request to Http server.
								*>it always try to connect again again
								*>it creates one file "fdgisjjd.exe" 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmallCpl()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x1928 && m_pSectionHeader[1].Misc.VirtualSize == 0x0BBA && m_dwAEPUnmapped == 0x2528)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int SMALL_BUFF_SIZE = 0x46;
		m_pbyBuff = new BYTE[SMALL_BUFF_SIZE];

		if(GetBuffer(0x1469, SMALL_BUFF_SIZE,SMALL_BUFF_SIZE))
		{
			TCHAR SMALL_CZ_Sig[] = {_T("BAE4414000890A897A045A8A078A2602250F41400032C4*8BFE6A3C68E44140006811010000FF353C414000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SMALL_CZ_Sig, _T("Downloader.Small.cpl"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], SMALL_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectArdurkG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Ardur.kG Family
						>it is internet worm, it is a software that attacks machine usually from e mail
						>this file creates its own copy in system32 i.e 1(1).exe
						>it get the handle of service control manager database using "open sc manager" function
						>after it creates the service and start the service automatically
						>it open the registery software\microsoft\internet account manager\accounts
						>it searches the .htm file in c drive
						>it searches the "mailto"in .htm file
						>it get the .htm file,first read it then create .exe by changing extention and add some data in it
						>it create the registery HKCR\CLSID\{2D4C7E97-8CA7-4B94} and set the value by NAMESD
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectArdurkG()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


	if(m_wNoOfSections != 0x2 && m_dwAEPUnmapped !=0x3FB8 && m_pSectionHeader[0].SizeOfRawData != 0x3200 && m_pMaxPEFile->m_dwFileSize != 0x3400)
		return iRetStatus;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int WORM_BUFF_SIZE = 0x40;
	m_pbyBuff = new BYTE[ WORM_BUFF_SIZE];

	DWORD dwDecryptionKey=0;

	if(m_pMaxPEFile->ReadBuffer(&dwDecryptionKey,m_dwAEPMapped-4, 0x4, 0x4))
	{

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x640,  WORM_BUFF_SIZE,  WORM_BUFF_SIZE))
		{   
			for(int i=0; i<0x40; i+=4)
				*(DWORD *)&m_pbyBuff[i] ^= dwDecryptionKey;

			TCHAR  WORM_CZ_Sig[] = {_T("4E657874506172745F253033645F253034585F2530382E386C582E25*30382E386C58004E616D6573640066666666685F315F375F38")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx( WORM_CZ_Sig, _T("WORM.Ardurk.g"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], WORM_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatreSby
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Upatre.Sby Family
						>this file drop exact same copy "youcanhelp.exe" in temp folder and create process
						>and also added "your_468D.txt" in temp folder
						>this file connect to the "icanhazip.com" and also coonect to the IP 91.211.17.201 didan.com and 24.240.107.12
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatreSby()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x03 && (m_dwAEPMapped >= 0x17B0 || m_dwAEPMapped <= 0x1BC0) && (m_pSectionHeader[0].SizeOfRawData >= 0x2A00) ||(m_pSectionHeader[0].SizeOfRawData <= 0X2E00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;

		}
		const int UPATRE_BUFF_SIZE = 0x860;
		m_pbyBuff = new BYTE[UPATRE_BUFF_SIZE];

		if(GetBuffer(0x1000, UPATRE_BUFF_SIZE, UPATRE_BUFF_SIZE))
		{
			TCHAR UPATRE_CZ_Sig[] = {_T("508BD08BD9AC8A0F32C84A7506*582BF0508BD08BC1AA8BCBE2E9")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(UPATRE_CZ_Sig, _T("Downloader.Upatre.sby"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], UPATRE_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectJSMultiplugP
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Multiplug.P Family
						 >this file creates one folder in temp i.e 7zS359.tmp 
						 >and in that it create one folder, in that it drops 3 jscript file, one .html file and one .json file
						 >also it drops one .exe and one .dat file and create process
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectJSMultiplugP()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x13F04  && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x255BB && m_pSectionHeader[0].SizeOfRawData == 0x19A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;

		}
		const int MULTIPLUG_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[MULTIPLUG_BUFF_SIZE];

		if(GetBuffer(0x12000, MULTIPLUG_BUFF_SIZE, MULTIPLUG_BUFF_SIZE))
		{
			TCHAR MULTIPLUG_CZ_Sig[] = {_T("81E12083B8EDD1E833C8890C95C03642004281FA000100000F825EFFFFFF*81E1FF000000C1E80833048DC0364200*42890495BC36420081FA0008000072D7")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(MULTIPLUG_CZ_Sig, _T("Adware.JS.MultiPlug.P"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], MULTIPLUG_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectInjectUezn
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Inject.Uezn Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInjectUezn() 
{

	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wNoOfSections != 0x4 && m_dwAEPMapped !=0x9276 && m_pSectionHeader[0].SizeOfRawData != 0x1AC00)
		return iRetStatus;

	if (m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff= NULL;
	}

	const int INJECT_BUFF_SIZE= 0X456;
	m_pbyBuff= new BYTE[INJECT_BUFF_SIZE];

	if(GetBuffer(0x1D808, INJECT_BUFF_SIZE, INJECT_BUFF_SIZE))
	{
		TCHAR INJECT_CZ_Sig[] = {_T("6D796170702E657865*73626965646C6C2E646C6C")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(INJECT_CZ_Sig, _T("Trojan Inject.uezn"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], INJECT_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRootkitegxj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Rootkit.EGXJ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRootkitegxj()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wNoOfSections == 0x5 && ((m_dwAEPMapped & 0x00FF) == (m_dwAEPUnmapped & 0x000FF)) && m_wAEPSec == 0x0 && 
		m_pMaxPEFile->m_stSectionHeader[0x2].SizeOfRawData == 0x3600)
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int ROOTKIT_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[ROOTKIT_BUFF_SIZE];

		if(GetBuffer(m_pMaxPEFile->m_stSectionHeader[0x1].PointerToRawData + 0x1500, ROOTKIT_BUFF_SIZE, ROOTKIT_BUFF_SIZE))
		{
			TCHAR Rootkit_Sig[] = {_T("687474703A2F2F6C6F672E736F6F6D656E672E636F6D2F77622F6A6471*73766368736F742E657865006D61696E70726F2E657865")};
			//http://log.soomeng.com/wb/jdq*svchsot.exe.mainpro.exe

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(Rootkit_Sig, _T("Rootkit.Agent.egxj"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], ROOTKIT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanAcqad
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Trojan.Acqad Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanAcqad()
{
	int iRetStatus =0;

	if(((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL) && m_wNoOfSections == 0xA && 
		m_wAEPSec == 0x8 && m_dwAEPMapped == 0x43AE9 && ((m_dwAEPMapped & 0xF00FF) == (m_dwAEPUnmapped & 0xF00FF)) && m_pMaxPEFile->m_stSectionHeader[0x6].SizeOfRawData == 0xE00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	AGENT_BUFF_SIZE = 0x200;
		DWORD		dwReadOffset = 0x0;

		m_pbyBuff = new BYTE[AGENT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwExportTableOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].VirtualAddress;
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwExportTableOff, &dwExportTableOff))
		{
			return iRetStatus;
		}
		DWORD dwDllNameOff=0x0;
		BYTE SigAGENT[] = { 0x42, 0x4C, 0x53, 0x6B, 0x79, 0x44, 0x6C, 0x6C, 0x2E, 0x64, 0x6C, 0x6C};//BLSkyDll.dll
		TCHAR szVirusName[MAX_PATH] = {0};
		if(!m_pMaxPEFile->ReadBuffer(&dwDllNameOff, dwExportTableOff + 0xC, 0x04, 0x04))
		{
			return iRetStatus;
		}
		if(OUT_OF_FILE == m_pMaxPEFile->Rva2FileOffset(dwDllNameOff, &dwDllNameOff))
		{
			return iRetStatus;
		}
		if(GetBuffer(dwDllNameOff,sizeof(SigAGENT),sizeof(SigAGENT)))
		{
			if(memcmp(&m_pbyBuff[0x0],SigAGENT,sizeof(SigAGENT)) == 0 )
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.acqad"));
				return VIRUS_FILE_DELETE;
			}
		}

	}
	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0 && m_dwAEPMapped == 0x14AEB && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x35FD0 
		&& m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x12C && m_pMaxPEFile->m_stSectionHeader[1].SizeOfRawData == 0xB400)
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int AGENT_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[AGENT_BUFF_SIZE];

		if(GetBuffer(m_pMaxPEFile->m_stSectionHeader[0x1].PointerToRawData + 0x8780, AGENT_BUFF_SIZE, AGENT_BUFF_SIZE))
		{
			TCHAR Agent_Sig[] = {_T("687474703A2F2F313131312E69703133382E636F6D2F69632E617370*333630B0B2C8ABCCD7D7B0002F73656C656374")};
			//http://1111.ip138.com/ic.asp*360........./select
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(Agent_Sig, _T("Adware.Agent.hpas"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSoftplusXsw
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Santosh Awale + Virus Analysis Team
	Description		: Detection routine for different varients of softplus Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSoftplusXsw()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0xF4E6 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x27800)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int SOFTPLUS_BUFF_SIZE = 0xC0;
		m_pbyBuff = new BYTE[SOFTPLUS_BUFF_SIZE];

		if(GetBuffer(0x32E80, SOFTPLUS_BUFF_SIZE,SOFTPLUS_BUFF_SIZE))
		{
			TCHAR SOFTPLSXSW_CZ_Sig[] = {_T("530045004C0045004300540020002A002000460052004F004D*570069006E00330032005F00420049004F0053*4C0049004B004500200027002500580045004E0025*2500560042004F0058002500")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SOFTPLSXSW_CZ_Sig, _T("Adware.softplus.xsw"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],SOFTPLUS_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownBVTD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.BVTD Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownBVTD()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x4 && m_dwAEPMapped != 0x8B902 && m_pSectionHeader[0].SizeOfRawData !=0xAB000)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int BVTD_BUFF_SIZE = 0x2A;
	m_pbyBuff = new BYTE[BVTD_BUFF_SIZE];

	if (m_pMaxPEFile->m_dwFileSize < (0xB2E6C + BVTD_BUFF_SIZE))
	{
		return iRetStatus;
	}

	if(GetBuffer(0xB2E6C, BVTD_BUFF_SIZE, BVTD_BUFF_SIZE))
	{
		TCHAR BVTD_CZ_Sig[] = {_T("486561646C69676874*4765745269676874546F476F")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(BVTD_CZ_Sig, _T("Trojan.Downloader.Agent.BVTD"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], BVTD_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

//Tushar ==> Commented below code as it is covered in Signature DB
/******************************************************************************************************************
Analyst      : Swapnil Sanghai
Type:        : Trojan
Name         : Downloader.Agent.hfdg
******************************************************************************************************************	
Signature    :
		  1> Decryption Loop
********************************************************************************************************************/
//int CSemiPolyTrojans::DetectDownHFDG()
//{
//	int iRetStatus = VIRUS_NOT_FOUND;
//
//	if(m_wNoOfSections != 0x4 && m_dwAEPMapped !=0x0400 &&m_pSectionHeader[0].SizeOfRawData !=0x1600)
//		return iRetStatus;
//
//	if(m_pbyBuff)
//	{
//		delete []m_pbyBuff;
//		m_pbyBuff = NULL;
//	}
//
//	const int HFDG_BUFF_SIZE = 0x5D;
//	m_pbyBuff = new BYTE[HFDG_BUFF_SIZE];
//
//	if(GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x963, HFDG_BUFF_SIZE, HFDG_BUFF_SIZE))
//	{
//		TCHAR HFDG_CZ_Sig[] = {_T("81581D4D7B82AFA715A461FE048ADA3F283BE0CC5E0839A9*8834519D4D6F2E91B5E5C95A259769C85821")};
//
//		CSemiPolyDBScn polydbObj;
//		polydbObj.LoadSigDBEx(HFDG_CZ_Sig, _T("Trojan.Downloader.Agent.hfdg"), FALSE);
//
//		TCHAR szVirusName[MAX_PATH] = {0};
//
//		if(polydbObj.ScanBuffer(&m_pbyBuff[0], HFDG_BUFF_SIZE , szVirusName)>=0)	
//		{
//			if(_tcslen(szVirusName) > 0)
//			{
//				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
//				return VIRUS_FILE_DELETE;
//			}
//		}
//	}
//	return iRetStatus;
//}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormBloored
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Worm.Bloored Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormBloored()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x5 && m_dwAEPMapped !=0x0620 &&m_pSectionHeader[0].SizeOfRawData !=0x3B800)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int Bloored_BUFF_SIZE = 0x39;
	m_pbyBuff = new BYTE[Bloored_BUFF_SIZE];

	if(GetBuffer(0x1CA3, Bloored_BUFF_SIZE, Bloored_BUFF_SIZE))
	{
		TCHAR Bloored_CZ_Sig[] = {_T("426C6F6F64726564*7E796F757E7E7E786F786F*4472446574726F6974*5B426C6F6F647265642E425D")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(Bloored_CZ_Sig, _T("Worm.Bloored.d"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], Bloored_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.B Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentB()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x5 && m_dwAEPMapped !=0x05E8 &&m_pSectionHeader[0].SizeOfRawData !=0x0A00)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int AGENTB_BUFF_SIZE = 0x2E;
	m_pbyBuff = new BYTE[AGENTB_BUFF_SIZE];

	if(GetBuffer(0x55B, AGENTB_BUFF_SIZE, AGENTB_BUFF_SIZE))
	{
		TCHAR AGENTB_CZ_Sig[] = {_T("8954241C33FF47EB188B4C24188B5424*1C8A0188024241894C241833FF895424*1C85DB0F84AFFEFFFF2B5424145F")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(AGENTB_CZ_Sig, _T("Trojan.Agentb.btuc"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], AGENTB_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatreBkvd
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Upatre.bkvd Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatreBkvd()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wNoOfSections != 0x3 && m_dwAEPMapped !=0x1930 && m_pSectionHeader[0].SizeOfRawData != 0x6600 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x18d21)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int UPATRE_BUFF_SIZE =0x64;
	m_pbyBuff = new BYTE[UPATRE_BUFF_SIZE];

	if(GetBuffer(0x2BF0,  UPATRE_BUFF_SIZE,  UPATRE_BUFF_SIZE))
	{   
		TCHAR  UPATRE_CZ_Sig[] = {_T("514AAD8B0F4E33C84E880F*4E85D27507FF75108B55145E4759E2E5")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(UPATRE_CZ_Sig, _T("Downloader.Upatre.bkvd"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], UPATRE_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdLoadGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of AdLoadGen Family
					  Adware.AdLoad.Gen :  .xpbq,.xqeg,.xryx
					  Adware.AdLoad.Gen1:  .xdfs,.xdgk,.xdin,.xdir
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdLoadGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if((m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5) && ((m_dwAEPMapped & 0xFF0F) == 0x1300 || (m_dwAEPMapped == 0x156F)|| (m_dwAEPMapped == 0x1631)) && (m_pSectionHeader[0].SizeOfRawData >= 0x7000 && m_pSectionHeader[0].SizeOfRawData <= 0xE000))
	{
		if(m_wAEPSec != 0)
			return iRetStatus;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int ADLOAD_BUFF_SIZE= 0x190;
		m_pbyBuff= new BYTE[ADLOAD_BUFF_SIZE];

		DWORD dwStartBuffAddre = 0x00;
		if(m_wNoOfSections == 0x4)
		{
			dwStartBuffAddre = 0x12AE;
		}

		else if(m_wNoOfSections == 0x5)
		{
			dwStartBuffAddre = 0x11B7;
		}

		if(GetBuffer(dwStartBuffAddre, ADLOAD_BUFF_SIZE, ADLOAD_BUFF_SIZE))
		{
			TCHAR ADLOAD_CZ_Sig[] = {_T("6A006A03*558BEC83EC1C*81E2FF00000081C2AE000000")}; 
			TCHAR ADLOAD_CZ_Sig1[] = {_T("B903000000E8EA0000006A006A00*558BEC83EC20*81E2FF00000081C2D6000000")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(ADLOAD_CZ_Sig, _T("Adware.AdLoad.Gen"), FALSE);
			polydbObj.LoadSigDBEx(ADLOAD_CZ_Sig1, _T("Adware.AdLoad.Gen1"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], ADLOAD_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		} 
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectShizEuxx
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Shiz.euxx Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectShizEuxx()
{

	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wNoOfSections != 0x8 && m_dwAEPMapped !=0x29F2 && m_pSectionHeader[0].SizeOfRawData != 0x37800)
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int SHIZ_BUFF_SIZE= 0XFF;
	m_pbyBuff= new BYTE[SHIZ_BUFF_SIZE];

	if(GetBuffer(0x2601, SHIZ_BUFF_SIZE, SHIZ_BUFF_SIZE))
	{
		TCHAR SHIZ_CZ_Sig[] = {_T("83C601C0C1056A5F5F83EF40*C0C905BA478C3600C1C215*80C19833FFD1EF81FF35D03C00*80C56C33FFC1CF0F")};

		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(SHIZ_CZ_Sig, _T("Backdoor.Shiz.euxx"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0], SHIZ_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	} 
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Imali.C Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectImaliC()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x3 && m_pSectionHeader[0x00].SizeOfRawData == 0x00 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress == 0x00)
	{
		if (m_pMaxPEFile->m_dwFileSize <= 0x1000)
		{
			return iRetStatus; 
		}

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int IMALI_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[IMALI_BUFF_SIZE];

		DWORD	dwOffSet = m_pMaxPEFile->m_dwFileSize - 0x1000;

		if(GetBuffer(dwOffSet, IMALI_BUFF_SIZE,IMALI_BUFF_SIZE))
		{
			TCHAR pszImaliSig[] = {_T("494D414C4920E28093204E2E492E204D45444941204C544431*494D414C4920E28093204E2E492E204D45444941204C544431")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(pszImaliSig, _T("not-a-virus:Adware.Imali.C"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],IMALI_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}

	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of DownloAdmin.gen Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloadmin()
{
	int  iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if((m_wNoOfSections >= 0x4 && m_wNoOfSections <= 0x6) && ((m_dwAEPUnmapped > 0xC000) || (m_dwAEPMapped <0x4000) || (m_dwAEPMapped == 0x43D6)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		int BUFF_SIZE = 0x1000;
		DWORD dwReadOffset = 0x2000;
		if(m_dwAEPMapped <0x4000)
		{
			BUFF_SIZE = 0x2000;
		}
		if(m_dwAEPMapped < 0x4000)
		{
			if((m_dwAEPMapped == 0x15B6) || (m_dwAEPMapped == 0x38A6 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x9927C))
			{
				dwReadOffset = m_dwAEPMapped + 0x3500;
			}
			else if(m_dwAEPMapped >0x1000 && m_dwAEPMapped <0x2000)
			{
				if(m_dwAEPMapped == 0x19F5 || m_dwAEPMapped == 0x108B)
				{
					dwReadOffset = m_dwAEPMapped + 0x5000;
					BUFF_SIZE = 0x1000;
				}
				else
				{
					dwReadOffset = m_dwAEPMapped + 0x3000;
				}
			}
			else if(m_dwAEPMapped <0x1000)
			{
				dwReadOffset = m_dwAEPMapped + 0x6000;
			}
			else
			{
				dwReadOffset =  m_dwAEPMapped + 0x2500;
			}

		}
		if(m_dwAEPMapped == 0x43D6)
		{
			dwReadOffset = m_dwAEPMapped;
		}

		if((memcmp(m_pMaxPEFile->m_stSectionHeader[3].Name,".dta2",5) == 0) || (memcmp(m_pMaxPEFile->m_stSectionHeader[3].Name,".bindat",7) == 0)&&  ((m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress > 0x87000) || (m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress & 0xFFF00) == 0x45300 || (m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress) == 0x10DEC ))
		{
			BUFF_SIZE = 0x4000;
			dwReadOffset = 0x1000;
		}
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!GetBuffer(dwReadOffset, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		BYTE bySig[] = {0x33,0xC0,0x85,0xC9,0x76,0x0D}; //33 C0 85 C9 76
		CMaxBMAlgo *pBMScan = new CMaxBMAlgo;
		if(pBMScan == NULL)
		{
			return iRetStatus;
		}
		if(pBMScan->AddPatetrn2Search(bySig, sizeof(bySig)))
		{
			DWORD dwStartOffset = 0;
			if(pBMScan->Search4Pattern(m_pbyBuff, BUFF_SIZE,&dwStartOffset))
			{
				if(!dwStartOffset)
				{
					return iRetStatus;
				}
				t_disasm	da;

				BYTE bDecryptKey = 0;
				int iInstruction = 0;

				DWORD dwLength = 0;

				if(m_dwAEPMapped != 0x108B)
					dwStartOffset++;

				for(DWORD dwOffset = dwStartOffset; dwOffset < (BUFF_SIZE - MAX_INSTRUCTION_LEN);dwOffset +=dwLength)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);

					if(dwLength == 0x2 && strstr(da.result,"MOV DL") && iInstruction == 0)
					{
						bDecryptKey = da.immconst;
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x6 && strstr(da.result,"ADD") && iInstruction == 1)
					{
						DWORD temp = da.adrconst;
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x1 && strstr(da.result,"INC EAX") && iInstruction == 2)
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x2 && strstr(da.result,"CMP EAX,ECX") && iInstruction == 3)
					{
						iInstruction++;
						continue;
					}
					else if(dwLength == 0x2 && strstr(da.result,"JB SHORT ") && iInstruction == 4)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.DownloAdmin.gen"));
						return VIRUS_FILE_DELETE; 
					}
				}	
			}                     
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMorstarEWI
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Morstar Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMorstarEWI()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x5 && m_dwAEPMapped == 0xB5DC && m_pSectionHeader[0].SizeOfRawData == 0x18800 &&  
		m_pSectionHeader[1].SizeOfRawData == 0x8600 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1944
		|| m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1879B) //Changes
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int MOREWI_BUFF_SIZE = 0x3D87;

		m_pbyBuff = new BYTE[MOREWI_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x746A, MOREWI_BUFF_SIZE, MOREWI_BUFF_SIZE))

		{
			TCHAR MOREWI_CZ_Sig[] = {_T("2BEA885C24398B4424388904D1896CD1*3D000100000F92C0FEC82460*83C504896C2420*893903C589590403CE3B44241072F1*33E8D1E885C575F8*6A1468")};
			CSemiPolyDBScn polydbObj; 
			polydbObj.LoadSigDBEx(MOREWI_CZ_Sig, _T("Trojan.Morstar.EWI"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], MOREWI_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormNgrbotOu
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of WormNgrbot.Ou Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormNgrbotOu()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x04 && m_dwAEPMapped == 0xB14E  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xAE00 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xAD54)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int NGRBOT_BUFF_SIZE = 0x2000;
		m_pbyBuff = new BYTE[NGRBOT_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x8E90, NGRBOT_BUFF_SIZE, NGRBOT_BUFF_SIZE))
		{
			TCHAR NGRBOT_CZ_Sig[] = {_T("505A6542572E646C6C*47724355662E646C6C*446B49302E646C6C*4B55742E646C6C*767A63442E646C6C*476F642E657865*64006E00610073006A00730061006A00730061*433A5C55736572735C41646D696E6973747261746F725C446F63756D656E74735C56697375616C2053747564696F20323031305C*50726F6A656374735C476F645C476F645C6F626A5C7838365C52656C656173655C476F642E706462")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(NGRBOT_CZ_Sig, _T("Worm.Win32.Ngrbot.OU"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], NGRBOT_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectCabresA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Cabres Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCabresA()
{
	int iRetStatus = VIRUS_NOT_FOUND;


	if(m_wNoOfSections != 0x3 && m_dwAEPMapped !=0x585C && m_pSectionHeader[0].SizeOfRawData !=0x9A00)
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int CABRESA_BUFF_SIZE = 0x6000;

	m_pbyBuff = new BYTE[CABRESA_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x8, CABRESA_BUFF_SIZE, CABRESA_BUFF_SIZE))

	{
		TCHAR CABRESA_CZ_Sig[] = {_T("5745585452414354*52756E4F6E6365*646F63756D656E742E657865")};
		CSemiPolyDBScn polydbObj;
		polydbObj.LoadSigDBEx(CABRESA_CZ_Sig, _T("Virus.Win32.Cabres.A"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], CABRESA_BUFF_SIZE , szVirusName)>=0)	
		{

			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWebToolbarLinkury
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Linkury Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWebToolbarLinkury()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x3 && m_dwAEPMapped !=0x790E && m_pSectionHeader[0].SizeOfRawData !=0x7800)
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int WEBTLBRLNKY_BUFF_SIZE = 0x250;
	m_pbyBuff = new BYTE[WEBTLBRLNKY_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x5E5E, WEBTLBRLNKY_BUFF_SIZE, WEBTLBRLNKY_BUFF_SIZE))
	{
		TCHAR			WEBTLBRLNKY_CZ_Sig[] = {_T("68007400740070003A002F002F007300760063002D00730074006100740073002E*006C0069006E006B007500720079002E0063006F006D*68007400740070003A002F002F0067006F006C00640069006E0067002E00390031006200330062*006E006500740064006E0061002D00630064006E002E0063006F006D")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		
		polydbObj.LoadSigDBEx(WEBTLBRLNKY_CZ_Sig, _T("not-a-virus:WebToolbar.Win32.Linkury.AQX"), FALSE);
		
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], WEBTLBRLNKY_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwAgentJTVG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of AdwAgent.JTVG Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwAgentJTVG()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if (m_wNoOfSections == 0x5 && m_dwAEPMapped <= m_dwAEPUnmapped && m_wAEPSec == 0x0000 && m_pSectionHeader[4].Characteristics==0x42000040 &&
		m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x119000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 &&
		m_pSectionHeader[4].SizeOfRawData == 0x29400 || m_pSectionHeader[4].SizeOfRawData == 0xA400 )  //Changes
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int ADWJTVG_BUFF_SIZE = 0x37A7;

		m_pbyBuff = new BYTE[ADWJTVG_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x7959, ADWJTVG_BUFF_SIZE, ADWJTVG_BUFF_SIZE))

		{
			TCHAR ADWJTVG_CZ_Sig[] = {_T("8DA424000000008B45D88D4DC48A04103283*834604024333C083FB1E0F4DD8428955CC3B55D0")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(ADWJTVG_CZ_Sig, _T("not-a-virus:AdWare.Agent.JTVG"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], ADWJTVG_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownMorstarBFT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Morstar.BFT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownMorstarBFT()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05 && m_dwAEPMapped == 0xBFEC && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1B400 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x80CFB )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int MONBFT_BUFF_SIZE = 0x24;
		m_pbyBuff = new BYTE[MONBFT_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x2B1A, MONBFT_BUFF_SIZE, MONBFT_BUFF_SIZE))
		{
			TCHAR			MONBFT_CZ_Sig[] = {_T("8B4C24288B14818BC2C1E8080FB6C8D3*EF2BD90FB6CA84D275CB46C1EA108816")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(MONBFT_CZ_Sig, _T("Trojan.Downloader.Morstar.BFT"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], MONBFT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownLmnAEV
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of DownLmn.AEV Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownLmnAEV()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x6 && m_dwAEPMapped != 0x0478 &&m_pSectionHeader[0].SizeOfRawData != 0x76600)
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int LMNAEV_BUFF_SIZE = 0xBC;
	m_pbyBuff = new BYTE[LMNAEV_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x74BE4, LMNAEV_BUFF_SIZE, LMNAEV_BUFF_SIZE))
	{
		TCHAR			LMNAEV_CZ_Sig[] = {_T("8A1508B0470088D281FA21120C00*A134B047008A1508B047000010*A03CA947008A8034A94700A240A94700")};
		TCHAR			szVirusName[MAX_PATH] = {0};
		CSemiPolyDBScn	polydbObj;

		polydbObj.LoadSigDBEx(LMNAEV_CZ_Sig, _T("not-a-virus:Downloader.LMN.AEV"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], LMNAEV_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVbCUVT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Vb.CUVT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVbCUVT()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections != 0x3 && m_dwAEPMapped !=0x1298 &&m_pSectionHeader[0].SizeOfRawData !=0x7000 && !m_pMaxPEFile->m_bIsVBFile )
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int VBCUV_BUFF_SIZE = 0x30;
	m_pbyBuff = new BYTE[VBCUV_BUFF_SIZE];

	if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x403C, VBCUV_BUFF_SIZE, VBCUV_BUFF_SIZE))
	{
		TCHAR			VBCUV_CZ_Sig[] = {_T("1452400000F030*BC4F4000B44F4000A41240")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(VBCUV_CZ_Sig, _T("Trojan.VB.CUVT"), FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], VBCUV_BUFF_SIZE , szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCosmuAIGH
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Cosmu.AIGH Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCosmuAIGH()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000)
	{	
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int COSMU_BUFF_SIZE = 0x64;
		m_pbyBuff = new BYTE[COSMU_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xEA8, COSMU_BUFF_SIZE, COSMU_BUFF_SIZE))
		{
			TCHAR			COSMU_CZ_Sig[] = {_T("BC20400000F830*281E4000181E40004C1440*4E657720466F6C64657220283229")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(COSMU_CZ_Sig, _T("Trojan.Cosmu.aigh"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], COSMU_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScarOetk
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Scar Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarOetk()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x2 || m_wNoOfSections == 0x3) && m_dwAEPUnmapped == 0x1000 && 
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".text", 5) == 0)||
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".MPRESS1", 8) == 0)||
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".MPRESS", 7) == 0)||
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int SCAR_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[SCAR_BUFF_SIZE];

		DWORD dwStrtBuff = 0x00;
		if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x40200) 
		{
			dwStrtBuff = 0x42226;
		}
		else if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8D000)
		{
			dwStrtBuff = 0x44226;
		}
		else if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7C000)
		{
			dwStrtBuff = 0x43626;   
		}


		if(GetBuffer(dwStrtBuff, SCAR_BUFF_SIZE,SCAR_BUFF_SIZE))
		{
			TCHAR			SCAR_CZ_Sig[] = {_T("53797371656D*71706174682E696E69*53797371616D717176617171642E657865*53797371616D")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(SCAR_CZ_Sig, _T("Trojan.Scar.OETK"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],SCAR_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWebToolbarCossder
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Cossder Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWebToolbarCossder()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(0x4 == m_wNoOfSections && (0xC9B4 == m_dwAEPMapped ||  0xD7DB == m_dwAEPMapped) && ( 0x8C00 == m_pSectionHeader[0x1].SizeOfRawData || 0x4600 == m_pSectionHeader[0x1].SizeOfRawData))
	{
		DWORD	dwBuffSize = 0x100;
		DWORD	dwStart = 0x0;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		memset(m_pbyBuff, 0x00, dwBuffSize);

		if( 0xD7DB == m_dwAEPMapped)
		{
			dwStart = 0x29CC;
		}
		else
		{
			dwStart = 0x1960;
		}

		if(!GetBuffer( m_pSectionHeader[0x0].PointerToRawData+dwStart, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		TCHAR			szAgentahruw[] = {_T("5A310105B0006BB14A83C10435C0C0C0C085D2*5A310881C1B0006BB14A83C00481F1C0C0C0C085D277EA")};
		TCHAR			szAgentxhdj[] = {_T("310105B0006BB183C10435C0C0C0C04F75EE*58317D0081C7B0006BB181F7C0C0C0C08D6D044875EB")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(szAgentahruw,_T("WebToolbar.Cossder.dgz"),TRUE);
		polydbObj.LoadSigDBEx(szAgentxhdj,_T("WebToolbar.Cossder.xhdj"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],dwBuffSize,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}

	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorSena
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Senna.V Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBackdoorSena()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x1AD8 && m_dwAEPUnmapped == 0x1AD8 && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xFC000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000
		&& m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0xD000 && (memcmp(m_pSectionHeader[1].Name, "ENGINE", 6) == 0))
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BACKDOORSENA_BUFF_SIZE = 0x36;
		m_pbyBuff = new BYTE[BACKDOORSENA_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x2F326, BACKDOORSENA_BUFF_SIZE, BACKDOORSENA_BUFF_SIZE))
		{
			TCHAR			BACKDOORSENA_CZ_Sig[] = {_T("7B41444238383041362D443846462D313143462D3933*37372D3030414130303342374131317D")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(BACKDOORSENA_CZ_Sig, _T("Backdoor.Win32.Senna.V"), FALSE);
			
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BACKDOORSENA_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectInjectAfhey
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Inject.Afhey Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectInjectAfhey()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;

	if ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if( m_wNoOfSections == 0x05 && m_wAEPSec == 0x3 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x8000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7C00 
		&& m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0x1000 && m_pSectionHeader[m_wAEPSec + 1].PointerToRawData == 0x32A00 && m_pSectionHeader[m_wAEPSec + 1].Name[0] != '.'
		&& dwOverlayStart >=0x3FFF)
	{
		int iCnt = 0;
		while(m_pSectionHeader[m_wAEPSec + 1].Name[iCnt])
		{
			iCnt++;
		}
		if(!iCnt==7)
			return iRetStatus;
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int INJECTAFHEY_BUFF_SIZE = 0x200;
		m_pbyBuff = new BYTE[INJECTAFHEY_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer(0x32A00, INJECTAFHEY_BUFF_SIZE, INJECTAFHEY_BUFF_SIZE))//(m_pSectionHeader[0x0].PointerToRawData + 0xA016C
		{
			return iRetStatus;
		}	

		TCHAR Cust_Issue_Buff[0x200] = {0};
		if(memcmp(m_pbyBuff,Cust_Issue_Buff,0x200)==0)
		{

			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}

			const int INJECTA_BUFF_SIZE = 0x35;
			m_pbyBuff = new BYTE[INJECTA_BUFF_SIZE];

			if(!m_pbyBuff)
			{
				return iRetStatus;
			}

			if(GetBuffer(0x238, INJECTA_BUFF_SIZE, INJECTA_BUFF_SIZE))
			{
				TCHAR			INJECTA_CZ_Sig[] = {_T("007C0000*002A0300")};
				CSemiPolyDBScn	polydbObj;
				TCHAR			szVirusName[MAX_PATH] = {0};

				polydbObj.LoadSigDBEx(INJECTA_CZ_Sig, _T("Trojan.Inject.Afhey"), FALSE);
				if(polydbObj.ScanBuffer(&m_pbyBuff[0], INJECTA_BUFF_SIZE , szVirusName)>=0)	
				{
					if(_tcslen(szVirusName) > 0)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojGenB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Shanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Generic.BT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojGenB()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if( m_wNoOfSections == 0x04 && m_dwAEPUnmapped == 0x2BE9 || m_dwAEPUnmapped == 0x2B4E && 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4E00 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 && m_pSectionHeader[m_wAEPSec + 1].SizeOfRawData == 0x600 &&
		m_pSectionHeader[m_wAEPSec + 2].SizeOfRawData == 0x800)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int TROGENGENBT_BUFF_SIZE = 0x1FF;
		m_pbyBuff = new BYTE[TROGENGENBT_BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x3C90, TROGENGENBT_BUFF_SIZE, TROGENGENBT_BUFF_SIZE))
		{
			TCHAR			TROGENGENBT_CZ_Sig[] = {_T("7B41444238383041362D443846462D313143462D3933*37372D3030414130303342374131317D")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};
			
			polydbObj.LoadSigDBEx(TROGENGENBT_CZ_Sig, _T("Trojan.Win32.Generic.BT"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], TROGENGENBT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDLBoost
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of DLBoost Family
					  Adware.InstallMonster.jnsk ,Adware.DLBoost.arwp,Adware.DLBoost.arxa,Adware.DLBoost.aryf,Adware.DLBoost.anxe,Adware.DLBoost.uel
					  Adware.DLBoost.ajrf,Adware.DLBoost.arfo,Adware.DLBoost.arhj,Adware.DLBoost.arxu,Adware.DLBoost.arzn,Adware.DLBoost.arzr,
					  Adware.DLBoost.arzu,Adware.DLBoost.asaf,Adware.DLBoost.asal,Adware.DLBoost.asar,Adware.DLBoost.asay,Adware.DLBoost.asbc,
					  Adware.DLBoost.asbf,Adware.DLBoost.asbo,Adware.DLBoost.asbs,Adware.DLBoost.asbw,Adware.DLBoost.ascc,Adware.DLBoost.ascd,
					  Adware.DLBoost.asch,Adware.DLBoost.ascl,Adware.DLBoost.ascn,Adware.DLBoost.asco,Adware.DLBoost.ascs,Adware.DLBoost.ascx,
					  Adware.DLBoost.asdd,Adware.DLBoost.asdf,Adware.DLBoost.aser,Adware.agent.ths
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDLBoost()
{																																		
	int iRetStatus = VIRUS_NOT_FOUND;
	if((0x8 == m_wNoOfSections) && m_wAEPSec == 0x0 && (((m_dwAEPMapped>= 0x190000) && (m_dwAEPMapped  <= 0x1C0000)) || (m_dwAEPMapped & 0xFFF000)== 0x135000 || (m_dwAEPMapped & 0xFF0000)== 0x150000 ||  (m_dwAEPMapped & 0xFF0000)== 0x160000 || (m_dwAEPMapped & 0xFFF000)== 0x132000 ||
		(m_dwAEPMapped & 0xFF0000)== 0x210000 || (m_dwAEPMapped & 0xFF0000)== 0x330000 || (m_dwAEPMapped & 0xFF0000)== 0x240000 || (m_dwAEPMapped & 0xFF0000)== 0x230000) && (((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x1A0000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x1B0000) ||
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x210000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFFF000)==0x135000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x330000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x240000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x230000)
		|| ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x150000) ||  ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF0000)==0x160000) || ((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFFF000)==0x132000)))
	{
		DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
		if((m_pMaxPEFile->m_dwFileSize - dwOverlayStart) == 0x0)
			return iRetStatus;

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[BUFF_SIZE];
		DWORD dwReadOffset = 0x0;

		if((m_dwAEPMapped & 0xFF0000)== 0x210000)
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xA5000;
		}
		else if(((m_dwAEPMapped & 0xFF0000)== 0x240000) || ((m_dwAEPMapped & 0xFF0000)== 0x230000))
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9E900;
		}
		else if((m_dwAEPMapped & 0xFF0000)== 0x330000)
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xAA600;
		}
		else if((m_dwAEPMapped & 0xFFF000)== 0x135000)
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x99900;
		}
		else if((m_dwAEPMapped & 0xFFF000)== 0x132000)
		{
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x95C00;
		}
		else if((m_dwAEPMapped & 0xFF0000)== 0x150000)
		{
			if((m_dwAEPMapped & 0xFFF000)== 0x15C000)
				dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9B7C7;
			else
				dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x9F700;
		}
		else
			dwReadOffset = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xA0160;

		if(!GetBuffer(dwReadOffset, BUFF_SIZE, BUFF_SIZE))
		{
			return iRetStatus;
		}
		BYTE bySig[] = {0x68, 0x69, 0x73, 0x73, 0x2E, 0x61, 0x70, 0x70, 0x72, 0x69, 0x73, 0x65, 0x73, 0x2E, 0x72, 0x75}; //http://hiss.apprises.ru
		CMaxBMAlgo *pBMScan = new CMaxBMAlgo;
		if(pBMScan == NULL)
		{
			return iRetStatus;
		}
		if(pBMScan->AddPatetrn2Search(bySig, sizeof(bySig)))
		{
			if(pBMScan->Search4Pattern(m_pbyBuff, BUFF_SIZE))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.DLBoost.Gen"));
				iRetStatus = VIRUS_FILE_DELETE;
			}
		}

		return iRetStatus;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperTDSS
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of TDSS.AWEO Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperTDSS()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((0x6 == m_wNoOfSections) && (0x969 == m_dwAEPMapped) && (0x2800 == m_pSectionHeader[0x0].SizeOfRawData) &&
		0x10E0 == m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress && 0xA3 == m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		DWORD	dwBuffSize = 0xB0;
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer( m_pSectionHeader[0x3].PointerToRawData + 0x350, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		TCHAR			szDropperTDSS[] = {_T("433A5C79726F4B5C6E766D5565634B6376627275345C7378526B645345*4576656C796E2057617567682028313930339631393636292077617320616E20456E676C697368")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(szDropperTDSS,_T("Dropper.TDSS.AWEO"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],dwBuffSize,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRazy
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of razy.86735 Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRazy()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	/*if((0x6 == m_wNoOfSections) && (0x2DE3 == m_dwAEPMapped) && (0x7000 == m_pSectionHeader[0x0].SizeOfRawData))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		DWORD dwBuffSize = 0x100;
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(!GetBuffer( m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x63F0, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		TCHAR szRazy[] = {_T("6A088BC15E8BD080E2010FB6D2F7DA1BD281E22083B8EDD1E833C24E75E78904*8D301146004181F9000100007CD2*0FB611FF4D1033D081E2FF000000C1E8083304953011460041837D100077E1")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		polydbObj.LoadSigDBEx(szRazy,_T("Trojan.Razy.86735"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],dwBuffSize,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}*/

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(((0x7 == m_wNoOfSections) && ((0xB700 < m_dwAEPMapped) && (0x1E300 > m_dwAEPMapped))) ||( (m_wNoOfSections == 0x5) && (m_dwAEPMapped == 0x833A)) )
	{
		DWORD	ExportOffDir = 0x0;
		DWORD	dwExportOff = 0x0;
		DWORD	dwBytesRead=0;

		m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress,&ExportOffDir);
		if(ExportOffDir != 0 && ExportOffDir< m_pMaxPEFile->m_dwFileSize)
		{
			m_pMaxPEFile->ReadBuffer(&dwExportOff,ExportOffDir + 0xC,4,4,&dwBytesRead);
			if(!dwBytesRead)
			{
				return iRetStatus;
			}
			m_pMaxPEFile->Rva2FileOffset(dwExportOff,&ExportOffDir);
			if(ExportOffDir == 0 || ExportOffDir> m_pMaxPEFile->m_dwFileSize)
			{
				return iRetStatus;
			}

			if(m_pbyBuff)
			{
				delete []m_pbyBuff;
				m_pbyBuff = NULL;
			}
			const int BUFF_SIZE = 0x50;
			m_pbyBuff = new BYTE[BUFF_SIZE];
			
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			if(GetBuffer(ExportOffDir,BUFF_SIZE,0x30))
			{
				BYTE bySig[] = {0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x57,0x61,0x69,0x74,0x65,0x72,0x44,0x6C,0x6C,0x2E,0x64,0x6C,0x6C};
				BYTE bySig1[] = {0x49,0x6E,0x6A,0x65,0x63,0x74,0x6F,0x72,0x44,0x6C,0x6C,0x33,0x32,0x2E,0x64,0x6C,0x6C};
				BYTE bySig2[] = {0x43,0x4D,0x47,0x33,0x44,0x2E,0x64,0x6C,0x6C};
				BYTE bySig3[] = {0x7A,0x69,0x70,0x5F,0x70,0x6C,0x75,0x67,0x69,0x6E,0x2E,0x64,0x6C,0x6C};
				BYTE bySig4[] = {0x34,0x37,0x2E,0x30,0x2E,0x30,0x2E,0x64,0x6C,0x6C};//42.0.0.dll


				if(memcmp(m_pbyBuff,bySig,sizeof(bySig)) == 0 || 
					memcmp(m_pbyBuff,bySig1,sizeof(bySig1)) == 0 ||
					memcmp(m_pbyBuff,bySig2,sizeof(bySig2)) == 0 || 
					memcmp(m_pbyBuff,bySig3,sizeof(bySig3)) == 0 ||
					memcmp(m_pbyBuff,bySig4,sizeof(bySig4)) == 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Razy")); //Trojan.razy.57239  Trojan.razy.57465
					iRetStatus = VIRUS_FILE_DELETE;

				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFenomenGame
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Alisha Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of FenomenGame Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFenomenGame()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(((0x6 == m_wNoOfSections || 0x3 == m_wNoOfSections) && (0x29A14 == m_dwAEPMapped) && (0x38600 == m_pSectionHeader[0x0].SizeOfRawData || 0x150000 == m_pSectionHeader[0x0].SizeOfRawData)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		DWORD	dwBuffSize = 0x500;
		m_pbyBuff = new BYTE[dwBuffSize];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD	dwBuffStart = 0;

		if(0x3 == m_wNoOfSections)
		{
			dwBuffStart = m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x3C4E0;
		}
		else
		{
			dwBuffStart = m_pSectionHeader[m_wAEPSec +2].PointerToRawData + 0x14C0;
		}

		if(!GetBuffer( dwBuffStart, dwBuffSize, dwBuffSize))
		{
			return iRetStatus;
		}

		TCHAR			szFenomenGame[] = {_T("687474703A2F2F7777772E66656E6F6D656E2D67616D65732E636F6D*64686F6D652E68746D*46656E6F6D656E2047616D65732E6C6E6B")};
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};

		polydbObj.LoadSigDBEx(szFenomenGame,_T("WebToolbar.FenomenGame.MFR"),FALSE);
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],dwBuffSize,szVirusName) >= 0)
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentKDEA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.KDEA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentKDEA()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if((m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x14D530 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1AB400)||
		(m_wNoOfSections == 0x5 && (m_dwAEPMapped >= 0x140EB && m_dwAEPMapped <= 0x2FCEB) &&  (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x28C00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x49C00)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	AGENT_BUFF_SIZE = 0x96;

		m_pbyBuff = new BYTE[AGENT_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD	dwStratBuff = 0x00;

		if(m_dwAEPMapped == 0x14D530 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1AB400)
		{
			dwStratBuff = m_pSectionHeader[0x1].PointerToRawData + 0x3F890;
		}
		else
		{
			dwStratBuff = m_pSectionHeader[0x1].PointerToRawData + 0x9E68;
		}

		if(GetBuffer(dwStratBuff ,AGENT_BUFF_SIZE, AGENT_BUFF_SIZE))
		{
			TCHAR AGENT_CZ_Sig[] = {_T("68007400740070003A002F002F0064006C002E00330036003000*73006100660065002E0063006F006D00*2F00670066002F0033003600300069006E0069002E006300610062*33003600300069006E0069002E0063006100620000*33003600300069006E0069002E0064006C006C")};
			//h.t.t.p.:././.d.l...3.6.0.s.a.f.e...c.o.m.//.g.f./.3.6.0.i.n.i...c.a.b*3.6.0.i.n.i...c.a.b..*3.6.0.i.n.i...d.l.l

			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(AGENT_CZ_Sig, _T("not-a-virus:Adware.Agent.KDEA"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],AGENT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLinkuryBD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Linkury.BD Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLinkuryBD()
{
	int		iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x1B8E &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int LINKURY_BUFF_SIZE = 0x190;
		m_pbyBuff = new BYTE[LINKURY_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0xE4B, LINKURY_BUFF_SIZE, LINKURY_BUFF_SIZE))
		{
			TCHAR			LINKURY_CZ_Sig[] = {_T("586D6C53657269616C697A6174696F6E*577269746572426C61636B4C6973744D616E61676572*426C61636B4C6973744D616E6167657253657269616C697A6572*4C696E6B757279*2E5265736F75726365732E4368726F6D654E6577546162")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(LINKURY_CZ_Sig, _T("Adware.Linkury.BD"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],LINKURY_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMorstarAS
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Morstar.AS Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMorstarAS()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0x0 &m_wNoOfSections == 0x5 && (m_dwAEPMapped >= 0xD29C && m_dwAEPMapped <=0xD3FC) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x1C600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x1C800))
	{	
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int MORSTAR_BUFF_SIZE = 0x6E;
		m_pbyBuff = new BYTE[MORSTAR_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x53C ,  MORSTAR_BUFF_SIZE,  MORSTAR_BUFF_SIZE))
		{   
			TCHAR			MORSTAR_CZ_Sig[] = {_T("894424188B44241C8B008A0401884424133C3D*8A4424133C2B74043C2F*8D4704508BCEE8610100008D4705")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(MORSTAR_CZ_Sig, _T("not-a-virus:Downloader.Morstar.AS"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], MORSTAR_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectOutBrowseBU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of OutBrowse.BU Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectOutBrowseBU()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x24FA &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int OUTBROWSE_BUFF_SIZE = 0x64;
		m_pbyBuff = new BYTE[OUTBROWSE_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x4DA0, OUTBROWSE_BUFF_SIZE, OUTBROWSE_BUFF_SIZE))
		{
			TCHAR OUTBROWSE_CZ_Sig[] = {_T("6A088BC15E8BD080E201F6DA1BD281E22083B8ED*D1E833C24E75EA89048D70C542004181F900010000*81E6FF00000033F7C1E8088B34B570C54200")};

			CSemiPolyDBScn	polydbObj;
			polydbObj.LoadSigDBEx(OUTBROWSE_CZ_Sig, _T("Downloader.OutBrowse.BU"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],OUTBROWSE_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRootkitBSE
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Rootkit.BSE Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRootkitBSE()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0x4 &m_wNoOfSections == 0x6 && m_dwAEPMapped == 0x09EE && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x300)
	{	
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int	ROOTKIT_BUFF_SIZE = 0x2F;
		m_pbyBuff = new BYTE[ROOTKIT_BUFF_SIZE];

		BYTE		bDecryptionKey = 0xBA;
		int			i = 0x0;

		if(GetBuffer(m_pSectionHeader[0x2].PointerToRawData ,  ROOTKIT_BUFF_SIZE,  ROOTKIT_BUFF_SIZE))
		{   
			for(int i=4; i<0x2C; i++)
			{
				m_pbyBuff[i] ^=  bDecryptionKey;
				m_pbyBuff[i] = (~ m_pbyBuff[i]);
			}

			TCHAR  ROOTKIT_CZ_Sig[] = {_T("5C0044006F00730044006500760069006300*650073005C004B0049004C004C00500052004300")};
			//\.D.o.s.D.e.v.i.c.e.s.\.K.I.L.L.P.R.C.

			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;
			
			polydbObj.LoadSigDBEx(ROOTKIT_CZ_Sig, _T("Rootkit.Small.BSE"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], ROOTKIT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRootkitVkd
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Rootkit.Vkd Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRootkitVkd()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x7D00 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16400)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int ROOTKIT_BUFF_SIZE = 0xC8;
		m_pbyBuff = new BYTE[ROOTKIT_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x2ECE, ROOTKIT_BUFF_SIZE,ROOTKIT_BUFF_SIZE))
		{
			TCHAR			ROOTKIT_CZ_Sig[] = {_T("8B4D0C83F90F731D83450C08*8B55F0C1E9080FB6C9D36DFC*C1EA108817E937020000C1EA1083E10F")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(ROOTKIT_CZ_Sig, _T("Rootkit.Small.VKD"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],ROOTKIT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentbBQAF
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.bBQAF Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentbBQAF()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x1BFA9 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD400 &&  m_pMaxPEFile->m_stPEHeader.CheckSum == 0x27309)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int AGENTB_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[AGENTB_BUFF_SIZE];

		if(GetBuffer(0x5ED2, AGENTB_BUFF_SIZE,AGENTB_BUFF_SIZE))
		{
			TCHAR			AGENTB_CZ_Sig[] = {_T("5C0044006F00730044006500760069006300650073005C00*450059004F004F00530045004300550052004900540059004400520056")};
			                         //\.D.o.s.D.e.v.i.c.e.s.\.E.Y.O.O.S.E.C.U.R.I.T.Y.D.R.V
            CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(AGENTB_CZ_Sig, _T("Trojan.Agentb.BQAF"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],AGENTB_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBadurJISX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Badur.JISX Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBadurJISX()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x17AB2 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x20800)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BADUR_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[BADUR_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x1375 ,BADUR_BUFF_SIZE, BADUR_BUFF_SIZE))
		{
			TCHAR			BADUR_CZ_Sig[] = {_T("83E70F81E6F000000089C3F7D383E30F25F0000000*B82EF4E3B43B4DF00F8468FFFFFFB8884D9B55")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};
			
			polydbObj.LoadSigDBEx(BADUR_CZ_Sig, _T("Trojan.Badur.jisx"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],BADUR_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCosmuDHRW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Cosmu.DHRW Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCosmuDHRW()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4) && (m_dwAEPMapped == 0x12362 || m_dwAEPMapped == 0x11762) &&  (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x36000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int COSMU_BUFF_SIZE = 0x82;
		m_pbyBuff = new BYTE[COSMU_BUFF_SIZE];
		DWORD dwStartBuff = 0x0;

		if(m_dwAEPMapped == 0x12362)
		{
			dwStartBuff = 0x1CFB0;  

		}
		else if(m_dwAEPMapped == 0x11762)
		{
			dwStartBuff = 0x1C3B0;  
		}

		if(GetBuffer(dwStartBuff , COSMU_BUFF_SIZE, COSMU_BUFF_SIZE))
		{
			TCHAR			COSMU_CZ_Sig[] = {_T("380032002E003100340036002E00350031002E003200320000*68007400740070003A002F002F00380032002E003100340036002E00350031002E00320032*002F006A006F006F006D006C0061002F006D006F00640075006C0065007300*2F00780073006E0074002E007000680070")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(COSMU_CZ_Sig, _T("Trojan.Cosmu.DHRW"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],COSMU_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCryptEUQ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Crypt.EUQ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCryptEUQ()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x127000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int CRYPT_BUFF_SIZE = 0xC8;
		m_pbyBuff = new BYTE[CRYPT_BUFF_SIZE];
		
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0xB5EC0 ,CRYPT_BUFF_SIZE, CRYPT_BUFF_SIZE))
		{
			TCHAR			CRYPT_CZ_Sig[] = {_T("890DC4CC5200BA40984400*8B0D30CD52008A140A889010A15200B840984400*8B1530CD52008B3530CD5200*68820000006A786A226A0A8B0DF0CA5200")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};	

			polydbObj.LoadSigDBEx(CRYPT_CZ_Sig, _T("Trojan.Crypt.EUQ"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0],CRYPT_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectScarOetr
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Scar Family
					  >it added following value in registery :
						HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\AhnUpadate: ""C:\Program Files\Common Files\AhnLab\AhnSvc.exe" /run"
					  >it add one AhnLab folder in C:\Program Files\Common Files directory.
					  >it drop "AhnSvc.exe" & "AhnSvc.exe_" files in AhnLab folder.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectScarOetr()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x64EF && m_dwAEPUnmapped == 0x70EF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12E00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int SCAROETR_BUFF_SIZE = 0xB7;
		m_pbyBuff = new BYTE[SCAROETR_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x20D4, SCAROETR_BUFF_SIZE, SCAROETR_BUFF_SIZE))
		{
			TCHAR			SCAROETR_CZ_Sig[] = {_T("433A5C50726F6772616D2046696C65735C436F6D6D6F6E2046696C6573*41686E5376632E657865*5C41686E4C61625C41686E5376632E657865*41686E55706164617465*3334357264786376677435363779686A6D")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(SCAROETR_CZ_Sig, _T("Trojan.Scar.OETR"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], SCAROETR_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
}
  
/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloaderAX()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwOverlaySize = m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData);

	if( m_wNoOfSections == 0x08 && m_dwAEPMapped & 0xF000 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0x8A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0x8C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0x8800 &&
		m_pMaxPEFile->m_stPEHeader.CheckSum == 0x0000 && dwOverlaySize>=0x86A8 && dwOverlaySize<=0x8AE8 && m_pSectionHeader[m_wAEPSec + 7].SizeOfRawData & 0x0E00 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int	DOWNAX_BUFF_SIZE = 0x2FA;
		m_pbyBuff = new BYTE[DOWNAX_BUFF_SIZE];
		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x755C, DOWNAX_BUFF_SIZE, DOWNAX_BUFF_SIZE))
		{
			TCHAR			DOWNAX1_CZ_Sig[] = {_T("687474703A2F2F7777772E6A69616F73737338*363737322E636F6D2F*6E65742E657865")};
			TCHAR			DOWNAX2_CZ_Sig[] = {_T("687474703A2F2F6464*2E746573656B6C2E696E666F*2E657865")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(DOWNAX1_CZ_Sig, _T("Virus.Downloader.AX"), TRUE);
			polydbObj.LoadSigDBEx(DOWNAX2_CZ_Sig, _T("Virus.Downloader.AX"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DOWNAX_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojRazy91846
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of razy.91846 Family
						>it connect to the internet.
						>it make changes in registery
						>it added following value in registery :
							HKLM\SOFTWARE\Classes\.amver\: "1.1.15.510.amver"
							HKLM\SOFTWARE\Classes\1.1.15.510.amver\shell\open\command\: ""C:\Documents and Settings\All Users\Application Data\AZRQV\HDFView.exe" "%1 %2""
							HKLM\SOFTWARE\Classes\1.1.15.510.amver\DefaultIcon\: "C:\WINDOWS\system32\shell32.dll,-154"
						>it add one folder in Temp & drop two ".exe" and three ".dll" files in this folder.
						>it also add "4997GameBox_Data" folder in Application Data.
						>it also add one folder in Application Data. 
						>it drop "1.1.15.510.amver" , "4997lik.dll" , "amui.dll" , "gb.dll" & two ".exe" files in Application Data.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojRazy91846()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x108FB && m_dwAEPUnmapped == 0x114FB && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int TROJANRZY_BUFF_SIZE = 0x49A;
		m_pbyBuff = new BYTE[TROJANRZY_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x7C34, TROJANRZY_BUFF_SIZE, TROJANRZY_BUFF_SIZE))
		{
			TCHAR			TROJANRZY_CZ_Sig[] = {_T("5C003400390039003700470061006D00650042006F0078005F0044006100740061005C0000*75006E0069006E0073003000300030002E0065007800650000*2E0061006D0076006500720000*6300700061002E0077006F0079006F006F002E0063006F006D00*3400390039003700470042006F0078002E00650078006500")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(TROJANRZY_CZ_Sig, _T("not-a-virus:Trojan.Razy.91846"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], TROJANRZY_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownDriverUpdAYVN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of DriverUpd.AYVN Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownDriverUpdAYVN()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
	if( m_wNoOfSections == 0x03 && m_dwAEPMapped == 0xABC40 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18D000 && dwOverlayStart == 0x199000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int UpdAYVN_BUFF_SIZE = 0x35;
		m_pbyBuff = new BYTE[UpdAYVN_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x1041C0, UpdAYVN_BUFF_SIZE, UpdAYVN_BUFF_SIZE))
		{
			TCHAR			UpdAYVN_CZ_Sig[] = {_T("36006E0075003200620066006D006100*740068002E006D0072007A0070003900*370063006D00670033002E0063006F006D")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};


			polydbObj.LoadSigDBEx(UpdAYVN_CZ_Sig, _T("not-a-virus:Downloader.Win32.DriverUpd.ayvn"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], UpdAYVN_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojRAZY71851
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of TrojRAZY.71851 Family
				      *>h.t.t.p.:././.d.2.j.y.e.m.x.z.9.d.o.7.a.d...c.l.o.u.d.f.r.o.n.t...n.e.t./.s.h.o.p.p.e.r.z.p.r.t._.1.2./.u.p.d.a.t.e...e.x.e.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojRAZY71851()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if( m_wNoOfSections == 0x07 && m_dwAEPMapped >=0x18E94 && m_dwAEPMapped <=0x1B1F4 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x2D800 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x30200)// && (memcmp(m_pSectionHeader[3].Name, ".gfids", 6) == 0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int RAZY71851_BUFF_SIZE = 0x2A88;
		m_pbyBuff = new BYTE[RAZY71851_BUFF_SIZE];
		if (m_pMaxPEFile->m_dwFileSize < (0x33D70 + RAZY71851_BUFF_SIZE))
		{
			return iRetStatus;
		}

		if(GetBuffer(0x33D70, RAZY71851_BUFF_SIZE, RAZY71851_BUFF_SIZE))//0x33D70 m_pSectionHeader[0x1].PointerToRawData + 0x6170
		{
			TCHAR			RAZY71851_CZ_Sig[] = {_T("68007400740070003A002F002F00640032006A00790065006D0078007A00390064006F003700610064002E0063006C006F0075006400660072006F006E0074002E006E00650074*002F00730068006F0070007000650072007A007000720074005F0031003200*2F007500700064006100740065002E0065007800650000")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(RAZY71851_CZ_Sig, _T("not-a-virus:Trojan.Razy.71851"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], RAZY71851_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomeBlockerOOEW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Blocker.OOEW Family
						>it add following values in registry :
							HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\{F146C9B1-VMVQ-A9RC-NUFL-D0BA00B4E999}\StubPath: "C:\Documents and Settings\admin\Local Settings\Application Data\mrsys.exe MR"
							HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\userinit: "c:\windows\userinit.exe RO"
							HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce\Swchost: "c:\windows\swchost.exe RO"
						>it drop "mrsys.exe" file in Application Data.
						>it also drop "spoolsw.exe" , "swchost.exe" and "userinit.exe" files in C:\WINDOWS directory.
						>".exe" files are exact same copy of original file. 	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomeBlockerOOEW()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;

	if(m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x379C &&m_pSectionHeader[0].SizeOfRawData == 0x2C000 && m_pMaxPEFile->m_bIsVBFile && dwOverlayStart == 0x2F000 || dwOverlayStart == 0x2F03E)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int RANBLKROOEW_BUFF_SIZE = 0xBAB;
		m_pbyBuff = new BYTE[RANBLKROOEW_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x2790, RANBLKROOEW_BUFF_SIZE, RANBLKROOEW_BUFF_SIZE))
		{
			TCHAR			RANBLKROOEW_CZ_Sig[] = {_T("18404000*18434000*A0404000*20424000*A8374000*C0B34000*50BE4200")};
			TCHAR			szVirusName[MAX_PATH] = {0};
			CSemiPolyDBScn	polydbObj;

			polydbObj.LoadSigDBEx(RANBLKROOEW_CZ_Sig, _T("Trojan-Ransom.Win32.Blocker.OOW"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], RANBLKROOEW_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectdWbtlbrDownloaderPGA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Downloader.PGA Family
					  *>Malicious Website
						*>h.t.t.p.:././.i.n.s.t.a.l.l...t.i.c.n.o...c.o.m./.m.a.i.l.r.u./.M.a.i.l.R.u.S.p.u.t.n.i.k._.r.f.r.m.l.a.b.z._.m.p.c.l.n.7.8.2.1...e.x.e
						*>h.t.t.p.:././.s.p.u.t.n.i.k...m.a.i.l...r.u./.m.s.i.e./.a.g.r.e.e.m.e.n.t
					  *>Malicious File name
						*>M.a.i.l.R.u.S.p.u.t.n.i.k...e.x.e..
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectdWbtlbrDownloaderPGA()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections == 0x08 && m_dwAEPMapped == 0x88A68 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x88A00)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int DOWNLOADERPGA_BUFF_SIZE = 0x190;
		m_pbyBuff = new BYTE[DOWNLOADERPGA_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x7BB00, DOWNLOADERPGA_BUFF_SIZE, DOWNLOADERPGA_BUFF_SIZE))
		{
			TCHAR			DOWNLOADERPGA_CZ_Sig[] = {_T("68007400740070003A002F002F0069006E007300740061006C006C002E007400690063006E006F002E0063006F006D*002F006D00610069006C00720075002F004D00610069006C005200750053007000750074006E0069006B005F00*7200660072006D006C00610062007A005F006D00700063006C006E0037003800320031002E006500780065*4D00610069006C005200750053007000750074006E0069006B002E0065007800650000*68007400740070003A002F002F0073007000750074006E0069006B002E006D00610069006C002E0072007500*2F006D007300690065002F00610067007200650065006D0065006E0074")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(DOWNLOADERPGA_CZ_Sig, _T("not-a-virus:WebToolbar.Win32.MultiBarDownloader.pga"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DOWNLOADERPGA_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanRazy9138
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Razy.9138 Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanRazy9138()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x4 && (m_dwAEPMapped > 0x40000 && m_dwAEPMapped < 0x90000) && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int RAZY_BUFF_SIZE = 0x3000;
		m_pbyBuff = new BYTE[RAZY_BUFF_SIZE];

		DWORD dwReadOff=0;
		if(m_dwAEPMapped > 0x40000 && m_dwAEPMapped < 0x50000)
		{
			dwReadOff = 0x479B0; 
		}
		if(m_dwAEPMapped > 0x5C000 && m_dwAEPMapped < 0x5E000)
		{
			dwReadOff = 0x56050; 
		}

		if(m_dwAEPMapped > 0x62000 && m_dwAEPMapped < 0x65000)
		{
			dwReadOff = 0X5C840; 
		}

		if(m_dwAEPMapped > 0x69000 && m_dwAEPMapped < 0x70000)
		{
			dwReadOff = 0X630E0; 
		}
		if(m_dwAEPMapped > 0x70000 && m_dwAEPMapped < 0x80000)
		{
			dwReadOff = 0x79B40; 
		}
		if(m_dwAEPMapped > 0x80000 && m_dwAEPMapped < 0x90000)
		{
			dwReadOff = 0X7EE60; 
		}

		if(GetBuffer(dwReadOff, RAZY_BUFF_SIZE, RAZY_BUFF_SIZE))
		{
			TCHAR			RAZY_CZ_Sig[] = {_T("8B01BAFFFEFE7E03D083F0FF33C283C104A900010181*74E88B41FC84C0743284E47424A90000FF007413A900")};//
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(RAZY_CZ_Sig, _T("Trojan.Razy.99138"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], RAZY_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBankerSHIFU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Banker.SHIFU Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBankerSHIFU()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections >= 0x04 ||m_wNoOfSections >= 0x03 && m_dwAEPMapped ==0x0856 || m_dwAEPMapped ==0x1456 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2200 ||  m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2b000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int BSHIFU_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[BSHIFU_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x1970, BSHIFU_BUFF_SIZE, BSHIFU_BUFF_SIZE))
		{
			TCHAR			BSHIFU_CZ_Sig[] = {_T("8A1C0E325D0C*8819414A75F4")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2200)
			{
				polydbObj.LoadSigDBEx(BSHIFU_CZ_Sig, _T("Banker.Shifu.EPA"), FALSE);
			}
			else if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2b000)
			{
				polydbObj.LoadSigDBEx(BSHIFU_CZ_Sig, _T("Trojan-Banker.Win32.Shifu.EPH"), FALSE);
			}
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], BSHIFU_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanDropperEB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Dropper.EB Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanDropperEB()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x02EB0 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01000 &&
		 m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x8000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int DROPEB_BUFF_SIZE = 0x70;
		m_pbyBuff = new BYTE[DROPEB_BUFF_SIZE];

		if(GetBuffer( m_pSectionHeader[0x0].PointerToRawData + 0x01C30, DROPEB_BUFF_SIZE, DROPEB_BUFF_SIZE))
		{
			TCHAR			DROPEB_CZ_Sig[] = {_T("4E423130*6963777475746F722E706462*5733FF397C2408750433")};
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(DROPEB_CZ_Sig, _T("Trojan.dropper.ZBH"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DROPEB_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVBZtl
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of VB.Ztl Family
					  Malware adds 'nuipuu.exe' hidden file in C:\Documents and Settings\Admin foldaer.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBZtl()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x03 && m_dwAEPMapped ==0x1220 && m_wAEPSec == 0 )  
	{
		TCHAR	pbyVbZTLSig[] = {_T("5642352136262A*C0BA684D4000680C124000C3F40100005C274000")};
		if (CheckSigInBuffer(m_pSectionHeader[0].PointerToRawData + 0x2F0,0x700,pbyVbZTLSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VB.ZTL"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int VBZTL_BUFF_SIZE = 0x700;
		m_pbyBuff = new BYTE[VBZTL_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x2F0, VBZTL_BUFF_SIZE, VBZTL_BUFF_SIZE))//m_pSectionHeader[0x1].PointerToRawData + 
		{
			TCHAR			JNSK_CZ_Sig[] = {_T("5642352136262A*C0BA684D4000680C124000C3F40100005C274000")};//
			CSemiPolyDBScn	polydbObj;
			TCHAR			szVirusName[MAX_PATH] = {0};

			polydbObj.LoadSigDBEx(JNSK_CZ_Sig, _T("Trojan.VB.ZTL"), FALSE);
			if(polydbObj.ScanBuffer(&m_pbyBuff[0], VBZTL_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
		*/
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTAgentIGRH
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.IGRH Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTAgentIGRH()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05   && m_dwAEPMapped == 0xFFF9 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x20800 &&   m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400)
	{

		TCHAR	pbyAgentIGRHSig[] = {_T("684026011064FF35*8B442410896C24108D6C24102BE0535657A108C002103145FC*33C5508965E8FF75F88B45FCC745FCFEFFFFFF8945F88D45F064A300000000C3")};

		if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x0115D0,0x80,pbyAgentIGRHSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.IGRH"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}


		const int IGRH_BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[IGRH_BUFF_SIZE];

		if(GetBuffer( m_pSectionHeader[0x0].PointerToRawData + 0x0115D0, IGRH_BUFF_SIZE, IGRH_BUFF_SIZE))
		{
			TCHAR IGRH_CZ_Sig[] = {_T("684026011064FF35*8B442410896C24108D6C24102BE0535657A108C002103145FC*33C5508965E8FF75F88B45FCC745FCFEFFFFFF8945F88D45F064A300000000C3")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(IGRH_CZ_Sig, _T("Trojan.Agent.igrh"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], IGRH_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;
				}
			}
			return iRetStatus;
		}
		*/
	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareZugoO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of zugo.o Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareZugoO()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(( m_wNoOfSections == 0x0007 || m_wNoOfSections == 0x0005) && (m_dwAEPMapped  == 0x3440 || m_dwAEPMapped == 0x024FA) && m_wAEPSec == 0x0000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5E00) )
	{
		TCHAR pbyZUGOOSig[] = {_T("7A00750067006F002D00670065006E00660069007800320000*530074006100720074004E006F007700200054006F006F006C00620061007200")};

		if (CheckSigInBuffer(0x0C1C0,0x0E0,pbyZUGOOSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,  _T("Adware.Zugo.O"));
			return VIRUS_FILE_DELETE;
		}


		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int ZUGOO_BUFF_SIZE = 0x0E0;
		m_pbyBuff = new BYTE[ZUGOO_BUFF_SIZE];

		if(GetBuffer( 0x0C1C0, ZUGOO_BUFF_SIZE, ZUGOO_BUFF_SIZE))
		{
			TCHAR ZUGOO_CZ_Sig[] = {_T("7A00750067006F002D00670065006E00660069007800320000*530074006100720074004E006F007700200054006F006F006C00620061007200")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(ZUGOO_CZ_Sig, _T("Adware.zugo.o"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], ZUGOO_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
			return iRetStatus;
		}
		*/
	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectMP3EXT
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Adware.MP3FileEXT Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMP3EXT()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x0005 && m_dwAEPMapped  == 0x18558 && m_wAEPSec == 0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2AA00 )
	{

		TCHAR pszMP3EXTSig[] = {_T("8A110FB6B9000100000FB6DA03F803DF*8BC325FF0000807907480D00FFFFFF40*0FB6C08A5C282088194183EE01885428")};

		if (CheckSigInBuffer(0x07460,0x0100,pszMP3EXTSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,  _T("Adware.MP3FileEXT"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int MP3EXT_BUFF_SIZE = 0x0100;
		m_pbyBuff = new BYTE[MP3EXT_BUFF_SIZE];

		
		if(GetBuffer( 0x07460, MP3EXT_BUFF_SIZE, MP3EXT_BUFF_SIZE)) 
			{
					TCHAR MP3EXT_CZ_Sig[] = {_T("8A110FB6B9000100000FB6DA03F803DF*8BC325FF0000807907480D00FFFFFF40*0FB6C08A5C282088194183EE01885428")};
					CSemiPolyDBScn polydbObj;
					polydbObj.LoadSigDBEx(MP3EXT_CZ_Sig, _T("MP3Extension"), FALSE);
					TCHAR szVirusName[MAX_PATH] = {0};

					if(polydbObj.ScanBuffer(&m_pbyBuff[0], MP3EXT_BUFF_SIZE , szVirusName)>=0)	
					{

						if(_tcslen(szVirusName) > 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
	
							return VIRUS_FILE_DELETE;
					
						}
					}
						return iRetStatus;

				}
		*/

	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperInjectotJKSA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Phalake + Virus Analysis Team
	Description		: Detection routine for different varients of Injectot.JKSA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperInjectotJKSA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections >= 0x08   && m_dwAEPMapped >= 0xA060 && ( m_wAEPSec == 0 || m_wAEPSec == 0x8 ) && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x9E00 )
	{

		TCHAR	pbyInjectorJKSASig[] = {_T("8B45088D88B8EFFFFF8D55F08D45F4*56FBFFFF598BC603C08B55F48914838B55F0895483044681FE8000000075CB")};

		if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x80D0,0x70,pbyInjectorJKSASig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,  _T("Dropper.Injector.JKSA"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int JKSA_BUFF_SIZE = 0x70;
		m_pbyBuff = new BYTE[JKSA_BUFF_SIZE];

		if(GetBuffer( m_pSectionHeader[0x0].PointerToRawData + 0x80D0, JKSA_BUFF_SIZE, JKSA_BUFF_SIZE)) 
		{
			TCHAR JKSA_CZ_Sig[] = {_T("8B45088D88B8EFFFFF8D55F08D45F4*56FBFFFF598BC603C08B55F48914838B55F0895483044681FE8000000075CB")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(JKSA_CZ_Sig, _T("Dropper.Injector.jksa"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], JKSA_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
			return iRetStatus;
		}
		*/
	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectSpyQQLogger
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Phalake + Virus Analysis Team
	Description		: Detection routine for different varients of Spy.QQLogger Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSpyQQLogger()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x04   && m_dwAEPMapped == 0x160E && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1400 &&   m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 )
	{

		TCHAR	pbyQQLoggerSig[] = {_T("526F6F74204167656E6379*526F6F74204167656E6379")};

		if (CheckSigInBuffer(m_pSectionHeader[0x3].PointerToRawData + 0x3DE00,0x1CD,pbyQQLoggerSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,  _T("Trojan.Spy.QQLogger"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SPXYZ_BUFF_SIZE = 0x1CD;
		m_pbyBuff = new BYTE[SPXYZ_BUFF_SIZE];

		if(GetBuffer( m_pSectionHeader[0x3].PointerToRawData + 0x3DE00 , SPXYZ_BUFF_SIZE, SPXYZ_BUFF_SIZE)) 
		{
			TCHAR SPXYZ_CZ_Sig[] = {_T("526F6F74204167656E6379*526F6F74204167656E6379")};
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SPXYZ_CZ_Sig, _T("Spy.QQLogger"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], SPXYZ_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
			return iRetStatus;
		}
		*/
	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareELEX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Adware.ELEX Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareELEX()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x05   && m_dwAEPMapped == 0x228F8 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4E400 &&   m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400)
	{

		TCHAR pbyELEX_AMXSig[] = {_T("0FB702668904168D*52026685C0740349")};

		if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x201B0,0x30,pbyELEX_AMXSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME,  _T("not-a-virus:Adware.ELEX.AMX"));
			return VIRUS_FILE_DELETE;
		}

		/*
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		
	
		const int ADELEX_BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[ADELEX_BUFF_SIZE];

		
		
		if(GetBuffer( m_pSectionHeader[0x0].PointerToRawData + 0x201B0 , ADELEX_BUFF_SIZE, ADELEX_BUFF_SIZE)) //
			{
					TCHAR ADELEX_CZ_Sig[] = {_T("0FB702668904168D*52026685C0740349")};
					CSemiPolyDBScn polydbObj;
					polydbObj.LoadSigDBEx(ADELEX_CZ_Sig, _T("not-a-virus:Adware.ELEX.amx"), FALSE);
					TCHAR szVirusName[MAX_PATH] = {0};

					if(polydbObj.ScanBuffer(&m_pbyBuff[0], ADELEX_BUFF_SIZE , szVirusName)>=0)	
					{

						if(_tcslen(szVirusName) > 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
	
							return VIRUS_FILE_DELETE;
					
						}
					}
						return iRetStatus;

				}
		*/

	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectSelfDelASBD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Delf.ASBD Family
					  Trojan.SelfDel.asbd
					  Trojan.SelfDel.ceas	
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSelfDelASBD()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && (m_dwAEPMapped == 0x7D95 || m_dwAEPMapped == 0x14780) && (m_pSectionHeader[0].SizeOfRawData == 0x14A00 || m_pSectionHeader[0].SizeOfRawData == 0x23800))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int SELFDEL_BUFF_SIZE = 0x2BC;
		m_pbyBuff = new BYTE[SELFDEL_BUFF_SIZE];

		DWORD dwStartBuff = 0x0;

		if(m_dwAEPMapped == 0x7D95)
		{
			dwStartBuff = m_pSectionHeader[0x1].PointerToRawData + 0x5970;
		}
		else
		{
			dwStartBuff = m_pSectionHeader[0x1].PointerToRawData + 0x25C0;
		}


		if(GetBuffer(dwStartBuff, SELFDEL_BUFF_SIZE, SELFDEL_BUFF_SIZE))
		{
			TCHAR SELFDEL_CZ_Sig[] = {_T("633A2F77696E646F77732F617830312E646130*58534351434B4E6B6C*7B41303941303146462D314442432D343030432D383133322D3534464134444245344539367D*5C5C2E5C4D32546469")};
			//c:/windows/ax01.da0*XSCQCKNkl*\\.\M2Tdi
			TCHAR SELFDEL_CZ_Sig1[] = {_T("73006D0061007200740069006E0066002E00720075*740069006D0065002D0074006F002D0072006500610064002E00720075*660075006E00640061007900320034002E00720075")};
			//s.m.a.r.t.i.n.f...r.u*t.i.m.e.-.t.o.-.r.e.a.d...r.u*f.u.n.d.a.y.2.4...r.u
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SELFDEL_CZ_Sig, _T("Trojan.SelfDel.asbd"), TRUE);
			polydbObj.LoadSigDBEx(SELFDEL_CZ_Sig1, _T("Trojan.SelfDel.ceas"), FALSE);


			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],SELFDEL_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: This function contains collection of small trojans with few top level check and single signature checking.
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectTrojanCommon()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x08 &&  m_dwAEPMapped == 0x28090 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x27E00 )
	{
		if (CheckSigInBuffer(0x025D60,0x0200,_T("73747269702E657865*6D696E652E657865*637261636B2E657865*706F6B652E657865*21627567212E657865*735F67616D652E657865*6D7376786170702E657865*64736772756E2E657865*536F6674776172655C5472657373")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLW.TRESS"));
			return VIRUS_FILE_DELETE;
		}
	}  

	if((m_dwAEPMapped + 0x08000) < m_pMaxPEFile->m_dwFileSize && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL )
	{
		if (CheckSigInBuffer(m_dwAEPMapped + 0x07600,0x1000,_T("3132312E323534*3132312E323534*5C7363616E69702E747874")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Agent.CNFX"));
			return VIRUS_FILE_DELETE;
		}		
	}
	
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 &&  m_dwAEPMapped == 0x05D8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1200 )
	{
		if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x0260,0x0D0,_T("56423521890E2A*00281240*00281240*447269766520776F726D0050726F6A65637431000050726F6A65637431")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLW.Fatuous.B"));
			return VIRUS_FILE_DELETE;
		}
	}  

	if( m_wNoOfSections == 0x0004 && m_dwAEPMapped == 0x36D3 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC0200)
	{
		if (CheckSigInBuffer(0x0CCB00 ,0x500,_T("590200008B0FAE5A4A8A0732C1D0C9AA4A75F6C3000000005C*006B0072006E0063006F00640065002E0064006100740000*005A632D336F652E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Patched.QK"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil Sanghai
	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x315C8 &&  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4FC00 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x53CB13 || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x580637)
	{
		if (CheckSigInBuffer(0x53904 ,0x9C,_T("425959422E657865*425953657665722E657865*556E696E732E657865*506C617965725570646174652E657865*687474703A2F2F757064617465746573742E77756A692E636F6D*2F73746A2E61736878")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:AdWare.Win32.iBryte.HWNX"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade
	if(m_wAEPSec == 0 && m_wNoOfSections == 0x1 &&  (m_dwAEPMapped == 0x5490 || m_dwAEPMapped == 0x554D) && m_dwAEPMapped == m_dwAEPUnmapped && (memcmp(m_pSectionHeader[0].Name, "kkrunchy", 8) == 0))
	{
		if (CheckSigInBuffer(m_dwAEPMapped ,0xFA,_T("8D740901B8CA8E2A2E99F7F601C389D8C1E815ABFEC175E8*3C287602B028F6C301*31C0AC89C3AC404301C3C1E01099F7F3")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("NetWorm.Win32.Kolab.DWW"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade
	//if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	//{
		if((m_wAEPSec == 0 || m_wAEPSec == 4) && m_wNoOfSections == 0x5 && (m_dwAEPMapped == 0x1AA5F1 || m_dwAEPMapped == 0x3DF1) && (m_pSectionHeader[4].SizeOfRawData == 0x34C00 || m_pSectionHeader[0].SizeOfRawData == 0xB000))
		{
			DWORD dwStartBuff = 0x0;

			if(m_dwAEPMapped == 0x1AA5F1)
			{
				dwStartBuff = 0x1B1E44;
			}
			else
			{
				dwStartBuff = 0xB644;
			}
			if (CheckSigInBuffer(dwStartBuff ,0x17C,_T("5C494E4554494E464F2E657865*5C696E665C737663686F73742E657865*3132312E3235342E3233312E323437*3132312E3235342E3233312E323436")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Patched.RO"));
				return VIRUS_FILE_DELETE;
			}
		}
		if(m_wAEPSec == 0 && m_pMaxPEFile->m_bIsVBFile == true && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x13A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x67000)
		{
			if (CheckSigInBuffer(m_pSectionHeader[0].PointerToRawData + 0x0DC0 ,0x64,_T("0435400017F9700100FFFFFF08*FC3B400090544000B4134000780000007D*6273735F736572766572")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Windef.AAQA"));
				return VIRUS_FILE_DELETE;
			}
		}
		if(m_wAEPSec == 0 && m_wNoOfSections == 0x3 &&  m_dwAEPMapped == 0x4B15E && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x56000 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x3D1E7)
		{
			if (CheckSigInBuffer(m_pSectionHeader[0].PointerToRawData + 0x11508 ,0x1F4,_T("3130372E3136332E35362E3235313A36363538*687474703A2F2F3130372E3136332E35362E*3233323A31383936332F6D61696E2E706870*687474703A2F2F3130372E3136332E35362E*3233313A31383533302F*7777772E6B62737461722E636F6D2E6B69")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Palevo.HZDG"));
				return VIRUS_FILE_DELETE;
			}
		}
		if(m_wNoOfSections == 0x3 && (m_dwAEPMapped ==0x37EDE || (m_dwAEPMapped & 0xFF000) == 0x38000 || m_dwAEPMapped ==0xA58E) && m_wAEPSec == 0x0 && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x37E00 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x38000 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xA400))
		{
			DWORD dwStartBuff = 0x0;

			if(m_dwAEPMapped == 0xA58E && m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xA400)
			{
				dwStartBuff = m_pMaxPEFile->m_stSectionHeader[0].PointerToRawData + 0xC4DC;
			}
			else
			{
				dwStartBuff = m_pMaxPEFile->m_stSectionHeader[0].PointerToRawData + 0x11700;
			}
			//A.p.p. .S.e.r.v.i.c.e.s*2...2...2...2*A.p.p.l.i.c.a.t.i.o.n.*L.a.y.e.r.S.e.r.v.i.c.e...e.x.e
			if (CheckSigInBuffer(dwStartBuff ,0x1000,_T("4100700070002000530065007200760069006300650073*32002E0032002E0032002E0032*4100700070006C00690063006100740069006F006E00*4C00610079006500720053006500720076006900630065002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Agent.DKMZ"));
				return VIRUS_FILE_DELETE;
			}
		}
	//}
	
	//Sneha Kurade
	if((m_wAEPSec == 3 || m_wAEPSec == 0) && m_wNoOfSections == 0x5 && ( m_dwAEPMapped == 0x15001 || m_dwAEPMapped == 0x011d0 )  && m_dwAEPMapped == m_dwAEPUnmapped && ( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xf000))
	{
		if (CheckSigInBuffer(m_pSectionHeader[0].PointerToRawData + 0x21C0,0x64,_T("04404000FEF9F80120FF*3432400034304000DC11400078*57696E576F726400546F6D6220526169646572")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.VB.CC"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade
	if(m_wAEPSec == 9 && m_wNoOfSections == 0xB && m_dwAEPMapped == 0x5309A && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x60600 && 
		m_pMaxPEFile->m_stPEHeader.CheckSum == 0x6AE19 && !memcmp(m_pSectionHeader[m_wAEPSec].Name, ".casa1", 6)) 
	{
		if (CheckSigInBuffer(0x5C1BD,0x64,_T("66C1E7096609C72CF689D7F6D00FC0D0D2C838D4B280*AC60FEC8F9F6D30F99C3F6D0D2CBC0C803FEC3FEC09C*80DD9080D974B904010000F8660FBAE30128C0660FBAE50D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Infector"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade
	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4)&& (m_dwAEPMapped == m_dwAEPUnmapped) && (m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xC4000 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x172000))
	{
		if (CheckSigInBuffer(0xC7CA8,0x98,_T("5C00640077006C00470069006E00610032002E0064006C006C*5C007E007E007E007E002C007E007A0033002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Agent.CAC"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade
	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x030CF && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12400)
	{
		if (CheckSigInBuffer(0x0168B0 ,0x0100,_T("7879787074737674656F2E646C6C*696C73767A746F766763747572737577*6B76666F72766A7667777571*6F626779757467787A*6F6F6F636473767A66786C*7966736C6273666663667062")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Generic"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if( m_wNoOfSections == 0x04   && m_dwAEPMapped == 0x8033 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000)
	{
		if (CheckSigInBuffer(0x16000 ,0x10000,_T("5C73646667686A6B6C2E6461740072740000886A3F24*663661646632333935663936613364*383936326334636235363963613733*257357696E5F256325")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.Inex"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if( m_wNoOfSections == 0x08   && m_dwAEPMapped == 0xA0CC && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E00 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400)
	{
		if (CheckSigInBuffer(0x9DA4 ,0x60,_T("230000005B57696E33322E484C4C572E52616E44697220286329*62792044756B652F534D465D00FFFFFFFF0D00000054686E7820746F204C616D4072")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLW.Randir"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if( m_wNoOfSections == 0x05   && m_dwAEPMapped == 0x0540 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400)
	{
		if (CheckSigInBuffer(0x2828 , 0x9D,_T("4927766520646F6E65206D79206A6F6220766572792077656C6C0000417474656E74696F6E21*596F757220504320697320696E6665637464206279204A4F422C20706C656173652075736520416E7469566972616C2070726F677320746F2066696E64206D65*4861686168616861000000417474656E74696F6E0000002A2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.Job.22528"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if( (m_wNoOfSections == 0x0004 ||  m_wNoOfSections == 0x0005 )   && (m_dwAEPMapped == 0x2470 || m_dwAEPUnmapped==0x2470) && m_wAEPSec == 0X00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000 )
	{
		if (CheckSigInBuffer(0x1170 , 0x100,_T("8A14082AD080F2CD*80EA07881408403B")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.Job.22528"));
			return VIRUS_FILE_DELETE;
		}
	}
	
	//Priyanka Lokhande
	if( ( m_wNoOfSections == 0x0008 || m_wNoOfSections == 0x0007 ) && (m_dwAEPMapped == 0xB5DFA || m_dwAEPMapped == 0x7B437 || m_dwAEPMapped == 0x7B417 || m_dwAEPMapped == 0xB03F6 || m_dwAEPMapped == 0xB02A6 ) && m_wAEPSec == 0X00 &&   m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400)
	{
		DWORD dwStartBuff = 0x0;

		if( m_dwAEPMapped == 0xB5DFA)
		{
			dwStartBuff = m_pSectionHeader[0x0].PointerToRawData + 0xE4938;
		}
		else if(m_dwAEPMapped == 0xB03F6 || m_dwAEPMapped == 0xB02A6)
		{
			dwStartBuff = 0xDE500;
		}
		else 
		{
			dwStartBuff = m_pSectionHeader[0x0].PointerToRawData + 0xE82D0;
		}

		if (CheckSigInBuffer(dwStartBuff , 0x2500,_T("68747470733A2F2F6375726C2E686178782E73652F646F63732F687474702D636F6F6B6965732E68746D6C*2320546869732066696C65207761732067656E657261746564206279206C69626375726C21204564697420617420796F7572206F776E207269736B*6C69626375726C2F372E35332E31")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Snojan.GEN"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if((memcmp(m_pSectionHeader[m_wAEPSec].Name, ".plo1", 5) == 0) && (memcmp(m_pSectionHeader[m_wAEPSec-1].Name, ".plo0", 5) == 0) && m_wNoOfSections == 0x07 && m_dwAEPMapped == 0x16E5  && m_wAEPSec == 0x4  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x28000 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01000)
	{
		if (CheckSigInBuffer(0x240 , 0x70,_T("2E706C6F30*2E706C6F31")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Pavelo.HZTS"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Priyanka Lokhande
	if( ( m_wNoOfSections == 0x6 || m_wNoOfSections == 0x4 ) && m_wAEPSec == 0X00 && ( m_dwAEPMapped == 0xFC0F || m_dwAEPMapped ==0xF0E7 || m_dwAEPMapped ==0x1BEB5 ) && ( m_pSectionHeader[0].SizeOfRawData ==0x21000 || m_pSectionHeader[0].SizeOfRawData ==0x2E000 || m_pSectionHeader[0].SizeOfRawData == 0x18800))
	{
		DWORD dwStartBuff = 0x0;
		if(m_dwAEPMapped == 0x1BEB5)
		{
			dwStartBuff = 0x47700;
		}
		else
		{
			dwStartBuff = 0X2C4000;
		}

		if (CheckSigInBuffer(dwStartBuff , 0x5000,_T("6E6F6168*2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:WebToolbar.Win32.Linkury.CB"));
			return VIRUS_FILE_DELETE;
		}
	}

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if( m_wNoOfSections == 0x04 && m_wAEPSec == 0x00)
		{
			if (CheckSigInBuffer( m_pSectionHeader[0x1].PointerToRawData ,0x300,_T("54686520717569636B2062726F776E20646F67206A756D7073206F76657220746865206C617A7920666F7800*515549434B2062726F776E20666F78*6A756D70206F7665722068696D"))) 
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GenUSB.Cust2602"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	//Sneha Kurade
	/*if((m_wNoOfSections >= 0x04 && m_wNoOfSections <= 0x010 ) && m_dwAEPMapped == 0x16B70 && ( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x07C000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x07BE00))
	{
		if (CheckSigInBuffer(0x400 ,0x100,_T("BEDCF34900E87FFFFFFFBE98F34900*BF80F34900C70580F3490064714800*83C404BE6CF34900C7056CF34900184C4800E8EF0701008B0D70F34900")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.AutoRun.FNC"));
			return VIRUS_FILE_DELETE;
		}
	}*/
	//Sneha Kurade
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x0998 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17C00)
	{
		if (CheckSigInBuffer(0x19D68 ,0xE7,_T("7700690078006500640069007300690067006100*6A0075007A006F007A006100630061007A00750067006F006C0061*6400610076006F00730069002000780061006E00750078006F00*64006F006200610068006F007300750076006F00780075*6B00610063006F0070006F006400650079006900720075006D0065*666F6E617965727520737572617A61796168756A656765206C6F77616E69")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.gzz"));

			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x09D3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19C00)
	{
		if (CheckSigInBuffer(0x1BD88 ,0x85,_T("63616B6F6675*746164756E6179657861766F6B696869746179696E6F7865746578757961*20766172757A696D6F686564617761737572696B6F667572617765*6C696665786F747570696B6F*76696B75636F7A69796566756B656E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.gen"));

			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && (m_dwAEPMapped >= 0x12DE && m_dwAEPMapped <= 0x134E) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1200)
	{
		if (CheckSigInBuffer(0x15B2 ,0x900,_T("300030003000300030003400620030*62006A006A0074006E007800440070006E*30002E0030002E0030002E0030")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Revenge.bc"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x110C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10000)
	{
		if (CheckSigInBuffer(0x77C4 ,0x6C,_T("647E400011F0300000FFFFFF*D07A4000E08240001811400078*54657874436F6E76*4465616C61686F7961")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VBKrypt.ybur"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x1150 && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19000 && (memcmp(m_pSectionHeader[m_wAEPSec].Name, "MEW", 3) == 0))
	{
		if (CheckSigInBuffer(0x9BDC ,0x500,_T("31003200330034003500360037003800390030002E002E00*620065006C0061006A0061007200200062006500720068006900740075006E00*4200610062006F006E0027007300200043006F006D00700075007400650072*50006C006500610073006500200065006E006A006F0079002000740068006500*20004200610062006F006E00200045006E00740065007200*7400610069006E006D0065006E00740020005E005F005E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.VB.es"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav Pakhale
	/*
	if( m_wNoOfSections == 0x05 && m_pMaxPEFile->m_stPEHeader.e_lfanew < 0x0100 )
	{
		if( (CheckSigInBuffer( (m_pSectionHeader[0x3].PointerToRawData + m_pSectionHeader[0x3].SizeOfRawData - 0x0E00 + 0x0C0) ,0x020,_T("2D007374646F6C65322E*746C62575757FFFF"))) || (CheckSigInBuffer( m_pSectionHeader[0x3].PointerToRawData + 0x0300 ,0x0300,_T("2D007374646F6C65322E*746C62575757FFFF"))))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.MultiPlug.heur"));
			return VIRUS_FILE_DELETE;
		}
	}
	*/

	if((m_wNoOfSections == 0x07 || m_wNoOfSections == 0x03 ) && m_pSectionHeader[0x0].PointerToRawData == 0x0400)
	{
		DWORD ZUSY_FF = 0x0;
		DWORD Z_BUFF_SIZE = 0x0;
		Z_BUFF_SIZE = 0x2500;

		if(m_wNoOfSections == 0x03)
		{
			ZUSY_FF = 0x03c500;
		}
		else
		{
			ZUSY_FF = 0x083CB0;
		}

		if (Z_BUFF_SIZE + ZUSY_FF >= m_pMaxPEFile->m_dwFileSize)
		{
			Z_BUFF_SIZE = 0x0500;
		}

		if (CheckSigInBuffer( ZUSY_FF ,Z_BUFF_SIZE,_T("15085461624F7264657202000454657874*33633A5C50726F6772616D2046696C65735C426F726C616E645C44656C706869365C42696E5C504153535C50415353322E646C6C"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.zusy.262356")); //GZ type
			return VIRUS_FILE_DELETE;
		}

	}

	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x2110 && m_pSectionHeader[0x0].PointerToRawData == 0x0400 && m_pSectionHeader[0x0].SizeOfRawData == 0x2C00 )
	{
 
		if (CheckSigInBuffer( 0x04AAB0 ,0x080,_T("7B45414637393942462D383434392D346665312D394130442D3935434433394443323031347D*006675636B00000000476C6F62616C5C*745F25303878006578706C6F7265722E657865000000005368656C6C5F54726179576E64"))) //EAF799BF-8449-4fe1-9A0D-95CD39DC2014}...fuck....Global\HighMemoryEvent_%08x.explorer.exe....Shell_TrayWnd.
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.zusy.elzob.8654")); //GZ type

			return VIRUS_FILE_DELETE;
		}
	
	}

	if(m_wNoOfSections == 0x03 && m_pSectionHeader[0x0].PointerToRawData == 0x0200 && m_pSectionHeader[0x0].SizeOfRawData == 0x13200 )
	{
		if (CheckSigInBuffer( 0x135A0 ,0x090,_T("74006D00700031002E0074006D0070002E0065007800650000*74006D00700031002E0074006D0070002E0065007800650000")))  //off:500d sign : Information..exe.../.c:.*.*.Couldn't open the file! .C:/exp/.visua.... [File] . [Sub-Dir] 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.zusy.258672")); //GZ type
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x1BE59 && m_pSectionHeader[0x0].PointerToRawData == 0x01000 && m_pSectionHeader[0x0].SizeOfRawData == 0x25000 )
	{
 		if (CheckSigInBuffer( m_pMaxPEFile->m_stSectionHeader[0x02].PointerToRawData + 0x01890 ,0x0B0,_T("4761746F72547269636B6C65722E6C6F67*25735C25735C63686B000000736F6674776172655C51776572747975696F5C547269636B6C65725C46696C657300")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Malware.sfyd.e4353219")); //GZ type
			return VIRUS_FILE_DELETE;
		}
	
	}

	if( (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x03 || m_wNoOfSections == 0x02)   && ( m_dwAEPMapped == 0x01000 || m_dwAEPMapped == 0x0177f || m_dwAEPMapped == 0x01110 ) && (m_wAEPSec == 0 || m_wAEPSec == 1)  && (m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01000 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01600 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0100))
	{
		if (CheckSigInBuffer( 0x01500 ,0x1000,_T("7600740062006F00730073002E0079006F006C006F0078002E006E0065007400*2D2D2D2D2D2D2D2D25303135640D"))) //vtbos.yolox.net * constant bytes
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VTFlooder.GEN"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04) && m_dwAEPMapped == 0x0400 && m_pSectionHeader[0x0].PointerToRawData == 0x0400 && (m_pSectionHeader[0x0].SizeOfRawData == 0x2000 || m_pSectionHeader[0x0].SizeOfRawData == 0x1A000))
	{
 		if (CheckSigInBuffer( 0x01C7A0 ,0x10B0,_T("424F475927532047414D4520454E47494E4500*687474703A2F2F31342E31382E3134312E32373A3333333535*6D63792E6173703F61743D6765746D62267331333D006F6B006E6F")))
		{
			if (m_pSectionHeader[0x0].SizeOfRawData == 0x1A000)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dinwod.acqn")); 
			}
			else
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dinwod.unm")); 
			}
			return VIRUS_FILE_DELETE;
		}
	}
	
	if( (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04)  && m_dwAEPMapped == 0x3300 && m_wAEPSec == 0  && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E000)
	{
		if (CheckSigInBuffer( 0x33B0 ,0x100,_T("5642352136262A*BAF340005C34400000F0300000FFFFFF080000000100000000000000E900000058334000583340000C33400078"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Vobfus.dgso"));
			return VIRUS_FILE_DELETE;
		}
	}

	if( m_wNoOfSections == 0x04 && m_wAEPSec == 0x00)
	{
		if (CheckSigInBuffer( m_pSectionHeader[0x1].PointerToRawData ,0x300,_T("54686520717569636B2062726F776E20646F67206A756D7073206F76657220746865206C617A7920666F7800*515549434B2062726F776E20666F78*6A756D70206F7665722068696D"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Generic"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x204CB && m_pSectionHeader[0x0].PointerToRawData == 0x0400 && m_pSectionHeader[0x0].SizeOfRawData == 0x9E400 )
	{
 		if (CheckSigInBuffer( m_pSectionHeader[0x0].PointerToRawData + 0x01A0 ,0x070,_T("8B75E889C10FB6108B3D1C007B3D29F1*89DE8D1C31890D00007B3D235DD80214*1F89F38B7DD029CB335DD40FB6CA0FB6*89D0DF893D01CB88184089F339F80F82BCFFFFFF")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.generickdz.41622")); //GZ type
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x0937 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13C00 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x4C8CC && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x4508 , 0xEC,_T("6261666F726970697961727570757275*7375706F79696D616C696A7520786579696D75646F776164*656E6F67757375707576752074696D65676F646579756D69746F67696361626F6D656C65*2073656A616761786964616675796F686F7A6F636F*20786F6B696461776163757965*6D6F77696365706F7875796F7765766F*2079652077656E697A6973616B75207A7567616C696E6974*6F7A696B696269796170656E756A696269726F6475*6B65686F736170697A6F666F6B6F6861*7669706F7661626177617765706F6475*2077756D696275686F6365736F20636520736F68617A7562697469")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Ransom.Crusis.CEN"));
			return VIRUS_FILE_DELETE;
		}
	}

	DWORD NameByteOffset = 0xC817;
	DWORD dwIMportTblRVA = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress;
	const BYTE byChkName[] = {0x63, 0x72, 0x79, 0x73, 0x69, 0x73}; //crysis
	if(GetBuffer(NameByteOffset, 0x6, 0x6))
	{
		if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x9DD0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E00 && dwIMportTblRVA == 0xD4E0 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		{
			if(memcmp(m_pbyBuff, byChkName, sizeof(byChkName))== 0)
			{
				if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x99D3 , 0x80,_T("81ECB0010000*68800000006800E04000683CA1000068*80E040006880E04000*83C41468800000006880E0400068DA05*0000683EE54000683EE54000*83C414683EE54000*83C40468DA0500006A00683EE54000")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crusis.To"));
					return VIRUS_FILE_DELETE;
				}//0x9DD3
			}
		}
	}

	DWORD dwFileSize = m_pMaxPEFile->m_dwFileSize;
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x572B && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5600 &&dwIMportTblRVA == 0x74E1 && dwFileSize == 0x5E10 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x4440, 0x26,_T("7B36316561336462642D346463652D*343932312D613831352D6636386233353035343763347D")))//{61ea3dbd-4dce-4921-a815-f68b350547c4} Resource Class ID
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crypren.aeia"));
			return VIRUS_FILE_DELETE;
		}
	}


	DWORD SecNameByteOffset = 0x177;
	const BYTE byChkSecName[] = {0x00, 0x43, 0x04, 0x12, 0x22, 0x1A, 0x68, 0x02}; //Section Name :.C..".h.....'
	if(m_wAEPSec == 0x04 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x53E0A && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0200 && dwIMportTblRVA == 0x2F3A4 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)// && (memcmp(m_pSectionHeader[0].Name, '.C..".h.....', 14) == 0))
	{
		int iCnt = 0;
		while(m_pSectionHeader[0].Name[iCnt])
		{
			iCnt++;
		}
		if(!iCnt==0xB)
			return iRetStatus;
		if (CheckSigInBuffer(0x3162D , 0xCC,_T("30393039394242394434354444373144323130413830463936433133353237394146384431353237*32364432433137314338413635304533354233364639353643363634303044303545453338333131*39323631313246373630454342353436373637354241343646314239424330414331394245443230*39353936314542393645393742363643353744304438464645363832354235334534463242364139*45443332323534314234383744414233373543313830344239363534434631323631363741373934")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crusis.CBP"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x32E3E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x32E00 &&dwIMportTblRVA == 0x34BEC && dwFileSize == 0x66E00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x32AE8, 0x5E,_T("433A5C55736572735C506C33786C33745C446F63756D656E74735C*4A696773617752616E736F6D776172655C*4A696773617752616E736F6D776172655C*6F626A5C52656C656173655C41706F7068697352616E736F6D776172652E706462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Generic"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x11E9 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 &&dwIMportTblRVA == 0x203C && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(m_pSectionHeader[0x2].PointerToRawData + 0x32360, 0x10C,_T("6D7373656373766332*433A5C25735C7165726975776A687266*7461736B736368652E657865*687474703A2F2F7777772E697571657266736F64703969666A61706F7364666A6867*6F737572696A66616577727765726777*2E636F6D")))//6666
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Wanna.m"));
			return VIRUS_FILE_DELETE;//6D73736563737663322E31*
		}
	}

	if(m_wNoOfSections == 0x0A && m_dwAEPMapped == 0x3F5E0 && m_wAEPSec == 0x01 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x03F400)
	{
		if (CheckSigInBuffer(0x200,0x150,_T("69616172746E65*6F6A687771776B*6D6869797A6C69*6F686F6876676E00*73626366637878*66786A6C6C6F7200*7178776E696B7300")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.AutoRun.FNC"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0xFE0 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x01000)
	{
		if (CheckSigInBuffer(0x1080,0x0160,_T("004200004500004800004B00004E00005100005400005700005A00*6300006600006900006C00006F00007200007500007800*4100004400004700004A00004D00005000005300005600005900")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.IRCNite.CCU"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x05bef && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17a00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x0870, 0x60,_T("89D889FE8A0B29D0BA5F427B0929C6A3*F809133189F0C1E803F7E269C2D80000*008B55E429C6668B8436B0A2123100C8*8803433B5DE00F82C4FFFFFFE96A0000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.BJUWVK"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav Phalake
	if(m_wAEPSec == 0x06 && m_wNoOfSections == 0x09 && m_dwAEPUnmapped == 0x0b0f4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400 && m_dwAEPUnmapped > m_pMaxPEFile->m_dwFileSize &&(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x64B0, 0x600,_T("7300650063007200390074006F00730000*007300650063007200390074006F0073*4F0045004D002D0053004C00500032002E0031002000410043005000490020005000610074006300680020004400720069007600650072*31CF31DF31F931353260328B32A032E2323133493361339C33")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("RiskTool.HackKMS.G"));//Company name and Constant bytes// AEPUnMapped is greater than file size
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_pMaxPEFile->m_stPEHeader.NumberOfSections == 0x04 && m_dwAEPMapped == 0x0600 && m_pSectionHeader[0x0].SizeOfRawData == 0x09200)
	{
		if(CheckSigInBuffer(m_pSectionHeader[0x0].SizeOfRawData + 0x600,0x100,_T("416C6D61205669727573*6279204C6974655379732F58414B45520D*5072696D6572612047656E65726163696F6E*54616D616E696F*76697275733A203337323734")))//Alma Virus by LiteSys/XAKER..Primera Generacion....Tamanio total del virus: 37274
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Alma.37274"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x55348 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x55000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x54B30, 0x50,_T("433A5C43616B6577616C6B2050726F6A6563747300*558BEC83C4F85333D28955FC33C05568D157450064FF30648920C645FB0233C0A3B88D45008D45FC")))//C:\Cakewalk Projects.
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.CEWALK"));
			return VIRUS_FILE_DELETE;
		}
	}
	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x9bd0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x9240, 0xE00,_T("8B1D64C640008D5C3302538A1A5F881F*0FB67413FF8B3981E7FF00000033F78B")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.Enterus.C"));
			return VIRUS_FILE_DELETE;
		}
	}

	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x448 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2400 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x1EE0, 0x70,_T("59006F007500270052006500200043006F004D00500075005400650052*00200048006100530020004200650065004E00200069004E004600610044006500440020002100210021002100210000")))//Y.o.u.'.R.e. .C.o.M.P.u.T.e.R. .H.a.S. .B.e.e.N. .i.N.F.a.D.e.D. .!.!.!.!.!.
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.FAD"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wNoOfSections == 0x08 && m_dwAEPMapped == 0x3e930 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3e600)
	{
		if (CheckSigInBuffer(0x49390,0x070,_T("3C0743617074696F6E064C57656C6C2C*204920616D20676F6E6E612075706461746520596F757220494520*7769746820736F6D65206A756E6B20636F646520617373686F6C652E*20456E6A6F79207570646174696E6721")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.Bubica"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x800)
	{
		if (CheckSigInBuffer(0x0AD0, 0x60,_T("2E4279746553560000*5B57696E33322E576F6C6668656172742E313438315D*286329204279746553562F56484300")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Bytesv.1391"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x07 && m_dwAEPMapped == 0x0600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xc00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x1260, 0x100,_T("536F6674776172655C4D6963726F736F66745C57696E646F77735C43757272656E7456657273696F6E5C52756E0053637265616D00536F6674776172655C*43757272656E7456657273696F6E0053637265616D56697200596573002A2E657865*5A654D6163726F4B696C6C657239382069732074686520626573742121*5369676E204F662053637265616D206973207468652062657374207465616D2121")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLO.zmk.C"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x338E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3200 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[1].PointerToRawData - 0x300, 0x300,_T("57696E646F7773205461736B204D616E6167657200*2401001F6C696B652066616365626F6F6B2E636F6D2F446F744E657447616E67*4A5352202E696E63C2A0000018010013536B69706572*446F744E657447616E67*4A5352202E696E6320436F7079726967687420C2A9202032303132C2*4A6169205369796152616DC2A000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Generic"));
			return VIRUS_FILE_DELETE;
		}
	}

	/*
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x400 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0200)
	{
		if(CheckSigInBuffer(0x3FA0,0x070,_T("384700004047000048470000*5747000067470000000001005354554233322E455845*4D61696E576E6450726F6340313600*5F5374756246696C6557726974654031320000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Drowor.D"));
			return VIRUS_FILE_DELETE;
		}
	}
	*/

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x16B70 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7BE00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x80AC0, 0x1000,_T("5820686173206E6F74206265656E20636F6D70696C6564006D616C666F726D6564*200061006C00690061007300200050006C00610079004D00650000007300740061007400750073*50006C00610079004D00650020006D006F00640065000000000063006C006F0073006500*70006C0061007900200050006C00610079004D006500200077006100690074000000000070006C0061007900")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.AutoIt.QN"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x0FE0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000) 
	{
		if (CheckSigInBuffer(0x6E8 ,0xEE,_T("8B510483EA08D1EA83E83D2BF883C10881EEEF00000081EEF4000000*BA000000002DC30000008BF8668B01662500F0663D0030752B83EF5D*BE000000008BC02DFE00000003F083EF5B2BD081EABB00000083C102836DEC01")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.IRCNite.ccu"));
			
			return VIRUS_FILE_DELETE;
		}
	}

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x2AAE  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2A00)
		{
			if (CheckSigInBuffer(0x1B00, 0x1000,_T("6964325F6874747074656D707572696F7267*68007400740070003A002F002F00740065006D0070007500720069*002E006F00720067")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("RiskTool.MSIL.Tpyn.gen"));
				return VIRUS_FILE_DELETE;
			}
		}

		if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && (m_dwAEPMapped == 0x1B6E || m_dwAEPMapped == 0x1EFE)  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E00))
		{
			if (CheckSigInBuffer(0xF00, 0x500,_T("3C4D6F64756C653E*586D6C53657269616C697A6174696F6E577269746572*4F626A6563744172726179*586D6C53657269616C697A6174696F6E*5265616465724F626A6563744172726179")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("RiskTool.MSIL.Tpyn.genA"));
				return VIRUS_FILE_DELETE;
			}
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x6 && (m_dwAEPMapped == 0x10B17 || m_dwAEPMapped == 0x100F7) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19400)  && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)//added
	{     
		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		const int MULTIPLUG_BUFF_SIZE = 0xD;
		m_pbyBuff = new BYTE[MULTIPLUG_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		const BYTE byChkNames[] = {0x43, 0x00, 0x4F, 0x00, 0x4E, 0x00, 0x4F, 0x00, 0x55, 0x00, 0x54, 0x00, 0x24}; //
		if(GetBuffer(m_pSectionHeader[0x1].PointerToRawData + 0x3EB8, MULTIPLUG_BUFF_SIZE, MULTIPLUG_BUFF_SIZE))
		{
			if(memcmp(m_pbyBuff, byChkNames, sizeof(byChkNames))== 0)
			{
				if (CheckSigInBuffer(0x15B63 , 0xD68,_T("C1F80583E11F8B0485C8114200C1E10680CA01885408048B*C0E107247F0AC8884C32248B4D14385D")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not a virus:Adware.MultiPlug.JAAA"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x23CEB && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x39000) 
	{
		if (CheckSigInBuffer(0x3A0E4 ,0xFF,_T("4463756D656E7442617365204469676974697A652E*41776172642048414E44532E*53716C436C69656E744661637472792061626C6520*436976696C697A6174696E20696E66696E74696C697A65732E*68617070656E696E6720657874726163747320696C746572696E672065737461626C6973686564*20646973686F6E6573742073616E6672616E636973636F6361626F73746F6E6D612E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-PSW.Win32.Chisburg.ajeu"));
			
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x5 || m_wNoOfSections == 0x4) && (m_dwAEPMapped == 0x11E9 || m_dwAEPMapped == 0x9A16) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000))
	{
		DWORD dwStartBuff = 0x0;
		if(m_dwAEPMapped == 0x11E9)
		{
			dwStartBuff = 0x1B39C; 
		}
		else 
		{
			dwStartBuff = 0x17338;
		}

		if (CheckSigInBuffer(dwStartBuff, 0x100,_T("57494E444F5753*6D737365637376632E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Wanna.m"));
			return VIRUS_FILE_DELETE;
		}

	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x419EF3 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25000)
	{
		if (CheckSigInBuffer(0x429840, 0x60,_T("434C5349445C7B41444238383041362D443846462D31314346*2D393337372D3030414130303342374131317D*5C496E70726F635365727665723332")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Swisyn.A"));
			return VIRUS_FILE_DELETE;
		}

	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x9620 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1B200)
	{
		if (CheckSigInBuffer(0x1B7E0, 0x110,_T("636568696A657475646578696361776F6D75746567616665666F7069776F*207A656D6F6769676178756A617A616A6979616E69766F7861206D69*6361766572656E697861646174656269636F667574697765666F6775*206375626F6865787576697969636179616E656D6F7969*007A006F007700690077006100790065007000610078006F006C006900770075*00200072006F0070006900790065006E0061007A0069007A006F0066006F0020*0063006F006E0061006C00650073006500790069006D00750063006100790065006400750070006F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.nyj"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x6C76 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18600)
	{
		if (CheckSigInBuffer(0x18C20, 0x90,_T("530075006A0069006E0065006600650067006500630069002000700061006E*006F006C00750020007900690066006F007A006F0062006500200072006900660065*50656A61637564616765206D75766166616C6F206D69*4E69796F6B756C752079657365707568657A696D6F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.npd"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0xB17 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6A00)
	{
		if (CheckSigInBuffer(0x6FC0, 0xC7,_T("6B656E6F6E6F68757775*6D697075746564696D61626F7A6F646573652079696C656D656A65207675786F*74697075666974657969796170656C69746179617A75*6B6573696A61766F626F686973616269796F686F7875636F6A61206E75*6B617A61686176697765786570656E6977616E6567696B69*6375646F736F796968757275796164652079616669706968*616A61626F6E6F7265786F6B656E652076656B6976756261")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Ransom.GandCrab.Gen.2"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x16EDE && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16C00)
	{
		if (CheckSigInBuffer(0x10D5A, 0x1C2,_T("34313562336537392D333365632D343737*332D383662342D353730376263646565346339*53462E657865*3C4D6F64756C653E7B32463432413542462D334442392D344231302D*394145362D3239454439464636413445447D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crypren.aeii"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x24868 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x24600)
	{
		if (CheckSigInBuffer(0x24500, 0xA8,_T("2E2E5C73696D2E657865*68652073657475702066696C65732061726520636F727275707465642E20*506C65617365206F627461696E2061206E657720636F7079206F66207468652070726F6772616D2E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crypmod.zfq"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x4206 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14400)
	{
		if (CheckSigInBuffer(0x14CE8, 0xE8,_T("67756C75796F206461776F68757261637572656D61786F6A6F20736577756D616A616D65*20706F7A6F746572616D657869207A6F73696D616B656C7578657075*44652076656D697261207A656C6572696E656B61626174696769736F6A65726F6A657A6F746F*206C757061736973756C696D7572696D656A6F7A757A75797577616B6F20*636170617661796966697265626967756865796968656D6573756A756B65")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.GandCrypt.pr"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x1175F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11A00)
	{
		if (CheckSigInBuffer(0x1FC88, 0x78,_T("5C222550524F4752414D46494C4553255C5C6D6963726F736F66742E6578655C*5C222550524F4752414D46494C4553255C5C7273702E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Blocker.kytq"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x2BA2E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2BA00)
	{
		if (CheckSigInBuffer(0x44484, 0x120,_T("410064006F00620065002000530079007300740065006D0073002000*49006E0063006F00720070006F00720061007400650064*410064006F006200650020004100630072006F0062006100740020005200650061006400650072*31002E0030002E0030002E00300000*63007500730074006F006D002D0032003000310037002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crypmodadv.xrm"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x5 && m_wNoOfSections == 0x7 && m_dwAEPMapped == 0x43EC2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x54800 && (memcmp(m_pSectionHeader[1].Name, "shared", 6) == 0))
	{
		if (CheckSigInBuffer(0xE0C, 0x24A,_T("687474703A2F2F79356D6F677A616C327732357036626E2E6D6C*6D007900690070002E0064006E0073006F006D0061007400690063002E0063006F006D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Gen.hsr"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0 && m_wNoOfSections == 0xB && m_dwAEPMapped == 0x8C0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF5000) 
	{
		if (CheckSigInBuffer(0xF7520 ,0x150,_T("4E4D6F7265697261*48006900200064006500620075006700670065007200200064007500640065002C002000610073006D002000690073002000*7600650072007900200063006F006F006C00200074006F00200075006E006400650072007300740061006E006400200069007300*20006E006F0074002000690074003F0020004900200075007300650064002000*74006F00200063007200610063006B0020006C006F007400730020006F006600200073006F006600740077006100720065007300*2000770069007400680020004F006C006C007900640062006700200062007500740020006C006100740065006C007900*20004900200064006F006E0027007400200068006100760065002000740069006D0065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Xpan.f"));

			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x10B6 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000) 
	{
		if (CheckSigInBuffer(0x66FC ,0x19B,_T("72006500630065007700610079006F00*7300690066006F006D006100640061006600650073006F007A006F0078007500*630061007800690079006900660069002000740061006B0075006C0069007A00*65007600650020007800690063006F0062006F00680069006400690073006500*700061007300690076006F007A00750067006F006B0065007A0069007A0075*74006F0077006F00720075007900690066006F006C006F006700610074006900*20007800690062006500720065006E0065006E00750072007500200067006F00*730061006A006100720069007A006F007400750070006F0073006900670075007A00750073006500780065006D0075")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.lvv"));

			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0xBFC && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1B800) 
	{
		if (CheckSigInBuffer(0x1E370 ,0x19B,_T("74006100730061006C006F006A00750062006900760075006200690077007500*640065006D0061006C00750078007500620061007900750020006A00650000007300610068006F007700610079006F00770075006B*006900640065006A006F007800610067006500730065006C0061002000790065007700750073006F0072006500790069006B00*75007A006900740075007A0061006700610074006F0073007500200068006100680069006E0061006C00750068007500730069*00630061007200750020006D007500700075006A0069006B0061007600690020*006A00690066006F007900750072006100670069006A00610066006500740065007200610070006900660065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.mad"));

			return VIRUS_FILE_DELETE;
		}
	}

	/*
	REMOVED : Virus Total False (+)ve
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x2740A && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8E000 && (memcmp(m_pSectionHeader[1].Name, ".rdata", 6) == 0))
	{
		if (CheckSigInBuffer(0x91F20, 0xC0,_T("5C005C005B005C005C006E00720074005D007C00250025007C0025005B002D00*2B002000300023005D003F0028005B0030002D0039005D002A007C005C002A00*29003F0028005C002E005B0030002D0039005D002A007C005C002E005C002A00*29003F005B0068006C004C005D003F005B00640069006F00750078005800650045006600670047")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Gen.hwr"));
			return VIRUS_FILE_DELETE;
		}
	}
	*/
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && (m_dwAEPMapped == 0x5AA2 || m_dwAEPMapped == 0x57DE) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5600))
	{
		if (CheckSigInBuffer(0x3972, 0x800,_T("530046002E00500072006F0070006500720074006900650073002E00*5200650073006F00750072006300650073*2432383262386438362D663333662D343431652D386262352D393539303333353162653339")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Spora.fby"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 1 && m_wNoOfSections == 0x9 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6F2E00 && (memcmp(m_pSectionHeader[0].Name, ".textbsskC5", 11) == 0)) 
	{
		if (m_dwAEPMapped == 0xDD58)
		{
			if (CheckSigInBuffer(0x6F6669  ,0x335,_T("736861646F77736F636B73*736861646F77736F636B73*77006500620073006F0063006B002E006500780065*77006500620073006F0063006B002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.CoinMiner"));
				return VIRUS_FILE_DELETE;
			}
		}
		else if (m_dwAEPMapped == 0xDD62)
		{
			if (CheckSigInBuffer(0x6F66F0 ,0x28A,_T("4C0061004300690065*636D647376722E657865*7300650063007500720065006400690073006B002E006500780065*7300650063007500720065006400690073006B002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.CoinMiner"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x0400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0800)
	{
		if (CheckSigInBuffer(0x626 ,0x40,_T("33C981C1001000008A5439FFD0C2*80F27E885439FF4983F90075ED")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Spy.Win32.Zbot.WQCD"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x4A06  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4A00)
	{
		if (CheckSigInBuffer(0x4251, 0x6D0,_T("2432383262386438362D663333662D343431652D386262352D393539303333353162653339*433A5C55736572735C706F7765725C4465736B746F705C*52616E736F6D4145535C6F626A5C44656275675C52616E736F6D4145532E706462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Spora.fcr"));//.fbz
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x26e7  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10600)
	{
		if (CheckSigInBuffer(0x10BA0, 0x100,_T("770061006E006500670069006B0069006300750064006F0073006F0079006900*6800750072007500200079006100640065007900610066006900700069006800*610020007700690020006A00610062006F006E006F007200650078006F006B0065006E0065*740065007900690079006100700065006C00690074006100790061007A007500*6B006500730069006A00610076006F0062006F00680069007300610020006200*690079006F0068006F007800750063006F006A0061006E0075006B0061007A00*610068006100760069007700650078006500700065006E0069*76656B697675")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.GandCrypt.aip"));//.fbz
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x7444E  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x74200)
	{
		if (CheckSigInBuffer(0xCA84, 0x13C,_T("7B00310031003100310031002D00320032003200320032002D003500*30003000300031002D00300030003000300032007D*5768617473617070*2461363830653565362D613037632D346634622D383630302D623830313566366632383838")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Gen.hqo"));//.fbz
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x4 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x4720A  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200)
	{
		if (CheckSigInBuffer(0xB2E5, 0x8B,_T("5363686F6F6C5F50726F6A6563742E50726F70657274696573*2462646663396631362D356463662D346130362D*396430612D663437333835323439376336")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Crusis.bwm"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0xB47  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6A00)
	{
		if (CheckSigInBuffer(0x6FD0, 0xC0,_T("626F647520676F72656B6F736F72656375736F7475626174617269*6B69796120686176697875726966697A6120*6B69787568696B6174697075636178656765636176617075*6B757A756B616B7570696B696B756D756A616775626F*6C6167696A6F6E6176616A69676F7975706F72696475206B6166657261*20686F646F6D6166656D69726F6369646172656A6178756C61")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.nzc"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x453E  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15000)
	{
		if (CheckSigInBuffer(0x178A0, 0x90,_T("72756B756C7572617A6170756E65*4465206B756365646F6C617065647520626F6A697265686562657461*206A65646172612067756C75796F6461776F6875")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.Mokes.xbp"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x2 && m_dwAEPMapped == 0x0000 && m_dwAEPMapped == m_dwAEPUnmapped  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xFAD000)
	{
		if (CheckSigInBuffer(0xFEF4B0, 0x191,_T("41006E006E006100620065006C006C0065*32002E0031002E0030002E0030*41006E006E006100620065006C006C0065002E006500780065*5500700064006100740065004200610063006B00750070")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Deshacop.giu"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x3D8CDA  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3D8C00)
	{
		if (CheckSigInBuffer(0x3D8B84, 0x500,_T("443A5C5374616C696E5C5374616C696E53637265616D65725C*5374616C696E53637265616D65725C6F626A5C52656C656173655C*5374616C696E4C6F636B65722E706462*5300740061006C0069006E00530063007200650061006D00650072*31002E0030002E0030002E00300000*5300740061006C0069006E004C006F0063006B00650072002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Blocker.lacf"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x14F0  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1800)
	{
		if (CheckSigInBuffer(0x1F68, 0x68,_T("5B005300650070007300690073004000*700072006F0074006F006E006D00610069006C002E0063006F006D005D*002E005300450050005300490053")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Reconyc.iwkk"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x6 && m_dwAEPMapped == 0x3FF0  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8400)

	{
		if (CheckSigInBuffer(0xEC88, 0x88,_T("48005400540050002F0031002E0031*47616E644372616247616E64437261626E6F6D6F726572616E736F6D2E*636F696E6F6D6F726572616E736F6D2E626974")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.GandCrab.C"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x43BE  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14E00)

	{
		if (CheckSigInBuffer(0x176B7, 0xE8,_T("440065002000770065006C0069006C0065006200610078007500700065007700*750072006900780061007A006F006E0061006E006F002000740061006C006500*6600650062007500680061006600750063006100790065002000700065006300*61007800750062006F0066006F007300650072006F0067006100740069006400*690066006500200076006900630065007A0061006B006F0077007500*6B00650077006F00660065006A0061007600650068006500620061006A006900670069")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.GandCrypt.asl"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0xE440  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF600)

	{
		if (CheckSigInBuffer(0x941C, 0x2FE,_T("47416531312E653131*3B75EC7D088B4DFC8A0C31EB0233C9463B75EC7C0233F60208004DF3*8A0833DB8A5DF38A9C1DEAFEFFFF881833DB8A5DF3888C1DEAFEFFFF404A75C4*8B5DF88A1C1381E1FF000000329C0DEAFEFFFF8B4DF8881C11424875A2*6809A3400064FF30648920FF05045541")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Snocry.daj"));
			return VIRUS_FILE_DELETE;
		}
	}


	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x6 && m_dwAEPMapped == 0x1551  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xD800)

	{
		if (CheckSigInBuffer(0x54B, 0x80,_T("85EDB82037EFC68BCF0F44F0C1E905030D1C8641008BC7C1E004030518864100*C1E905030D14864100C1E00403051086410033C88D041E33C82BF22BF94583FD20")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.GandCrypt.apz"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x683D  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C800)
	{
		if (CheckSigInBuffer(0xFFB0, 0x3E8,_T("81C76505000033C4C7050E884200314F4B25891D5083420087C0C705F8844200564F9F01*812D2185420000CCA12D81EEB4D6542A81C6B4D6542A*C70572824200643D5A2B812FC0934DA4*C70500844200D83ED414C1C8144A42C1C014813545874200EEEA2910C1C00B*81EE20A9FA02F7D64033F0C1C2198137C0934DA481358486420000A4BA1F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Gen.fso"));
			return VIRUS_FILE_DELETE;
		}
	}

	if(m_wAEPSec == 0x2 && m_dwAEPMapped == 0x0A00 && (memcmp(m_pSectionHeader[2].Name, "infinite", 8) == 0) && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x0800)
	{
		if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData - 0x200, 0x44,_T("57696E33322E496E66696E697465*0053697A652031363939202D205669727475616C20323432390A*28632920323030302042696C6C792042656C636562752F694B58")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Infinite.1661"));
			return VIRUS_FILE_DELETE;
		}
	}
	
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x04 && m_dwAEPUnmapped == 0x002d67f9 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0034e200)
	{ 
		if(CheckSigInBuffer(0x360870, 0x200,_T("55006200610065007700650072006C00750069007400650020006100740075006300640065006C0069006F0068007000650020006500720065006C0073006F006F00670065006200690063006F007200200000*4F0072006900670069006E0061006C00460069006C0065006E0061006D00650000006D0065006F00730065007300770065006100730065006D002E0065007800650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Downloader.Win32.Snojan.fgwb"));
			return VIRUS_FILE_DELETE;
		}
	}

	/*
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && m_dwAEPUnmapped == 0xaa98 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa200)
	{
		DWORD dwOvStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData;
		if(CheckSigInBuffer(dwOvStart, 0x250,_T("DCCE2FC1ECEB0057294E0916762F91351F2D3783453159B556BF962B0E47636D*474E107321663654CDFBECD4786F2AE451C8B5605C726638956EBE8DD65E63D4*5C6E246B5181D1436A34B9")))//Decryption loop
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Clicker.MSIL.Agent.cngj"));
			return VIRUS_FILE_DELETE;
		}
	}
	*/
	//Mukesh : 13 Jul 2018
	if((m_wAEPSec == 0x0 || m_wAEPSec == 0x4) && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5)&& (m_dwAEPMapped == 0x255F || m_dwAEPMapped == 0xB3F7E || m_dwAEPMapped == 0x10E000) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xB3E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18A00 ))
	{ 
		if(CheckSigInBuffer(0x180E0, 0x50,_T("89D88A0B8B3D00206E1D2B45E08D14302355D0020C1789F7BA8BE609B529C789*F8F7E2C1EA07884DEB69C2B5000000F7D88A8407BC247C1D0245EB8803433B5DDC0F82B9FFFFFF")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.RAZY.296399"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 13 Jul 2018
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x110C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10000)
	{ 
		if(CheckSigInBuffer(0x7790, 0x1A0,_T("56423521F01F2A*54657874436F6E76004465616C61686F796100004465616C61686F796100")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VB.DMQP"));
			return VIRUS_FILE_DELETE;
		}
	}
	//Mukesh : 13 Jul 2018
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x7 && m_dwAEPMapped == 0x2A1C2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x70A00 )
	{ 
		if(CheckSigInBuffer(0x6A060, 0x44,_T("89F08B157C801A3189FB2B45E48D0C3829C3234DD489D8C1E803*0FB60C0ABABD86F21AF7E2D1EA69C298000000320E29C3*328C1B08A02831BBBD86F21A880E463B75E0")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.RAZY.251271"));
			return VIRUS_FILE_DELETE;
		}
	}
	//Mukesh : 17 Jul 2018
	if((m_wAEPSec == 0x0 || m_wAEPSec == 0x4) && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5)&& (m_dwAEPMapped == 0x298F || m_dwAEPMapped == 0x11B600) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18400 ))
	{ 
		if(CheckSigInBuffer(0x17850, 0x50,_T("89C62B75E88A0885D2893500BE8F100F850F0000000375D48B1D002080102375*D8320C330FB6C98A890C618F108B1D00*BE8F1001FB00CB8818403B45E40F82BDFFFFFF")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.razy.359339"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 17 Jul 2018
	if( m_wNoOfSections == 0x03   && m_dwAEPMapped == 0xA08E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		DWORD ExeNameByteOffset = 0x7AF3;
		const int IGRH_BUFF_SIZE = 0x185;

		if (m_pbyBuff)
		{
			delete []m_pbyBuff; 
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[IGRH_BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		const BYTE byChkExeName[] = {0x63,0x00,0x72,0x00,0x61,0x00,0x6D,0x00,0x62,0x00,0x6F,0x00,0x2E,0x00,0x65,0x00,0x78,0x00,0x65};
		if(GetBuffer(ExeNameByteOffset, 0x13, 0x13))
		{
			if(memcmp(m_pbyBuff, byChkExeName, sizeof(byChkExeName))== 0)
			{
				{	
					if (CheckSigInBuffer(0x7CD8 , 0x185,_T("68007400740070003A002F002F007300760063002D00730074006100740073002E006C0069006E006B007500720079*002E0063006F006D002F00530074006100740065005300740061007400690073007400690063*00730053006500720076006900630065002E007300760063002F*680074007400700073003A002F002F0067006F007300650072007600650072007500700064006100740065002E0062006C006F0062002E0063006F00720065002E00770069006E0064006F00770073002E006E0065007400*2F007800740063002D0064006100740061002F0064006F00690074002E006500780065")))
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:WebToolbar.Win32.Linkury.aqy"));
						return VIRUS_FILE_DELETE;
					}//0x9DD3
				}
			}
		}
	}

	//Sneha Kurade : 17 Jul 2018
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && (m_dwAEPMapped >= 0x5C42 && m_dwAEPMapped <= 0x243C6A) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x5C00/*0xADC00*/ && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x243C00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x50;


		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped- 0x8A,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMSILChk[] = {0x43, 0x3A, 0x5C, 0x46, 0x72, 0x69, 0x64, 0x61, 0x79, 0x4D, 0x6F, 0x72, 0x6E, 0x69, 0x6E, 0x67, 0x5C};//C://Friday

			for(int i =0;i<0x100; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMSILChk,sizeof(byMSILChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				DWORD dwStartBuff = 0x00;

				if(m_dwAEPMapped == 0xB5192 || m_dwAEPMapped == 0xB7192)
				{
					dwStartBuff = 0xC9E;
				}
				else 
				{
					dwStartBuff = 0xC80;
				}

				if (CheckSigInBuffer(dwStartBuff,0x44C,_T("476574537472696E6700*726568726A74796A74796A*447A643434647A*65666566657A667A657A")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Agent.gen"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}  

	//Sneha Kurade : 17 Jul 2018
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 && (m_dwAEPMapped >= 0x160E && m_dwAEPMapped <= 0x243D86) &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x1600/*0xADC00*/ && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x243C00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x50;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped- 0xA2,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMSILChk[] = {0x43, 0x3A, 0x5C, 0x55, 0x73, 0x65, 0x72, 0x73, 0x5C, 0x57, 0x69, 0x7A, 0x7A, 0x6C, 0x61, 0x62, 0x73, 0x5C};//,0x57,0x56};

			for(int i =0;i<0x100; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMSILChk,sizeof(byMSILChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(0xA00/*dwStartBuff*/,0x3E8,_T("747972727479653738727468377274683765*666566657A66657A667A65*476574537472696E67*646973706F73696E67*726568726A74796A74796A")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Agent.gen1"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	//Sneha Kurade : 19 Jul 2018
	if(m_wAEPSec == 0x0 && m_pMaxPEFile->m_bIsVBFile == true && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x3670 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B000 )
	{
		if (CheckSigInBuffer(0x3F04,0xAC,_T("D441400001F830*5C3F4000DC4040007C364000780000007C*57696E0057696E000057696E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Swisyn.BNER"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Mukesh : 19 Jul 2018
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x1274 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2F000)
	{ 
		if(CheckSigInBuffer(0x944C, 0x6B,_T("62007000730031002E0065007800650000*620068006F006F006B0070006C002E0064006C006C0000*56004E00430048006F006F006B0073002E0064006C006C0000*78007200340074006400770061002E0065007800650000")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Llac.LLZL"));
			return VIRUS_FILE_DELETE;
		}
	}
	
	//Gaurav : 19 Jul 2018 : Customer Issue
	if(memcmp(m_pSectionHeader[0x03].Name, ".AESeal", 7) == 0 && m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 && (m_dwAEPMapped == 0x24240 || m_dwAEPMapped == 0x0167a8) && m_pSectionHeader[0x03].SizeOfRawData == 0x1A00 )
	{ 
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x03].PointerToRawData + 0xF00, m_pMaxPEFile->m_stSectionHeader[0x03].SizeOfRawData - 0x200,_T("6D79717569636B636F6E7665727465722E636F6D*7061636B616765696E7472616E7369742E636F6D*747261636B796F75727061636B616765732E636F*656D61696C6163636573736F6E6C696E652E636F6D*737072696E6764776E6C64322E636F")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.StartPage.esqohz"));//websites and section name
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 19 Jul 2018 : Customer Issue
	if(memcmp(m_pSectionHeader[0x01].Name, ".my_dat0", 7) == 0 && m_wAEPSec == 0x0 && m_wNoOfSections == 0x07 && m_dwAEPMapped == 0x46B0 && m_pSectionHeader[0x01].SizeOfRawData == 0x200 )
	{ 
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData,0x100,_T("558BEC83EC286A00FF1540414100C745F800000000C745D801000000C745DC02*41410050FF150040410085C074196A4068003000008B0DC4D74100516A00FF15*FF83C410C745E801000000C745F000000000C745F400000000EB098B45F483C0*45FC02000000EB098B55FC83C2038955FC8B45FC3B05C4D7410073168B4DF803*4DFC0FB61183F21E8B45F80345FC8810EBD68B")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.StartSurf.bqto"));//Decryption loop
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 26 Jul 2018 : Virus Patch 94
	if((m_wAEPSec == 0x00 || m_wAEPSec == 0x04) &&( m_wNoOfSections == 0x04 ||m_wNoOfSections == 0x05) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x71C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2AA00 ))
	{
		if (CheckSigInBuffer(0x082D0C,0x01F,_T("7374726174756D2B7463703A2F2F*00002E6E696365686173682E636F6D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:RiskTool.BitMiner.gen"));
			return VIRUS_FILE_DELETE;
		}
	}  

	//Mukesh : 26 Jul 2018 : Virus Patch 94
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x40BC6 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x77E00)
	{ 
		if(CheckSigInBuffer(0x6F600, 0x45,_T("89D88A0B8B150060A51D2B45E48D34382375D4020C3289FEBA95204F0929C689*F0C1E802F7E2D1EA69C2DC000000F7D88A8406205CB61D00C88803*433B5DE00F82BBFFFFFF")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.razy.256375"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 26 Jul 2018 : Virus Patch 94
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x1BE59 && m_dwAEPMapped == m_dwAEPUnmapped && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25000)
	{
		if (CheckSigInBuffer(0x2F6C0,0x3D0,_T("49454761746F722E696E66*49454761746F722E646C6C*6761746F7220636F72706F726174696F6E*6761746F722E636F6D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not a virus:Adware.Gator.fg"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 26 Jul 2018 : Virus Patch 94
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x13B2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3800)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x50;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[m_wNoOfSections - 0x2].PointerToRawData + 0x9B0,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byDapatoChk[] = {0x63, 0x3F, 0x6E, 0x77, 0x3C, 0x67, 0x68, 0x54, 0xA0, 0x0F, 0x39, 0x34, 0xE6, 0x32, 0x33, 0x06, 0xEC, 0x37, 0xCF, 0x08, 0x30, 0x33};//C://Friday

			for(int i =0;i<0x50; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byDapatoChk,sizeof(byDapatoChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(0x580,0x110,_T("476C6F62616C5C41746F6D46756E*476C6F62616C5C7B33443541313639342D434332432D34656537*2D413344352D4138373941394533413632417D")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dapato.EGDG"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	//Sneha : 26 Jul 2018 : Virus Patch 94
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x2DD60 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2DC00)
	{
		if (CheckSigInBuffer(0x3110,0x120,_T("83EC40A1E82D4300535683F838*A3042E4300A1F82D43008B3D142E43008B35182E4300*C705402E430038274300C705402E430040274300C705402E430048274300*BB3B000000BEDF05000033D283FBD5*D3E3C705402E430058274300C705402E4300602743004E75D983FBDB")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.W32.TYPN"));
			return VIRUS_FILE_DELETE;
		}
	}	

	//Gaurav : 26 Jul 2018 : Virus Patch 94
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x8 && m_dwAEPMapped == 0x062F34 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x62C00 )
	{ 
		if(CheckSigInBuffer(0xFC3B0,0x40,_T("687474703A2F2F7777772E6E65746D*6173746572736C6C632E636F6D")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Spy.MSIL.Omaneat.awa"));//http://www.netmastersllc.com
			return VIRUS_FILE_DELETE;// Samples found in Downloader.NSIS.Gen Samples
		}
	}

	//Swapnil : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x05 && (m_dwAEPMapped == 0x1746F || m_dwAEPMapped == 0x1745F || m_dwAEPMapped == 0x15E6F || m_dwAEPMapped == 0x169CF ) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x26E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x26200 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		DWORD dwOverLayStart = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].VirtualAddress;
		DWORD dwOverLaySize = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x4].Size;
		DWORD dwSignOffset;
		if (dwOverLaySize == 0x2C10)
		{
			if (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25400)
			{
				dwSignOffset = 0x2B904;
			}
			else if (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x26E00)
			{
				dwSignOffset = 0x2D3A4;
			}
			else
			{
				dwSignOffset = 0x2C784;
			}
			if(CheckSigInBuffer(dwSignOffset, 0x150,_T("65006C0065006D0065006E0074007300620072006F007700730065*0072002E0065007800650000*65006C0065006D0065006E007400730062007200*6F0077007300650072007500700064006100740065*00620072006F00770073006500720075007000640061007400650074007200690067006700650072*45006C0065006D0065006E0074007300420072006F007700730065007200200055007000640061007400650000")))//*68747470733A2F2F6170692E656C656D656E747362726F777365722E636F6D")))//*2F636F6E6669672F7374617274706167653F"))) 
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:Downloader.Win32.Elemental.gen"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	//Swapnil : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x05 && (m_dwAEPMapped == 0x1118C || m_dwAEPMapped == 0x111FC) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22200 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if(CheckSigInBuffer(0x28658, 0x150,_T("680074007400700073003A002F002F006100700069002E006500*6C0065006D0065006E0074007300620072006F0077007300650072002E0063006F006D0000*6D0069006E0069005F0069006E00730074006100*6D0069006E0069005F0069006E007300740061006C00*6C00650072002E0065007800650000*65006C0065006D0065006E007400730062007200*6F00770073006500720075007000640061007400650000*45006C0065006D0065006E0074007300420072006F0077007300650072*00200055007000640061007400650000"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:Downloader.Win32.Elemental.gen1"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 01 Aug 2018 : Virus Patch 95
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 &&(m_dwAEPMapped == 0x166A || m_dwAEPMapped == 0x226A)&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000))
	{ 
		if(CheckSigInBuffer(0x5765, 0xC82,_T("8B85F0FEFFFF83C0018985F0FEFFFF81BDF0FEFFFF000100007D258B45F899F7*7D108B8DF0FEFFFF8B450C8A141088940DF4FEFFFF8B45F883C0018945F8EBC0")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Inject.bbyo"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 01 Aug 2018 : Virus Patch 95
	/*
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x8 && (m_dwAEPMapped == 0x9040 || m_dwAEPMapped == 0x99F8 || m_dwAEPMapped == 0x8E58 || m_dwAEPMapped == 0x8E54) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E00))
	{ 
		if(CheckSigInBuffer(0x68B4, 0x40C,_T("8BC6BA08000000A8017409D1E8352083B8EDEB02D1*E84A75EE89014683C10481FE0001000075D9")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.installcore.fe"));
			return VIRUS_FILE_DELETE;
		}
	}
	*/

	//Aniket : 01 Aug 2018 : Virus Patch 95
	if(m_wAEPSec == 0x0 && (memcmp(m_pSectionHeader[m_wNoOfSections -2].Name, ".u", 2) == 0) && m_wNoOfSections == 0x0005 && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL )
	{
		if (CheckSigInBuffer(0x059A8,0x035,_T("8D8564FFFFFF8B8D50FFFFFF668B5586*6689C66609F266899564FFFFFF8B851C*FFFFFF034594668B55866681CAE82466")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Hupigon.tipv"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 01 Aug 2018 : Virus Patch 95
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x3 && (m_dwAEPMapped == 0x0bde9 || m_dwAEPMapped == 0x0c9e9) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5c000 )
	{ 
		if(CheckSigInBuffer(0x01D160,0xC90,_T("312E3233342E38332E313436*3133332E3234322E3132392E313535*5F75696E7365792E626174006F70656E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Plite.buhz"));//PE Compact//1.234.83.146....133.242.129.155//_uinsey.bat.open
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Krade : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x04 && (m_dwAEPMapped == 0x9ADD5) && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBA000)
	{
		if (CheckSigInBuffer(0xBF2B2,0x58D,_T("5C636F70792E646174*636F70792E646174*3138302E3130312E37352E3538*7777772E657A64756E2E636F6D*4C6561677565206F66204C6567656E64732E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.graftor.373521"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Krade : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x06 && (m_dwAEPMapped == 0x9064 || m_dwAEPMapped == 0x8E64) && m_wAEPSec == 0x04 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xE00))
	{
		if (CheckSigInBuffer(0x7B90,0x3E8,_T("5C004400650076006900630065005C004300740072006C0053004D*5C0044006F00730044006500760069006300650073*005C004300740072006C0053004D*5C00730065007200760069006300650073005C0065007000660077007700660070")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("NetTool.Win64.NetFilter.k"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Krade : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x05 && (m_dwAEPMapped >=0x1EB2F0 && m_dwAEPMapped <= 0x2F50C1) && m_wAEPSec == 0x01 && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x126000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x1B2000) && 
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".UPX", 4) == 0 || memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX", 3) == 0)&&
		(memcmp(m_pSectionHeader[m_wAEPSec+3].Name, ".UPX", 4) == 0 || memcmp(m_pSectionHeader[m_wAEPSec+3].Name, "UPX", 3) == 0))
	{
		if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec+2].PointerToRawData,m_pSectionHeader[m_wAEPSec+2].SizeOfRawData,_T("770077002E00*350032006400660067002E0063006F006D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.Blackv.gen"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Krade : 01 Aug 2018 : Virus Patch 95
	if(m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x22A076 && m_wAEPSec == 0x01 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x132000 &&
		memcmp(m_pSectionHeader[m_wAEPSec].Name, ".sedata", 4) == 0 && memcmp(m_pSectionHeader[m_wAEPSec+3].Name, ".sedata", 4) == 0)
	{
		if (CheckSigInBuffer(0xB7950,0xA00,_T("7918EB0A980A98FF0AE82B42A125B5DC2FC4D156C4A35EBE41CB5B3ECD25*47B25D3FB72742B1512A45F4E7*3D44B75732BE2C4BC62D0F9601C0833A*3958AB7D43CA583FCA25E76FFF9A6999")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.Blackv.gen1"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 13 Aug 2018 : Virus Patch 96
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x22114 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x29200 && m_dwAEPUnmapped == 0x22D14)
	{
		if (CheckSigInBuffer(0x031744,0x050,_T("537430726D0000005B536F74726D2042*6F74204279204F7A5D0000006E657665*7261736B0000000032332E6733772E6F*7267000023736B79626F792E31323334*000000004E53746F726D322E65786500")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.Rbot.AEU"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 13 Aug 2018 : Virus Patch 96
	if((m_wNoOfSections == 0x04 || m_wNoOfSections == 0x08) && (m_dwAEPMapped == 0x7CAF8 || m_dwAEPMapped == 0x7CCF8) && m_wAEPSec == 0x00 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9EA00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7CA00))
	{
		DWORD dwStartBuff = 0x00;
		if(m_wNoOfSections == 0x04)
		{
		  dwStartBuff = 0x7AFA4;
		}
		else
		{
		  dwStartBuff = 0x7B1A4;
		}

		if (CheckSigInBuffer(dwStartBuff,0x12B4,_T("706170692E646D70*636F6D63746C3231*4172636869766520697320636F72727570746564")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Banload.BAEH"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 13 Aug 2018 : Virus Patch 96
	if(m_wNoOfSections == 0x09 && (m_dwAEPMapped == 0x13EC || m_dwAEPMapped == 0x1428) && m_wAEPSec == 0x00 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B2000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2f7200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2AFC00))
	{
		if (CheckSigInBuffer(m_pSectionHeader[0x1].PointerToRawData,m_pSectionHeader[0x1].SizeOfRawData,_T("4D656469614D61676E6574*687474703A2F2F666173746C6F61646D656469612E72752F6C696273*2F746573742F6B6F74696B692E7A6970*70726F6772616D66696C657328783836297D5A617861725C5C*5A6178617247616D6542726F777365722E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.graftor.311803"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 13 Aug 2018 : Virus Patch 96
	if(m_wNoOfSections == 0x08 && (m_dwAEPMapped == 0x18E92C) && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18EC00)
	{
		if (CheckSigInBuffer(0x531F0,0xE0,_T("4D757465784E50415F556E697456657273696F6E696E67*53686D4E50415F556E697456657273696F6E696E67")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.graftor.429489"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 13 Aug 2018 : Virus Patch 96
	//if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x08 || m_wNoOfSections == 0x03) && ((m_dwAEPMapped & 0xFF000) == 0xBC000  || (m_dwAEPMapped & 0xFF000) == 0xBD000 || m_dwAEPMapped == 0x255A2 || m_dwAEPMapped == 0xca264) &&
	//	((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF000)== 0xE1000 || (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF000)== 0xE2000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF0800)&& 
	//	((m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x130000 || (m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x140000 || (m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x150000) || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x0000)
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x08 || m_wNoOfSections == 0x03) && ((m_dwAEPMapped & 0xFF000) == 0xBC000  || (m_dwAEPMapped & 0xFF000) == 0xBD000 || m_dwAEPMapped == 0x255A2 || m_dwAEPMapped == 0xca264 || m_dwAEPMapped == 0xca0c4) &&
		((m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF000)== 0xE1000 || (m_pSectionHeader[m_wAEPSec].SizeOfRawData & 0xFF000)== 0xE2000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x35000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF0800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF0600)&& 
		((m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x130000 || (m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x140000 || (m_pMaxPEFile->m_stPEHeader.CheckSum & 0xFF0000) == 0x150000) || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x0000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x20;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byGraftorChk[] = {0xE8, 0x5E, 0x03, 0x00, 0x00, 0xC6};
			BYTE	byGraftorChk1[] = {0xE8, 0x7E, 0x03, 0x00, 0x00, 0xC6};
			BYTE	byGofot[] = {0x85, 0xDB, 0x75, 0x03, 0x33, 0xC0};
			BYTE	byVBDMQP[] = {0x86, 0x00, 0x01, 0x00, 0x04, 0x02, 0x00, 0x80};// ADDED

			BYTE	byGofot1[] = {0xE8, 0x6B, 0x04, 0x00, 0x00,0xC6,0x05,0x28};

			for(int i =0;i<0x20; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byGraftorChk,sizeof(byGraftorChk)) == 0) ||
					(memcmp(&m_pbyBuff[i],&byGraftorChk1,sizeof(byGraftorChk1)) == 0) ||
					(memcmp(&m_pbyBuff[i],&byGofot,sizeof(byGofot)) == 0) ||
					(memcmp(&m_pbyBuff[i],&byVBDMQP,sizeof(byVBDMQP)) == 0) || (memcmp(&m_pbyBuff[i],&byGofot1,sizeof(byGofot1)) == 0))//added
				{
					bCheck =  true;

				}

			}
			if(bCheck)
			{
				DWORD dwOverlaySize = 0x00;
				dwOverlaySize = m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData);
				if(dwOverlaySize > m_pMaxPEFile->m_dwFileSize)
				{
					if(m_wNoOfSections == 0x08)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("CORRUPT:Trojan.graftor.449611"));
					}
					else
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("CORRUPT:Trojan.Gofot.ges"));
					}
					if(m_dwAEPMapped == 0xca264)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.generickd.40794731"));
					}
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
    

	//Gaurav : 23 Aug 2018 : Virus Patch 98
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x3e721 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6a400 )
	{ 
		if(CheckSigInBuffer(0x6DC70 ,0x40,_T("60706C6163656D656E742064656C65746520636C6F7375726527*6F6D6E692063616C6C736967*64656C6574655B5D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.Win32.Application.Agent.06WV6T"));//Name taken from virustotal(GData)
			return VIRUS_FILE_DELETE;
		}
		//omni callsig//
	}

	//Mukesh : 23 Aug 2018 : Virus Patch 98
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x29A4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2800)
	{ 
		if(CheckSigInBuffer(0x3448, 0x1AB,_T("555342536572766572733332*25735365727665723332486973746F72792E646174*257374747462726F7A7A7A2E626174")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Ransom.Blocker.cgth"));
			return VIRUS_FILE_DELETE;
		}
	}
    
	//Gaurav : 23 Aug 2018 : Virus Patch 98
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && (m_dwAEPMapped >= 0x0a2C00 || m_dwAEPMapped <= 0x0a2D00) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa6000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0a7000))
	{ 
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x02].PointerToRawData + 0x01F000 ,0x1000,_T("2B687474703A2F2F777777*2E7669636D616E2E6E6574")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Ekstak.a"));//Website
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 23 Aug 2018 : Virus Patch 98
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x5 && m_dwAEPMapped == 0x74dc1 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa2200 )
	{ 
		if(CheckSigInBuffer(0xB2650 ,0xC0,_T("2E00200041006C006C002000770061*6700650072006F007500730020006600610075*200079006F00750072002000610074007400610063006B00*700072006F007400720061006300740065006400")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GenericKD.40384219"));
			return VIRUS_FILE_DELETE;
		}
		//. .A.l.l. .w.a.....g.e.r.o.u.s. .f.a.u..... .y.o.u.r. .a.t.t.a.c.k.s...g. .d.a.m.a.g.e. .o.n. .t... .p.r.o.t.r.a.c.t.e.d.,. .t.....o.m.b.a.t.a.n.t.....u	
	}

	/*
	//REMOVED : Virus Total False (+)ve
	//Mukesh : 23 Aug 2018 : Virus Patch 98
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x02 && m_dwAEPMapped == 0x1376 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].PointerToRawData)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		int		BUFF_SIZE = 0x60;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byDapatoChk[] = {0x55, 0x8B, 0xEC, 0x83, 0xEC, 0x0C, 0x53, 0x56, 0x57};

			for(int i =0;i<0x50; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byDapatoChk,sizeof(byDapatoChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(0x136C,0x60,_T("776233322E706462*8D45F45068EC1240006A0453682C124000895DF4")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Trojan.heur.jp.ai0@agez5uki"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	*/
	//Sneha : 23 Aug 2018 : Virus Patch 98
	if(m_wNoOfSections == 0x08 && m_dwAEPMapped == 0x55864 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x55600)
	{
		if (CheckSigInBuffer(0x552B4,0x16C,_T("6720206A202E20206920206E202069*206D20202E20206920206E202069*52454359434C45525C532D312D352D31385C4463385C*73706F6F6C5C445249564552535C5733325838365C335C*79202063202E202062202061202074")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Gofot.cnq"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 23 Aug 2018 : Virus Patch 98
	if(m_wNoOfSections == 0x08 && m_dwAEPMapped == 0xC905C && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC8E00)
	{
		if (CheckSigInBuffer(0xC3020,0xB30,_T("687474703A2F2F7777772E64746F70746F6F6C2E636F6D*2F7064732F6C61756E636865722F5253532E747874*687474703A2F2F7777772E64746F70746F6F6C2E636F6D*2F7064732F6C61756E636865722F4154492E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.graftor.elzob.12617"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 23 Aug 2018 : Virus Patch 98
	if(m_wNoOfSections == 0x02 && m_dwAEPMapped == 0x8DEA && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x36000 &&
		memcmp(m_pSectionHeader[m_wAEPSec].Name, "drws0", 5) == 0 && memcmp(m_pSectionHeader[m_wNoOfSections-1].Name, ".imp", 4) == 0)
	{
		if (CheckSigInBuffer(0x1A000,0x1650,_T("6C0075004D006F0067006A006300650063004D0079*6E007A0062007100630078004D0063006E*433A5C61663332643362305C62363632656634392E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Gen"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 31 Aug 2018 : Virus Patch 99
	if ((m_wAEPSec == 0x00 || m_wAEPSec == 0x01) && (m_wNoOfSections == 0x3 || m_wNoOfSections == 0x5 || m_wNoOfSections == 0x6) && (m_dwAEPMapped == 0x59CC5 || m_dwAEPMapped == 0x1B6E00) && 
	   (m_pSectionHeader[0].SizeOfRawData == 0x93000 || m_pSectionHeader[0].SizeOfRawData == 0x2AA00)) 
	{
		if(CheckSigInBuffer(0xA3AB4,0x30C,_T("2500610070007000640061007400610025005C005200410043005C00*730076006300730063002E006500780065002E0063006F006E006600690067*68007400740070003A002F002F007700780061006E0061006C00790074006900630073*002E00720075002F006E00650074002E006500780065002E0063006F006E006600690067*2500610070007000640061007400610025005C00*5200410043005C006D006C0073002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.ifdx"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 31 Aug 2018 : Virus Patch 99
	if(m_wNoOfSections == 0x06 && m_dwAEPMapped == 0x5E1D && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000)
	{
		if (CheckSigInBuffer(0x1D70,0x90,_T("687D160000BADC864000FFD283C404*8B45FC69C06A04010099B935820000*8B55FC8A80C88640008882C8864000*8A91C886400083FA22*8A88C886400083C1018B55FC888AC88640008B45FC83C0018945FC817DFCFE05")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Gen:Variant.Zbot.161"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 31 Aug 2018 : Virus Patch 99
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x102E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1200)
	{ 
		if(CheckSigInBuffer(0x1138, 0x53,_T("8B4508408BCF99F7F98A1C328955088D04328945F40FB6C30345F899F7F98B45*F48955F88D0C328A143288108B55FC88198B4D0C0FB60003CA0FB6D303C28BDF*99F7FB8A04323001FF45FC8B45FC3B45107CAD")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.razy.4419"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 31 Aug 2018 : Virus Patch 99
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x2419B && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x24000)
	{ 
		if(CheckSigInBuffer(0x28738, 0x99,_T("433A5C77696E646F77735C73797374656D5C2573*5768617460732074686520706F696E742021*59656170202C2069606D206120626164206D6F74686572206675636B65722021")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.antno"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 31 Aug 2018 : Virus Patch 99
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0xA2025 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xB1A00)
	{ 
		if(CheckSigInBuffer(0xDD0, 0x48,_T("7B45354438414346462D364539382D343838322D413939412D4543434146424538343438437D*2A31393437616238643061323762356361656338303662393838663065653264612A")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Salgorea.c"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 31 Aug 2018 : Virus Patch 99
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x005 &&  m_dwAEPMapped == 0x10916 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22600 && m_dwAEPUnmapped == 0x11516)
	{
		if (CheckSigInBuffer(0x026128,0x0250,_T("7B30333030373439352D303962622D3433*33342D393837612D6165373538366263*613032347D2D39613332316263373863*42003C7942000000000000000000020000004C794200587942")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Agent2.mml"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Aniket : 31 Aug 2018 : Virus Patch 99
	if((m_wAEPSec == 0x04 && m_wNoOfSections == 0x005 &&  m_dwAEPMapped == 0x10600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200 && m_dwAEPUnmapped == 0x32000) && (memcmp(m_pSectionHeader[m_wAEPSec].Name, ".ajelhf", 7) == 0))
	{
		if (CheckSigInBuffer(0x10897,0x053,_T("2D443B2C39263B3D3A*5050505050005B5A5B5A5B*5A5B585B5800EA0000002A")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.Padodor.gen"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Aniket : 10 Sep 2018 : Virus Patch 3.00
	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05) && m_dwAEPMapped == 0x549A && m_pSectionHeader[0x0].PointerToRawData == 0x0400 && (m_pSectionHeader[0x0].SizeOfRawData == 0x8200 || m_pSectionHeader[0x0].SizeOfRawData == 0x5400) )
	{
 		if (CheckSigInBuffer( 0x064AC ,0x20CA,_T("25735C4D2D353035303435303838343838*3739383736303132303530343036303330*433A5C55736572735C735C4465736B746F705C486F6D655C436F64655C5472696B2076322E355C52656C656173655C5472696B2E706462*77696E6D67722E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.IRCbot.aino")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 10 Sep 2018 : Virus Patch 3.00
	if(m_wAEPSec == 0x4  && m_wNoOfSections == 0x6 && m_dwAEPMapped == 0xBA9A && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11E00 )
	{ 
		if(CheckSigInBuffer(0x12400, 0x3B,_T("5A54AB53EAFA0000E0C40100C550010090D4010002780100E7630100AB4A0200*E4150100DF7802002903010074B4080006AA010068080200731F09")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.iftf"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 10 Sep 2018 : Virus Patch 3.00
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x45CF0 && m_wAEPSec == 0x03 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x41200 && memcmp(m_pSectionHeader[m_wAEPSec].Name, ".text", 5) == 0)
	{
		if (CheckSigInBuffer(0x45A30,0xB0,_T("5F5B5E8BE55DC2140033FF8B5514E91B000000*8B0133022B020302890683C204478BC72B4518*0F8502000000EBDB83C10483C6044B75*558BEC83EC046A006A006A006A006A00")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Gen:Variant.Symmi.19582"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 10 Sep 2018 : Virus Patch 3.00
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x0B55 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8A00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL )
	{
		if (CheckSigInBuffer(0xB200,0x50,_T("646C6C5F646F776E5F657865632E646C6C*5F666E646F74403136")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Generic.KDV.828546"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 10 Sep 2018 : Virus Patch 3.00
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x0B55 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8A00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL )
	{
		if (CheckSigInBuffer(0xB200,0x50,_T("646C6C5F646F776E5F657865632E646C6C*5F666E646F74403136")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Generic.KDV.828546"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 10 Sep 2018 : Virus Patch 3.00
	if (m_wNoOfSections == 0x4 && m_dwAEPMapped == 0xA067 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x52000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0xA4000)
	{
		if(CheckSigInBuffer(0x1DD84, 0x66,_T("4800470044007200610077002E0064006C006C0000*0000002E0065007800650000000000*3100320031002E00380038002E0035002E003100380033*3200310038002E00350034002E00330030002E003200330035"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.Plite.bhus"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 25 Sep 2018 : Virus Patch 3.01
	if (m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x1000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x3108)
	{
		if(CheckSigInBuffer(0x1FAF, 0x1789,_T("8B4508408BCF99F7F98A1C328955088D*04328945F40FB6C30345F899F7F98B45F4*726F7564616E782E65786500737A46696C65"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Inject.AACEH"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 25 Sep 2018 : Virus Patch 3.01
	if ((m_wNoOfSections == 0x0006) && (m_dwAEPMapped == m_dwAEPUnmapped) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_pSectionHeader[0x0].SizeOfRawData == 0x26000)
	{
		if(CheckSigInBuffer(0x277A4, 0x2C,_T("6A7573636865642E*6577393F776476314175505800"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.FIH"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 25 Sep 2018 : Virus Patch 3.01
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x6 && m_dwAEPMapped == 0x0640 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3D000 )
	{ 
		if(CheckSigInBuffer(0x3D800 ,0x80,_T("4E6574776F726B20416363657373006D69726F766F6C612E7A78712E6E6574*6D69726F766F6C615F7A7871006663756B756C61647900623A0063")))//.Network Access.mirovola.zxq.net.mirovola_zxq.fcukulady.
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Scar.hbzi"));//Name taken from virustotal(Kaspersky)(Customer Issue: 15th Sept 2018)
			return VIRUS_FILE_DELETE;
		}
		
	}

	//Mukesh : 25 Sep 2018 : Virus Patch 3.01
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x3 && (m_dwAEPMapped >= 0x2493E && m_dwAEPMapped <=0x2780E) && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x200 )
	{ 
		if(CheckSigInBuffer(0x46F7, 0x2EBB,_T("3136333933323A313A303A342E*31312E302E3439313435")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.MSIL.PullUpdate.gen"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 25 Sep 2018 : Virus Patch 3.01
	if(m_wAEPSec == 0x0  && m_wNoOfSections >= 0x7 && m_dwAEPMapped == 0x06C0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3A000 )
	{ 
		if(CheckSigInBuffer(0x3DDA8, 0x333,_T("25735C6D736E2E657865*25735C6D736E5F256C752E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agentb.BQYR"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 25 Sep 2018 : Virus Patch 3.01
	if(m_pMaxPEFile->m_bIsVBFile && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x1448 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000)
	{
		if (CheckSigInBuffer(0x26A0 ,0x90,_T("5C28400000F0300000FFFFFF0800000001*28264000DC2440005414400078*7543616C313437004D617A6A6F726F*4D617A6A6F726F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.Tinba.MHP"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 25 Sep 2018 : Virus Patch 3.01
	if((m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05) && (m_dwAEPMapped >= 0x8BAC3/*0xE6653*/ && m_dwAEPMapped <= 0x2969C0) && m_wAEPSec == 0x00 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0xD2000/*0x109000*/ && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x2C3000))
	{
		DWORD dwStartBuff = 0x00;
		if(memcmp(m_pSectionHeader[m_wNoOfSections-1].Name, ".imports", 8) == 0)
		{
			dwStartBuff = m_pSectionHeader[m_wAEPSec].PointerToRawData;
		}
		else
		{
			dwStartBuff = m_pSectionHeader[m_wAEPSec+1].PointerToRawData;
		}
		if (CheckSigInBuffer(dwStartBuff ,m_pSectionHeader[m_wAEPSec+1].SizeOfRawData,_T("687474703A2F2F7777772E323334352E636F6D*2F3F3238383739")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Rootkit.Agent.EINO"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 25 Sep 2018 : Virus Patch 3.01
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x63035 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x91C00 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0xB6D00)
	{	
		if(CheckSigInBuffer(0xA6D98, 0xF0,_T("68007400740070003A002F002F0073007400610074002E00340074006F006F006C0073002E0072007500*2F0077006900640067006500740064006100740061002F00*7B00450045004100410035003600420030002D0038003100340043002D0034003000390045002D00*41003100440032002D003300300034004300410039003900360031003000360030007D0000*68007400740070003A002F002F00730074006100*74002E00340074006F006F006C0073002E00720075002F006100700069002F003F0000"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:Downloader.Win32.InnoBundle.gen"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 15 Oct 2018 : Virus Patch 3.02
	if (m_wNoOfSections == 0x0004 && m_dwAEPMapped == 0x251F &&  m_dwAEPUnmapped == 0x311F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==  0x7000)
	{
		if(CheckSigInBuffer(0x45C8, 0x205,_T("6E63756D6E7569686E756A6962*5C5C2E5C4C616E4D616E447276*6965786368672E646C6C*6C616E6D616E77726B2E657865*716D6F70742E646C6C*687474703A2F2F00696E65745F6E746F61"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Downloader.Win32.Agent.ein"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 15 Oct 2018 : Virus Patch 3.02
	if ((m_wNoOfSections == 0x0006) && (m_dwAEPMapped == m_dwAEPUnmapped) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && (m_pSectionHeader[0x0].SizeOfRawData == 0x26000 || m_pSectionHeader[0x0].SizeOfRawData == 0x24000))
	{
		if(CheckSigInBuffer(0x277A4, 0x2C,_T("6A7573636865642E*6577393F776476314175505800"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.fih"));
			return VIRUS_FILE_DELETE;
		}
		else if ((CheckSigInBuffer(0x256B8 , 0x2C,_T("6A7573636865642E*21423F3742313D76393C3543000000005D354835"))))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.fhz"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 15 Oct 2018 : Virus Patch 3.02
	if(m_wAEPSec == 0x1 && m_wNoOfSections == 0x0b &&  m_dwAEPMapped == 0x243098 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6c600 )
	{
		if (CheckSigInBuffer(0x46D0,0x0330,_T("416E20756E6578706563746564206D656D6F7279206C65616B20686173206F636375727265642E*556E6578706563746564204D656D6F7279204C65616B*81E97CAB7F0189CAC1E9030FB6D6B801*D3E0090495FCAA7F01B801")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Inject.aixeq"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Mukesh : 15 Oct 2018 : Virus Patch 3.02
	if((m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && (m_wNoOfSections == 0x02 || m_wNoOfSections == 0x03) && (m_dwAEPMapped == 0x1150 || m_dwAEPMapped == 0x0350 || m_dwAEPMapped == 0xA8C4) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x19000 && (memcmp(m_pSectionHeader[m_wAEPSec].Name, "MEW", 3) == 0))
	{
		if (CheckSigInBuffer(0x9BDC ,0x500,_T("31003200330034003500360037003800390030002E002E00*620065006C0061006A0061007200200062006500720068006900740075006E00*4200610062006F006E0027007300200043006F006D00700075007400650072*50006C006500610073006500200065006E006A006F0079002000740068006500*20004200610062006F006E00200045006E00740065007200*7400610069006E006D0065006E00740020005E005F005E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.VB.es"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 15 Oct 2018 : Virus Patch 3.02
	if(m_pMaxPEFile->m_bIsVBFile && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x054C && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5400)
	{
		if (CheckSigInBuffer(0x05E0 ,0xBF,_T("F41940006815400000F030*941140009411400058114000780000007E*466E4571750049474153506D4868*466E457175")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.VB.zqs"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 15 Oct 2018 : Virus Patch 3.02
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x0888 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA600)
	{
		if (CheckSigInBuffer(0x6A0 ,0x100,_T("0FB64C85D440308AC020410033C983F80B0F44C10FB64C85D440308AC120410033C983F80B*0F44C10FB64C85D440308AC220410033C983F80B*0F44C10FB64C85D440308AC3204100*33C983F80B0F44C183C20481FA0028010072A5")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Zamg.C"));//ransomware
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 15 Oct 2018 : Virus Patch 3.02
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 && m_dwAEPMapped == 0x0640 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1400 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x6000 && m_pMaxPEFile->m_dwFileSize == 0xC6BB)
	{	
		if(CheckSigInBuffer(0x1B04, 0xFA,_T("5245472041444420484B43555C536F6674776172655C4D6963726F736F66745C57696E646F77735C43757272656E7456657273696F6E5C52*756E202F762057696E5368656C6C202F74205245475F535A202F6420433A5C57696E5368656C6C5C57696E536576656E2E657865202F66*433A5C57696E5368656C6C*433A5C57696E5368656C6C5C57696E536576656E2E657865*5C57696E646F77735C5374617274204D656E755C50726F6772616D735C537461727475705C7461736B686F73742E657865*433A5C57696E5368656C6C5C57696E436F6E2E646C6C"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Ransom.Win32.Blocker.GFEQ"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 16 Nov 2018 : Virus Patch 3.03
	if (m_wNoOfSections == 0x0004 && m_dwAEPMapped == 0x2200  &&  m_dwAEPUnmapped == 0x2E00 && m_wAEPSec == 0x00 && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_pSectionHeader[0x0].SizeOfRawData == 0x4200)
	{
		if(CheckSigInBuffer(0x1BBC, 0x820,_T("8B148F3B152450400075128B548F043B1528*50400075068D51028955FC413BC872DE*64738291"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Dropper.Dinwood.YLN"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 16 Nov 2018 : Virus Patch 3.03
	if (m_wNoOfSections == 0x0004 && m_dwAEPMapped == 0x0400  &&  m_dwAEPUnmapped == 0x1000 && m_wAEPSec == 0x00 && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_pSectionHeader[0x0].SizeOfRawData == 0x3400)
	{
		if(CheckSigInBuffer(0x154E, 0x200,_T("22312E65786522*7600740062006F00730073002E0079006F006C006F0078002E006E006500740000*2F00760074006100700069002F00760032002F00660069006C0065002F007300630061006E0000*007700770077002E007600690072007500730074006F00740061006C002E0063006F006D00"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Vtflooder.ekl"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x24f4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 )
	{
		if (CheckSigInBuffer(0x45D0,0x03000,_T("005C5C2E5C4C616E4D616E4472760000006965786368672E646C6C*6C616E6D616E6472760000006A7067006C616E6D616E77726B2E65786500*835C2E5CFA859BFF4C616E4D616E44727669657809672E646C6C")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.cdo"));
			return VIRUS_FILE_DELETE;//for exe file
		}
	} 

	//Gaurav : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x3ea && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xb80 )
	{
		if (CheckSigInBuffer(0x300,0x01000,_T("005C004400650076006900630065005C004C0061006E004D0061006E0044007200760000005C0044006F00730044006500760069006300650073005C004C0061006E004D0061006E00440072007600*21005200650067006900730074007200790021004D0061006300680069006E006500210053006F0066007400770061007200650021004D006900630072006F0073006F00660074002100570069006E0064006F00770073002100430075007200720065006E007400560065007200730069006F006E002100470075006E000000558B")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.cdo"));
			return VIRUS_FILE_DELETE;//for sys file
		}
	}

	//Gaurav : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x2b2a && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x15800 )
	{
		if (CheckSigInBuffer(0x15A00,0x0200,_T("0F82D800000033C08B9484D8090000339484DC09000081E2FFFFFF7F339484D8090000*B00899338C840C10000033CA894C8418403DE30000007CBC3D6F0200007D470F1F00*C9F7D91BC9D1EA81E1DFB00899338C848CFCFFFF33CA894C8418403D6F0200007CBC")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.razy.404535"));//Decryption loop
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x19900 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x72200 )
	{
		if (CheckSigInBuffer(0x3200C ,0x9B,_T("3200310038002E00350034002E00330030002E0032003300350000*312E3233342E38332E313436*3133332E3234322E3132392E313535")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Plite.bhud"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x8833  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10B000 && ((memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)) )
	{
		if (CheckSigInBuffer(0xCB2E1 ,0x40,_T("65652E786D7269672E636F6D*2E6E696365686173682E636F6D*2E6D696E6572676174652E636F6D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not.a.virus.RiskTool.HTML.Miner.b"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x24F4  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 )
	{
		if (CheckSigInBuffer(0x45DC ,0x140,_T("5C5C2E5C4C616E4D616E447276*6965786368672E646C6C*6C616E6D616E647276*6C616E6D616E77726B2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Dropper.Win32.Agent.CDO"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sagar Bade : 16 Nov 2018 : Virus Patch 3.03
	if ((m_wNoOfSections == 0x0006)&& (m_wAEPSec==0x0) && (m_dwAEPMapped ==0x4b2c)&&(m_dwAEPUnmapped==0x572c)  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData ==0x13c00  )&& (m_pSectionHeader[0x0].PointerToRawData==0x400)&&( m_pSectionHeader[m_wAEPSec].Misc.VirtualSize ==0x13b4e))
	{
		if(CheckSigInBuffer(0x16AF0, 0x60,_T("76006F00730074006500720061006E002E006500780065*7400610070006C0069006B0061002E006500780065*620069006E006B0069006C0061006E0064002E006500780065"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:AdWare.Win32.SwiftBrowse.gen"));
			return VIRUS_FILE_DELETE;
		}
	}
	
	//Sneha : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05)  &&  (m_dwAEPMapped == 0x65B44 || m_dwAEPMapped == 0x66744) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x76E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x67000))
	{
		DWORD dwStartBuff = 0x00;
		if(m_wNoOfSections == 0x04)
		{
			dwStartBuff = 0x753D0;
		}
		else
		{
			dwStartBuff = 0x75FD0;
		}
		if (CheckSigInBuffer(dwStartBuff,0x190,_T("4B726973*633A5C57696E646F77735C737663686573742569256925692E657865*633A5C57696E646F77735C424A2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Agent.GRGY"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x05 || m_wNoOfSections == 0x04 || m_wNoOfSections == 0x03) && (m_dwAEPMapped == 0x65D14 || m_dwAEPMapped == 0x65114) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x66000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC7000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x76A00))
	{
		if (CheckSigInBuffer(0x75190,0x1000,_T("4B726973*633A5C57696E646F77735C257325642E657865*633A5C57696E646F77735C424A2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Farfli.AKDA"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 16 Nov 2018 : Virus Patch 3.03
	if(m_wAEPSec == 0x0  && m_wNoOfSections == 0x3 && (m_dwAEPMapped == 0x1274 || m_dwAEPMapped == 0x0674) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2F000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x20000)) //added
	{ 
		DWORD dwStartBuff = 0x00;

		if(m_dwAEPMapped == 0x1274)
		{
			dwStartBuff = 0x944C; 
		}
		else
		{
			dwStartBuff = 0x8840;
		}

		if(CheckSigInBuffer(dwStartBuff, 0xD0,_T("62007000730031002E0065007800650000*620068006F006F006B0070006C002E0064006C006C0000*56004E00430048006F006F006B0073002E0064006C006C0000*78007200340074006400770061002E0065007800650000")))//
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Llac.LLZL"));
			return VIRUS_FILE_DELETE;
		}
	}

	//JayPrakash : 19 Nov 2018 : Virus Patch 3.04
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x4 && m_dwAEPMapped == 0x255A && m_dwAEPUnmapped == 0x315A && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200)
	{ 
		if(CheckSigInBuffer(0x4870 ,0x50,_T("6C616E6D616E6472760000006A7067006C616E*6D616E77726B2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Dropper.Win32.Agent.csp")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//JayPrakash : 19 Nov 2018 : Virus Patch 3.04
	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04) && (m_dwAEPMapped == m_pSectionHeader[0x0].PointerToRawData) && (m_pSectionHeader[0x0].SizeOfRawData == 0x2000 || m_pSectionHeader[0x0].SizeOfRawData == 0x1A000)) 
	{
		if (CheckSigInBuffer( 0x01C7A0 ,0x10B0,_T("424F475927532047414D4520454E47494E4500*687474703A2F2F31342E31382E3134312E32373A3333333535*6D63792E6173703F61743D6765746D62267331333D006F6B006E6F"))) 
		{
			if (m_pSectionHeader[0x0].SizeOfRawData == 0x1A000) 
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dinwod.ACQN")); 
			}
			else if (m_pSectionHeader[0x0].SizeOfRawData == 0x2000)	
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.nimda.57edaf37")); 
			}
			return VIRUS_FILE_DELETE;
		}
	}
	
	//Gaurav: 4 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  (m_dwAEPMapped == 0x7da6 || m_dwAEPMapped == 0x7acf) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16000 )
	{
		if (CheckSigInBuffer(0x17200,0x0300,_T("0063006F006D006D0061006E0064002E0063006F006D0000002F0063*43004F004D00530050004500430000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Symmi.48667"));//Name taken from G Data
			return VIRUS_FILE_DELETE;
		}
	} 

	//Sneha: 7 Dec 2018	: Virus Patch 3.05
	if(m_pMaxPEFile->m_bIsVBFile && m_wAEPSec == 0x0 && m_wNoOfSections == 0x03  && m_dwAEPMapped == 0x109C  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x48000)
	{
		if (CheckSigInBuffer(0x11E0,0xD0,_T("D02040009814400010F270*14114000EC104000A810400078*656368616E74696C20656D616E63697061*64696374E9657320652763686F7569657A*6265736D69726368696E67")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.VBKryjetor.alpx"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 7 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x2D30  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 && ((memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)) )
	{
		if (CheckSigInBuffer(0x4744 ,0x100,_T("5C5C2E5C4C616E4D616E447276*6965786368672E646C6C*6C616E6D616E647276*6C616E6D616E77726B2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.cqi"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 7 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x5 &&  m_wNoOfSections == 0x06 && m_dwAEPMapped == 0xE9000  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1000 && m_dwAEPMapped==m_pSectionHeader[m_wAEPSec].PointerToRawData)
	{
		if (CheckSigInBuffer(0xE905C ,0x20,_T("85C9740A3106011E*83C60449EBF2")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Generic.pak"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 7 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x2A7D && m_dwAEPUnmapped == 0x367D && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14A00 )
	{
		if (CheckSigInBuffer(0x13C50 ,0x40,_T("8B50FC8D40043350FC81E2FFFFFF7F3350F88BCA80E1010FB6C9F7D91BC9D1EA*81E1DFB0089933882C06000033CA8988B809000083EE0175C7")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.ulise.1299"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 7 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x1 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x0804 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8400 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0800)
	{
		if (CheckSigInBuffer(0x8E27 ,0x1E0,_T("304F3058306D3042324732*62616462656566")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.W32.ETap"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 7 Dec 2018	: Virus Patch 3.05
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x07A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x65000 && ((memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)))
	{
		if (CheckSigInBuffer(0x19608 ,0xC3,_T("62007000730031002E0065007800650000*620068006F006F006B0070006C002E0064006C006C0000*62006E00660061002E0065007800650000*56004E00430048006F006F006B0073002E0064006C006C0000*78007200340074006400770061002E0065007800650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Shakblades.WVD"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil: 7 Dec 2018	: Virus Patch 3.05
	if(m_wNoOfSections == 0x3 && m_dwAEPMapped ==0x0656 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x20A00 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x2D000 && memcmp(m_pSectionHeader[0].Name, ".MPRESS1", 8) == 0)
	{
		if(CheckSigInBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x1970, 0x30,_T("8A1C0E325D0C*8819414A75F4")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.Shifu.EPA"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Jay Prakash: 10 Dec 2018	: Virus Patch 3.06
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x1580 && m_dwAEPUnmapped == 0x1580 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 && m_pMaxPEFile->m_bIsVBFile == true)
	{
		if (CheckSigInBuffer(0x0558C,0x0125,_T("430069006E007400690061002E0062006D0070002E006500780065*5C004B00650072006E0065006C006C00330032002E0064006C006C002E006500780065*4200450053004F002E004A00500047002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.HLLW.Acint"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Jay Prakash: 10 Dec 2018	: Virus Patch 3.06
	if((m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x6) && (m_dwAEPMapped == 0x0A00 || m_dwAEPMapped == 0x01680C) && (m_dwAEPUnmapped == 0x2000 || m_dwAEPUnmapped == 0x1680C) && 				(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17000))
	{ 
		DWORD dwStartOff= 0x0;

		if(m_dwAEPMapped == 0xA00)
		{
			dwStartOff = 0xA04;
		}
		else 
		{
			dwStartOff = 0x26B90;
		}
		
		if(CheckSigInBuffer(dwStartOff,0x17,_T("2460E8000000005E83C611*B907090000310683C604E2F9"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Sentinel.a")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket: 10 Dec 2018	: Virus Patch 3.06
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		DWORD dwOverSize = 0x0;
		dwOverSize = m_pMaxPEFile->m_dwFileSize - m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData - m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData;

		if(dwOverSize > 0x200)
		{
			if (CheckSigInBuffer(m_pMaxPEFile->m_dwFileSize - 0x500,0x500,_T("5365727665722E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865")))
            {
                  _tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dinwood.rsj"));//server.exe// infect.exe(8 times in last 500  bytes)
                  return VIRUS_FILE_DELETE;
            }
		}
	}

	//Aniket: 10 Dec 2018	: Virus Patch 3.06
	if(m_wAEPSec == 0x06 && m_wNoOfSections == 0x09 && m_dwAEPUnmapped == 0x0b0f4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400 && m_dwAEPUnmapped > m_pMaxPEFile->m_dwFileSize &&(m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(CheckSigInBuffer(0x64B0, 0x600,_T("7300650063007200390074006F00730000*007300650063007200390074006F0073*4F0045004D002D0053004C00500032002E0031002000410043005000490020005000610074006300680020004400720069007600650072*31CF31DF31F931353260328B32A032E2323133493361339C33")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.hacktool.kmsactivator.ac"));//Company name and Constant bytes// AEPUnMapped is greater than file size
			return VIRUS_FILE_DELETE;
		}
	}
	//Aniket: 10 Dec 2018	: Virus Patch 3.06
	if (m_wNoOfSections == 0x0004 && m_dwAEPMapped == m_dwAEPUnmapped && m_wAEPSec == 0x00 && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_pSectionHeader[0x0].SizeOfRawData == 0x5000 || m_pSectionHeader[0x0].SizeOfRawData == 0x6000)
	{
		if(CheckSigInBuffer(0x1C15, 0x3F,_T("6A3E9959F7F90FBE4415C2508D450E68*FF33C083C40CF2AEF7D12BF98BF78B7D*088BD183C9FFF2AE8BCA4F"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Nitol.B"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x05 || m_wNoOfSections == 0x04) &&  m_dwAEPMapped == 0x448 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7400) )
	{
		if (CheckSigInBuffer(m_dwAEPMapped,0x0200,_T("0047696761427974655F426F6D626572*4000564235218C0E2A*47696761427974655F426F6D6265720047696761427974655F426F6D626572000047696761427974655F426F6D626572")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.VB.bx"));//NOnRepairable virus //virus files are dropping on the desktop with process names 
			return VIRUS_FILE_DELETE;
		}
	} 

	//Mukesh: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x0C && m_dwAEPMapped == 0x6B2D8 && m_dwAEPUnmapped == m_dwAEPMapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6B000 )
	{
		if (CheckSigInBuffer(0x6B4B4 ,0x2B,_T("5C5065642E657865*5C5065642E657865222022")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.generic.8135648"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x5 && m_wNoOfSections == 0x6 &&  m_dwAEPMapped == 0x268000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0028 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x268000 
		&& memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, "xiaohui", 7) == 0)
	{
		if (CheckSigInBuffer(0x1E6A60 ,0x3465,_T("433A5C6B7337372E696E69*5C4D6963726F53752E646C6C*4D6963726F5375")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Genome.AMTXS"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x400 && (m_dwAEPMapped==m_pSectionHeader[m_wAEPSec].PointerToRawData) && (m_dwAEPUnmapped == m_pSectionHeader[m_wAEPSec].SizeOfRawData) )
	{
		if (CheckSigInBuffer(0x1136 ,0x40,_T("8A06463245F75056FF45F88B75F88A06*468B5DFC395DF8750C8B55108955F88B*75F88A06468845F75E588807474983F90075CD")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Small.xxd"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x1910 && (m_dwAEPMapped==m_dwAEPUnmapped) && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 )
	{
		if (CheckSigInBuffer(0x4600 ,0x205,_T("6100760070002E0065007800650000*2E006500780065002E0065007800650000*68007400740070003A002F002F007A0070006F0070002E0063006E002F0073002E0065007800650020*6F00700065006E002E0065007800650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.VB.go"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha: 24 Dec 2018	: Virus Patch 3.07
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x7CC2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xF000 )
	{
		if (CheckSigInBuffer(0x125A0,0x100,_T("433A5C00756E6B003030303030303030*5C5F746D7062663037612E657865*687474703A2F2F7777772E7468657365787371756172652E636F6D2F322F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Agent.zd"));
			return VIRUS_FILE_DELETE;
		}
	} 

	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  (m_dwAEPMapped == 0x24f4 || m_dwAEPMapped == 0x2319) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4200) ) //added
	{
		DWORD dwStartBuff = 0x0; 

		if(m_dwAEPMapped == 0x24f4)
		{
			dwStartBuff = 0x45D0;
		}
		else
		{	
			dwStartBuff = 0x3600;
		}

		if (CheckSigInBuffer(dwStartBuff,0x03000,_T("005C5C2E5C4C616E4D616E4472760000006965786368672E646C6C*6C616E6D616E6472760000006A7067006C616E6D616E77726B2E65786500"))) //added
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.cdo"));
			return VIRUS_FILE_DELETE;//for exe file
		}
	} 

	//Gaurav: 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x58a2 && m_pSectionHeader[0x01].PointerToRawData == 0x13e00 && memcmp(m_pSectionHeader[0x01].Name, ".kkx", 4) == 0)
	{
		if (CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData,0x100,_T("558BEC81EC10010000*A150C04A0033C58945FC")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.bozk"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav: 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x0B &&  m_dwAEPMapped == 0xA9F && m_pSectionHeader[m_wNoOfSections -2].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections -3].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections -4].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections - 5].SizeOfRawData == 0x7C00)
	{
		if (CheckSigInBuffer(0x280,0x100,_T("7768736F677268*706F70676D676D*7276716B677366*63676A6C636D6B*677A7375697773*646B646B636D66")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Androm.qxe"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav: 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0xd9e8 && m_pSectionHeader[m_wNoOfSections -2].SizeOfRawData == 0x5200 && m_pSectionHeader[m_wNoOfSections -3].SizeOfRawData == 0x1400)
	{
		if (CheckSigInBuffer(0x1810,0x100,_T("508D8D64FFFFFFE80E0900008D8D78FDFFFF89*8D58FFFFFF8B9558FFFFFF8955A48B45A4C7*8B4DA4C74104000000008B55A4C74208*8A45BF8845CB8A4DCB884DCA8A55CA8855C98A45C98845BEC645B9018B4D9C83C9")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.bnku"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Jay Prakash: 18 Jan 2019	: Virus Patch 3.08
	if ((m_wNoOfSections == 0x0003 || m_wNoOfSections == 0x0004) && (m_dwAEPMapped == 0x0200 || m_dwAEPMapped == 0x0400 || m_dwAEPMapped == 0x0B80) &&  (m_dwAEPUnmapped == 0x1000 || m_dwAEPUnmapped == 0x05780) && (m_wAEPSec == 0x00 || m_wAEPSec == 0x01) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && (m_pSectionHeader[0x0].SizeOfRawData == 0x3400 || m_pSectionHeader[0x0].SizeOfRawData == 0x6400 || m_pSectionHeader[0x0].SizeOfRawData == 0x800))
	{
		if(CheckSigInBuffer(0x134E, 0x400,_T("22312E65786522*7600740062006F00730073002E0079006F006C006F0078002E006E006500740000*2F00760074006100700069002F00760032002F00660069006C0065002F007300630061006E0000*007700770077002E007600690072007500730074006F00740061006C002E0063006F006D00"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Vtflooder.ekl"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x2F410 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x49C00 )
	{
		if (CheckSigInBuffer(0x5B734 ,0x8D,_T("42006C00610063006B0042006F006E006500440072007600310030002E0073007900730000*5C005C002E005C0042006C00610063006B0042006F006E00650000*42006C00610063006B0042006F006E006500440072007600380031002E0073007900730000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.razy.436108"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x0C && m_dwAEPMapped == 0x6B2D8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6B000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(0x6A11C ,0x1484,_T("5454542E746D70*7364612E746574*6464642E746574*5C5065642E657865*5C5065642E657865222022")))      
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Pedex.a"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 &&  (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05) && m_dwAEPMapped == 0x1E8C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10E00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		if (CheckSigInBuffer(0x17520 ,0xE0,_T("7A616E636C786A64782E646C6C*7A6A6A63726D6265686F616B6D")))      
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Wauchos.ex"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08
	if ((m_wNoOfSections == 0x0004 || m_wNoOfSections == 0x0003)  && (m_dwAEPMapped == 0x0400 || m_dwAEPMapped == 0x0200)   &&  m_dwAEPUnmapped == 0x1000 && m_wAEPSec == 0x00 && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && (m_pSectionHeader[0x0].SizeOfRawData == 0x3400 || m_pSectionHeader[0x0].SizeOfRawData == 0x6400))//added
	{
		if(CheckSigInBuffer(0x134E, 0x500,_T("22312E65786522*7600740062006F00730073002E0079006F006C006F0078002E006E006500740000*2F00760074006100700069002F00760032002F00660069006C0065002F007300630061006E0000*007700770077002E007600690072007500730074006F00740061006C002E0063006F006D00"))) //added
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Vtflooder.ekl"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x58a2 && m_pSectionHeader[0x01].PointerToRawData == 0x13e00 && memcmp(m_pSectionHeader[0x01].Name, ".kkx", 4) == 0)
	{
		if (CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData,0x100,_T("558BEC81EC10010000*A150C04A0033C58945FC")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.bozk"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x0B &&  m_dwAEPMapped == 0xA9F && m_pSectionHeader[m_wNoOfSections -2].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections -3].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections -4].SizeOfRawData == 0x7C00 && m_pSectionHeader[m_wNoOfSections - 5].SizeOfRawData == 0x7C00)
	{
		if (CheckSigInBuffer(0x280,0x100,_T("7768736F677268*706F70676D676D*7276716B677366*63676A6C636D6B*677A7375697773*646B646B636D66")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Androm.qxe"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0xd9e8 && m_pSectionHeader[m_wNoOfSections -2].SizeOfRawData == 0x5200 && m_pSectionHeader[m_wNoOfSections -3].SizeOfRawData == 0x1400)
	{
		if (CheckSigInBuffer(0x1810,0x100,_T("508D8D64FFFFFFE80E0900008D8D78FDFFFF89*8D58FFFFFF8B9558FFFFFF8955A48B45A4C7*8B4DA4C74104000000008B55A4C74208*8A45BF8845CB8A4DCB884DCA8A55CA8855C98A45C98845BEC645B9018B4D9C83C9")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.bnku"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x69C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25d8 )
	{
		if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x11E0,0x0100,_T("EB218B06898568FFFFFF89C78B550889F9D3E2*01D781F7E478266A893B83C60483C304833E0075DA8DB574FFFFFF8B4508508D151C34400001*8D1510344000899564FFFFFF89F8898568FFFFFF8D3D1034400089F980C90131")))//Decryption loop
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agentb.ylj"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x1 && m_wNoOfSections == 0x4 &&  m_dwAEPMapped == 0x551F8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x27200 && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x43400 
		&& memcmp(m_pSectionHeader[0].Name, "UPX0", 4) == 0)
	{
		if (CheckSigInBuffer(0x5053C ,0x4C,_T("4D4F4F4C4956452E455845*4D4748544D4C2E455845*4D434D4E48444C522E455845*4D4356535254452E455845")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Generic"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Jan 2019	: Virus Patch 3.08
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x25D91  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2D000)
	{
		if (CheckSigInBuffer(0x15270 ,0x25,_T("8A9C048C0000008A4C047832D988*9C048C0000004083F8137CE6")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Warezov.GEN"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sagar : 18 Jan 2019	: Virus Patch 3.08
	if(m_wNoOfSections == 0xb && m_wAEPSec == 0x9 && m_dwAEPUnmapped == 0xE7001 && m_dwAEPMapped == 0x42c01 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x42c00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2bc00 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x2c000 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0xe7000 &&
		(memcmp(m_pSectionHeader[m_wAEPSec].Name, ".aspack", 7) == 0))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		if(CheckSigInBuffer(0xf3218, 0x80,_T("332423353724232140313030302A2829*3324233537242321405374696B794E6F742E6578652A2829254035*4D4F5954523536515733242335372423214053796E63486F73742E6578652A28292540355954")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Delf.tgsa"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sagar : 18 Jan 2019	: Virus Patch 3.08
	if(m_wNoOfSections == 0xb && m_wAEPSec == 0x1 && m_dwAEPUnmapped == 0x244298 && m_dwAEPMapped == 0x243098 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1D6E00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6C600 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x6c600 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1d8000 &&
		(m_pSectionHeader[m_wAEPSec].Characteristics & 0x60000020) == 0x60000020 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x901000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x3664)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		if(CheckSigInBuffer(0x8FBE0C, 0x80,_T("46609000010000000300000003000000286090*34609000406090003CD68F005C0701003020060053609000*50726F6A656374312E65786500544D6574686F64*496D706C656D656E746174696F6E496E746572636570*64626B5F6663616C6C5F77726170706572")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Inject.AIXEQ"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x004 && m_dwAEPMapped == 0x204CB && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9E400) 
	{ 
		if(CheckSigInBuffer(0x570,0xE0,_T("89C189DA2B4DE829CA890D00007B3D*0FB60831F20FB689D0DF893D01CA88104039F80F82D8FFFFFF*8B75E889C10FB6108B3D1C007B3D29F189DE8D1C31890D00007B3D*235DD802141F89F38B7DD029CB335DD40FB6CA0FB689D0DF893D*01CB88184089F339F80F82BCFFFFFF")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not.a.virus.AdWare.Adposhel.GEN")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08	
	if(m_wAEPSec == 0x1 && m_wNoOfSections == 0x00A && m_dwAEPMapped == 0xB227C && m_pSectionHeader[m_wNoOfSections - 2].SizeOfRawData == 0x00f000) 
	{ 
		if(CheckSigInBuffer(0xAB620,0x630,_T("5C00570049004E0057004F00520044002E004500580045*55681EC34A0064FF3064892033C08945F833C0556801C34A00*6E00750052005C006E006F006900730072006500560074006E0065007200720075004300*5C00730077006F0064006E00690057005C00740066006F00*73006F007200630069004D005C006500720061007700740066006F0053*5C00570049004E0057004F00520044002E004500580045")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Broskod.rb")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Jan 2019	: Virus Patch 3.08	
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x10DB0E&& m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x141A00 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{			
		if (CheckSigInBuffer(0x142B20 ,0x2000,_T("2F6B7561697A69707265706F72742F6B756E62616E673F636F64653D*6B7561697A6970*6865696E6F7465A1A26B7561697A6970")))      
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.fugrafa.592"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 18 Jan 2019	: Virus Patch 3.08
	if(m_wNoOfSections == 0xB && m_dwAEPMapped == 0x08A0 && m_pMaxPEFile->m_dwFileSize == 0x169A00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData ==0x128600)
	{
		if (CheckSigInBuffer(0x12B607,0x100,_T("6D696E65722E6665652E786D726967*2E636F6D*343865646648753756395A3834597A7A4D6136665575656F454C5A395A52587139566574577A5947*7A4B743532585535787671677A596E444B3955526E526F4A4D6B316A386E4C774556736153574A3466686455795A696A42475569636F44*656D657267656E63792E666565*2E786D7269672E636F6D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:RiskTool.Win32.BitCoinMiner.GEN"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Aniket : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04  && m_dwAEPMapped == 0x07A8 && m_dwAEPUnmapped == 0x13A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x65000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x48000 && ((memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0)))
	{
		if (CheckSigInBuffer(0x19608 ,0xCF,_T("62007000730031002E0065007800650000*620068006F006F006B0070006C002E0064006C006C0000*62006E00660061002E0065007800650000*56004E00430048006F006F006B0073002E0064006C006C0000*78007200340074006400770061002E0065007800650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Shakblades.WVD"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x006 &&  m_dwAEPMapped == 0x1a8c && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x10400 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL && m_pMaxPEFile->m_b64bit == true)
	{
		if (CheckSigInBuffer(0x5F720,0x0200,_T("585D4F5849502A2B377D7575195049515549584950375D555519525C4B575C552A*375D55551976757C2A2B377D7575194A515C55552A2B377D7575194A51554E584950377D7575194C4A5C4B2A2B377D7575194E505750575C4D377D7575194E4D4A5849502A2B377D7575*4F706B6D6C7875496B766D7C7A6D19195A765A6B7C786D7C5E6C707D19194A515E7C6D5F76757D7C6B49786D715819194A6D6B5A7469504E19196E6A696B70776D*4E4D4A486C7C6B604C6A7C6B4D76727C771919391D190D191919")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Daws.eqpe"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 &&  m_dwAEPMapped == 0xfe1c && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x33c00 && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".7tef7", 7) == 0))
	{
		if (CheckSigInBuffer(m_pMaxPEFile->m_dwFileSize - 0x1000,0x1000,_T("0043006F006D00700061006E0079004E0061006D00650000000000A90044007200690073006F0068*52004500490054004500420045004E0052002E00450058004500")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Agent.dnym"));
			return VIRUS_FILE_DELETE;
		}
	} 

	//Gaurav : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 &&  m_dwAEPMapped == 0xac7b && m_pSectionHeader[0x01].SizeOfRawData == 0x400 && (memcmp(m_pSectionHeader[0x01].Name, ".frd", 5) == 0))
	{
		if (CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData,0x60,_T("558BEC6AFF6840B3410064A1000000005081EC0C010000A16CA0420033C58945*F0508D45F464A300000000E8E060FEFFE8DB60FEFFE8D660FEFF6844754200FF*1510C041008985F8FEFFFFC70544B94200C0D50200E8B660FEFFE8B160FEFF6A")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.downloader.ate"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Gaurav : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x7b485 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9e000)
	{
		if (CheckSigInBuffer(0xA4900,0x300,_T("63726F7373666972652E65786500006E657473682077696E736F636B207265736574*284675636B730001000000000100004553504931312E646C6C000100000000E001004D5A")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.ulise.3542"));
			return VIRUS_FILE_DELETE;
		}
	}  
	
	//Gaurav : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x004 || m_wNoOfSections == 0x05) &&  m_dwAEPMapped == 0x1000 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5284 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5400))
	{
		if (CheckSigInBuffer(0x5000,0x0340,_T("E9030000009090904D656C6C6973736100000000002200002C01000004000000*484944524147204D55535420444945*436F6E74726F6C2050616E656C5C437572736F72730000536F6674776172655C4D656C6C69737361004E616D6564204D656C6C697373612E20556B7261696E6528436865726E697674736929*4D656C6C69737361002E72737263002E72737263002E72737263002E72737263002E72737263004D5341002E72737263002A2E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Assilla.A"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Jay Prakash : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && (m_dwAEPMapped == 0x154C0 || m_dwAEPMapped == 0x16B70) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7BE00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7F200) && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{ 
		if(m_dwAEPMapped == 0x154C0)
		{
			if(CheckSigInBuffer(0x842F0,0x650,_T("5820686173206E6F74206265656E20636F6D70696C6564006D616C666F726D6564*200061006C00690061007300200050006C00610079004D00650000007300740061007400750073*50006C00610079004D00650020006D006F00640065000000000063006C006F0073006500*70006C0061007900200050006C00610079004D006500200077006100690074000000000070006C0061007900")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Clicker.Win32.AutoIt.r"));
				return VIRUS_FILE_DELETE;
			}
		}
		else 
		{
			if(CheckSigInBuffer(0x80AC0,0x1000,_T("5820686173206E6F74206265656E20636F6D70696C6564006D616C666F726D6564*200061006C00690061007300200050006C00610079004D00650000007300740061007400750073*50006C00610079004D00650020006D006F00640065000000000063006C006F0073006500*70006C0061007900200050006C00610079004D006500200077006100690074000000000070006C0061007900")))
            {
                _tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.AutoIt.QN"));
                return VIRUS_FILE_DELETE;
            }
        }
	}

	//Mukesh : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x18D8 && m_dwAEPMapped==m_dwAEPUnmapped  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xE2000 )
	{
		if (CheckSigInBuffer(0x2F34 ,0x798,_T("564235213626*4348494E434150494E00544F494C455454455052414754000048616E64656C7372757465*F4010000D45240*50000000F75A7BCB6DE53C47BF0905FA8A64E2A5")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.MSIL.Bladabindi.aubi"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x12B4 && m_dwAEPMapped==m_dwAEPUnmapped  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2A000 )
	{
		if (CheckSigInBuffer(0x13B0 ,0xA8,_T("5642352136262A*546872656579656172004F757473686F756C646572380000496E7465726D756E6469616C37*F40100008C1640")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VBKrypt.XXZF"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x129C && m_dwAEPMapped==m_dwAEPUnmapped  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x28000 )
	{
		if (CheckSigInBuffer(0x13A0 ,0xA0,_T("5642352136262A*436861696E6167653400466F726568617264000042656E6368696D6F6C38*F4010000981A40")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.VBKrypt.XZHW"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Mukesh : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x13A8 && m_dwAEPMapped==m_dwAEPUnmapped  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x68000 )
	{
		if (CheckSigInBuffer(0x1A208 ,0xAC,_T("620068006F006F006B0070006C002E0064006C006C0000*62006E00660061002E0065007800650000*56004E00430048006F006F006B0073002E0064006C006C0000*78007200340074006400770061002E0065007800650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Shakblades.XOD"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 18 Feb 2019	: Virus Patch 3.09
	if(m_wNoOfSections == 0x09 && m_dwAEPMapped == 0x1ECA0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x25200 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x693AC && m_pMaxPEFile->m_dwFileSize == 0xA5421)
	{
		if(CheckSigInBuffer(0x2BC18, 0x120,_T("4D0069007200610020004D0061006C00770061007200650000*4D0069007200610020004D0061006C00770061007200650000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MiraMalware"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x005 && m_dwAEPMapped == 0x27B6 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6200) 
	{ 
		if(CheckSigInBuffer(0x8820,0x100,_T("6900680064006F006D0000*650079007A0073006300000044")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not.a.virus:AdWare.ICLoader.gen")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_pMaxPEFile->m_bIsVBFile == true && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x1194 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3000) 
	{ 
		if(CheckSigInBuffer(0x12D0,0xA0,_T("301A40004413400000F0300000FFFFFF*0C1240000C124000A011400078*54696D6552656D61696E")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.IcedID.tohy")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_pMaxPEFile->m_bIsVBFile == true && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x1390 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2B000) 
	{ 
		if(CheckSigInBuffer(0x1524,0x200,_T("604B40009815400033F030*50144000081440009C13400078*54696D6552656D61696E*5C005F0043004C0043002E007600620070")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.IcedID.tolh")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x1D0E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C00) 
	{ 
		if(CheckSigInBuffer(0x2AF0,0xC0,_T("7E4446336262732E746D70*3300000069000000740000007E37")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.sbra")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x004 && m_dwAEPMapped == 0x89A4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x54000) 
	{ 
		if(CheckSigInBuffer(0x87A0,0x1C0,_T("7961686F6F206861636B65722E657865*31322079656172206F6C6420666F7263656420726170652063756D2E657865*4861636B696E6720546F6F6C20436F6C6C656374696F6E2E657865*4861636B696E6720546F6F6C20436F6C6C656374696F6E2E657865*576F726D7320576F726C6420506C617920637261636B2E657865*77696E786366672E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Malware.g")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 18 Feb 2019	: Virus Patch 3.09
	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x006 || m_wNoOfSections == 0x003) && (m_dwAEPMapped == 0x06A0 || m_dwAEPMapped == 0x04A0)  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xB600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13000)) 
	{ 
		DWORD dwStartBuff = 0x00;

		if(m_dwAEPMapped == 0x06A0)
		{
			dwStartBuff = 0xCDB8;
		}
		else
		{
			dwStartBuff = 0xDFB0;
		}

		if(CheckSigInBuffer(dwStartBuff,0x320,_T("495F4C6F76655F596F752E7A6970*48617070795F62697274686461795F746F5F796F752E7A6970*6D766373766E642E717979*74657062636C2E717979*666F746F2E706966*466273676A6E65725C5A76706562666273675C4A766171626A665C5068656572616749726566766261*5C526B6379626572655C6968796169627933325C49726566766261")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Small.acli")); 
			return VIRUS_FILE_DELETE;
		}
	}
	
	//Aniket : 05 Apr 2018 : Virus Patch 3.10
	if ((m_wNoOfSections == 0x0006) || (m_wNoOfSections == 0x00A) || (m_wNoOfSections == 0x007) || ( m_wNoOfSections == 0x009 ) || ( m_wNoOfSections == 0x008 ) && (m_dwAEPMapped == m_dwAEPUnmapped) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && (m_pSectionHeader[0x0].SizeOfRawData == 0x26000 || m_pSectionHeader[0x0].SizeOfRawData == 0x24000))
	{	
		if(CheckSigInBuffer(0x277A4, 0x2C,_T("6A7573636865642E*6577393F776476314175505800"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.FIH"));
			return VIRUS_FILE_DELETE;
		}
		else if ((CheckSigInBuffer(0x256B8 , 0x2C,_T("6A7573636865642E*21423F3742313D76393C3543000000005D354835"))))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.FHZ"));
			return VIRUS_FILE_DELETE;
		}
		else if ((CheckSigInBuffer(0x25680 , 0x2C,_T("6A7573636865642E*21423F3742313D76393C3543000000005D354835"))))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Win32.Juched.FIA"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Jay Prakash : 05 Apr 2018 : Virus Patch 3.10
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x09 && m_dwAEPMapped == 0x4690 && m_dwAEPUnmapped == 0x4690 && (memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".ap0x", 7) == 0)
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA200 ||  m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA400))
	{
		if(CheckSigInBuffer(0x1EB0,0x50,_T("595A5E5BC38D400033D2C1E8023D000400007716*8B1574D440008B5482F485D27508403D*0104000075EA8BC2C38D40"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Fugrafa.1333"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade : 05 Apr 2018 : Virus Patch 3.10
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x005 && m_dwAEPMapped == 0x868D0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBCC00) 
	{ 
		if(CheckSigInBuffer(0xC4D80,0x1C0,_T("43003A006D0079005C00540065006D0070005C00760072006D0000*433A6D795C54656D705C76726D*6C006C00650072002E0064006100740000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not.a.virus.AdWare.Linkury.GEN")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade : 05 Apr 2018 : Virus Patch 3.10
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x003 && (m_dwAEPMapped == 0x1D0E || m_dwAEPMapped == 0x290E) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000)) 
	{ 
		DWORD dwStartBuff = 0x0;

		if(m_dwAEPMapped == 0x1D0E)
		{
			dwStartBuff = 0x2AF0;
		}
		else
		{
			dwStartBuff = 0x40F8;
		}

		if(CheckSigInBuffer(dwStartBuff,0xC0,_T("7E4446336262732E746D70*3300000069000000740000007E37")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.sbra")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade : 05 Apr 2018 : Virus Patch 3.10
	if(m_wAEPSec == 0x02 && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x1000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0240) 
	{ 
		if(CheckSigInBuffer(m_pMaxPEFile->m_dwFileSize - 0x40,0x40,_T("EB03FEC38BEB00BAD079400052C3BAD0794000B860BE1570890283*C203B87040008D890283C2FDFFE2F3")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Small.ACLI")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha Kurade : 05 Apr 2018 : Virus Patch 3.10
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x0600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13800)
	{
        TCHAR  pbyBATAgentSig[] = {_T("4465766F757265725F332E305F*3332323130323833393232353037312E626174")};

		if (CheckSigInBuffer(0x1D6F0,0x58,pbyBATAgentSig))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.BAT.Agent.BC"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Swapnil : 05 Apr 2018 : Virus Patch 3.10
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x60333 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7F000 && m_pMaxPEFile->m_dwFileSize == 0x46A000)
	{
		if(CheckSigInBuffer(0x407558, 0x28,_T("646F6E6174652E76322E786D7269672E636F6D*637075001B5B313B33316D6E6F6E651B5B306D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Miner.gen"));
			return VIRUS_FILE_DELETE;
		}	
	}

	//Sneha : 17 Sep 2019 Virus Patch 3.20
	if(m_wAEPSec ==  0x04 && m_wNoOfSections == 0x005 && (m_dwAEPMapped == 0x2A125 || m_dwAEPMapped == 0x13125) && 
		(m_pSectionHeader[0].SizeOfRawData == 0x12000 || m_pSectionHeader[0].SizeOfRawData == 0x2000))
	{
		DWORD dwStartBuff = 0x00;
		if(m_dwAEPMapped == 0x2A125)
		{
			dwStartBuff = 0x1E280;
		}
		else 
		{
			dwStartBuff = 0x7280;
		}
		if(CheckSigInBuffer(dwStartBuff, 0x100, _T("687474703A2F2F76677561726465722E*3931692E6E65742F757365722E68746D*687474703A2F2F76677561726465722E*6272617665686F73742E636F6D2F757365722E68746D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.W32.Madangel.a"));
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 17 Sep 2019 Virus Patch 3.20
	if(m_wAEPSec ==  0x00 && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x11A0 && m_pSectionHeader[0].SizeOfRawData == 0xD000)
	{
		if(CheckSigInBuffer(0x77D0, 0x100, _T("4880400000F8300100FFFFFF08*C875400080754000AC11400078*5669727573204D6972697020466F6C6465722D72657665727369352E33*5669727573204D6972697020466F6C646572")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.W32.VB.an"));
			return VIRUS_FILE_DELETE;
		}
	}
	//Sneha : 17 Sep 2019 Virus Patch 3.20
	if(m_wAEPSec ==  0x00 && m_wNoOfSections == 0x004 && m_dwAEPMapped == 0x5B768 && m_pSectionHeader[0].SizeOfRawData == 0x9DE00)
	{
		if(CheckSigInBuffer(0x3130, 0x100, _T("434C5349445C7B43443030303130302D38423935*2D313144312D383244422D3030433034464231363235447D")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.W32.Xpaj.Gen.C"));
			return VIRUS_FILE_DELETE;
		}
	}
	//Sneha : 17 Sep 2019 Virus Patch 3.20
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x004 && m_dwAEPMapped == 0x0600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1E00) 
	{ 
		if(CheckSigInBuffer(0x1110,0x100,_T("57696E33322E4C657669617468616E2028632920313939392062792042656E6E79*4865792073747570696420210D0D5468697320697320676F6E6E6120626520796F7572206E696768746D617265*333074682067656E65726174696F6E206F66204C657669617468616E2069732068657265")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Levi.3240")); 
			return VIRUS_FILE_DELETE;
		}
	}

	//Sneha : 11 Oct 2019 Virus Patch 3.21
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x0600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0800 )
	{
		if (CheckSigInBuffer(0x7D0,0x0100,_T("2A2E657865*77696E33322E696E66616E63792E353430*687474703A2F2F73686974646F776E4073662E637A*77656C636F6D6520746F2066697273742067656E65726174696F6E21")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Shown.540.a"));
			return VIRUS_FILE_DELETE;
		}
	}  

	//Sneha : 11 Oct 2019 Virus Patch 3.21
	if(m_wAEPSec == 0x03 && m_wNoOfSections == 0x004 && m_dwAEPMapped == 0x36060 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0C7E) 
	{ 
		if(CheckSigInBuffer(0x392E0,0xC0,_T("D826400000F0340000FFFFFF08*EC254000E4254000401640007800000081*4669726577616C6C00706A7442696E646572*706A744469736B42696E646572")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.VB.ge")); 
			return VIRUS_FILE_DELETE;
		}
	}
	//Sneha : 11 Oct 2019 Virus Patch 3.21
	if(m_wAEPSec == 0x05 && m_wNoOfSections == 0x006 && m_dwAEPMapped == 0xE000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x37D4) 
	{ 
		if(CheckSigInBuffer(0xD300,0xA7,_T("5C7379736C30676F6E2E657865*5C7379736C6F672E6C6F67")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Golsys.14292")); 
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentSILTZR
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.SILTZR Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentSILTZR()
{

	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 && 
		(m_dwAEPMapped == 0x2028 || m_dwAEPMapped == 0x2023 || m_dwAEPMapped == 0x0E1C || m_dwAEPMapped == 0x19D0 || m_dwAEPMapped == 0x2093) /*&& m_pMaxPEFile->m_stPEHeader.CheckSum == 0x3C2CA*/ && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x13C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x11600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000))
	{


		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int INFECTOR_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[INFECTOR_BUFF_SIZE];

		DWORD  m_dwStratBuff = 0x0;

		if(m_dwAEPMapped == 0x2023 || m_dwAEPMapped == 0x2028)
		{
			m_dwStratBuff = 0x626;
		}
		else if(m_dwAEPMapped == 0x19D0)
		{
			m_dwStratBuff = 0x571;
		}
		else if(m_dwAEPMapped == 0x2093)
		{
			m_dwStratBuff = 0x662;
		}
		else if(m_dwAEPMapped == 0x0E1C)
		{
			m_dwStratBuff = 0x577;
		}

		if(GetBuffer(m_dwStratBuff, INFECTOR_BUFF_SIZE, INFECTOR_BUFF_SIZE))
		{

			DWORD dwLength = 0;
			t_disasm da = {0};
			int iInstructionNo = 0;



			DWORD dwOffset=0;

			while(dwOffset<0x32)
			{
				dwOffset=dwOffset+dwLength;

				dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 


				if(dwLength == 0x2 && iInstructionNo == 0x0  && strstr(da.result, "MOV ECX,EDI"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x1  && strstr(da.result, "SHR ECX,5"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x2  && strstr(da.result, "SHL EAX,4"))
				{  
					iInstructionNo++;
					continue;
				}
				else if((dwLength == 0x3 || dwLength == 0x4) && iInstructionNo == 0x3  && (strstr(da.result, "ADD EAX,[EBP-C]") || strstr(da.result, "ADD EAX,[ESP+14]")))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x2 && iInstructionNo == 0x4 && (strstr(da.result, "XOR ECX,EAX") || strstr(da.result, "XOR[EDI+ESI],AL")))
				{

					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x5  && (strstr(da.result, "LEA EAX,[ESI+EDI]") || strstr(da.result, "LEA EAX,[EDI+EBP]")))
				{
					iInstructionNo++;
					continue;
				}
				else if((dwLength == 0x2 || dwLength == 0x3) && iInstructionNo == 0x6 && (strstr(da.result, "LEA EAX,[ESI+EBX]")|| strstr(da.result, "XOR ECX,EAX")))
				{

					iInstructionNo++;
					continue;
				}
				else if((dwLength == 0x6 || dwLength == 0x3 || dwLength == 0x2) && iInstructionNo == 0x7 && (strstr(da.result, "LEA ESI,[ESI+61C88647]") || strstr(da.result, "SUB EBX,ECX")|| strstr(da.result, "SUB ESI,[EBP-18]")))
				{

					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Agent.siltzr"));

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	return iRetStatus;
}


int CSemiPolyTrojans::DetectIRCbotGEN()
{

	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && 
		(m_dwAEPMapped == 0x4320 || m_dwAEPMapped == 0x4588) && 
		(m_pMaxPEFile->m_stPEHeader.CheckSum == 0x8935A || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x42358 || m_pMaxPEFile->m_stPEHeader.CheckSum == 0x3C2CA) 
		&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17600 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x16400))
	{


		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff =NULL;
		}

		const int INFECTOR_BUFF_SIZE = 0x500;
		m_pbyBuff = new BYTE[INFECTOR_BUFF_SIZE];

		DWORD  m_dwStratBuff = 0x0;

		if(m_dwAEPMapped == 0x4320)
		{
			m_dwStratBuff = 0x16BE3;
		}
		else
		{
			m_dwStratBuff = 0x154CE;
		}

		if(GetBuffer(m_dwStratBuff, INFECTOR_BUFF_SIZE, INFECTOR_BUFF_SIZE))
		{

			DWORD dwLength = 0;
			t_disasm da = {0};
			int iInstructionNo = 0;



			DWORD dwOffset=0;

			while(dwOffset<0x19)
			{
				dwOffset=dwOffset+dwLength;

				dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 


				if(dwLength == 0x5 && iInstructionNo == 0x0  && strstr(da.result, "MOV EAX"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x6 && iInstructionNo == 0x1  && strstr(da.result, "IMUL EAX,EAX,343FD"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x5 && iInstructionNo == 0x2  && strstr(da.result, "ADD EAX,269EC3"))
				{  
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x5 && iInstructionNo == 0x3  && strstr(da.result, "MOV"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x4 && (strstr(da.result, "SHR EAX,10") || strstr(da.result, "XOR[EDI+ESI],AL")))
				{

					iInstructionNo++;
					continue;
				}
				else if((dwLength == 0x5 || dwLength == 0x3) && iInstructionNo == 0x5  && (strstr(da.result, "AND EAX,7FFF")|| strstr(da.result, "XOR [EDI+ESI],AL")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.IRCbot.GEN"));

					return VIRUS_FILE_DELETE;

				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.GEN Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectClickerGEN()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec != 0x0 && m_wAEPSec != 0x8 && m_dwAEPMapped !=0x9E98 && m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0xA200)		// Primary Checks
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int CLICKER_BUFF_SIZE = 0x42;
	m_pbyBuff = new BYTE[CLICKER_BUFF_SIZE];
	
	if(GetBuffer(m_dwAEPMapped + 0x11 ,CLICKER_BUFF_SIZE,CLICKER_BUFF_SIZE))
	{

		DWORD dwLength = 0;
		t_disasm da = {0};
		int iInstructionNo = 0;

		DWORD dwOffset=0;

		while(dwOffset<0x4B)
		{
			dwOffset=dwOffset+dwLength;

			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 



			if(dwLength == 0x5 && iInstructionNo == 0x0 && strstr(da.result, "CALL 003F8633"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0x1 && strstr(da.result,"CALL 003F983A"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0x2 && strstr(da.result, "CALL 003F9BA1"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x5 && iInstructionNo == 0x3 && strstr(da.result, "CALL 003F9FBC"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x5 && iInstructionNo == 0x4 && strstr(da.result, "CALL 003FBF5B"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x5 && iInstructionNo == 0x5 && strstr(da.result, "CALL 003FE8F2"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x5 && iInstructionNo == 0x6 && strstr(da.result, "CALL 003FEA59"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0x7 && strstr(da.result, "PUSH 40B169"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0x8 && strstr(da.result, "PUSH 40B132"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0x9 && strstr(da.result,"MOV EAX,[FDFDD014]"))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Clicker.MSIL.Agent.GEN"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanCurruptedFile
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for Corrupt Files
					  These files are currupted and identified by pointer to raw data and size of raw data of last section.
					  Size of raw data is out of range.	
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectTrojanCurruptedFile()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wNoOfSections >= 0 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
	{
		if(m_wNoOfSections == 0 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Currupt:Trojan.graftor.449611"));
				return VIRUS_FILE_DELETE;

		}
		for(DWORD i = 0; i<m_wNoOfSections; i++)
		{
			if(m_pSectionHeader[i].PointerToRawData > m_pMaxPEFile->m_dwFileSize && m_pSectionHeader[i].SizeOfRawData != 0 )
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Currupt:Trojan.graftor.449611"));
				return VIRUS_FILE_DELETE;
			}

		}
	}
	
	/*
	BYTE byCheckZero[8] = {0x00};
	if(m_wNoOfSections > 0 && (memcmp(m_pSectionHeader[0].Name, &byCheckZero, 7) == 0))
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("HEUR:Trojan.Win32.Generic.CUR"));
			return VIRUS_FILE_DELETE;

	}
	*/

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCrabRansom
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil Sanghai + Virus Analysis Team
	Description		: Detection routine for different varients of Crab Ransomware Family
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectCrabRansom()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	DWORD	dwRsrcOff = 0x0;
	DWORD	dwRsrcDataOff = 0x0;
	DWORD	dwoff = 0x0;
	DWORD	dwMainOff = 0x0;
	DWORD	dwFinalOff = 0x0;
	DWORD	count = 0x0;
	DWORD	dwStartOffSet = 0x00;
	bool	bPatternBritched = false;

	if ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if (m_pMaxPEFile->m_stPEHeader.NumberOfSections != 0x05 &&((m_pMaxPEFile->m_stSectionHeader[0x00].SizeOfRawData & 0x000FF) != 0x00000))
	{
		return iRetStatus;
	}

	if (m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress == 0x00 || m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size < 0x5000)
	{
		return iRetStatus;
	}

	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + 0x014;
	if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
	{
		if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
		{
			dwoff = dwoff - 0x80000000;
		}
		dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
		if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
			{
				dwoff = dwoff - 0x80000000;
			}
			dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
			if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
			{
				if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
				{
					dwoff = dwoff - 0x80000000;

				}
				dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
				if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
				{
					if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
					{
						dwoff = dwoff - 0x80000000;

					}
				}
			}
		}
	}


	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff;// + 0x010;
	dwStartOffSet = dwRsrcOff = dwRsrcOff - 0x80000000;

	for (int iResCnt = 0x00; iResCnt <= 0x05; iResCnt++)
	{

		if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
			{
				if(dwoff == 0x0)
				{
					dwRsrcOff = dwStartOffSet + (0x10 * (iResCnt + 1));
					continue;
				}
				if(m_pMaxPEFile->Rva2FileOffset(dwoff,&dwFinalOff))
				{
					BYTE	byRansomeBuffer[100] = {0x00};

					if (m_pMaxPEFile->ReadBuffer(&byRansomeBuffer[0x00],dwFinalOff,100,100))
					{
						int i = 0x00;
						int pi = 0x0;
						for (i = 0x00; i < 100; i++)
						{
							if(byRansomeBuffer[i] == 0x20 || byRansomeBuffer[i] == 0x2E)
							{
								if(pi == 1)
									pi = 0x0;
								else
									pi = 0x01;
								continue;

							}
							if(pi == 0x0)
							{
								if (i % 2 == 0x00)
								{
									if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
								else
								{
									if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
							}
							if(pi == 0x01)
							{
								if (i % 2 == 0x01)
								{
									if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
								else
								{
									if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
							}
						}
						if (i == 100)
						{
							bPatternBritched = true;
						}

					}


				}

			}

		}
		if (bPatternBritched == true)
		{
			break;
		}
		dwRsrcOff = dwStartOffSet + (0x10 * (iResCnt + 1));
	}

	if (bPatternBritched == true)
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Ransomeware.CRAB.gen"));
		iRetStatus = VIRUS_FILE_DELETE;
	}

	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareBrowsefox10
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of Browsefox.10 Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareBrowsefox10()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (m_wAEPSec==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x11200 
		&&((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)&& (m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 && m_dwAEPMapped == 0x4175 && m_dwAEPUnmapped == 0x4D75 ))
	{
		if(CheckSigInBuffer(0x13934,0x130,_T("74006F007200630068002E006500780065*620072006F0077007300650072002E006500780065*72006F0063006B00650074002E006500780065*73007000610072006B002E006500780065*7400610070006C0069006B0061002E00650078006500*620069006E006B0069006C0061006E0064002E006500780065*630072006F0073007300620072006F007700730065002E006500780065")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.browsefox.10"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;

}


/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareBrowsefoxFY
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of Browsefox.FYFamily
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareBrowsefoxFY()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (m_wAEPSec==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x8E00
		&& m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 && m_dwAEPMapped == 0x833A && m_dwAEPUnmapped == 0x8F3A)
	{
		if(CheckSigInBuffer(0x9EB0,0x1A3C,_T("61002E0061006B0061006D0061006900680064002E006E0065007400*633A5C6275696C64735C6D6F7A325F736C6176655C*6275696C645C7372635C7870636F6D5C676C75655C6E735441727261792E68")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.browsefox.FY"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareBrowsefoxGE
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of Browsefox.GE Family
					  >It Alters Registry entries.
					  >It makes changes in registry.
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdwareBrowsefoxGE()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (m_wAEPSec==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x8A00 
		&& m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x0400 && m_dwAEPMapped == 0x8098 && m_dwAEPUnmapped == 0x8C98 )
	{
		if(CheckSigInBuffer(0x9220,0x20CC,_T("61002E0061006B0061006D0061006900680064002E006E0065007400*633A5C6275696C64735C6D6F7A325F736C6176655C*6275696C645C7870636F6D5C676C75655C6E735441727261792E6800")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Adware.browsefox.GE"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanjpai
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of PAI Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanjpai()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (((m_pSectionHeader[0].Characteristics & 0xE0000020) == 0xE0000020) && ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_wNoOfSections ==0x0002 && m_wAEPSec==0x0000  
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0x1000 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x1000 && m_dwAEPMapped == m_dwAEPUnmapped)
	{
		if(CheckSigInBuffer(0x134C,0x200,_T("636233322E7064620000558BEC51*5633F656FF150C1040008D45FC5068CC1240006A0456*680C1240008975FCFF150810400085C0*7C158B45FC8B08566A0150FF51308B45*FC8B0850FF5108FF151010400056")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.heur.jp.ai0@agoftqpi"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanScarOjsz
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of Dundun Family
					  It drops Mediacenter.exe in C:\Documents and Settings\admin\Local Settings\Temp\MicroMedia\MediaCenter.exe
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanScarOjsz()
{
	int	iRetStatus = VIRUS_NOT_FOUND;

	if (((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) && m_wNoOfSections ==0x0005 && m_wAEPSec==0x0000  
		&& m_pSectionHeader[m_wAEPSec].SizeOfRawData== 0xDC00 && m_dwAEPMapped == 0x3B3A && m_dwAEPUnmapped == 0x473A)
	{
		if(CheckSigInBuffer(0xF5F0,0x5C,_T("2225732220000000506C617978363400*506C617957696E333200000077620000*2F632070696E67203132372E302E302E3120262064656C202F71202225732200636D642E65786500*6F70656E00000000000000004800")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Scar.ojsz"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}


/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanSelfDeldpaj
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of SelfDele Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanSelfDeldpaj()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x0005 && m_dwAEPMapped ==0x105A14 && m_wAEPSec ==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x195000 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SelfDeld_BUFF_SIZE = 0x59;// Size of Signature
		m_pbyBuff = new BYTE[SelfDeld_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x1EB7C8, SelfDeld_BUFF_SIZE, SelfDeld_BUFF_SIZE))//
		{
			TCHAR SelfDeld_CZ_Sig[] = {_T("68007400740070003A002F00*2F0067006F002D007300650061007200630068002E00720075002F*007300650061007200630068003F0071003D007B007300650061007200630068005400650072006D0073007D0000")};//
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SelfDeld_CZ_Sig, _T("Trojan.Win32.SelfDel.DPAJ"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], SelfDeld_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
			return iRetStatus;
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanSelfDelesqg
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients of SelfDele Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanSelfDelesqg()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x0005 && m_dwAEPMapped ==0x7E98D && m_wAEPSec ==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA5600 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int SelfDel_BUFF_SIZE = 0x4F;// Size of Signature
		m_pbyBuff = new BYTE[SelfDel_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0xB0ED, SelfDel_BUFF_SIZE, SelfDel_BUFF_SIZE))//
		{
			TCHAR SelfDel_CZ_Sig[] = {_T("837F141072048B07EB028BC78B4DF00FB61408C1EA048A9A588C4C00E8223D0000*837F141072048B07EB028BC78B4DF00FBE140883E20F8A9A588C4C00E8013D0000*8B45F0408945F03B4710")};//
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(SelfDel_CZ_Sig, _T("Trojan.Win32.SelfDel.esqg"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], SelfDel_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdwareAmontize
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + SWapnil + Virus Analysis Team
	Description		: Detection routine for different varients of AdwareAmontize Family
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectAdwareAmontize()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	bool IsDigit = false;
	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
	DWORD dwOverlaySize = m_pMaxPEFile->m_dwFileSize - (m_pSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pSectionHeader[m_wNoOfSections - 1].SizeOfRawData);

	if(m_wNoOfSections <= 6 && m_wNoOfSections >0x9)
	{
		return iRetStatus;
	}

	if((memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".rsrc", 7) == 0) && 
		m_wAEPSec == (m_wNoOfSections - 2) && dwOverlaySize >=0xC4 &&
		(m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x0400 || m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x0600))
	{

		WORD wCt0 = 0x0;
		for(int i = 0;i < (m_wNoOfSections - 0x02); i++ )
		{

			if((m_pMaxPEFile->m_stSectionHeader[i].PointerToRawData + 
				m_pMaxPEFile->m_stSectionHeader[i].SizeOfRawData +
				m_pMaxPEFile->m_stSectionHeader[i].PointerToRelocations + 
				m_pMaxPEFile->m_stSectionHeader[i].PointerToLinenumbers + 
				m_pMaxPEFile->m_stSectionHeader[i].NumberOfRelocations +
				m_pMaxPEFile->m_stSectionHeader[i].NumberOfLinenumbers) == 0x0 )
			{
				wCt0++;
			}
		}			
		if((m_wNoOfSections - wCt0) == 0x02 || (m_wNoOfSections - wCt0) == 0x03)
		{
			BYTE	byAmonetizeBuffer[0xC4] = {0x00};
			if (m_pMaxPEFile->ReadBuffer(&byAmonetizeBuffer[0x00],dwOverlayStart,0xC4,0xC4))
			{
				for (int j = 0x00; j <0xC4;j++)
				{
					if (isdigit(byAmonetizeBuffer[j]))
					{
						IsDigit = true;
						continue;
					}
					else
					{
						IsDigit = false;
						break;
					}
				}
			}
		}
		if (IsDigit == true)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:HEUR:AdWare.Win32.Amonetize.fp"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownloadSponsorPE
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Choukde + Virus Analysis Team
	Description		: Detection routine for different varients of DownloadSponsorPE Family
					  *>Those setup files can be further used to gain remote access of users coomputer in various ways. 
					  *>it creates one file in the temp folder "dmr_72.exe" 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownloadSponsorPE()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x0005 && m_dwAEPMapped ==0x25374 && m_wAEPSec ==0x0000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8B600 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int DSponsor_BUFF_SIZE = 0xCDF;// Size of Signature
		m_pbyBuff = new BYTE[DSponsor_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x14F158, DSponsor_BUFF_SIZE, DSponsor_BUFF_SIZE))//m_pSectionHeader[0x1].PointerToRawData + Address of Sign_Buff ( (Sign_Buff Address - PRD_Address[of Unpacked if Packed]) )
		{
			TCHAR DSponsor_CZ_Sig[] = {_T("44004D0052002E00650078006500*00430068006900700020004400690067006900740061006C00200047006D0062004800")};//
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DSponsor_CZ_Sig, _T("Downloader.DownloadSponsor.pe"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DSponsor_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}	
	return iRetStatus;
}


/*
-------------------------------------------------------------------------------------
	Function		: DetectDownloaderAgent
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket Choukde + Virus Analysis Team
	Description		: Detection routine for different varients of Downloader.Agent Family
					  *>it tries to download some random applications from that Website.
					  *>it always try to connect again again.	
--------------------------------------------------------------------------------------
int CSemiPolyTrojans::DetectDownloaderAgent()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( m_wNoOfSections == 0x03 && m_dwAEPMapped ==0x8190 && m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xE000 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int DAgent_BUFF_SIZE = 0x25;
		m_pbyBuff = new BYTE[DAgent_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0x0].PointerToRawData + 0x70EC, DAgent_BUFF_SIZE, DAgent_BUFF_SIZE))//m_pSectionHeader[0x1].PointerToRawData + Address of Sign_Buff
		{
			TCHAR DAgent_CZ_Sig[] = {_T("687474703A2F2F7777772E676F3839302E636F6D*2F642F436C69656E742E646C6C")};//
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(DAgent_CZ_Sig, _T("Downloader.Agent.wtpdt"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], DAgent_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);

					return VIRUS_FILE_DELETE;

				}
			}
		}
	}	
	return iRetStatus;

}
*/

/*-------------------------------------------------------------------------------------
	Function		: DetectVirus
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Agent.DKMZ Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMSILDkmz()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wNoOfSections == 0x3 && (m_dwAEPMapped ==0x37EDE || (m_dwAEPMapped & 0xFF000) == 0x38000 || m_dwAEPMapped ==0xA58E) && m_wAEPSec == 0x0 && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x37E00 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x38000 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xA400))
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int MSIL_BUFF_SIZE = 0x1000;
		m_pbyBuff = new BYTE[MSIL_BUFF_SIZE];

		DWORD dwStartBuff = 0x0;

		if(m_dwAEPMapped == 0xA58E && m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xA400)
		{
			dwStartBuff = m_pMaxPEFile->m_stSectionHeader[0].PointerToRawData + 0xC4DC;

		}
		else
		{
			dwStartBuff = m_pMaxPEFile->m_stSectionHeader[0].PointerToRawData + 0x11700;
		}

		if(GetBuffer(dwStartBuff, MSIL_BUFF_SIZE, MSIL_BUFF_SIZE))
		{
			TCHAR MSIL_Sig[] = {_T("4100700070002000530065007200760069006300650073*32002E0032002E0032002E0032*4100700070006C00690063006100740069006F006E00*4C00610079006500720053006500720076006900630065002E006500780065")};
			//A.p.p. .S.e.r.v.i.c.e.s*2...2...2...2*A.p.p.l.i.c.a.t.i.o.n.*L.a.y.e.r.S.e.r.v.i.c.e...e.x.e
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(MSIL_Sig, _T("Trojan.MSIL.Agent.dkmz"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], MSIL_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
} 

/*-------------------------------------------------------------------------------------
	Function		: DetectWindefAAQA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Windef.AAQA Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWindefAAQA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


	if(m_wAEPSec == 0 && m_pMaxPEFile->m_bIsVBFile == true && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x13A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x67000)
	{	

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int WINDEF_BUFF_SIZE = 0x64;
		m_pbyBuff = new BYTE[WINDEF_BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x0DC0,  WINDEF_BUFF_SIZE,  WINDEF_BUFF_SIZE))
		{   

			TCHAR  WINDEF_CZ_Sig[] = {_T("0435400017F9700100FFFFFF08*FC3B400090544000B4134000780000007D*6273735F736572766572")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(WINDEF_CZ_Sig, _T("Trojan.Windef.aaqa"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], WINDEF_BUFF_SIZE , szVirusName)>=0)	
			{

				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormCAC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Worm.CAC Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormCAC()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	
	if((m_wNoOfSections == 0x3 || m_wNoOfSections == 0x4)&& (m_dwAEPMapped == m_dwAEPUnmapped) && (m_wAEPSec == 0x0 || m_wAEPSec == 0x1) && (m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0xC4000 || m_pMaxPEFile->m_stSectionHeader[0].SizeOfRawData == 0x172000))
	{
		if (m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int WORM_BUFF_SIZE = 0x98;
		m_pbyBuff = new BYTE[WORM_BUFF_SIZE];
        
		
		if(GetBuffer(0xC7CA8, WORM_BUFF_SIZE, WORM_BUFF_SIZE))
		{
			TCHAR WORM_Sig[] = {_T("5C00640077006C00470069006E00610032002E0064006C006C*5C007E007E007E007E002C007E007A0033002E006500780065")};
			                      
			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(WORM_Sig, _T("Worm.Win32.Agent.cac"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], WORM_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
} 

/*-------------------------------------------------------------------------------------
	Function		: DetectPalevoHZDG
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients of Palevo.hzdg Family
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPalevoHZDG()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0 && m_wNoOfSections == 0x3 &&  m_dwAEPMapped == 0x4B15E && m_dwAEPMapped == m_dwAEPUnmapped && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x56000 && m_pMaxPEFile->m_stPEHeader.CheckSum == 0x3D1E7)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int WORM_BUFF_SIZE = 0x1F4;
		m_pbyBuff = new BYTE[WORM_BUFF_SIZE];


		if(GetBuffer(m_pSectionHeader[0].PointerToRawData + 0x11508, WORM_BUFF_SIZE, WORM_BUFF_SIZE))
		{
			TCHAR WORM_CZ_Sig[] = {_T("3130372E3136332E35362E3235313A36363538*687474703A2F2F3130372E3136332E35362E*3233323A31383936332F6D61696E2E706870*687474703A2F2F3130372E3136332E35362E*3233313A31383533302F*7777772E6B62737461722E636F6D2E6B69")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(WORM_CZ_Sig, _T("Worm.Palevo.HZDG"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],WORM_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPackedKrapJC
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Krap.JC Family
					  > It make changes in registry.
					  > It alters the registry entries.
					  > It drops file in Temp folder
					  > Dropped file is legitimate.
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectPackedKrapJC()
{
	int iRetStatus = 0x0;

	DWORD dwEPStart = 0x0;
	DWORD dwStartBuff = 0x00;

	m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_dwAEPMapped,&dwEPStart);
	if(!m_pMaxPEFile->ReadBuffer(&dwStartBuff,dwEPStart + 0x01,0x04,0x04))
	{
		return iRetStatus;
	}
	dwStartBuff = dwStartBuff + m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PACKEDKRAP_BUFF_SIZE = 0xC0;
	m_pbyBuff = new BYTE[PACKEDKRAP_BUFF_SIZE];
	int countNOP = 0;
	int countSUBADD = 0;
	int countDummyINS = 0;
	int countESIEDI = 0;
	int countDummyPP = 0;

	if(memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".NewSec", 7) == 0)
		dwStartBuff = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
	/*if(memcmp(m_pSectionHeader[m_wNoOfSections - 1].Name, ".", 1) == 0 && memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".", 1) == 0 && memcmp(m_pSectionHeader[m_wNoOfSections - 3].Name, ".", 1) == 0)
	{
	dwStartBuff = 0x1B80;

	}*/



	if(GetBuffer(dwStartBuff ,PACKEDKRAP_BUFF_SIZE,PACKEDKRAP_BUFF_SIZE))
	{
		/*if(dwStartBuff == 0x1B80)
		{
		DWORD w1 = 0x0;
		DWORD w2 = 0x0;
		for(WORD i = 0; i < PACKEDKRAP_BUFF_SIZE;i++)
		{
		w1 = m_pbyBuff[i];
		w2 = m_pbyBuff[i+1];
		w1 = w1>>4;
		w2 = w2<<4;
		m_pbyBuff[i] = (BYTE)(w1 ^ w2);

		}
		}*/

		DWORD dwLength = 0;
		t_disasm da = {0};

		int count0 = 0;

		DWORD dwOffset=0;

		do
		{
			dwOffset=dwOffset+dwLength;
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 

			if(strstr(da.result,"NOP"))
				countNOP++;

			if(strstr(da.result,"XOR ESI,ESI") || strstr(da.result,"XOR EDI,EDI"))
				countESIEDI++;

			if(countESIEDI > 0x02)
				return iRetStatus;

			if(strstr(da.result,"INC EBX") || strstr(da.result,"INC ECX") || strstr(da.result,"INC EDX") || strstr(da.result,"PUSHAD") || strstr(da.result,"POPAD") || strstr(da.result,"PUSHFD") || strstr(da.result,"POPFD"))
				count0 = 0x01;
			if((strstr(da.result,"DEC EBX") || strstr(da.result,"DEC ECX") || strstr(da.result,"DEC EDX") || strstr(da.result,"PUSHAD") || strstr(da.result,"POPAD") || strstr(da.result,"PUSHFD") || strstr(da.result,"POPFD")) && count0 == 0x01)
			{
				count0 = 0x0;
				countDummyINS++;
			}

			if(strstr(da.result,"PUSH EBX") || strstr(da.result,"PUSH ECX") || strstr(da.result,"PUSH EDX"))
				count0 = 0x01;
			if((strstr(da.result,"XOR EBX,EBX") || strstr(da.result,"XOR ECX,ECX") || strstr(da.result,"XOR EDX,EDX")) && count0 == 0x01)
				count0 = 0x02;
			if((strstr(da.result,"POP EBX") || strstr(da.result,"POP ECX") || strstr(da.result,"POP EDX")) && count0 == 0x02)
			{
				count0 = 0x0;
				countDummyPP++;
			}

			if(strstr(da.result,"SUB BYTE PTR [EAX],") || strstr(da.result,"ADD BYTE PTR [EAX],") || strstr(da.result,"XOR BYTE PTR [EAX],"))
				countSUBADD++;
		}while(dwOffset <= PACKEDKRAP_BUFF_SIZE);
	}
	//---------------------------------------- old is commented (countDummyPP,countSUBADD)------------------------------
	if(countNOP >= 0x12 && countSUBADD >= 0x06 && countESIEDI == 0x02 && countDummyINS >= 0x10 && countDummyPP >= 0x07)
		//if(countNOP >= 0x12 && countSUBADD >= 0x09 && countESIEDI == 0x02 && countDummyINS >= 0x10 && countDummyPP >= 0x09)
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.Krap.JC"));
		return VIRUS_FILE_DELETE;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCrabRansomGandCryptJZ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients of Ransomeware Family
				      Ransomeware
					  Ransomeware.GandCrypt.JZ
					  Ransomeware.GandCrypt.DM
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectCrabRansomGandCryptJZ()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	DWORD	dwRsrcOff = 0x0;
	DWORD	dwRsrcDataOff = 0x0;
	DWORD	dwoff = 0x0;
	DWORD	dwMainOff = 0x0;
	DWORD	dwFinalOff = 0x0;
	DWORD	count = 0x0;
	DWORD	dwStartOffSet = 0x00;

	bool	bPatternBritched = false;

	if ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}

	if (m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress == 0x00 || m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size < 0x5000)
	{
		return iRetStatus;
	}

	//m_pMaxPEFile->Rva2FileOffset(,&dwRsrcOff);
	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + 0x014;
	if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
	{
		if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
		{
			dwoff = dwoff - 0x80000000;
		}
		dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
		if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
			{
				dwoff = dwoff - 0x80000000;
			}
			dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
			if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
			{
				if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
				{
					dwoff = dwoff - 0x80000000;

				}
				dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
				if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
				{
					if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
					{
						dwoff = dwoff - 0x80000000;

					}
				}
			}
		}
	}


	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff;// + 0x010;
	dwStartOffSet = dwRsrcOff - 0x80000000;

	if(m_dwAEPMapped == 0x02a67)
		dwStartOffSet = dwStartOffSet + (0x10 * 0x06);
	else
		dwStartOffSet = dwStartOffSet + (0x10 * 0x08);

	if(m_pMaxPEFile->Rva2FileOffset(dwStartOffSet,&dwRsrcDataOff))
	{
		if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
		{
			if(m_pMaxPEFile->Rva2FileOffset(dwoff,&dwFinalOff))
			{
				BYTE	byRansomeBuffer[100] = {0x00};

				if (m_pMaxPEFile->ReadBuffer(&byRansomeBuffer[0x00],dwFinalOff,100,100))
				{

					int i = 0x00;
					int pi = 0x0;
					int iZeros = 0x0;
					int iNonZeros = 0x0;
					for (i = 0x00; i < 100; i++)
					{
						if (i % 2 == 0x01 && byRansomeBuffer[i] == 0x00)
						{
							iZeros++;
							continue;
						}
						if (i % 2 != 0x01 && byRansomeBuffer[i] != 0x00)
						{
							iNonZeros++;
						}

						if (byRansomeBuffer[i] == 0x00)
							continue;
						if ((byRansomeBuffer[i] < 0x5C) && (byRansomeBuffer[i] > 0x40))
							continue;
						if(byRansomeBuffer[i] == 0x3F)
							continue;
						if(byRansomeBuffer[i] == 0x20)
						{
							if(pi == 1)
								pi = 0x0;
							else
								pi = 0x01;
							continue;

						}
						if(pi == 0)
						{
							if (i % 4 == 0x2)
							{
								if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
								{
									bPatternBritched = false;
									break;
								}
							}
							else
							{
								if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
								{
									bPatternBritched = false;
									break;
								}
							}
						}
						if(pi == 1)
						{
							if (i % 4 == 0x02)
							{
								if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
								{
									bPatternBritched = false;
									break;
								}
							}
							else
							{
								if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
								{
									bPatternBritched = false;
									break;
								}
							}

						}


					}
					if (i == 100 && iZeros == 50 && iNonZeros >= 40)
					{
						bPatternBritched = true;
					}

				}


			}

		}

	}

	if (bPatternBritched == true)
	{
		if (m_dwAEPMapped == 0x02A67)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Ransomeware.GandCrypt.DM"));
		}
		else
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Ransomeware.GandCrypt.JZ"));
		}
		iRetStatus = VIRUS_FILE_DELETE;
	}
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectPackedUpantrixGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav Pakhale + Virus Analysis Team
	Description		: Detection routine for different varients : Packed.Upantrix.Gen
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectPackedUpantrixGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	const BYTE bySign_E[] = {0x57, 0x56, 0x55, 0x89, 0xE5};//EXE
	//const BYTE bySign_E1[] = {0xC7, 0x45, 0xF8, 0x00, 0x00, 0x00, 0x00};

	const BYTE bySign_D[] = {0x80, 0x7C, 0x24, 0x08, 0x01, 0x0f, 0x85};//DLL

	if(m_wNoOfSections != 3 ||  memcmp(m_pSectionHeader[0x0].Name, ".UPX0", 7) != 0 || memcmp(m_pSectionHeader[0x01].Name, ".UPX1", 7) != 0)
	{
		return iRetStatus;
	}

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	DWORD dwStartAddress = 0x0;

	const int PACKEDUPAN_BUFF_SIZE = m_pMaxPEFile->m_stSectionHeader[0x01].SizeOfRawData;
	m_pbyBuff = new BYTE [PACKEDUPAN_BUFF_SIZE];

	if(GetBuffer(m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData, PACKEDUPAN_BUFF_SIZE, PACKEDUPAN_BUFF_SIZE))
	{
		for(DWORD dwIndex = m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData;dwIndex < m_pMaxPEFile->m_stSectionHeader[0x01].SizeOfRawData; dwIndex++)
		{
			if(memcmp(&m_pbyBuff[dwIndex], bySign_E, sizeof(bySign_E)) == 0x00 || memcmp(&m_pbyBuff[dwIndex], bySign_D, sizeof(bySign_D)) == 0x00)// || memcmp(&m_pbyBuff[dwIndex], bySign_E1, sizeof(bySign_E1)) == 0x00)
			{
				dwStartAddress = dwIndex;
				break;
			}
		}
	}
	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PACKEDUPAN_BUFF_SIZE_1 = m_pMaxPEFile->m_stSectionHeader[0x01].SizeOfRawData - dwStartAddress;
	m_pbyBuff = new BYTE [PACKEDUPAN_BUFF_SIZE_1];

	dwStartAddress = dwStartAddress + m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData;
	if(GetBuffer(dwStartAddress, PACKEDUPAN_BUFF_SIZE_1, PACKEDUPAN_BUFF_SIZE_1))
	{

		DWORD dwLength = 0;
		t_disasm da = {0};
		int iNoOfIns = 0;
		int iNoOfInsMain = 0;
		DWORD dwOffset=0;
		do
		{
			dwOffset = dwOffset + dwLength;
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 

			if(strstr(da.result,"PUSH"))
				iNoOfIns++;
			else if(strstr(da.result,"MOV EBP,ESP"))
				iNoOfIns++;
			else if(strstr(da.result,"SUB ESP,"))
				iNoOfIns++;
			else if(strstr(da.result,"MOV DWORD PTR [EBP"))
				iNoOfIns++;
			else if(strstr(da.result,"MOV DWORD PTR [EBP"))
				iNoOfIns++;
			else if(strstr(da.result,"MOV ECX,10000000") || strstr(da.result,"MOV EDX,1000000") || strstr(da.result,"MOV EAX,10000000") || strstr(da.result,"MOV EBX,10000000"))
				iNoOfInsMain++;
			else if(strstr(da.result,"MOV ECX,20000000") || strstr(da.result,"MOV EDX,2000000") || strstr(da.result,"MOV EAX,20000000") || strstr(da.result,"MOV EBX,20000000"))
				iNoOfInsMain++;
			else if(strstr(da.result,"MOV EAX") || strstr(da.result,"MOV EBX") || strstr(da.result,"MOV EBCX") || strstr(da.result,"MOV EDX"))
				iNoOfIns++;

			else if(strstr(da.result,"SUB EAX,1") || strstr(da.result,"SUB EBX,1") || strstr(da.result,"SUB ECX,1") || strstr(da.result,"SUB EDX,1"))
				iNoOfInsMain++;
			else if(strstr(da.result,"JNZ SHORT"))
			{
				iNoOfInsMain++;
				break;
			}
		}while(dwOffset <= PACKEDUPAN_BUFF_SIZE_1);
		if(!(iNoOfInsMain >= 3 && iNoOfIns >= 10 && iNoOfIns <= 15))
			return iRetStatus;	
		iNoOfIns = 0;
		do
		{
			dwOffset = dwOffset + dwLength;
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 
			if(iNoOfIns == 0)
			{
				if(strstr(da.result,"XOR AL,AL") || strstr(da.result,"XOR BL,BL") || strstr(da.result,"XOR CL,CL") || strstr(da.result,"XOR DL,DL"))
					iNoOfIns++;
				if(strstr(da.result,"XOR EAX,EAX"))// || strstr(da.result,"XOR EBX,EBX") || strstr(da.result,"XOR ECX,ECX") || strstr(da.result,"XOR EDX,EDX"))
					iNoOfIns++;
				else
					continue;
			}
			else
			{
				if(strstr(da.result,"XOR AL") || strstr(da.result,"XOR BL") || strstr(da.result,"XOR CL") || strstr(da.result,"XOR DL"))
					iNoOfIns++;
				if(strstr(da.result,"[EDI]"))
					iNoOfIns++;
				if(strstr(da.result,"NOP"))
					iNoOfIns++;
				if(strstr(da.result,"ADD EDI,1"))
					iNoOfIns++;
				if(strstr(da.result,"CMP EDI,ECX"))
					iNoOfIns++;
				if(strstr(da.result,"JNZ SHORT"))
				{
					iNoOfIns++;
					break;
				}

			}

		}while(dwOffset <= PACKEDUPAN_BUFF_SIZE_1);

		if(iNoOfIns >= 6 && iNoOfInsMain >= 3 && iNoOfIns <= 15)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.Upantrix.Gen"));
			return VIRUS_FILE_DELETE;
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormNgrbotDHX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Worm.Ngrbot.dhx
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormNgrbotDHX()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if( (m_wNoOfSections == 0x0006 || m_wNoOfSections == 0x0004 )&& (m_dwAEPMapped == 0x0510 || m_dwAEPMapped == 0x1110) && m_wAEPSec == 0 &&  m_dwAEPUnmapped == 0x1110 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x84000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int NgrbotDHX_BUFF_SIZE = 0xB2C;
		m_pbyBuff = new BYTE[NgrbotDHX_BUFF_SIZE];

		DWORD dwStartBuff = 0x00;

		if(m_wNoOfSections == 0x0006)
		{
			dwStartBuff = 0xE3E8;
		}
		else
		{
			dwStartBuff = 0x109E8;
		}

		if(GetBuffer(dwStartBuff, NgrbotDHX_BUFF_SIZE, NgrbotDHX_BUFF_SIZE))
		{
			TCHAR NgrbotDHX_CZ_Sig[] = {_T("202F46202F494D206176702E657865*3661616161616161616161616161616161616161616161616161616161616161*7A7A7A7A7A7A7A7A")};
			TCHAR NgrbotDHX_CZ_Sig1[] = {_T("3661616161616161616161616161616161616161616161616161616161616161*7A7A7A7A7A7A7A7A*202F46202F494D206176702E657865")};

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(NgrbotDHX_CZ_Sig, _T("Worm.Ngrbot.DHX"), TRUE);
			polydbObj.LoadSigDBEx(NgrbotDHX_CZ_Sig1, _T("Worm.Ngrbot.DHX"), FALSE);
			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0], NgrbotDHX_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;
				}
			}
			return iRetStatus;
		}
	}	
	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectPondFullA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients : Worm.Pondfull.A (Worm.TDSS.C)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPondFullA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if (m_wNoOfSections == 0x06 && m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x1130)
	{
		const int PONDFULL_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[PONDFULL_BUFF_SIZE];	
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, PONDFULL_BUFF_SIZE);
		if(!GetBuffer(m_dwAEPMapped, PONDFULL_BUFF_SIZE, PONDFULL_BUFF_SIZE))
		{
			return iRetStatus;
		}
		
		TCHAR			bPondFullSig[] = {_T("5589E583EC18*3D910000C077*3D930000C075")};
		CSemiPolyDBScn	polydbObj;
		
		polydbObj.LoadSigDBEx(bPondFullSig, _T("Worm.Pondfull.A"), FALSE);
		TCHAR szVirusName[MAX_PATH] = {0};

		if(polydbObj.ScanBuffer(&m_pbyBuff[0],PONDFULL_BUFF_SIZE, szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdposhel_C
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Adposhel.C
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdposhel_C()
{
	int			iRetStatus = VIRUS_NOT_FOUND;
	const int	ADPOSHEL_BUFF_SIZE = 0x100;
	DWORD		dwReadOffSet = 0x00;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		if (m_wNoOfSections != 0x04 && m_wNoOfSections != 0x05 && m_wNoOfSections != 0x07)
		{
			return iRetStatus;
		}
		m_pbyBuff = new BYTE[ADPOSHEL_BUFF_SIZE];	
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		memset(m_pbyBuff, 0, ADPOSHEL_BUFF_SIZE);
		
		CSemiPolyDBScn	polydbObj;
		TCHAR			szVirusName[MAX_PATH] = {0};
		

		if (m_wNoOfSections == 0x04)
		{	
			if (m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size == 0x4C)
			{
				//polydbObj.LoadSigDBEx(_T("6963667574696C6B2E646C6C*446C6C496E7374616C6C"), _T("Trojan.Adposhel.C1"), FALSE);
				polydbObj.LoadSigDBEx(_T("2E646C6C*446C6C496E7374616C6C"), _T("Trojan.Adposhel.C"), FALSE);

				dwReadOffSet = Rva2FileOffsetEx(m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress,NULL);
				if(!GetBuffer(dwReadOffSet, ADPOSHEL_BUFF_SIZE, ADPOSHEL_BUFF_SIZE))
				{
					return iRetStatus;
				}
			}
			else
			{
				polydbObj.LoadSigDBEx(_T("65625F63656936342E646C6C*5F5074725F62"), _T("Trojan.Adposhel.C"), FALSE);

				dwReadOffSet = 0x78D10;
				if(!GetBuffer(dwReadOffSet, ADPOSHEL_BUFF_SIZE, ADPOSHEL_BUFF_SIZE))
				{
					return iRetStatus;
				}
			}
		}
		else if (m_wNoOfSections == 0x05)
		{
			if (m_pMaxPEFile->m_stPEHeader.DataDirectory[0].Size == 0x4C)
			{
				//polydbObj.LoadSigDBEx(_T("6963667574696C6B2E646C6C*446C6C496E7374616C6C"), _T("Trojan.Adposhel.C1"), FALSE);
				polydbObj.LoadSigDBEx(_T("2E646C6C*446C6C496E7374616C6C"), _T("Trojan.Adposhel.C"), FALSE);

				dwReadOffSet = Rva2FileOffsetEx(m_pMaxPEFile->m_stPEHeader.DataDirectory[0].VirtualAddress,NULL);
				if(!GetBuffer(dwReadOffSet, ADPOSHEL_BUFF_SIZE, ADPOSHEL_BUFF_SIZE))
				{
					return iRetStatus;
				}
			}
		}
		else if (m_wNoOfSections == 0x07)
		{
			dwReadOffSet = 0x85210;
			polydbObj.LoadSigDBEx(_T("64616B36343634772E646C6C*245F486173"), _T("Trojan.Adposhel.C"), FALSE);

			if(!GetBuffer(dwReadOffSet, ADPOSHEL_BUFF_SIZE, ADPOSHEL_BUFF_SIZE))
			{
				return iRetStatus;
			}
		}
		if(polydbObj.ScanBuffer(&m_pbyBuff[0],ADPOSHEL_BUFF_SIZE, szVirusName)>=0)	
		{
			if(_tcslen(szVirusName) > 0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;

			}
		}
	}
	else
	{
		if (m_wNoOfSections == 0x8 && m_dwAEPUnmapped == 0x247EB)
		{
			dwReadOffSet = 0xC66EA;
			BYTE	byAPI[] = {0x47, 0x65, 0x74, 0x41, 0x64, 0x61, 0x70, 0x74, 0x65, 0x72, 0x73, 0x49, 0x6E, 0x66};

			m_pbyBuff = new BYTE[ADPOSHEL_BUFF_SIZE];	
			if(!m_pbyBuff)
			{
				return iRetStatus;
			}
			memset(m_pbyBuff, 0, ADPOSHEL_BUFF_SIZE);

			if(!GetBuffer(dwReadOffSet, ADPOSHEL_BUFF_SIZE, ADPOSHEL_BUFF_SIZE))
			{
				return iRetStatus;
			}
			if(memcmp(&m_pbyBuff[0],&byAPI[0x00],sizeof(byAPI)) == 0x00)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Adposhel.C"));
				return VIRUS_FILE_DELETE;
			}
		}
	}


	return iRetStatus;
}

int CSemiPolyTrojans::DetectTrojRanBlockerKPUO()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections == 0x04 || m_wNoOfSections == 0x03) && (m_dwAEPMapped == 0x250C || m_dwAEPMapped == 0x3F62) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x24000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x29000) && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL && m_pMaxPEFile->m_bIsVBFile)
	{
		const int REGRUNPKE_BUFF_SIZE = 0x193;
		const BYTE byChkRT[] = {0x00,0x58,0x44,0x40,0x00,0x40,0x43,0x40,0x00,0x18,0x25,0x40};
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[REGRUNPKE_BUFF_SIZE];
		if(GetBuffer(0x44F3, 0xC, 0xC))
		{
			if(memcmp(m_pbyBuff, byChkRT, sizeof(byChkRT))== 0)
			{
				if(CheckSigInBuffer(0x7180, REGRUNPKE_BUFF_SIZE,_T("5600490052005500530000*5C0058004B005C0046006F006C00640065007200*2E0068007400740000*5C0058004B005C004E0065007700200046006F006C006400650072*002E0065007800650000*500072006F0063006500730073004D0061006E0061006700650072002E0065007800650000*4E00560043004F0044002E0065007800650000"))) 
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Blocker.kpuo"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatreGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Virus Analysis Team
	Description		: Detection routine for different varients : Dwonloader.Upatre
						Downloader.Upatre.fxzr
						Downloader.Upatre.frgb
						Downloader.Upatre.frrs
						Downloader.Upatre.frki
						Downloader.Upatre.frir
						Downloader.Upatre.frht
						Downloader.Upatre.dmid
						Downloader.Upatre.djry
						Downloader.Upatre.dfp
						Downloader.Upatre.cubu
						Downloader.Upatre.chbm
						Downloader.Upatre.bpp
						Downloader.Upatre.bla
						Downloader.Upatre.bkvd
						Trojan.upatre.gen.3 (gzip)
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatreGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if(m_wNoOfSections > 0x05)
	{
		return iRetStatus;
	}
	DWORD	dwLoaderSize = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections-1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections-1].PointerToRawData;
	if (m_pMaxPEFile->m_dwFileSize > dwLoaderSize)
	{
		DWORD	dwData2Read = m_pMaxPEFile->m_dwFileSize - dwLoaderSize;
		if (dwData2Read < 0x100)
		{
			return iRetStatus;
		}

		int UPATRE_BUFF_SIZE = 0x300;
		if (dwData2Read < 0x300)
		{
			UPATRE_BUFF_SIZE = dwData2Read;
		}

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[UPATRE_BUFF_SIZE];
		if(GetBuffer(dwLoaderSize, 0xC, 0xC))
		{
			if(m_pbyBuff[0x00] == 0x43 || m_pbyBuff[0x00] == 0x63 || (m_pbyBuff[0x02] == 0x3A && m_pbyBuff[0x04] == 0x5C))
			{

				if(GetBuffer(dwLoaderSize, UPATRE_BUFF_SIZE, UPATRE_BUFF_SIZE))
				{
					CSemiPolyDBScn	polydbObj;
					TCHAR			szVirusName[MAX_PATH] = {0};

					polydbObj.LoadSigDBEx(_T("43003A005C00*2E00650078006500*43003A005C00*2E00650078006500*43003A005C00*2E00650078006500"), _T("Trojan.Upatre.Gen"), TRUE);
					polydbObj.LoadSigDBEx(_T("43003A005C00*2E00650078006500*43003A005C00*43003A005C00*43003A005C00"), _T("Trojan.Upatre.Gen"), TRUE);
					polydbObj.LoadSigDBEx(_T("43003A005C00*43003A005C00*43003A005C00*43003A005C00*43003A005C00"), _T("Trojan.Upatre.Gen"), FALSE);

					if(polydbObj.ScanBuffer(&m_pbyBuff[0],UPATRE_BUFF_SIZE, szVirusName)>=0)	
					{
						if(_tcslen(szVirusName) > 0)
						{
							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
							return VIRUS_FILE_DELETE;

						}
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCosstaSHU
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil + Virus Analysis Team
	Description		: Detection routine for different varients : Cossta						
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCosstaSHU()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwFileSize = m_pMaxPEFile->m_dwFileSize;
	if(m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x10E4 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xA000 && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL && m_pMaxPEFile->m_bIsVBFile && dwFileSize == 0x7F000)
	{
		const int COSSTASHU_BUFF_SIZE = 0x288;
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		m_pbyBuff = new BYTE[COSSTASHU_BUFF_SIZE];
		if(CheckSigInBuffer(0x7528, COSSTASHU_BUFF_SIZE,_T("9077400000F8300000FFFFFF0800000001000000010000*744000A8744000F0104000780000007C*415053007973700000595053*20AB400030AB4000C00B000000B04000BA104000"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Cossta.shu"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorPliteBHSY
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Backdoor.Plite.bhsy						
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectBackdoorPliteBHSY()
{
	int iRetStatus = 0x0;

	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData;

	if(dwOverlayStart == 0)
		return iRetStatus;

	if(!(m_wAEPSec == 0 && m_wNoOfSections == 0x3 &&  m_dwAEPMapped == 0x019900 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6C600))
		return iRetStatus;

	DWORD dwByteCheck = 0x0;
	for(int iIndex = dwOverlayStart; iIndex <= (dwOverlayStart + 0xC0); iIndex = iIndex+2)
	{
		dwByteCheck = 0x0;
		m_pMaxPEFile->ReadBuffer(&dwByteCheck,0x02,0x02);
		if(dwByteCheck == 0x0)
			return iRetStatus;
	}

	if(CheckSigInBuffer(dwOverlayStart,0x50,_T("87110000D56F0000602E00004C6000000C540000B2250000C10D00008353*A00900008C0D0000AF190000804D0000900900004C6E")))//Decryption loop
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Plite.bhsy"));
		return VIRUS_FILE_DELETE;
	}	
	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPackedCrapJD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Packed.Krap.JD						
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectPackedCrapJD()
{
	int iRetStatus = 0x0;

	if(m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData != m_pMaxPEFile->m_dwFileSize)
		return iRetStatus;

	if(m_wNoOfSections != 0x03 && memcmp(m_pSectionHeader[0x0].Name, ".UPX0", 7) != 0 && memcmp(m_pSectionHeader[0x1].Name, ".UPX1", 7) != 0) 
		return iRetStatus;

	if(CheckSigInBuffer(m_pMaxPEFile->m_dwAEPMapped ,0x100,_T("8A03320414880349434283FA10*750231D283F90075EA58585858")))//Decryption loop
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Packed.Krap.JD"));
		return VIRUS_FILE_DELETE;
	}	
	
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanClickerCNGJ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : MSIL.Agent.cngj						
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectTrojanClickerCNGJ()
{
	int iRetStatus = 0x0;
	LPCTSTR sign1 = (_T("DCCE2FC1ECEB0057294E0916762F91351F2D3783453159B556BF962B0E47636D*474E107321663654CDFBECD4786F2AE451C8B5605C726638956EBE8DD65E63D4*5C6E246B5181D1436A34B9"));
	LPCTSTR sign2 = (_T("7A6C621A78DA4D965D92E3361284DF1DE13BE004BAC2*86BD335E4F84BD3DFE8B897D844850C43409D00028357DFAFDB220A9E7A9D5C45F556656567D7CF36B4CC1D539B8"));
	LPCTSTR sign3 = (_T("2F4171F98E6B01EC4C782396A474CD3884EE4B7019CAEAA37308975F8E67723D4E1D6039FBF9A7BC3F0C*4FB167700F30DA37AC1C795F842509920857D28B746212931202379DDE0C270165D6*BDE9ADF8FE1B05444B177E1BBBE3822D755F0D61CA8FAF2CEC5F251E8EC703"));
	DWORD dwOvStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData;
	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x08 && (m_dwAEPUnmapped == 0xaa98 || m_dwAEPUnmapped == 0xaad0) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xa400))
	{
		if(CheckSigInBuffer(dwOvStart,0x250,sign1) || CheckSigInBuffer(dwOvStart,0x250,sign2) || CheckSigInBuffer(dwOvStart,0x250,sign3))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Clicker.MSIL.Agent.cngj"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomGandCrab
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : MSIL.Agent.cngj						
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomGandCrab()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 && (m_dwAEPMapped == 0x07FE || m_dwAEPMapped == 0x0621)&& (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBA00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4A00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = m_pSectionHeader[m_wNoOfSections-2].SizeOfRawData;

		m_pbyBuff = new BYTE[BUFF_SIZE];
		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[m_wNoOfSections-2].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byRansomChk[] = {0x73, 0x00, 0x67, 0x00, 0x61, 0x00, 0x68, 0x00, 0x66, 0x00, 0x66, 0x00, 0x6A, 0x00, 0x66, 0x00, 0x67, 0x00, 0x68, 0x00, 0x6A, 0x00, 0x2E, 0x00, 0x65, 0x00, 0x78, 0x00, 0x65};//

			for(int i =0;i<m_pSectionHeader[m_wNoOfSections-2].SizeOfRawData; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byRansomChk,sizeof(byRansomChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if(GetBuffer(m_dwAEPMapped ,BUFF_SIZE,BUFF_SIZE))
				{

					DWORD dwLength = 0;
					t_disasm da = {0};
					int iInstructionNo = 0;

					DWORD dwOffset=0;

					while(dwOffset<0x100)
					{
						dwOffset=dwOffset+dwLength;

						dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 

						if(dwLength == 0x5 && iInstructionNo == 0x0 && (strstr(da.result, "CALL 004013DE") || strstr(da.result, "CALL 00403285")))
						{
							iInstructionNo++;
							continue;
						}
						else if(dwLength == 0x5 && iInstructionNo == 0x1 && strstr(da.result,"JMP 003FFE8E"))
						{
							iInstructionNo++;
							continue;
						}
						else if((dwLength == 0x1 || dwLength == 0x2)  && (iInstructionNo == 0x2 || iInstructionNo == 0x3) && (strstr(da.result, "PUSH EBP") || strstr(da.result, "TEST AL,82")))
						{
							iInstructionNo++;
							continue;
						}

						else if(dwLength == 0x6 && (iInstructionNo == 0x3 || iInstructionNo == 0x4)&& (strstr(da.result, "CMP DWORD PTR [EAX],E06D7363") || strstr(da.result, "MOV DWORD PTR [EAX],9")))
						{
							iInstructionNo++;
							continue;
						}
						else if((dwLength == 0x3 || dwLength == 0x4) && (iInstructionNo == 0x4 || iInstructionNo == 0x5) && (strstr(da.result, "MOV EAX,[EAX+14]") || strstr(da.result, "OR DWORD PTR [ESI+C],20")))
						{
							iInstructionNo++;
							continue;
						}

						else if((dwLength == 0x5 || dwLength == 0x3) && (iInstructionNo == 0x5 || iInstructionNo == 0x6) && (strstr(da.result, "CMP EAX,19930520") || strstr(da.result, "OR EAX,FFFFFFFF")))
						{
							iInstructionNo++;
							continue;
						}

						else if(dwLength == 0x5 && (iInstructionNo == 0x6 || iInstructionNo == 0x7)&& (strstr(da.result, "CMP EAX,19930521") || strstr(da.result, "JMP 00400134")))
						{
							iInstructionNo++;
							continue;
						}
						else if((dwLength == 0x5 || dwLength == 0x2) && (iInstructionNo == 0x7 || iInstructionNo == 0x8) && (strstr(da.result, "CMP EAX,1994000") || strstr(da.result, "TEST AL,40")))
						{

							_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Ransom.GandCrab.Gen"));
							return VIRUS_FILE_DELETE;
						}
					}
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomXorist
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Xorist.lr						
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectRansomXorist()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_dwAEPMapped ==0x03E0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400)		
	{	
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int RANSOM_BUFF_SIZE = 0x100;
		m_pbyBuff = new BYTE[RANSOM_BUFF_SIZE];

		if(GetBuffer(m_dwAEPMapped ,RANSOM_BUFF_SIZE,RANSOM_BUFF_SIZE))
		{

			DWORD dwLength = 0;
			t_disasm da = {0};
			int iInstructionNo = 0;

			DWORD dwOffset=0;

			while(dwOffset<0x100)
			{
				dwOffset=dwOffset+dwLength;

				dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 



				if(dwLength == 0x1 && iInstructionNo == 0x0 && strstr(da.result, "PUSH EBP"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x6 && iInstructionNo == 0x1 && strstr(da.result,"SUB ESP,2C"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x2 && strstr(da.result, "LEA EAX,[EBP-18]"))
				{
					iInstructionNo++;
					continue;
				}

				else if(dwLength == 0x5 && iInstructionNo == 0x3 && strstr(da.result, "CALL 00400103"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x3 && iInstructionNo == 0x4 && strstr(da.result, "ADD ESP,4"))
				{
					iInstructionNo++;
					continue;
				}

				else if(dwLength == 0x5 && iInstructionNo == 0x5 && strstr(da.result, "MOV EAX,0"))
				{
					iInstructionNo++;
					continue;
				}

				else if(dwLength == 0x5 && iInstructionNo == 0x6 && strstr(da.result, "MOV EAX,30000"))
				{
					iInstructionNo++;
					continue;
				}
				else if(dwLength == 0x5 && iInstructionNo == 0x7 && strstr(da.result, "MOV EAX,10000"))
				{

					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Ransom.Win32.Xorist.lr"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCrabRansomGandCryptGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Ransomeware.GandCrypt.Gen					
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectCrabRansomGandCryptGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD	dwRsrcOff = 0x0;
	DWORD	dwRsrcDataOff = 0x0;
	DWORD	dwoff = 0x0;
	DWORD	dwMainOff = 0x0;
	DWORD	dwFinalOff = 0x0;
	DWORD	count = 0x0;
	DWORD	dwStartOffSet = 0x00;
	bool	bPatternBritched = false;
	if ((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if (m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress == 0x00 || m_pMaxPEFile->m_stPEHeader.DataDirectory[2].Size < 0x5000)
	{
		return iRetStatus;
	}
	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + 0x014;
	if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
	{
		if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
		{
			dwoff = dwoff - 0x80000000;
		}
		dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
		if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
			{
				dwoff = dwoff - 0x80000000;
			}
			dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
			if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
			{
				if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
				{
					dwoff = dwoff - 0x80000000;
				}
				dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff + 0x014;
				if(m_pMaxPEFile->Rva2FileOffset(dwRsrcOff,&dwRsrcDataOff))
				{
					if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
					{
						dwoff = dwoff - 0x80000000;
					}
				}
			}
		}
	}
	dwRsrcOff = m_pMaxPEFile->m_stPEHeader.DataDirectory[2].VirtualAddress + dwoff;// + 0x010;
	dwStartOffSet = dwRsrcOff - 0x80000000;
	for( int iIndex = 0; iIndex < 10; iIndex++)
	{
		int iNoNum = 0x0;
		int iZerosEx = 0x0;
		if(m_pMaxPEFile->Rva2FileOffset(dwStartOffSet,&dwRsrcDataOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwoff,dwRsrcDataOff,0x04,0x04))
			{
				if(m_pMaxPEFile->Rva2FileOffset(dwoff,&dwFinalOff))
				{
					BYTE	byRansomeBuffer[100] = {0x00};
					if (m_pMaxPEFile->ReadBuffer(&byRansomeBuffer[0x00],dwFinalOff,100,100))
					{
						int i = 0x00;
						int pi = 0x0;
						int iZeros = 0x0;
						for (i = 0x00; i < 100; i++)
						{
							if (i % 2 == 0x01 && byRansomeBuffer[i] == 0x00)
							{
								iZeros++;
								continue;
							}
							if (byRansomeBuffer[i] == 0x00)
							{
								iZerosEx++;
								continue;
							}
							if(byRansomeBuffer[i] == 0x20 || byRansomeBuffer[i] == 0x40 || byRansomeBuffer[i] == 0x13)
							{
								if(pi == 1)
									pi = 0x0;
								else
									pi = 0x01;
								continue;
							}
							if(byRansomeBuffer[i] > 0x40 && byRansomeBuffer[i] < 0x5B && byRansomeBuffer[i-2] > 0x40 && byRansomeBuffer[i-2] < 0x5B)
							{
								iNoNum++;
								if(pi == 0)
									pi = 0x1;
								else
									pi = 0x00;
								continue;
							}
							if ((byRansomeBuffer[i] < 0x5B) && (byRansomeBuffer[i] > 0x40))
							{
								iNoNum++;
								continue;
							}
							if(byRansomeBuffer[i] == 0x1C)
								continue;
							if(byRansomeBuffer[i] <= 0x39 && byRansomeBuffer[i] >= 0x31)
							{
								iNoNum++;
								continue;
							}
							if(pi == 0)
							{
								if (i % 4 == 0x2)
								{
									if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
								else
								{
									if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
							}
							if(pi == 1)
							{
								if (i % 4 == 0x02)
								{
									if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
								else
								{
									if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
									{
										bPatternBritched = false;
										break;
									}
								}
							}	
						}
						if (i == 100 && iZeros == 50 && iNoNum < 7 && iZerosEx < 20)
						{
							bPatternBritched = true;
							break;
						}
					}
				}
			}
		}
		dwStartOffSet = dwStartOffSet + 0x10;
	}
	if (bPatternBritched == true)
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Ransomeware.GandCrypt.Gen"));
		return VIRUS_FILE_DELETE;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectKryptikDL
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Kryptik.DL					
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectKryptikDL()
{
	int iRetStatus = VIRUS_NOT_FOUND;
					
	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x6021 && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xBE00)
	{
	
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x10;
		

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byKryptikChk[] = {0xE8, 0xF6, 0x15, 0x00, 0x00, 0xE9, 0x78, 0xFE, 0xFF, 0xFF};
                                  
			for(int i =0;i<0x10; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byKryptikChk,sizeof(byKryptikChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(0x44C0,0x340,_T("8B152400410083C25583E23A83F21966899540FFFFFFC7054800410038000000*B8230000002BC223C883E114888D8BFDFFFFC78524FEFFFF01000000C7852CFF*83C82D0FB78DA0FDFFFF03C866898DA0*81C2A400000088958BFDFFFFB85800000066898598FDFFFFB977FF")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Kryptik.DL"));
					return VIRUS_FILE_DELETE;
				}

			}
		}
	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectRansomChapak
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Emotet.Gen					
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectRansomChapak()
{
	int iRetStatus = 0x0;
	bool	bPatternBritched = false;
	if(memcmp(m_pSectionHeader[0x01].Name, ".rdata", 7) != 0)
		return iRetStatus;

	DWORD dwStartArr[] = {0x210,0x6740,0x2590,0x01ED0,0x28F0,0x5870};
	for(int iMain = 0x0; iMain < 6; iMain++)
	{
		DWORD dwStart = m_pMaxPEFile->m_stSectionHeader[0x01].PointerToRawData + dwStartArr[iMain];//0x210;//0x2590;
		BYTE	byRansomeBuffer[100] = {0x00};


		if (m_pMaxPEFile->ReadBuffer(&byRansomeBuffer[0x00],dwStart,100,100))
		{
			int i = 0x00;
			int pi = 0x0;
			int iNoChange = 0x0;//This variable prevents from false detection
			for (i = 0x00; i < 100; i++)
			{
				if(byRansomeBuffer[i] == 0x20)
				{
					if(pi == 0x0)
						pi = 0x01;
					else
						pi = 0x0;
					iNoChange++;
					continue;
				}
				if(byRansomeBuffer[i] == 0x0)
				{
					if(pi == 0x0)
						pi = 0x01;
					else
						pi = 0x0;
					iNoChange++;
					continue;
				}
				if(pi == 0x0)
				{		
					if (i % 2 == 0x00)
					{
						if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
						{
							bPatternBritched = false;
							break;
						}
					}
					else
					{
						if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
						{
							bPatternBritched = false;
							break;
						}
					}
				}
				if(pi == 0x1)
				{		
					if (i % 2 == 0x00)
					{
						if (!(byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
						{
							bPatternBritched = false;
							break;
						}
					}
					else
					{
						if ((byRansomeBuffer[i] == 'a' || byRansomeBuffer[i] == 'e' || byRansomeBuffer[i] == 'i' || byRansomeBuffer[i] == 'o' || byRansomeBuffer[i] == 'u'))
						{
							bPatternBritched = false;
							break;
						}
					}
				}
				if (i == 97 && iNoChange < 0x10)
					bPatternBritched = true;
				
				if(bPatternBritched == true && iMain < 3)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Emotet.Gen.3"));//name by GData(Ransomware)
					return VIRUS_FILE_DELETE;
				}
				if(bPatternBritched == true && iMain == 3)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.rc"));//name by Kaspersky(Ransomware)
					return VIRUS_FILE_DELETE;
				}
				if(bPatternBritched == true && iMain == 4)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Chapak.mad"));//name by Kaspersky(Ransomware)
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanUrsu
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : ursu			
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectTrojanUrsu()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x00 && m_wNoOfSections == 0x00D &&  m_dwAEPMapped == 0x06E0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2C00 && m_dwAEPUnmapped == 0x12E0 
          &&((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL) 
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 3].Name, "/4", 2) == 0) 
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 8].Name, "/14", 3) == 0) 
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 9].Name, "/29", 3) == 0)
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 0x0A].Name, "/41", 3) == 0) 
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 0x0B].Name, "/55", 3) == 0) 
	  && (memcmp(m_pSectionHeader[m_wAEPSec + 0x0C].Name, "/67", 3) == 0))
	{
		if (CheckSigInBuffer(0x03264,0x055,_T("456E746572207468726573686F6C647320*666F7220412C20422C20432C2044*696E2074686174206F726465722C2064656372*656173696E672070657263656E7461676573203E20002566202566202566202566")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Gen:Variant.Trojan.ursu.206057"));
			return VIRUS_FILE_DELETE;
		}
	}  
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectStartSurfGEN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Adware.StartSurf.GEN		
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectStartSurfGEN()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x05 && (m_dwAEPMapped >= 0x4369B && m_dwAEPMapped <= 0x46B9B) && m_wAEPSec == 0x00 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData >= 0x49400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData <= 0x4CA00))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x50;
		int		iLEACnt = 0;
		int     iNOPCnt = 0;
		int		iLEACnt1 = 0;
		int		iTotalCnt = 0;


		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMultiPlugChk[] = {0x8D,0x36,0x8D,0x3F,0x55};//,0x57,0x56};

			for(int i =0;i<0x10; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMultiPlugChk,sizeof(byMultiPlugChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				t_disasm	da;
				int			iInstruction =0;
				for(DWORD dwOffset = 0x0; dwOffset < (BUFF_SIZE - MAX_INSTRUCTION_LEN);dwOffset +=dwLength)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);

					if(dwLength == 0x2 && strstr(da.result,"LEA ESI,[ESI]"))
					{
						iLEACnt++;
						continue;
					}
					else if(dwLength == 0x2 && strstr(da.result,"LEA EDI,[EDI]"))
					{
						iLEACnt1++;
						continue;
					}
					else if(dwLength == 0x1 && strstr(da.result,"NOP"))
					{
						iNOPCnt++;
						continue;
					}
					else if(dwLength == 0x6 && strstr(da.result,"AND ESP,FFFFFFFC"))
					{
						continue;
					}

				}	
				iTotalCnt = (iLEACnt + iLEACnt1 + iNOPCnt);

				if(iTotalCnt == 0x0C)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not_a_virus:Adware.StartSurf.GEN")); //Adware.MultiPlug.ofea ofem offm ofed
					return VIRUS_FILE_DELETE; 
				}
			}
		}
	}

	//Sneha
	if((m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05)&& (m_dwAEPMapped == 0x2D04B || m_dwAEPMapped == 0x2D05B || m_dwAEPMapped == 0x2EB4B || m_dwAEPMapped == 0x2E8FB || m_dwAEPMapped == 0x14230 || m_dwAEPMapped == 0x14D20 || m_dwAEPMapped == 0x2AA30 || m_dwAEPMapped == 0x32FCB) && 
		m_wAEPSec == 0x00 && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x42E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x43000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x51C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x51A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x56600 || 
		m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22C00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x165600))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x3AF;
		int	iPUSHCnt = 0; 
		int	iMOVCnt = 0; 
		int	iNOPCnt = 0; 
		int iRETCnt = 0;


		int iTotalCnt = 0;


		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[0].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMultiPlugChk[] = {0x55,0x8B,0xEC,0x5D,0xC3,0xCC};
			for(int i =0;i<0x10; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMultiPlugChk,sizeof(byMultiPlugChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				t_disasm	da;
				int			iInstruction =0;
				for(DWORD dwOffset = 0x0; dwOffset < (BUFF_SIZE - MAX_INSTRUCTION_LEN);dwOffset +=dwLength)
				{
					memset(&da, 0x00, sizeof(struct t_disasm));
					dwLength = m_objMaxDisassem.Disasm((char*)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE);

					if(dwLength == 0x1 && strstr(da.result,"PUSH EBP"))
					{
						iPUSHCnt++;
						continue;
					}
					else if(dwLength == 0x2 && strstr(da.result,"MOV EBP,ESP"))
					{
						iMOVCnt++;
						continue;
					}
					else if(dwLength == 0x1 && strstr(da.result,"POP EBP"))
					{
						iPUSHCnt++;
						continue;
					}
					else if(dwLength == 0x1 && strstr(da.result,"???"))
					{
						iRETCnt++;
						continue;
					}
					else if(dwLength == 0x1 && strstr(da.result,"NOP"))
					{
						iNOPCnt++;
						continue;
					}

				}
			}
			iTotalCnt = (iPUSHCnt + iRETCnt + iMOVCnt);

			if((iTotalCnt >= 0x2D && iTotalCnt <= 0x46)&& (iNOPCnt == 0x29A || iNOPCnt == 0x0))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not a virus:Adware.StartSurf.GEN")); 
				return VIRUS_FILE_DELETE; 
			}


		}
	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x10E79 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x34200 &&
		m_pSectionHeader[m_wAEPSec + 0x3].SizeOfRawData == 0x228000 && (memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, ".02red7", 7) == 0) ||
		(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x138DD && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x37E00 &&
		m_pSectionHeader[m_wAEPSec + 0x3].SizeOfRawData == 0x175200 && (memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, ".a2ht", 5) == 0) ||
		(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 &&  m_dwAEPMapped == 0x83E2 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2CA00 &&
		m_pSectionHeader[m_wAEPSec + 0x3].SizeOfRawData == 0x39A600 && (memcmp(m_pSectionHeader[m_wAEPSec + 0x3].Name, ".9iycm9", 7) == 0))))//added
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x50;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}
		DWORD dwStartBuff = 0x0;

		if(m_dwAEPMapped == 0x83E2)
		{
			dwStartBuff = m_pSectionHeader[m_wAEPSec + 0x4].PointerToRawData + 0x10;
		}
		else
		{
			dwStartBuff = m_pSectionHeader[m_wAEPSec + 0x3].PointerToRawData;
		}

		if(GetBuffer(dwStartBuff,BUFF_SIZE,BUFF_SIZE))
		{
			boolean bCheck = false; 
			BYTE bySartsurf[] = {0x53, 0xA7, 0x00, 0x00, 0x00, 0x3F, 0xBC, 0x00, 0x00, 0xDC, 0x96, 0xB0, 0x6B};//AdWare.StartSurf.ejfm
			BYTE bySartsurf1[] = {0x9E, 0x9F, 0xDF, 0xDC, 0x13, 0x57, 0x88, 0x38, 0xA4, 0x93, 0x55, 0x23, 0x98};//AdWare.StartSurf.eivm
			BYTE bySartsurf2[] = {0xD5, 0x4A, 0xC4, 0x0E, 0xC1, 0xA1, 0x0C, 0xEF, 0xDD, 0x50, 0xC5, 0x4B, 0x28, 0x72, 0x48, 0x19, 0x84, 0x8E, 0x75, 0x06, 0xD2, 0x39, 0xB5, 0x06};//added

			for(int i =0;i<0x50; i++)
			{
				if((memcmp(&m_pbyBuff[i],&bySartsurf,sizeof(bySartsurf)) == 0)||
					(memcmp(&m_pbyBuff[i],&bySartsurf1,sizeof(bySartsurf1)) == 0)||
					(memcmp(&m_pbyBuff[i],&bySartsurf2,sizeof(bySartsurf2)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{		
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not.a.virus.AdWare.StartSurf.ejfm"));
				return VIRUS_FILE_DELETE;

			}
		}
	}

	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackGbotANWY
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil + Virus Analysis Team
	Description		: Detection routine for different varients : Adware.StartSurf.GEN		
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectBackGbotANWY()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	DWORD dwOverlayStart = m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData;
	BYTE byGbotAnwyBuff[5] = {0x00};
	BYTE byVisuaSign[5] = {0x76,0x69,0x73,0x75,0x61};
	if (m_wNoOfSections == 0x05 && m_dwAEPMapped == 0x38D0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5000 && 
		m_pMaxPEFile->m_stPEHeader.CheckSum == 0x18ECD && (m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		if(m_pMaxPEFile->ReadBuffer(&byGbotAnwyBuff[0x00],dwOverlayStart,0x5,0x5))
		{
			if((memcmp(&byGbotAnwyBuff[0x00],byVisuaSign,sizeof(byVisuaSign)) ==0x00))
			{
				if(CheckSigInBuffer(0x92A0, 0x30,_T("2E81FABF357DF7BFF940F8BFA06DF7BF*5281FABFC876F7BF6857F7BF7958F7BF*5B7DF7BF3C00F9BF6FD1F8BF88B2F9BF"))) 
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Backdoor.Win32.Gbot.anwy"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
		return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropper
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Dropper.Agent		
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectDropper()	
{
	int iRetStatus = 0x0;
	DWORD dwStart = m_dwAEPUnmapped + 0x870;
	if(m_wAEPSec == 0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0C80 && m_dwAEPMapped == 0x402)
	{
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x0].PointerToRawData,0x150,_T("5C004400650076006900630065005C004C0061006E004D0061006E0044007200*5C0044006F00730044006500760069006300650073005C004C0061006E004D0061006E00440072007600")))//Decryption loop
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.CIS"));
			return VIRUS_FILE_DELETE;
		}
	}
	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x3) &&  m_dwAEPMapped == 0x0253F && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7000))
	{
		if(CheckSigInBuffer(m_pMaxPEFile->m_stSectionHeader[0x0].PointerToRawData + 0x0BA0,0x20,_T("8A1C0F80F35B*8819414A75F4")))//Decryption loop
		{
			if(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x7000)
				dwStart = m_dwAEPUnmapped + 0x1470;
			if(CheckSigInBuffer(dwStart,0x100,_T("5C5C2E5C4C616E4D616E447276*6965786368672E646C6C")))//lcujkbujmuim....\\.\LanManDrv...iexchg.dll
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Agent.CIS"));
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDownAdGazele
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Swapnil + Virus Analysis Team
	Description		: Detection routine for different varients : AdGazele
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDownAdGazele()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 && m_dwAEPMapped == 0x29B7 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6800 && 
	   m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress == 0x8A3C && m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData + m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData == 0xAA00)
	{	
		if(CheckSigInBuffer(0x607F, 0x2F,_T("6A088BC15E8BD080E2010FB6D2F7DA1B*D281E22083B8EDD1E833C24E75E78904*8D900046004181F9000100007CD2"))) 
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:Downloader.Win32.AdGazele.h"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectCryptoLockerDY
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.CryptoLocker
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectCryptoLockerDY()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x5711C && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x57000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int		BUFF_SIZE = 0x20;
		
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byCryptoLockerChk[] = {0x55, 0x8B, 0xEC, 0x6A, 0xFF, 0x68, 0xC0, 0x83, 0x45, 0x00, 0x68, 0xA0, 0x72, 0x45, 0x00};
                                  
			for(int i =0;i<0x20; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byCryptoLockerChk,sizeof(byCryptoLockerChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(0x56A00,0xF0,_T("8B0DF86C46008BD02BD18915EC6C46008B0D086D46008B15FC6C46002BCA*8A1C0303D788188BCA*33D28A5C31FFF7F7498A0432881C32*880431C14514078B45142BC72DD202964985C98945")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.CryptoLocker.DY"));
					return VIRUS_FILE_DELETE;
				}

			}
		}
	
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGlomaruA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Glomaru
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGlomaruA()
{
	int iRetStatus = VIRUS_NOT_FOUND;	

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0 && (m_wNoOfSections == 0x4 || m_wNoOfSections == 0x5)  &&  (m_dwAEPMapped == 0x15CA || m_dwAEPMapped == 0x76F8)  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x17200))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int GLOMARU_BUFF_SIZE = 0x60;
		m_pbyBuff = new BYTE[GLOMARU_BUFF_SIZE];

		DWORD dwStartBuff = 0x00;

		if(m_wNoOfSections == 0x5)
		{
			dwStartBuff = 0x2AEAC;
		}
		else
		{
			dwStartBuff = 0x20A0;
		}
		if(GetBuffer(dwStartBuff, GLOMARU_BUFF_SIZE, GLOMARU_BUFF_SIZE))
		{

			for(int i=0, j=0x30; i<0x50; i=i+2,j++)
			{
				*(BYTE*)&m_pbyBuff[j]=*(BYTE*)&m_pbyBuff[i]^0xAD;
			}


			TCHAR GLOMARU_CZ_Sig[] = {_T("476C6F62616C*5C4D617374657252756E")};  
			//Global\MasterRun

			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(GLOMARU_CZ_Sig, _T("Trojan.Glomaru.a"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],GLOMARU_BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectPackedKrapO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Glomaru
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectPackedKrapO()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec != 0x2 && m_dwAEPMapped !=0x14049  && m_dwAEPUnmapped !=0x15049 && m_pSectionHeader[m_wAEPSec].SizeOfRawData != 0x2E00 )		// Primary Checks
		return iRetStatus;

	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PACKED_BUFF_SIZE = 0x36;
	m_pbyBuff = new BYTE[PACKED_BUFF_SIZE];
	
	if(GetBuffer(m_dwAEPMapped ,PACKED_BUFF_SIZE,PACKED_BUFF_SIZE))
	{

		DWORD dwLength = 0;
		t_disasm da = {0};
		int iInstructionNo = 0;

		DWORD dwOffset=0;

		while(dwOffset<0x3A)
		{
			dwOffset=dwOffset+dwLength;

			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 



			if(dwLength == 0x1 && iInstructionNo == 0x0 && strstr(da.result, "PUSHFD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x1 && strstr(da.result,"PUSH EDI"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x2 && strstr(da.result, "PUSHFD"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x1 && iInstructionNo == 0x3 && strstr(da.result, "PUSH EDX"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x2 && iInstructionNo == 0x4 && strstr(da.result, "XOR EDX,ESI"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x2 && iInstructionNo == 0x5 && strstr(da.result, "XCHG EBP,EBP"))
			{
				iInstructionNo++;
				continue;
			}

			else if(dwLength == 0x5 && iInstructionNo == 0x6 && strstr(da.result, "MOV EDX,BC0CA701"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x7 && strstr(da.result, "POP EDX"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x8 && strstr(da.result, "POPFD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x6 && iInstructionNo == 0x9 && strstr(da.result,"ADC EDI,F36BC930"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x2 && iInstructionNo == 0xA && strstr(da.result,"SUB EDI,EDX"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0xB && strstr(da.result,"POP EDI"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0xC && strstr(da.result,"POPFD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0xD && strstr(da.result,"PUSHFD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0xE && strstr(da.result,"PUSH EDX"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x5 && iInstructionNo == 0xF && strstr(da.result,"MOV EDX,FC5268E1"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x6 && iInstructionNo == 0x10 && strstr(da.result,"ADD EDX,F59A9768"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x11 && strstr(da.result,"POP EDX"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x12 && strstr(da.result,"POPFD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x1 && iInstructionNo == 0x13 && strstr(da.result,"PUSHAD"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x2 && iInstructionNo == 0x14 && strstr(da.result,"XOR EAX,EAX"))
			{
				iInstructionNo++;
				continue;
			}
			else if(dwLength == 0x3 && iInstructionNo == 0x15 && strstr(da.result,"LEA ECX,[EAX+A]"))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Packed.Krap.O"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDropperRSJ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Dropper.Dinwod.RSJ
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDropperRSJ()
{
	int iRetStatus = 0x0;

	DWORD dwOverSize = 0x0;
	dwOverSize = m_pMaxPEFile->m_dwFileSize - m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].PointerToRawData - m_pMaxPEFile->m_stSectionHeader[m_wNoOfSections - 1].SizeOfRawData;

	if(dwOverSize == 0x0)
		return iRetStatus;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;


		if (CheckSigInBuffer(m_pMaxPEFile->m_dwFileSize - 0x300,0x300,_T("5365727665722E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865*54770000496E666563742E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Dropper.Dinwod.RSJ"));//server.exe// infect.exe(8 times at last 300 bytes)
			return VIRUS_FILE_DELETE;
		}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGenerickd
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Generickd
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGenerickd()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x08 &&  m_dwAEPMapped == 0x1355A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x135600)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x15;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byGenerickdChk[] = {0x55, 0x8B, 0xEC, 0x83, 0xC4, 0xE4, 0x53, 0x56, 0x57, 0x33, 0xC0, 0x89, 0x45, 0xEC};

			for(int i =0;i<0x15; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byGenerickdChk,sizeof(byGenerickdChk)) == 0))
				{
					bCheck =  true;

				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(0x99F40,0x100,_T("687474703A2F2F686973732E61707072697365732E72752F*747261636B696E672F696E7374616C6C65723F6969643D")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Generickd.31204955"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectSalgoreaB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha Kurade + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Salgorea.B
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSalgoreaB()
{
	int iRetStatus = VIRUS_NOT_FOUND;					

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x10B75 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x29000 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x15;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	bySalgoreaB[] = {0x55, 0x8B, 0xEC, 0x6A, 0xFE, 0x68, 0xB8, 0x1E, 0x43, 0x00, 0x68, 0xF0, 0x99, 0x41, 0x00};

			for(int i =0;i<0x15; i++)
			{
				if((memcmp(&m_pbyBuff[i],&bySalgoreaB,sizeof(bySalgoreaB)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(0x3090,0x100,_T("C1C007C1C90B33C88BC6C1C806*33471C03C181C29144377103D0*C1C90D33C88B45D8C1C802*C1C007C1C90B33C88BC7C1C806*8B521C81C2CFFBC0B5")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Salgorea.B"));
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectEmotetBankerGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Swapnil + Virus Analysis Team
	Description		: Detection routine for different varients : EmotetBanker
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectEmotetBankerGen()
{
	int iRetStatus = 0x0;

	DWORD dwImportTBL = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x01].VirtualAddress;
	if((m_wAEPSec == 0x0 && (m_wNoOfSections == 0x04 || m_wNoOfSections == 0x05 || m_wNoOfSections == 0x06) &&  
		(m_dwAEPMapped == 0x6CBE || m_dwAEPMapped == 0x1D42 || (m_dwAEPMapped & 0xF000) == 0xA000 || m_dwAEPMapped == 0x154B || m_dwAEPMapped == 0x107A2)) && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x22E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x18200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xC000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x24000 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x12000) && 
		(dwImportTBL == 0x32E1C || dwImportTBL == 0x1C25C || dwImportTBL == 0x2781C || dwImportTBL == 0x24158 || dwImportTBL == 0x1506C || dwImportTBL == 0x15070))
	{

		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x06].Size == 0)
			return iRetStatus;
		DWORD dwBuffStart = 0x0;
		DWORD dwBuffSize = 0x0;
		dwBuffStart = m_pMaxPEFile->m_stPEHeader.DataDirectory[0x06].VirtualAddress;
		m_pMaxPEFile->Rva2FileOffset(dwBuffStart,&dwBuffStart);
		m_pMaxPEFile->ReadBuffer(&dwBuffSize,dwBuffStart + 0x010,0x04,0x04);
		m_pMaxPEFile->ReadBuffer(&dwBuffStart,dwBuffStart + 0x018,0x04,0x04);

		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("00633A5C68656176795C73686F756C645C686967685C636F6173745C57*6865656C5C46696E6973685C73696D706C655C6265656E4C6F73742E70646200")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.IcedID.teyr"));
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("00633A5C656173745C77686F73655C686F745C426F74685C*64657363726962655C6E6F746963655C73696E63656C6F76652E706462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-PSW.Win32.Azorult.vu")); 
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("633A5C5468616E6B5C63686F6F73655C73656C656374*5C4E6F7468696E675C447261775C4461795C4C6561645C486F6C654F6E63652E706462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.IcedID.hcp"));
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("52534453F1C6DED0C6329A4E90C61270F9B57E*B40100000077684023237765682E506462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.Emotet.bqip"));
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("5253445392CB27A1C4C2BE40AA34E2FC232472DE*0100000077684023237765682E506462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.Emotet.bqjh"));
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("525344538DFD2AB3D2527744A93D6EBCB9419C7B*0100000077684023237765682E506462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.Emotet.bqjl"));
			return VIRUS_FILE_DELETE;
		}
		if (CheckSigInBuffer(dwBuffStart,dwBuffSize,_T("525344538216FE776AF5B44A8C9BAB389ACA0B94*010000004A45524A57484554574023234852456A77722E506462")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan-Banker.Win32.Emotet.bqcj"));
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectEmotetBankerGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Nakuru.A
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectNakuraA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x4 && m_wAEPSec == 0x01 && m_dwAEPUnmapped == 0x5A9DC && m_dwAEPMapped == 0x59DDC &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x57400 || m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x58000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3E200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3F000 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3F000 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x58000 &&
		(m_pSectionHeader[m_wAEPSec].Characteristics & 0xE0000020) == 0xE0000020 || (m_pSectionHeader[m_wAEPSec].Characteristics & 0xE0000060) == 0xE0000060 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x9F000 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x118 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x9].VirtualAddress == 0x96070 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x9].Size == 0x18)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		const int NAKURA_BUFF_SIZE = 0x2A0;
		m_pbyBuff = new BYTE[NAKURA_BUFF_SIZE];
		DWORD dwBuffSize = 0x1A0;


		if( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3E200 )
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xAB0, 0x1A0, 0x1A0))
			{
				return iRetStatus;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x47400, 0x90, 0x90))
			{
				return iRetStatus;
			}

		}
		else if( m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3F000 )
		{
			if(!GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData + 0xAB0, 0x1A0, 0x1A0))
			{
				return iRetStatus;
			}
			if(!m_pMaxPEFile->ReadBuffer(&m_pbyBuff[dwBuffSize], m_pSectionHeader[m_wAEPSec].PointerToRawData + 0x49000, 0x40, 0x40))
			{
				return iRetStatus;
			}

		}


		dwBuffSize += 0x90;

		TCHAR NAKURA_SIG[] = {_T("4B53504F4F4C442E545854*6B73706F6F6C642E657865*61766D6574657233322E646C6C*006C642E65786500*00520043005800*0074006D007000")};
		CSemiPolyDBScn polydbObj;		
		polydbObj.LoadSigDBEx(NAKURA_SIG, _T("Virus.Win32.Nakuru.A"), FALSE);

		TCHAR szVirusName[MAX_PATH] = {0};
		if(polydbObj.ScanBuffer(&m_pbyBuff[0], dwBuffSize, szVirusName) >= 0)
		{
			if(_tcslen(szVirusName)>0)
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
				return VIRUS_FILE_DELETE;
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectEmotetBankerGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : BankerEmotet
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectBankerEmotetSB()
{
	int iRetStatus = 0x0;
	int count = 0x0;


	if(m_wNoOfSections < 0x05)
		return iRetStatus;

	int i = 0x0;
	int ct = 0x0;
	for(i; i < m_wNoOfSections; i++)
	{
		if(memcmp(m_pSectionHeader[i].Name, ".reloc", 5) == 0)
			break;
	}

	i++;

	if(m_wNoOfSections - i < 3)
		return iRetStatus;

	for(i; i < m_wNoOfSections - 1; i++)
	{
		if(m_pMaxPEFile->m_stSectionHeader[i].SizeOfRawData >= 0x1000)
		{
			int ii = 0x0;
			DWORD dwSum = 0x0;
			DWORD dwADD = 0x0;
			do
			{
				if(m_pMaxPEFile->ReadBuffer(&dwADD,m_pMaxPEFile->m_stSectionHeader[i].PointerToRawData +  
					ii,0x04,0x04))
				{
					dwSum = dwSum + dwADD;
				}
				ii = ii + 0x04;
			}while(ii <= m_pMaxPEFile->m_stSectionHeader[i].SizeOfRawData );
			if(dwSum != 0)
				break;
			else
				ct++;
		}

	}
	if(ct >= 1 && i == m_wNoOfSections - 1)
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.Win64.Emotet.sb"));
		return VIRUS_FILE_DELETE;
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectChapakBNBM
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Chapak
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectChapakBNBM()
{
	int iRetStatus = 0x0;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x05 &&  m_dwAEPMapped == 0x15bbf && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2da00 )
	{
		DWORD dwStartOff = 0x0;
		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].Size == 0x0)
			return iRetStatus;

		if(m_pMaxPEFile->Rva2FileOffset(m_pMaxPEFile->m_stPEHeader.DataDirectory[0x0].VirtualAddress + 0x0C,&dwStartOff))
		{
			if(m_pMaxPEFile->ReadBuffer(&dwStartOff,dwStartOff,0x04,0x04))
			{
				m_pMaxPEFile->Rva2FileOffset(dwStartOff,&dwStartOff);
			}
		}
		if(CheckSigInBuffer(dwStartOff,0x050,_T("54656D706C6174656C45786546696C652E6578*65003F3F30564D656D4D67724061736D6A6974404051414540504158405A003F3F*564D656D4D67724061736D6A6974404051414540585A00")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.bnbm"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanReconycFXMS
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Jay Prakash + Virus Analysis Team
	Description		: Detection routine for different varients : Reconyc
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanReconycFXMS()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x000A && m_dwAEPMapped == 0x566A8 && m_dwAEPUnmapped == 0x572A8 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x56400 && (m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400) && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".aspack", 7) == 0))
	{ 
		
		if(CheckSigInBuffer(m_pSectionHeader[0].PointerToRawData + 0x54458,0xD0,_T("6B617639782E657865*6B617673766339782E657865*736D656E752E657865*7261766D6F6E2E657865*70617373776F726467756172642E657865*76706333322E657865*776174636865722E657865")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Win32.Reconyc.FXMS")); 
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectFearsoB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Fearso
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectFearsoB()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x06 &&  m_dwAEPMapped == 0xCE38 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xCC00 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x15;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(GetBuffer(m_dwAEPMapped,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byFearsoB[] = {0x55, 0x8B, 0xEC, 0x83, 0xC4, 0xC4, 0xB8, 0x98, 0xD9, 0x40, 0x00, 0xE8, 0xC0, 0x5D, 0xFF, 0xFF};

			for(int i =0;i<0x15; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byFearsoB,sizeof(byFearsoB)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(0x50EE,0x100,_T("66BB01008BC6E86BD0FFFF0FB7EB8B160FB6542AFF*83EA64885428FF4366FFCF75E2")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Fearso.b"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAdWareStartSurf
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Jay Prakash + Virus Analysis Team
	Description		: Detection routine for different varients : Fearso
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAdWareStartSurf()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	// not-a-virus:AdWare.Win32.StartSurf.ekzb 
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x005 && m_dwAEPMapped == 0xCE69 && m_dwAEPUnmapped == 0xDA69 && m_pSectionHeader[m_wNoOfSections - 2].SizeOfRawData == 0x48fa00 && (m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x3d600) && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".cwh7n", 7) == 0))
	{ 
		if(CheckSigInBuffer(0x486B0,0x100,_T("5D5FABDE05AA9E314D2784735AB06F0E169F636FC3CB4680FA8ED96BF1D65C7E636E*2A484576458F7A0E4169DD0F77A2F2156D9928873A264324")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:AdWare.Win32.StartSurf.EKZB")); 
			return VIRUS_FILE_DELETE;
		}
	}

	// not-a-virus:AdWare.Win32.StartSurf.ekyx
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x005 && m_dwAEPMapped == 0xA979 && m_dwAEPUnmapped == 0xB579 && m_pSectionHeader[m_wNoOfSections - 2].SizeOfRawData == 0x51c000 && (m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x3b200) && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".rwg0a", 7) == 0))
	{ 
		if(CheckSigInBuffer(0x2939B7,0x100,_T("2738762D2163764B1B37A7DDA4D1C06E42643F83D1434A5F6D5C35724E68*3C596E63182AA4B8F91816FFBF8124CFB2D8CA6CBE66B47ADD80")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:AdWare.Win32.StartSurf.EKYX")); 
			return VIRUS_FILE_DELETE;
		}
	}

	// not-a-virus:AdWare.Win32.StartSurf.eivp
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x006 && m_dwAEPMapped == 0xA6A9 && m_dwAEPUnmapped == 0xB2A9 && m_pSectionHeader[m_wNoOfSections - 2].SizeOfRawData == 0xD8200  && (m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData == 0x169600) && (memcmp(m_pSectionHeader[m_wNoOfSections - 3].Name, ".0ewa", 7) == 0) && (memcmp(m_pSectionHeader[m_wNoOfSections - 2].Name, ".1i7g5", 7) == 0))
	{ 
		if(CheckSigInBuffer(0x3E4B0,0x100,_T("F756FC5B2CDDF5A0D409225B26C5262DD09825B6D70BA6E755C84C82CF*2C507D7C56F6F7590ABFAAE7995B7D160E4D69463B")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virus:AdWare.Win32.StartSurf.EIVP")); 
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWORMBAGLEZ
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Mukesh + Virus Analysis Team
	Description		: Detection routine for different varients : Fearso
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWORMBAGLEZ()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 &&  (m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04) && (m_dwAEPMapped == 0x4448 || m_dwAEPMapped == 0x0310 ||m_dwAEPMapped == 0x4248) && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4400
		|| m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200 ||m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x9000))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x27;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		DWORD dwStartBuff = 0x00;

		if((memcmp(m_pSectionHeader[m_wAEPSec].Name, "UPX0", 4) == 0))
		{
			dwStartBuff =  0x6220;
		}
		else if(m_wNoOfSections == 0x04)
		{
			dwStartBuff =  0x5420;
		}
		else 
		{
			dwStartBuff= 0x5A24;
		}

		if(GetBuffer(dwStartBuff, 0x27, 0x27))
		{
			for(int i=0; i<0x26; i++)
			{
				*(BYTE*)&m_pbyBuff[i] = ~(*(BYTE*)&m_pbyBuff[i]);
				*(BYTE*)&m_pbyBuff[i] = *(BYTE*)&m_pbyBuff[i]^05;

			}

			TCHAR WORMBAGLEZ_CZ_Sig[] = {_T("534F4654574152455C54696D65006472*7664646C6C2E657865005C64727664646C6C2E657865")};  


			CSemiPolyDBScn polydbObj;
			polydbObj.LoadSigDBEx(WORMBAGLEZ_CZ_Sig, _T("Worm.Bagle.z"), FALSE);

			TCHAR szVirusName[MAX_PATH] = {0};

			if(polydbObj.ScanBuffer(&m_pbyBuff[0],BUFF_SIZE , szVirusName)>=0)	
			{
				if(_tcslen(szVirusName) > 0)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, szVirusName);
					return VIRUS_FILE_DELETE;

				}
			}

		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectApplicationBundleiStartSurfAEO
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Fearso
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectApplicationBundleiStartSurfAEO()
{
	int iRetStatus = 0x0;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
	{
		return iRetStatus;
	}
	if( m_wNoOfSections == 0x4 && m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x22392 && m_dwAEPMapped == 0x21792 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x3b200 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x3b035 && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
		(m_pSectionHeader[m_wAEPSec].Characteristics & 0xE0000060) == 0x60000020 &&
		m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].VirtualAddress == 0x4ec20 && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x1].Size == 0x28 )
	{

		if (CheckSigInBuffer(0x488CC,0x2EA,_T("643A5C6C69625C626F6F73745F315F36385F305C626F6F73745C67656F6D657472795C696E6465785C64657461696C5C657863657074696F6E2E687070*643A5C6C69625C626F6F73745F315F36385F305C626F6F73745C67656F6D657472795C616C676F726974686D735C64657461696C5C7468726F775F6F6E5F656D7074795F696E7075742E687070")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Application.Bundler.iStartSurf.AEO"));
			return VIRUS_FILE_DELETE;
		}
		else if(CheckSigInBuffer(0x488D0,0x2EA,_T("643A5C6C69625C626F6F73745F315F36385F305C626F6F73745C67656F6D657472795C696E6465785C64657461696C5C657863657074696F6E2E687070*643A5C6C69625C626F6F73745F315F36385F305C626F6F73745C67656F6D657472795C616C676F726974686D735C64657461696C5C7468726F775F6F6E5F656D7074795F696E7075742E687070")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Application.Bundler.iStartSurf.AEO"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBackdoorPaddorGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Gaurav + Virus Analysis Team
	Description		: Detection routine for different varients : Padodor
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectBackdoorPaddorGen()
{
	int iRetStatus = 0x0;

	if(!((m_wAEPSec == 0x04 && m_wNoOfSections == 0x005 &&  m_dwAEPMapped == 0x10600 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x200 && m_pSectionHeader[m_wAEPSec].VirtualAddress == m_dwAEPUnmapped && m_dwAEPUnmapped == 0x32000) && (memcmp(m_pSectionHeader[m_wAEPSec].Name, ".ajelhf", 7) == 0) ))
	{
		return iRetStatus;
	}
	DWORD dwEPStart = 0x0;
	DWORD dwStartBuff = m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].PointerToRawData;


	if(m_pbyBuff)
	{
		delete []m_pbyBuff;
		m_pbyBuff = NULL;
	}

	const int PADDOR_BUFF_SIZE = m_pMaxPEFile->m_stSectionHeader[m_wAEPSec].SizeOfRawData;
	
	m_pbyBuff = new BYTE[PADDOR_BUFF_SIZE];
	int countNOP = 0;
	int iMainInsXOR = 0;

	if(GetBuffer(dwStartBuff ,PADDOR_BUFF_SIZE,PADDOR_BUFF_SIZE))
	{

		DWORD dwLength = 0;
		t_disasm da = {0};
		DWORD dwOffset=0;
		do
		{
			dwOffset=dwOffset+dwLength;
			dwLength = m_objMaxDisassem.Disasm((char *)&m_pbyBuff[dwOffset], MAX_INSTRUCTION_LEN, 0x400000, &da, DISASM_CODE); 

			if(strstr(da.result,"NOP"))
				countNOP++;
			if(strstr(da.result,"XOR ["))
				iMainInsXOR++;

		}while(dwOffset <= PADDOR_BUFF_SIZE);
	}
	if(countNOP >= 0x55 && iMainInsXOR >= 0x02) 
	{
		_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Backdoor.Win32.Padodor.gen"));
		return VIRUS_FILE_DELETE;
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectAgentdjcr
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sagar + Virus Analysis Team
	Description		: Detection routine for different varients : Agent.djcr
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectAgentdjcr()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x2 && m_wAEPSec == 0x00 && m_dwAEPUnmapped == (m_dwAEPMapped + 0xc00) && m_dwAEPMapped == 0xc5f6 || m_dwAEPMapped == 0xf2b6   && m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 )
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}
		DWORD m_dwsignoffset=0x0;
		if(m_dwAEPMapped==0xf2b6)
		{
			m_dwsignoffset=0x2A240;
			if(CheckSigInBuffer(m_dwsignoffset, 0x30,_T("4637746F4D5047437A6D645934637379*515100006D796170702E657865*364B3732384C3667416B7168734A5346")))
			{                        

				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virusAdWare.Win32.Agent.DJCR"));
				return VIRUS_FILE_DELETE;

			}
		}
		else if(m_dwAEPMapped==0xc5f6)
		{

			if(CheckSigInBuffer(0x2bfc0, 0x30,_T("62756767657250726573656E74000000*6D796170702E65786500*530045004C0045004300540020002A00")))
			{                        

				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("not-a-virusAdWare.Win32.Agent.DJCR"));
				return VIRUS_FILE_DELETE;

			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: Detectcerbu25355
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sagar + Virus Analysis Team
	Description		: Detection routine for different varients : 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::Detectcerbu25355()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x1 && m_wAEPSec == 0x0 && m_dwAEPUnmapped == 0X0  &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x00200 && 
		m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].Misc.VirtualSize)
		)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		WORD forcheckmz1;
		WORD offsetofmz1=0x00;
		m_pMaxPEFile->ReadBuffer(&forcheckmz1,offsetofmz1,0x2,0x2);
		if(forcheckmz1 ==0x5A4D)
		{
			WORD offsetofPE=0x0;
			m_pMaxPEFile->ReadBuffer(&offsetofPE,0x3c,0x2,0x2);
			if(offsetofPE==0x40)
			{
				WORD forcheckmz2;
				m_pMaxPEFile->ReadBuffer(&forcheckmz2,0x200,0x2,0x2);
				if(forcheckmz2 ==0x5A4D)
				{
					DWORD d_wforsearchstring;
					d_wforsearchstring=m_pMaxPEFile->m_dwFileSize- 0x64;  
					if(CheckSigInBuffer(d_wforsearchstring, 0x40,_T("44554D505448494E*5350434B2169742069732061*5B283F726964646C653F292077726170706564")))
						//if(dwStrtBuff)
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.cerbu.25355"));
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectGenericKDZ51306
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sagar + Virus Analysis Team
	Description		: Detection routine for different varients : 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectGenericKDZ51306()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x03)
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		const int GENKDZ51306_BUFF_SIZE = 0xA;
		m_pbyBuff = new BYTE[GENKDZ51306_BUFF_SIZE];

		bool IsDigit = false;

		if(GetBuffer(0x2236, GENKDZ51306_BUFF_SIZE, GENKDZ51306_BUFF_SIZE))
		{
			if((*(BYTE*)&m_pbyBuff[0x0] == 'x') && (*(BYTE*)&m_pbyBuff[0x5] == 'y') && (*(BYTE*)&m_pbyBuff[0x6] == '.') &&
				(*(BYTE*)&m_pbyBuff[0x7] == 'e') && (*(BYTE*)&m_pbyBuff[0x8] == 'x') && (*(BYTE*)&m_pbyBuff[0x9] == 'e'))
			{

				for(int i = 1; i<=4; i++)
				{

					if (isdigit(m_pbyBuff[i]))
					{
						IsDigit = true;
						continue;
					}
					else
					{
						IsDigit = false;
						break;
					}
				}
			}
		}
		if (IsDigit == true)
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.GenericKDZ.51306"));
			return VIRUS_FILE_DELETE;
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMSILGEN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMSILGEN()
{

	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 &&  m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0xB245E  && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xB2000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(GetBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD	dwLength = 0;
			boolean bCheck = false; 
			BYTE	byMINER[] = {0x05,0x00,0x48,0x1E,0x0B,0x00,0xC0,0x15,0x00,0x00,0x03,0x00,0x00,0x00,0x15,0x00,0x00,0x06,0x00};

			for(int i =0;i<0xF; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMINER,sizeof(byMINER)) == 0))
				{

					if (CheckSigInBuffer(0xB6E90,0xE0,_T("74006500730074002E0065007800650000*53006E0044006B002600700000*31002E0030002E0030002E00300000")))
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Generic"));
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}

	}

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x003 && m_dwAEPMapped == 0x14F1E && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x14000) 
	{ 
		if(CheckSigInBuffer(0x151B0,0x1D0,_T("62006400410077006C0079006F0075002E0065007800650000*30002E0030002E0030002E00300000*30002E0030002E0030002E00300000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.MSIL.Generic")); 
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

int CSemiPolyTrojans::DetectDownloaderNSISHafengen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0x331d && m_dwAEPMapped == 0x271d &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x6000 &&
		m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x5e3a && m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
		(memcmp(m_pSectionHeader[m_wNoOfSections-2].Name, ".ndata", 5) == 0) && m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].Size != 0)
	{
		DWORD m_dwforoverlay=m_pSectionHeader[m_wNoOfSections-1].PointerToRawData + m_pSectionHeader[m_wNoOfSections-1].SizeOfRawData;

		if(CheckSigInBuffer(m_dwforoverlay, 0x10,_T("377ABCAF271C00*048D9BD50F0000")))
		{
			if(m_dwforoverlay != m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].VirtualAddress)
			{
				if((m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].VirtualAddress + m_pMaxPEFile->m_stPEHeader.DataDirectory[0x04].Size) > m_pMaxPEFile->m_dwFileSize)
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.NSIS.Hafen.gen"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectWormZafiB
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Zafi
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectWormZafiB()
{

	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x02 || m_wNoOfSections == 0x03 && (m_dwAEPMapped == 0x30FB && m_dwAEPUnmapped == 0xBEFB) || (m_dwAEPMapped == m_dwAEPUnmapped) && m_wAEPSec == 0x001 || m_wAEPSec == 0x000 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2FF4 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 )
	{

		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int BUFF_SIZE = 0x15;

		m_pbyBuff = new BYTE[BUFF_SIZE];
		
		DWORD dwBufferStart = 0x00;

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(dwBufferStart,BUFF_SIZE,BUFF_SIZE))
		{
			DWORD   dwLength = 0;
			boolean bCheck = false; 
			BYTE byZafiChk[] = {0x4D,0x5A,0x90,0x00,0x03,0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x50,0x45,0x00,0x00,0x4C,0x01 };

			for(int i =0;i<0x15; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byZafiChk,sizeof(byZafiChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData,0x35,_T("6A0720683D73400EAD6D0BF2A702E8B7*2A0E01C6054250B1222E6F551301222B*22EA65C70B3DB708030F856004180CB8")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Zafi.B"));
					return VIRUS_FILE_DELETE;
				}
				else if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec].PointerToRawData,0x35,_T("6A20683D734000686D7340006A006A00*6A00E86D2A0000C6054250400000686F*5540006A016A00E8222A0000E8652A00")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Zafi.B"));
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectUpatreA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Upatre.A
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectUpatreA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 &&  (m_wNoOfSections == 0x005 || m_wNoOfSections == 0x003) && (m_dwAEPMapped == 0x0420 || m_dwAEPMapped == 0x0200 || m_dwAEPMapped == 0x0400 || m_dwAEPMapped == 0x1000)  && (m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0400 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1200 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x03AB)) 
	{
		if(m_dwAEPMapped == 0x0420)
		{
			if(CheckSigInBuffer(0x940,0x1B0,_T("76006100720075006E006D0061006900720061002E0063006F006D*67006F002D0071007500690063006B0079002E0063006F006D*730061006D00680065002E006500780065*640061006800650064002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Upatre.a")); 
				return VIRUS_FILE_DELETE;
			}
		}
		else if(m_dwAEPMapped == 0x0200)
		{
			if(CheckSigInBuffer(0x1270,0x190,_T("6600660065006E00670068002E006500780065*6400720069007000700069006E0067007300740072006100*7700620065007200720079002E0063006F006D*2F006C0069006E0065002F0031006F00740070002E00650078006500*68006600730072006600670073002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Upatre.a")); 
				return VIRUS_FILE_DELETE;
			}
		}
		else if(m_dwAEPMapped == 0x0400)
		{
			if(CheckSigInBuffer(0x890,0x160,_T("6600630062006E00610066002E006500780065*3100710061007A0078007300770032*6800750079006F006E0074006F0070002E0063006F006D*610067006F00720070002E006500780065*6E00640064006B006A0065002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Upatre.a")); 
				return VIRUS_FILE_DELETE;
			}
		}
		else if(m_dwAEPMapped == 0x1000)
		{
			if(CheckSigInBuffer(0x2070,0x160,_T("68006600640066006A0064006B002E006500780065*630065002D0063006C006F00750064002E0063006F006D*2F0069006D0061006700650073002F006E006F00740065002E006500780065*63006B006A00690065006E006E002E006500780065")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Downloader.Upatre.a")); 
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectDostreA
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Dostre.A
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectDostreA()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x1FD0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x2000)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x30;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		BYTE byDostre[] = {0x25, 0x73, 0x2E, 0x65, 0x78, 0x65, 0x00, 0x00, 0x64, 0x6C, 0x6C ,0x72};

		if(GetBuffer (m_pSectionHeader[m_wNoOfSections - 2].PointerToRawData + 0x40, BUFF_SIZE, BUFF_SIZE))
		{ 
			for(int i =0;i<0x30; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byDostre,sizeof(byDostre)) == 0))
				{
					if (CheckSigInBuffer(0x1680,0x50,_T("8BC133D2F7F38A042A8A1431*32D0881431413BCF72EA")))
					{
						_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Dostre.a"));
						return VIRUS_FILE_DELETE;
					}
				}
			}
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectMinerGen
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Miner
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectMinerGen()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && (m_wNoOfSections == 0x05 || m_wNoOfSections == 0x07) &&  (m_dwAEPMapped == 0xA185B || m_dwAEPMapped == 0x16A6F4 || m_dwAEPMapped == 0x52BC0 || m_dwAEPMapped == 0x16BEB0) && 
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x113800 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1B8A00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x93E00 || m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x1BB600))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0xF;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(GetBuffer(m_pMaxPEFile->m_dwFileSize - 0xF,BUFF_SIZE,BUFF_SIZE))
		{

			BYTE	byMINER[] = {0x68, 0x65, 0x6C, 0x6C, 0x6F, 0x38};
			boolean bCheck =  false;

			for(int i =0;i<0xF; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byMINER,sizeof(byMINER)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{
				if (CheckSigInBuffer(m_pSectionHeader[m_wAEPSec + 0x1].PointerToRawData,m_pSectionHeader[m_wAEPSec + 0x1].SizeOfRawData,_T("6D696E6572676174652E636F6D0000786D722E706F6F6C*786D7269672E636F6D*5C74656D705C78484867496D754F73614A6C7574433078483965447A2E68617368")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Miner.gen"));
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectLamerEL
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Lamer.EL
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectLamerEL()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if((m_wAEPSec == 0 && m_wNoOfSections == 0x4  && m_dwAEPMapped == 0x1FD4 && m_pSectionHeader[0].SizeOfRawData == 0x2D000 && memcmp(m_pSectionHeader[0].Name, "UPX0", 4) == 0)||
		(m_pMaxPEFile->m_bIsVBFile && m_wAEPSec == 0 && m_wNoOfSections == 0x3 && m_dwAEPMapped == 0x2BD4 && m_pSectionHeader[0].SizeOfRawData == 0x24000 &&  memcmp(m_pSectionHeader[0].Name, ".text", 5) == 0)) //added
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x20;
		m_pbyBuff = new BYTE[BUFF_SIZE];

		BYTE byLamer[] = {0x4B, 0x00, 0x61, 0x00, 0x76, 0x00, 0x55, 0x00, 0x70, 0x00, 0x64, 0x00, 0x61, 0x00, 0x2E, 0x00, 0x65, 0x00, 0x78, 0x00, 0x65};

		DWORD dwStartBuff = 0x0;
		DWORD dwStartBuff1 = 0x0;

		if(m_dwAEPMapped == 0x2BD4)
		{
			dwStartBuff = 0xB120;
			dwStartBuff1 = 0x9FA0;
		}
		else
		{
			dwStartBuff = 0xA520;
			dwStartBuff1 = 0x93A0;
		}

		if(GetBuffer (dwStartBuff, BUFF_SIZE, BUFF_SIZE))
		{ 
			boolean bCheck = false; 

			for(int i =0;i<0x20; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byLamer,sizeof(byLamer)) == 0))
				{

					bCheck = true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(dwStartBuff1,0xC0,_T("D4A2400000F030*DC9D4000949D4000E02B400078*494E4355425553*57696E557064617465")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.win32.Lamer.EL111"));

					return VIRUS_FILE_DELETE;
				}
			}

		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectChapakCNYR
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Chapak.CNYR
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectChapakCNYR()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x06 && m_dwAEPMapped == 0x67B && m_dwAEPUnmapped == 0x127B && m_wAEPSec == 0x00 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0xDA00 && (m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0xD9CF) && ((memcmp(m_pSectionHeader[m_wNoOfSections-5].Name, ".kl1", 7) == 0)))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int BUFF_SIZE = 0x0B;

		m_pbyBuff = new BYTE[BUFF_SIZE];

		if(!m_pbyBuff)
		{
			return iRetStatus;
		}

		if(GetBuffer(m_dwAEPUnmapped,BUFF_SIZE,BUFF_SIZE))
		{
			boolean bCheck = false; 
			BYTE byChapakChk[] = {0x45,0x0C,0xC7,0x40,0x24,0x01,0x00,0x00,0x00,0x33};

			for(DWORD i =0;i<BUFF_SIZE; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byChapakChk,sizeof(byChapakChk)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{

				if (CheckSigInBuffer(0xA2671,0x50,_T("7075626C69634B6579546F6B656E3D27*3635393562363431343463636631646627*206C616E6775616765203D2020202020*202020272A2720202F3E0D0A20202020")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Chapak.cnyr"));
					return VIRUS_FILE_DELETE;
				}
			}
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanFsysna
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Fsysna
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanFsysna()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x172C && m_dwAEPUnmapped == 0x172C && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x8000 &&m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x1000 && m_pSectionHeader[m_wAEPSec].Misc.VirtualSize == 0x7DF0)
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		int	BUFF_SIZE = 0x10;
		m_pbyBuff = new BYTE[BUFF_SIZE];


		if(GetBuffer(m_dwAEPMapped+0x1FEC,BUFF_SIZE,BUFF_SIZE))
		{
			boolean bCheck = false; 
			BYTE byFsysna[]  = {0x76,0x00,0x69,0x00,0x72,0x00,0x75,0x00,0x73,0x00};

			for(DWORD i =0;i<0x10; i++)
			{
				if((memcmp(&m_pbyBuff[i],&byFsysna,sizeof(byFsysna)) == 0))
				{
					bCheck =  true;
				}
			}
			if(bCheck)
			{		
				if (CheckSigInBuffer(0x35A4,0x200,_T("43003A005C003100320033002E0062006100740000*760069007200750073002000510051002000*36003200310033003700300039003000320000")))
				{
					_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Fsysna.fcpq"));
					return VIRUS_FILE_DELETE;
				}
			}
		}

	}

	return iRetStatus;

}

/*-------------------------------------------------------------------------------------
	Function		: DetectTrojanSlugin
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Trojan.Slugin
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectTrojanSlugin()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if(m_wNoOfSections == 0x5 && m_wAEPSec == 0x00 && m_dwAEPUnmapped == 0xDD33 &&
		m_pSectionHeader[m_wAEPSec].PointerToRawData == 0x01000 && 
		m_pSectionHeader[m_wAEPSec].VirtualAddress == 0x1000 &&
		(m_pSectionHeader[m_wAEPSec].SizeOfRawData == m_pSectionHeader[m_wAEPSec].Misc.VirtualSize + 0x7F6))
	{
		if(m_pbyBuff)
		{
			delete []m_pbyBuff;
			m_pbyBuff = NULL;
		}

		if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) != IMAGE_FILE_DLL )
			return iRetStatus;


		if (CheckSigInBuffer(0x14D18,0x100,_T("6D78312E686F746D61696C2E636F6D*6D78322E686F746D61696C2E636F6D*63766D6240686F746D61696C2E636F6D*7376303033407961686F6F2E636F6D*3130313030")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Trojan.Slugin.A"));

			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectSmallX
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Virus.Win32.Small.x
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectSmallX()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0X00 && m_wNoOfSections == 0x04  &&  m_dwAEPMapped == 0x400 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x400)
	{
		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[1].VirtualAddress == 0x2064 )

		{
			if (CheckSigInBuffer(m_dwAEPMapped + 0x458,0x500,_T("4D6573736167652E2E2E*436C6F736548616E646C65*726561746546696C6541*4578697450726F63657373*52746C46696C6C4D656D6F7279*52746C4D6F76654D656D6F7279*52746C556E77696E64*52746C5A65726F4D656D6F7279*566572536574436F6E646974696F6E4D61736B*2A2E2A")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.Small.X"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectVBkm
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Virus.Win32.VB.km 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBKM()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x03 && m_wNoOfSections == 0x04 &&  m_dwAEPMapped == 0x36060 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x0C7E && ((memcmp(m_pSectionHeader[m_wAEPSec].Name, "yC", 2) == 0)))
	{
		if(m_pMaxPEFile->m_stPEHeader.DataDirectory[1].VirtualAddress == 0x36000)

		{
			if (CheckSigInBuffer(0x224F0,0x50,_T("300031003000370000*30003100300037002E0065007800650000")))
			{
				_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.VB.km"));
				return VIRUS_FILE_DELETE;
			}
		}
	}

	return iRetStatus;
}
/*-------------------------------------------------------------------------------------
	Function		: DetectVBm
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Tushar Kadam + Aniket + Virus Analysis Team
	Description		: Detection routine for different varients : Virus.Win32.VB.M 
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBM()
{
	int iRetStatus = VIRUS_NOT_FOUND;

	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;

	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x03 &&  m_dwAEPMapped == 0x13F0 && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x4000)
	{
		if (CheckSigInBuffer(0x27EC,0x215,_T("43003A005C00770069006E0064006F00770073005C00530059005300540045004D00330032005C00520075006E006400310031002E0045005800450000*63003A005C006E002E0074007800740000*63003A005C0046004B006E006100740074006F002E0074007800740000*4600690072006900680065006E006B0075006C00680069002000280053006F006100730061006E0067006500290020004E006100740074006F002E0000*4B007500640061006B0075006400680069006E002000660061006C00680061002000280053006F006100730061006E0067006500290020004E006100740074006F0000")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.VB.m"));
			return VIRUS_FILE_DELETE;
		}
	}

	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectVBJW
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Sneha + Virus Analysis Team
	Description		: Detection routine for different varients : Virus.Win32.VB.jw
--------------------------------------------------------------------------------------*/
int CSemiPolyTrojans::DetectVBJW()
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_pMaxPEFile->m_stPEHeader.Characteristics & IMAGE_FILE_DLL) == IMAGE_FILE_DLL)
		return iRetStatus;
	if(m_pMaxPEFile->m_bIsVBFile == true && m_wAEPSec == 0x00 && m_wNoOfSections == 0x03 && m_dwAEPMapped == 0x18D8 && m_pSectionHeader[0x2].SizeOfRawData == 0x6000)
	{
		if (CheckSigInBuffer(0x7328,0xB8,_T("1875400004F9300000FFFFFF0800000001*E90000008873400054724000E41840*30382D322D3600726973696E67")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Virus.Win32.VB.jw"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

//Virus Patch 20 Nov 2019
/*-------------------------------------------------------------------------------------
	Function		: DetectBankerTricksterEKD
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Sagar + Virus Analysis Team
	Description		: Detection routine for different varients : Banker.Trickster.ekd
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectBankerTricksterEKD()	
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if(m_wAEPSec == 0x0 && m_wNoOfSections == 0x04 && m_dwAEPMapped == 0x572F && m_pSectionHeader[m_wAEPSec].SizeOfRawData == 0x5c00)		
	{
		if(CheckSigInBuffer(0x7c0,0x50,_T("2F750583CA3FEB06C1FA0283EE0285F67416*83EE088BDA8BCED3FB47885C07FF85F6*75EE8B4C241883C50483E901894C24180F")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Banker.Trickster.ekd"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}

/*-------------------------------------------------------------------------------------
	Function		: DetectBrontokN
	In Parameters	: 
	Out Parameters	: Status : VIRUS_NOT_FOUND or VIRUS_FILE_DELETE or VIRUS_FILE_REAPIR
	Purpose			: 
	Author			: Sagar + Virus Analysis Team
	Description		: Detection routine for different varients : Worm.Brontok.n
--------------------------------------------------------------------------------------*/
int	CSemiPolyTrojans::DetectBrontokN()	
{
	int iRetStatus = VIRUS_NOT_FOUND;
	if((m_wNoOfSections == 0x03 || m_wNoOfSections == 0x04)&&m_pSectionHeader[0].PointerToRawData == 0x1000 && m_pSectionHeader[0].Misc.VirtualSize >= 0x7000)		
	{
		if(CheckSigInBuffer(m_pSectionHeader[1].PointerToRawData + 0x1880,0x100,_T("53746F70204672656520536578*476F20546F2048454C4C")))
		{
			_tcscpy_s(m_szVirusName, MAX_VIRUS_NAME, _T("Worm.Brontok.n"));
			return VIRUS_FILE_DELETE;
		}
	}
	return iRetStatus;
}